{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/auth/login/face.js","webpack:///./app/Resources/static-src/app/js/auth/login/index.js"],"names":["Face","options","$element","element","$loginDom","$","init","bindEvent","closeModal","on","back","refresh","approveAgain","showQrcode","addClass","target","find","removeClass","ajax","type","url","data","dataType","success","console","log","attr","qrcode","onlyShow","token","pollStatus","self","goto","$failStatus","$successStatus","$failTip","$failBtn","hasClass","flag","get","res","status","setTimeout","statusShow","siblings","window","location","href","feedbackShow","$status","$show","$hide","$form","validator","validate","rules","_username","required","_password","keypress","e","which","trigger","preventDefault","click","event","form","currentTarget","button","submit","length"],"mappings":"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","file":"app/js/auth/login/index.js","sourcesContent":["export default class Face {\n  constructor(options) {\n    this.options = options;\n    this.$element = this.options.element;\n    this.$loginDom = $('.js-sts-login');\n    this.init();\n  }\n  init() {\n    this.bindEvent();\n    this.closeModal();\n  }\n\n  bindEvent() {\n    this.$loginDom.on('click', '.js-login-back', () => this.back());\n    this.$loginDom.on('click', '.js-invalid-btn', () => this.refresh());\n    this.$loginDom.on('click', '.js-approve-again-btn', () => this.approveAgain());\n    this.$element.on('click', '.js-sts-login-link', () => this.showQrcode());\n  }\n\n  back() {\n    $('.js-approve-ing, .js-feedback, .js-sts-login').addClass('hidden');\n    if (this.options.target) {\n      this.$element.find(this.options.target).removeClass('hidden');\n    } else {\n      this.$element.removeClass('hidden');\n    }\n  }\n\n  showQrcode() {\n    $.ajax({\n      type: 'post',\n      url: this.$loginDom.data('url'),\n      dataType: 'json',\n      success: (data) => {\n        console.log(data);\n        this.$loginDom.find('.js-sts-login-qrcode img').attr('src', data.qrcode);\n        this.onlyShow();\n        this.token = data.token;\n        this.pollStatus();\n      }\n    });\n  }\n\n  approveAgain() {\n    $('.js-feedback').addClass('hidden');\n    $('.js-login-section, .js-sts-tip').removeClass('hidden');\n    this.refresh();\n  }\n\n  refresh() {\n    $('.js-approve-ing').addClass('hidden');\n    this.showQrcode();\n  }\n\n  pollStatus() {\n    const self = this;\n    const token = this.token;\n    const goto = this.$loginDom.data('goto');\n    const $failStatus = $('.js-fail-feedback');\n    const $successStatus = $('.js-success-feedback');\n    const $failTip = $('.js-fail-tip');\n    const $failBtn = $('.js-approve-again-btn');\n    if (this.$loginDom.hasClass('hidden') || this.flag) {\n      return;\n    }\n    $.get(`/login/face_token/${token}`, { goto: goto }, (res) => {\n      switch (res.status) {\n      case 'created':\n        setTimeout(() => {\n          self.pollStatus();\n        }, 2000);\n        break;\n\n      case 'processing':\n        $('.js-invalid-btn').addClass('hidden');\n        $('.js-approve-ing, .js-approve-ing-tip').removeClass('hidden');\n        setTimeout(() => {\n          self.pollStatus();\n        }, 2000);\n        break;\n\n      case 'expired':\n        $('.js-approve-ing-tip').addClass('hidden');\n        $('.js-approve-ing, .js-invalid-btn').removeClass('hidden');\n        break;\n\n      case 'successed':\n        self.statusShow();\n        $successStatus.removeClass('hidden').siblings().addClass('hidden');\n        window.location.href = res.url;\n        break;\n\n      case 'failed':\n        self.feedbackShow($failStatus, $failBtn, $failTip);\n        break;\n\n      case 'failures':\n        self.feedbackShow($failStatus, $failTip, $failBtn);\n        break;\n      }\n    });\n  }\n\n  closeModal() {\n    $('#login-modal').on('hide.bs.modal', () => {\n      this.flag = true;\n    });\n  }\n\n  onlyShow() {\n    $('.js-sts-login, .js-login-section, .js-sts-tip').removeClass('hidden');\n    if (this.options.target) {\n      this.$element.find(this.options.target).addClass('hidden');\n    } else {\n      this.$element.addClass('hidden');\n    }\n  }\n\n  statusShow() {\n    $('.js-login-section, .js-sts-tip').addClass('hidden');\n    $('.js-feedback').removeClass('hidden');\n  }\n\n  feedbackShow($status, $show, $hide) {\n    this.statusShow();\n    $status.removeClass('hidden').siblings().addClass('hidden');\n    $show.removeClass('hidden');\n    $hide.addClass('hidden');\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/auth/login/face.js","import Face from './face';\n\nlet $form = $('#login-form');\nlet validator = $form.validate({\n  rules: {\n    _username: {\n      required: true,\n    },\n    _password: {\n      required: true,\n    }\n  }\n});\n$('#login-form').keypress(function (e) {\n  if (e.which == 13) {\n    $('.js-btn-login').trigger('click');\n    e.preventDefault(); // Stops enter from creating a new line\n  }\n});\n\n$('.js-btn-login').click((event) => {\n  if (validator.form()) {\n    $(event.currentTarget).button('loadding');\n    $form.submit();\n  }\n});\n\n$('.receive-modal').click();\n\n\nif ($('.js-sts-login-link').length) {\n  new Face({\n    element: $('.js-login-main'),\n  });\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/auth/login/index.js"],"sourceRoot":""}