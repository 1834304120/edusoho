{"version":3,"sources":["webpack:///external \"jQuery\"","webpack:///./app/Resources/static-src/common/es-webuploader.js","webpack:///./app/Resources/static-src/app/js/group/logo/index.js","webpack:///./app/Resources/static-src/common/fex-webuploader/Uploader.swf","webpack:///./app/Resources/static-src/common/fex-webuploader/webuploader.js"],"names":["EsWebUploader","option","self","config","fileSizeLimit","type","fileInput","title","Translator","trans","formData","accept","extensions","mimeTypes","uploader","fileVal","element","$","onFileQueued","onUploadSuccess","ele","WebUploader","create","swf","SWF_PATH","server","app","uploadUrl","pick","id","attr","multiple","extend","token","data","_csrf_token","auto","fileNumLimit","resize","compress","on","file","console","log","response","removeFile","cd","message","url","document","location","href","root","factory","modules","_require","deps","callback","args","len","i","getModule","length","push","apply","_define","arguments","setModule","module","exports","returned","undefined","Error","exportsTo","obj","key","host","parts","part","last","ucFirst","str","charAt","toUpperCase","substr","hasOwnProperty","split","pop","shift","makeExport","dollar","__dollar","origin","define","noConflict","window","require","jQuery","Zepto","_","Deferred","when","isPromise","anything","then","promise","noop","call","Function","uncurryThis","fn","bindFn","context","createObject","proto","f","prototype","version","browser","ua","ret","webkit","match","chrome","ie","firefox","safari","opera","parseFloat","navigator","userAgent","os","android","ios","replace","inherits","Super","protos","staticProtos","child","constructor","__super__","nextTick","cb","setTimeout","slice","guid","counter","prefix","Date","toString","Math","floor","random","formatSize","size","pointLength","units","unit","toFixed","Base","separator","findHandlers","arr","name","grep","handler","e","_cb","ctx","eachEvent","events","iterator","each","triggerHanders","stoped","ctx2","me","set","_events","once","off","trigger","allEvents","installTo","Mediator","Uploader","opts","options","_init","upload","stop","getFile","getFiles","addFile","addFiles","sort","cancelFile","skipFile","retry","isInProgress","makeThumb","md5File","getDimension","addButton","predictRuntimeType","refresh","disable","enable","reset","command","request","state","val","isPlainObject","getStats","stats","successNum","numOfSuccess","progressNum","numOfProgress","cancelNum","numOfCancel","invalidNum","numOfInvalid","uploadFailNum","numOfUploadFailed","queueNum","numOfQueue","interruptNum","numofInterrupt","substring","isFunction","concat","destroy","factories","getFirstKey","Runtime","container","body","uid","getContainer","parent","_container","createElement","css","position","top","left","width","height","overflow","append","addClass","_parent","init","exec","remove","removeClass","orders","addRuntime","hasRuntime","runtime","cache","add","get","ruid","standalone","__standalone","RuntimeClient","component","deferred","runtimeReady","done","connectRuntime","runtimeOrder","__promise","resolve","__client","getRuntime","disconnectRuntime","unshift","getRuid","RuntimeClent","DragAndDrop","disableGlobalDnd","_destroy","IGNORE","widgetClass","isArrayLike","nodeType","Widget","owner","invoke","apiName","map","responseMap","widgets","_widgets","deactives","disableWidgets","klass","indexOf","_name","rlts","dfds","widget","rlt","pipe","register","widgetProto","toLowerCase","unRegister","splice","Dnd","dnd","files","items","FilePaste","paste","Blob","source","ext","start","end","getSource","rExt","File","RegExp","$1","lastModifiedDate","toLocaleString","FilePicker","innerHTML","label","html","button","_refer","_resizeHandler","shimContainer","outerWidth","outerHeight","pos","offset","bottom","right","btn","pickers","addBtn","promises","picker","Image","_info","_meta","quality","crop","preserveHeaders","allowMagnify","info","meta","loadFromBlob","blob","getAsDataUrl","getAsBlob","throttle","max","occupied","waiting","tick","item","emiter","thumb","image","reason","beforeSendFile","compressSize","noCompressIfLarger","_compressed","always","reject","idPrefix","idSuffix","statusMap","gid","WUFile","statusText","Status","INITED","loaded","msg","setStatus","ERROR","status","text","prevStatus","getStatus","QUEUED","PROGRESS","COMPLETE","CANCELLED","INTERRUPT","INVALID","STATUS","Queue","numofDeleted","_queue","_map","_fileAdded","prepend","fileId","fetch","sts","inArray","existing","cur","pre","_onFileStatusChange","curStatus","preStatus","join","queue","placeholder","_ruid","_wrapFile","acceptFile","invalid","test","_addFile","fetchFile","noForceStart","sortFiles","support","Transport","_blob","_formData","_headers","headers","_timeout","clearTimeout","_timer","method","withCredentials","timeout","sendAsBinary","appendBlob","filename","value","setRequestHeader","send","abort","getResponse","getResponseAsJson","duration","prepareNextFile","chunked","chunkSize","chunkRetry","threads","CuteFile","pending","total","chunks","ceil","index","api","has","block","min","chunk","cuted","blocks","remaning","runing","progress","pool","stack","__tick","_tick","v","transport","_trigged","_promise","startUpload","stopUpload","interrupt","_putback","_popBlock","_tr","_getStats","skipped","_nextBlock","_startSend","idx","_getStack","act","next","preparing","_prepareNextFile","_finishFile","fail","_doSend","percentage","updateFileProgress","tr","requestAccept","_raw","flag","retried","hds","totalPercent","uploaded","validators","addValidator","removeValidator","count","parseInt","fileSingleSizeLimit","mapping","duplicate","hashString","hash","_char","charCodeAt","__hash","Md5","getResult","md5","notify","CompBase","components","Html5Runtime","comp","client","instance","FileReader","DataView","webkitSlice","mozSlice","elem","dragEnterHandler","_dragEnterHandler","dragOverHandler","_dragOverHandler","dragLeaveHandler","_dragLeaveHandler","dropHandler","_dropHandler","dndOver","denied","_denied","originalEvent","dataTransfer","dropEffect","parentElem","contains","currentTarget","_leaveTimer","getData","err","_getTansferFiles","results","canAccessFolder","webkitGetAsEntry","isDirectory","_traverseDirectoryTree","entry","isFile","createReader","readEntries","entries","hander","_pasteHander","allowed","clipboardData","kind","getAsFile","preventDefault","stopPropagation","input","mouseHandler","inputChange","opacity","display","cursor","background","clone","target","cloneNode","parentNode","replaceChild","urlAPI","createObjectURL","URL","revokeObjectURL","webkitURL","dataURL2Blob","dataURI","byteStr","intArray","ab","mimetype","atob","decodeURIComponent","ArrayBuffer","Uint8Array","arrayBufferToBlob","dataURL2ArrayBuffer","buffer","builder","BlobBuilder","WebKitBlobBuilder","bb","getBlob","canvasToDataUrl","canvas","toDataURL","parseMeta","updateImageHead","Util","parsers","maxMetaDataSize","parse","fr","onload","_parse","result","onerror","readAsArrayBuffer","noParse","byteLength","dataview","maxOffset","headLength","markerBytes","markerLength","getUint16","imageHead","subarray","head","buf1","buf2","bodyoffset","ImageMeta","EXIF","ExifMap","exifTagTypes","getValue","dataView","dataOffset","getUint8","String","fromCharCode","ascii","littleEndian","getUint32","getInt32","getExifValue","tiffOffset","tagType","tagSize","values","c","parseExifTag","tag","exif","parseExifTags","dirOffset","tagsNumber","dirEndOffset","parseExifData","JPEGEncoder","fround","round","ffloor","YTable","Array","UVTable","fdtbl_Y","fdtbl_UV","YDC_HT","UVDC_HT","YAC_HT","UVAC_HT","bitcode","category","outputfDCTQuant","DU","byteout","bytenew","bytepos","YDU","UDU","VDU","clt","RGB_YUV_TABLE","currentQuality","ZigZag","std_dc_luminance_nrcodes","std_dc_luminance_values","std_ac_luminance_nrcodes","std_ac_luminance_values","std_dc_chrominance_nrcodes","std_dc_chrominance_values","std_ac_chrominance_nrcodes","std_ac_chrominance_values","initQuantTables","sf","YQT","t","UVQT","j","u","aasf","k","row","col","computeHuffmanTbl","nrcodes","std_table","codevalue","pos_in_table","HT","initHuffmanTbl","initCategoryNumber","nrlower","nrupper","cat","nr","nrneg","initRGBYUVTable","writeBits","bs","posval","writeByte","writeWord","fDCTQuant","fdtbl","d0","d1","d2","d3","d4","d5","d6","d7","dataOff","I8","I64","tmp0","tmp7","tmp1","tmp6","tmp2","tmp5","tmp3","tmp4","tmp10","tmp13","tmp11","tmp12","z1","z5","z2","z4","z3","z11","z13","tmp0p2","tmp7p2","tmp1p2","tmp6p2","tmp2p2","tmp5p2","tmp3p2","tmp4p2","tmp10p2","tmp13p2","tmp11p2","tmp12p2","z1p2","z5p2","z2p2","z4p2","z3p2","z11p2","z13p2","writeAPP0","writeSOF0","writeDQT","writeDHT","l","m","n","o","p","writeSOS","processDU","CDU","DC","HTDC","HTAC","EOB","M16zeroes","I16","I63","DU_DCT","Diff","end0pos","lng","startpos","nrzeroes","nrmarker","initCharLookupTable","sfcc","encode","setQuality","DCY","DCU","DCV","displayName","imageData","quadWidth","tripleWidth","x","y","r","g","b","fillbits","jpegDataUri","btoa","encoder","supportJpeg","w","h","fragement","getContext","getImageData","BLANK","modified","img","_metas","error","_img","src","_canvas","_resize","s","cvs","iw","naturalWidth","ih","naturalHeight","orientation","getOrientation","_rotate2Orientaion","_renderImageToCanvas","clearRect","scale","translate","rotate","PI","drawImage","detectVerticalSquash","sy","ey","py","alpha","ratio","vertSquashRatio","detectSubsampling","subsampled","doSquash","d","dy","tmpCanvas","tmpCtx","dw","dh","sx","dx","save","restore","_status","_response","xhr","_initAjax","binary","param","FormData","open","_setRequestHeader","overrideMimeType","_parseJson","_xhr","onprogress","onreadystatechange","XMLHttpRequest","XDomainRequest","lengthComputable","readyState","responseText","json","JSON","ex","FlashRuntime","add32","a","cmn","q","ff","gg","hh","ii","md5cycle","md5blk","md5blks","md5blk_array","md51","tail","tmp","lo","hi","md51_array","hex_chr","rhex","hex","SparkMD5","lsw","msw","unescape","encodeURIComponent","appendBinary","contents","_buff","_length","_state","raw","buff","_finish","hashBinary","content","_concatArrayBuffer","first","second","firstLength","spark","blobSlice","loadNext","onloadend","getFlashVersion","plugins","description","ActiveXObject","GetVariable","ex2","clients","jsreciver","flashExec","evt","flash","getFlash","_flash","copy","_responseJson","forceURLStream","mimeType","percent","readBody","logUrl","product","hostname","base","dv","master","online","code","c_error_code","c_reason","c_count","c_size","c_usage","preset"],"mappings":"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","file":"app/js/group/logo/index.js","sourcesContent":["module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = app/js/main app/js/v2/demo/index app/js/activity-manage/doc/index app/js/activity-manage/download/index app/js/activity-manage/flash/index app/js/activity-manage/homework/index app/js/activity-manage/ppt/index app/js/activity-manage/video/index app/js/article/detail/index app/js/attachment/index app/js/auth/captcha-modal/index app/js/auth/password-reset/index app/js/auth/register/index app/js/batch-upload/index app/js/card/card-receive/index app/js/card/index/index app/js/cashier/index app/js/cashier/modal/index app/js/classroom-manage/set-picture/index app/js/classroom-manage/student-expiryday/index app/js/classroom-manage/student-import/index app/js/classroom-manage/students-create/index app/js/classroom-manage/students-manage/index app/js/classroom/buy-modal/index app/js/classroom/index app/js/classroom/thread-form/index app/js/classroom/thread-show/index app/js/coin/invite-code/index app/js/course-chapter-manage/index app/js/course-manage-file/index/index app/js/course-manage/batch-create/index app/js/course-manage/lesson-manage/default/index app/js/course-manage/lesson-manage/normal/index app/js/course-manage/live-replay/upload/index app/js/course-manage/overview/index app/js/course-manage/student-import/index app/js/course/buy-modal/index app/js/course/thread-show/index app/js/courseset/show/index app/js/exporter/index app/js/group/index app/js/group/logo/index app/js/group/thread-add/index app/js/live-course/explore/index app/js/material-lib/index/index app/js/material-lib/share-history/index app/js/media-manage/index app/js/activity-manage/audio/index app/js/mobile-bind/index app/js/my/order-refund-apply/index app/js/my/order-refund/index app/js/my/order/index app/js/oauth2/create/index app/js/open-course-manage/add-material/index app/js/open-course-manage/lesson-modal/index app/js/open-course/index app/js/open-course/member-sms/index app/js/order/coupon-item/index app/js/order/create-sms/index app/js/order/create/index app/js/pay/select/index app/js/pay/show-mobile-modal/index app/js/player/index app/js/question-manage/form/index app/js/review/list/index app/js/search/index app/js/settings/avatar-crop-modal/index app/js/settings/bind-mobile/index app/js/settings/email/index app/js/settings/find_pay_password_by_sms/index app/js/settings/find-pay-password/index app/js/settings/password/index app/js/settings/pay-password-modal/index app/js/settings/pay-password/index app/js/settings/profile/index app/js/settings/reset-pay-password/index app/js/settings/security-questions/index app/js/settings/security/index app/js/settings/setup-password/index app/js/settings/setup/index app/js/settings/update-pay-password/index app/js/settings/user-profile/index app/js/subject/index app/js/task-manage/create/index app/js/task/plugin/note/index app/js/task/plugin/question/index app/js/testpaper-manage/create/index app/js/testpaper-manage/index app/js/testpaper-manage/questions/index app/js/testpaper/do-test/exercise/index app/js/testpaper/do-test/normal/index app/js/testpaper/result/index app/js/thread/user-info-modal/index app/js/user/fill-info/index app/js/message/show/index","import WebUploader from './fex-webuploader/webuploader.js';\nimport SWF_PATH from './fex-webuploader/Uploader.swf';\n\nclass EsWebUploader {\n  constructor(option) {\n    let self = this;\n    let config = Object.assign({}, {\n      fileSizeLimit: 2 * 1024 * 1024,\n      type: '',\n      fileInput: '',\n      title: Translator.trans('uploader.title'),\n      formData: {},\n      accept: {\n        title: 'Images',\n        extensions: 'gif,jpg,jpeg,png,ico',\n        mimeTypes: 'image/png,image/jpg,image/jpeg,imge/bmp,image/gif'\n      },\n      uploader: null,\n      fileVal: 'file',\n      element: $(option.element)\n    }, option);\n\n    this.onFileQueued = config.onFileQueued || this.onFileQueued;\n    this.onUploadSuccess = config.onUploadSuccess || this.onUploadSuccess;\n\n    let ele = $(config.element);\n    let uploader = WebUploader.create({\n      swf: SWF_PATH,\n      server: app.uploadUrl, // 配置参见script_boot.html.twig\n      pick: {\n        id: '#' + ele.attr('id'),\n        multiple: false\n      },\n      formData: $.extend(config.formData, {\n        token: ele.data('uploadToken'),\n        _csrf_token: $('meta[name=csrf-token]').attr('content')\n      }),\n      accept: config.accept,\n      auto: true,\n      fileNumLimit: 1,\n      fileSizeLimit: config.fileSizeLimit,\n      resize: false,\n      compress: false\n    });\n\n    uploader.on('fileQueued', function(file) {\n      console.log('fileQueued :', file);\n      self.onFileQueued(file);\n    });\n\n    uploader.on('uploadSuccess', function(file, response) {\n      console.log('uploadSuccess: ', file, response);\n      self.onUploadSuccess(file, response);\n      uploader.removeFile(file, true);\n    });\n    uploader.on('uploadError', function(file, response) {\n      console.log('uploadError : ', file, response);\n      cd.message({type: 'danger', message: Translator.trans('uploader.error_hint')});\n    });\n\n    uploader.on('error', function(type) {\n      console.log('error : ', type);\n      switch (type) {\n      case 'Q_EXCEED_SIZE_LIMIT':\n        cd.message({type: 'danger', message: Translator.trans('uploader.size_limit_hint')});\n        break;\n      case 'Q_EXCEED_NUM_LIMIT':\n        cd.message({type: 'danger', message: Translator.trans('uploader.num_limit_hint')});\n        break;\n      case 'Q_TYPE_DENIED':\n        cd.message({type: 'danger', message: Translator.trans('uploader.type_denied_limit_hint')});\n        break;\n      default:\n        break;\n      }\n    });\n  }\n\n  onFileQueued() {\n    //override it if you need\n  }\n\n  onUploadSuccess() {\n    //override it if you need\n  }\n}\n\nexport default EsWebUploader;\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/common/es-webuploader.js","import EsWebUploader from 'common/es-webuploader.js';\nimport notify from 'common/notify';\n\nnew EsWebUploader({\n  element: '#group-save-btn',\n  onUploadSuccess: function(file, response) {\n    let url = $('#group-save-btn').data('gotoUrl');\n    notify('success', Translator.trans('site.upload_success_hint'));\n    document.location.href = url;\n  }\n});\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/group/logo/index.js","module.exports = __webpack_public_path__ + \"app/media/Uploader.swf\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./app/Resources/static-src/common/fex-webuploader/Uploader.swf\n// module id = a3b7dceb380ae7ceeae3\n// module chunks = app/js/classroom-manage/set-picture/index app/js/classroom/thread-form/index app/js/group/logo/index app/js/settings/user-profile/index","\n/*! WebUploader 0.1.5 */\n\n\n/**\n * @fileOverview 让内部各个部件的代码可以用[amd](https://github.com/amdjs/amdjs-api/wiki/AMD)模块定义方式组织起来。\n *\n * AMD API 内部的简单不完全实现，请忽略。只有当WebUploader被合并成一个文件的时候才会引入。\n */\n/**\n  * rewrite malianbo@howzhi.com\n  * https://github.com/fex-team/webuploader 这里提供的实现，存在arguments.callee这样的代码，由于上述代码已被ES5废弃，Babel使用严格模式编译时会出错。\n  * 参见：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/arguments/callee\n  *\n  */\n(function( root, factory ) {\n  var modules = {},\n\n    // 内部require, 简单不完全实现。\n    // https://github.com/amdjs/amdjs-api/wiki/require\n    _require = function( deps, callback ) {\n      var args, len, i;\n\n      // 如果deps不是数组，则直接返回指定module\n      if ( typeof deps === 'string' ) {\n        return getModule( deps );\n      } else {\n        args = [];\n        for( len = deps.length, i = 0; i < len; i++ ) {\n          args.push( getModule( deps[ i ] ) );\n        }\n\n        return callback.apply( null, args );\n      }\n    },\n\n    // 内部define，暂时不支持不指定id.\n    _define = function( id, deps, factory ) {\n      if ( arguments.length === 2 ) {\n        factory = deps;\n        deps = null;\n      }\n\n      _require( deps || [], function() {\n        setModule( id, factory, arguments );\n      });\n    },\n\n    // 设置module, 兼容CommonJs写法。\n    setModule = function( id, factory, args ) {\n      var module = {\n          exports: factory\n        },\n        returned;\n\n      if ( typeof factory === 'function' ) {\n        args.length || (args = [ _require, module.exports, module ]);\n        returned = factory.apply( null, args );\n        returned !== undefined && (module.exports = returned);\n      }\n\n      modules[ id ] = module.exports;\n    },\n\n    // 根据id获取module\n    getModule = function( id ) {\n      var module = modules[ id ] || root[ id ];\n\n      if ( !module ) {\n        throw new Error( '`' + id + '` is undefined' );\n      }\n\n      return module;\n    },\n\n    // 将所有modules，将路径ids装换成对象。\n    exportsTo = function( obj ) {\n      var key, host, parts, part, last, ucFirst;\n\n      // make the first character upper case.\n      ucFirst = function( str ) {\n        return str && (str.charAt( 0 ).toUpperCase() + str.substr( 1 ));\n      };\n\n      for ( key in modules ) {\n        host = obj;\n\n        if ( !modules.hasOwnProperty( key ) ) {\n          continue;\n        }\n\n        parts = key.split('/');\n        last = ucFirst( parts.pop() );\n\n        while( (part = ucFirst( parts.shift() )) ) {\n          host[ part ] = host[ part ] || {};\n          host = host[ part ];\n        }\n\n        host[ last ] = modules[ key ];\n      }\n\n      return obj;\n    },\n\n    makeExport = function( dollar ) {\n      root.__dollar = dollar;\n\n      // exports every module.\n      return exportsTo( factory( root, _define, _require ) );\n    },\n\n    origin;\n\n  if ( typeof module === 'object' && typeof module.exports === 'object' ) {\n\n    // For CommonJS and CommonJS-like environments where a proper window is present,\n    module.exports = makeExport();\n  } else if ( typeof define === 'function' && define.amd ) {\n\n    // Allow using this built library as an AMD module\n    // in another project. That other project will only\n    // see this AMD call, not the internal modules in\n    // the closure below.\n    define([ 'jquery' ], makeExport );\n  } else {\n\n    // Browser globals case. Just assign the\n    // result to a property on the global.\n    origin = root.WebUploader;\n    root.WebUploader = makeExport();\n    root.WebUploader.noConflict = function() {\n      root.WebUploader = origin;\n    };\n  }\n})( window, function( window, define, require ) {\n\n\n  /**\n     * @fileOverview jQuery or Zepto\n     */\n  define('dollar-third',[],function() {\n    var $ = window.__dollar || window.jQuery || window.Zepto;\n    \n    if ( !$ ) {\n      throw new Error('jQuery or Zepto not found!');\n    }\n    \n    return $;\n  });\n  /**\n     * @fileOverview Dom 操作相关\n     */\n  define('dollar',[\n    'dollar-third'\n  ], function( _ ) {\n    return _;\n  });\n  /**\n     * @fileOverview 使用jQuery的Promise\n     */\n  define('promise-third',[\n    'dollar'\n  ], function( $ ) {\n    return {\n      Deferred: $.Deferred,\n      when: $.when,\n    \n      isPromise: function( anything ) {\n        return anything && typeof anything.then === 'function';\n      }\n    };\n  });\n  /**\n     * @fileOverview Promise/A+\n     */\n  define('promise',[\n    'promise-third'\n  ], function( _ ) {\n    return _;\n  });\n  /**\n     * @fileOverview 基础类方法。\n     */\n    \n  /**\n     * Web Uploader内部类的详细说明，以下提及的功能类，都可以在`WebUploader`这个变量中访问到。\n     *\n     * As you know, Web Uploader的每个文件都是用过[AMD](https://github.com/amdjs/amdjs-api/wiki/AMD)规范中的`define`组织起来的, 每个Module都会有个module id.\n     * 默认module id为该文件的路径，而此路径将会转化成名字空间存放在WebUploader中。如：\n     *\n     * * module `base`：WebUploader.Base\n     * * module `file`: WebUploader.File\n     * * module `lib/dnd`: WebUploader.Lib.Dnd\n     * * module `runtime/html5/dnd`: WebUploader.Runtime.Html5.Dnd\n     *\n     *\n     * 以下文档中对类的使用可能省略掉了`WebUploader`前缀。\n     * @module WebUploader\n     * @title WebUploader API文档\n     */\n  define('base',[\n    'dollar',\n    'promise'\n  ], function( $, promise ) {\n    \n    var noop = function() {},\n      call = Function.call;\n    \n    // http://jsperf.com/uncurrythis\n    // 反科里化\n    function uncurryThis( fn ) {\n      return function() {\n        return call.apply( fn, arguments );\n      };\n    }\n    \n    function bindFn( fn, context ) {\n      return function() {\n        return fn.apply( context, arguments );\n      };\n    }\n    \n    function createObject( proto ) {\n      var f;\n    \n      if ( Object.create ) {\n        return Object.create( proto );\n      } else {\n        f = function() {};\n        f.prototype = proto;\n        return new f();\n      }\n    }\n    \n    \n    /**\n         * 基础类，提供一些简单常用的方法。\n         * @class Base\n         */\n    return {\n    \n      /**\n             * @property {String} version 当前版本号。\n             */\n      version: '0.1.5',\n    \n      /**\n             * @property {jQuery|Zepto} $ 引用依赖的jQuery或者Zepto对象。\n             */\n      $: $,\n    \n      Deferred: promise.Deferred,\n    \n      isPromise: promise.isPromise,\n    \n      when: promise.when,\n    \n      /**\n             * @description  简单的浏览器检查结果。\n             *\n             * * `webkit`  webkit版本号，如果浏览器为非webkit内核，此属性为`undefined`。\n             * * `chrome`  chrome浏览器版本号，如果浏览器为chrome，此属性为`undefined`。\n             * * `ie`  ie浏览器版本号，如果浏览器为非ie，此属性为`undefined`。**暂不支持ie10+**\n             * * `firefox`  firefox浏览器版本号，如果浏览器为非firefox，此属性为`undefined`。\n             * * `safari`  safari浏览器版本号，如果浏览器为非safari，此属性为`undefined`。\n             * * `opera`  opera浏览器版本号，如果浏览器为非opera，此属性为`undefined`。\n             *\n             * @property {Object} [browser]\n             */\n      browser: (function( ua ) {\n        var ret = {},\n          webkit = ua.match( /WebKit\\/([\\d.]+)/ ),\n          chrome = ua.match( /Chrome\\/([\\d.]+)/ ) ||\n                        ua.match( /CriOS\\/([\\d.]+)/ ),\n    \n          ie = ua.match( /MSIE\\s([\\d\\.]+)/ ) ||\n                        ua.match( /(?:trident)(?:.*rv:([\\w.]+))?/i ),\n          firefox = ua.match( /Firefox\\/([\\d.]+)/ ),\n          safari = ua.match( /Safari\\/([\\d.]+)/ ),\n          opera = ua.match( /OPR\\/([\\d.]+)/ );\n    \n        webkit && (ret.webkit = parseFloat( webkit[ 1 ] ));\n        chrome && (ret.chrome = parseFloat( chrome[ 1 ] ));\n        ie && (ret.ie = parseFloat( ie[ 1 ] ));\n        firefox && (ret.firefox = parseFloat( firefox[ 1 ] ));\n        safari && (ret.safari = parseFloat( safari[ 1 ] ));\n        opera && (ret.opera = parseFloat( opera[ 1 ] ));\n    \n        return ret;\n      })( navigator.userAgent ),\n    \n      /**\n             * @description  操作系统检查结果。\n             *\n             * * `android`  如果在android浏览器环境下，此值为对应的android版本号，否则为`undefined`。\n             * * `ios` 如果在ios浏览器环境下，此值为对应的ios版本号，否则为`undefined`。\n             * @property {Object} [os]\n             */\n      os: (function( ua ) {\n        var ret = {},\n    \n          // osx = !!ua.match( /\\(Macintosh\\; Intel / ),\n          android = ua.match( /(?:Android);?[\\s\\/]+([\\d.]+)?/ ),\n          ios = ua.match( /(?:iPad|iPod|iPhone).*OS\\s([\\d_]+)/ );\n    \n        // osx && (ret.osx = true);\n        android && (ret.android = parseFloat( android[ 1 ] ));\n        ios && (ret.ios = parseFloat( ios[ 1 ].replace( /_/g, '.' ) ));\n    \n        return ret;\n      })( navigator.userAgent ),\n    \n      /**\n             * 实现类与类之间的继承。\n             * @method inherits\n             * @grammar Base.inherits( super ) => child\n             * @grammar Base.inherits( super, protos ) => child\n             * @grammar Base.inherits( super, protos, statics ) => child\n             * @param  {Class} super 父类\n             * @param  {Object | Function} [protos] 子类或者对象。如果对象中包含constructor，子类将是用此属性值。\n             * @param  {Function} [protos.constructor] 子类构造器，不指定的话将创建个临时的直接执行父类构造器的方法。\n             * @param  {Object} [statics] 静态属性或方法。\n             * @return {Class} 返回子类。\n             * @example\n             * function Person() {\n             *     console.log( 'Super' );\n             * }\n             * Person.prototype.hello = function() {\n             *     console.log( 'hello' );\n             * };\n             *\n             * var Manager = Base.inherits( Person, {\n             *     world: function() {\n             *         console.log( 'World' );\n             *     }\n             * });\n             *\n             * // 因为没有指定构造器，父类的构造器将会执行。\n             * var instance = new Manager();    // => Super\n             *\n             * // 继承子父类的方法\n             * instance.hello();    // => hello\n             * instance.world();    // => World\n             *\n             * // 子类的__super__属性指向父类\n             * console.log( Manager.__super__ === Person );    // => true\n             */\n      inherits: function( Super, protos, staticProtos ) {\n        var child;\n    \n        if ( typeof protos === 'function' ) {\n          child = protos;\n          protos = null;\n        } else if ( protos && protos.hasOwnProperty('constructor') ) {\n          child = protos.constructor;\n        } else {\n          child = function() {\n            return Super.apply( this, arguments );\n          };\n        }\n    \n        // 复制静态方法\n        $.extend( true, child, Super, staticProtos || {} );\n    \n        /* jshint camelcase: false */\n    \n        // 让子类的__super__属性指向父类。\n        child.__super__ = Super.prototype;\n    \n        // 构建原型，添加原型方法或属性。\n        // 暂时用Object.create实现。\n        child.prototype = createObject( Super.prototype );\n        protos && $.extend( true, child.prototype, protos );\n    \n        return child;\n      },\n    \n      /**\n             * 一个不做任何事情的方法。可以用来赋值给默认的callback.\n             * @method noop\n             */\n      noop: noop,\n    \n      /**\n             * 返回一个新的方法，此方法将已指定的`context`来执行。\n             * @grammar Base.bindFn( fn, context ) => Function\n             * @method bindFn\n             * @example\n             * var doSomething = function() {\n             *         console.log( this.name );\n             *     },\n             *     obj = {\n             *         name: 'Object Name'\n             *     },\n             *     aliasFn = Base.bind( doSomething, obj );\n             *\n             *  aliasFn();    // => Object Name\n             *\n             */\n      bindFn: bindFn,\n    \n      /**\n             * 引用Console.log如果存在的话，否则引用一个[空函数noop](#WebUploader:Base.noop)。\n             * @grammar Base.log( args... ) => undefined\n             * @method log\n             */\n      log: (function() {\n        if ( window.console ) {\n          return bindFn( console.log, console );\n        }\n        return noop;\n      })(),\n    \n      nextTick: (function() {\n    \n        return function( cb ) {\n          setTimeout( cb, 1 );\n        };\n    \n        // @bug 当浏览器不在当前窗口时就停了。\n        // var next = window.requestAnimationFrame ||\n        //     window.webkitRequestAnimationFrame ||\n        //     window.mozRequestAnimationFrame ||\n        //     function( cb ) {\n        //         window.setTimeout( cb, 1000 / 60 );\n        //     };\n    \n        // // fix: Uncaught TypeError: Illegal invocation\n        // return bindFn( next, window );\n      })(),\n    \n      /**\n             * 被[uncurrythis](http://www.2ality.com/2011/11/uncurrying-this.html)的数组slice方法。\n             * 将用来将非数组对象转化成数组对象。\n             * @grammar Base.slice( target, start[, end] ) => Array\n             * @method slice\n             * @example\n             * function doSomthing() {\n             *     var args = Base.slice( arguments, 1 );\n             *     console.log( args );\n             * }\n             *\n             * doSomthing( 'ignored', 'arg2', 'arg3' );    // => Array [\"arg2\", \"arg3\"]\n             */\n      slice: uncurryThis( [].slice ),\n    \n      /**\n             * 生成唯一的ID\n             * @method guid\n             * @grammar Base.guid() => String\n             * @grammar Base.guid( prefx ) => String\n             */\n      guid: (function() {\n        var counter = 0;\n    \n        return function( prefix ) {\n          var guid = (+new Date()).toString( 32 ),\n            i = 0;\n    \n          for ( ; i < 5; i++ ) {\n            guid += Math.floor( Math.random() * 65535 ).toString( 32 );\n          }\n    \n          return (prefix || 'wu_') + guid + (counter++).toString( 32 );\n        };\n      })(),\n    \n      /**\n             * 格式化文件大小, 输出成带单位的字符串\n             * @method formatSize\n             * @grammar Base.formatSize( size ) => String\n             * @grammar Base.formatSize( size, pointLength ) => String\n             * @grammar Base.formatSize( size, pointLength, units ) => String\n             * @param {Number} size 文件大小\n             * @param {Number} [pointLength=2] 精确到的小数点数。\n             * @param {Array} [units=[ 'B', 'K', 'M', 'G', 'TB' ]] 单位数组。从字节，到千字节，一直往上指定。如果单位数组里面只指定了到了K(千字节)，同时文件大小大于M, 此方法的输出将还是显示成多少K.\n             * @example\n             * console.log( Base.formatSize( 100 ) );    // => 100B\n             * console.log( Base.formatSize( 1024 ) );    // => 1.00K\n             * console.log( Base.formatSize( 1024, 0 ) );    // => 1K\n             * console.log( Base.formatSize( 1024 * 1024 ) );    // => 1.00M\n             * console.log( Base.formatSize( 1024 * 1024 * 1024 ) );    // => 1.00G\n             * console.log( Base.formatSize( 1024 * 1024 * 1024, 0, ['B', 'KB', 'MB'] ) );    // => 1024MB\n             */\n      formatSize: function( size, pointLength, units ) {\n        var unit;\n    \n        units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\n    \n        while ( (unit = units.shift()) && size > 1024 ) {\n          size = size / 1024;\n        }\n    \n        return (unit === 'B' ? size : size.toFixed( pointLength || 2 )) +\n                        unit;\n      }\n    };\n  });\n  /**\n     * 事件处理类，可以独立使用，也可以扩展给对象使用。\n     * @fileOverview Mediator\n     */\n  define('mediator',[\n    'base'\n  ], function( Base ) {\n    var $ = Base.$,\n      slice = [].slice,\n      separator = /\\s+/,\n      protos;\n    \n    // 根据条件过滤出事件handlers.\n    function findHandlers( arr, name, callback, context ) {\n      return $.grep( arr, function( handler ) {\n        return handler &&\n                        (!name || handler.e === name) &&\n                        (!callback || handler.cb === callback ||\n                        handler.cb._cb === callback) &&\n                        (!context || handler.ctx === context);\n      });\n    }\n    \n    function eachEvent( events, callback, iterator ) {\n      // 不支持对象，只支持多个event用空格隔开\n      $.each( (events || '').split( separator ), function( _, key ) {\n        iterator( key, callback );\n      });\n    }\n    \n    function triggerHanders( events, args ) {\n      var stoped = false,\n        i = -1,\n        len = events.length,\n        handler;\n    \n      while ( ++i < len ) {\n        handler = events[ i ];\n    \n        if ( handler.cb.apply( handler.ctx2, args ) === false ) {\n          stoped = true;\n          break;\n        }\n      }\n    \n      return !stoped;\n    }\n    \n    protos = {\n    \n      /**\n             * 绑定事件。\n             *\n             * `callback`方法在执行时，arguments将会来源于trigger的时候携带的参数。如\n             * ```javascript\n             * var obj = {};\n             *\n             * // 使得obj有事件行为\n             * Mediator.installTo( obj );\n             *\n             * obj.on( 'testa', function( arg1, arg2 ) {\n             *     console.log( arg1, arg2 ); // => 'arg1', 'arg2'\n             * });\n             *\n             * obj.trigger( 'testa', 'arg1', 'arg2' );\n             * ```\n             *\n             * 如果`callback`中，某一个方法`return false`了，则后续的其他`callback`都不会被执行到。\n             * 切会影响到`trigger`方法的返回值，为`false`。\n             *\n             * `on`还可以用来添加一个特殊事件`all`, 这样所有的事件触发都会响应到。同时此类`callback`中的arguments有一个不同处，\n             * 就是第一个参数为`type`，记录当前是什么事件在触发。此类`callback`的优先级比脚低，会再正常`callback`执行完后触发。\n             * ```javascript\n             * obj.on( 'all', function( type, arg1, arg2 ) {\n             *     console.log( type, arg1, arg2 ); // => 'testa', 'arg1', 'arg2'\n             * });\n             * ```\n             *\n             * @method on\n             * @grammar on( name, callback[, context] ) => self\n             * @param  {String}   name     事件名，支持多个事件用空格隔开\n             * @param  {Function} callback 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             * @class Mediator\n             */\n      on: function( name, callback, context ) {\n        var me = this,\n          set;\n    \n        if ( !callback ) {\n          return this;\n        }\n    \n        set = this._events || (this._events = []);\n    \n        eachEvent( name, callback, function( name, callback ) {\n          var handler = { e: name };\n    \n          handler.cb = callback;\n          handler.ctx = context;\n          handler.ctx2 = context || me;\n          handler.id = set.length;\n    \n          set.push( handler );\n        });\n    \n        return this;\n      },\n    \n      /**\n             * 绑定事件，且当handler执行完后，自动解除绑定。\n             * @method once\n             * @grammar once( name, callback[, context] ) => self\n             * @param  {String}   name     事件名\n             * @param  {Function} callback 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             */\n      once: function( name, callback, context ) {\n        var me = this;\n    \n        if ( !callback ) {\n          return me;\n        }\n    \n        eachEvent( name, callback, function( name, callback ) {\n          var once = function() {\n            me.off( name, once );\n            return callback.apply( context || me, arguments );\n          };\n    \n          once._cb = callback;\n          me.on( name, once, context );\n        });\n    \n        return me;\n      },\n    \n      /**\n             * 解除事件绑定\n             * @method off\n             * @grammar off( [name[, callback[, context] ] ] ) => self\n             * @param  {String}   [name]     事件名\n             * @param  {Function} [callback] 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             */\n      off: function( name, cb, ctx ) {\n        var events = this._events;\n    \n        if ( !events ) {\n          return this;\n        }\n    \n        if ( !name && !cb && !ctx ) {\n          this._events = [];\n          return this;\n        }\n    \n        eachEvent( name, cb, function( name, cb ) {\n          $.each( findHandlers( events, name, cb, ctx ), function() {\n            delete events[ this.id ];\n          });\n        });\n    \n        return this;\n      },\n    \n      /**\n             * 触发事件\n             * @method trigger\n             * @grammar trigger( name[, args...] ) => self\n             * @param  {String}   type     事件名\n             * @param  {*} [...] 任意参数\n             * @return {Boolean} 如果handler中return false了，则返回false, 否则返回true\n             */\n      trigger: function( type ) {\n        var args, events, allEvents;\n    \n        if ( !this._events || !type ) {\n          return this;\n        }\n    \n        args = slice.call( arguments, 1 );\n        events = findHandlers( this._events, type );\n        allEvents = findHandlers( this._events, 'all' );\n    \n        return triggerHanders( events, args ) &&\n                        triggerHanders( allEvents, arguments );\n      }\n    };\n    \n    /**\n         * 中介者，它本身是个单例，但可以通过[installTo](#WebUploader:Mediator:installTo)方法，使任何对象具备事件行为。\n         * 主要目的是负责模块与模块之间的合作，降低耦合度。\n         *\n         * @class Mediator\n         */\n    return $.extend({\n    \n      /**\n             * 可以通过这个接口，使任何对象具备事件功能。\n             * @method installTo\n             * @param  {Object} obj 需要具备事件行为的对象。\n             * @return {Object} 返回obj.\n             */\n      installTo: function( obj ) {\n        return $.extend( obj, protos );\n      }\n    \n    }, protos );\n  });\n  /**\n     * @fileOverview Uploader上传类\n     */\n  define('uploader',[\n    'base',\n    'mediator'\n  ], function( Base, Mediator ) {\n    \n    var $ = Base.$;\n    \n    /**\n         * 上传入口类。\n         * @class Uploader\n         * @constructor\n         * @grammar new Uploader( opts ) => Uploader\n         * @example\n         * var uploader = WebUploader.Uploader({\n         *     swf: 'path_of_swf/Uploader.swf',\n         *\n         *     // 开起分片上传。\n         *     chunked: true\n         * });\n         */\n    function Uploader( opts ) {\n      this.options = $.extend( true, {}, Uploader.options, opts );\n      this._init( this.options );\n    }\n    \n    // default Options\n    // widgets中有相应扩展\n    Uploader.options = {};\n    Mediator.installTo( Uploader.prototype );\n    \n    // 批量添加纯命令式方法。\n    $.each({\n      upload: 'start-upload',\n      stop: 'stop-upload',\n      getFile: 'get-file',\n      getFiles: 'get-files',\n      addFile: 'add-file',\n      addFiles: 'add-file',\n      sort: 'sort-files',\n      removeFile: 'remove-file',\n      cancelFile: 'cancel-file',\n      skipFile: 'skip-file',\n      retry: 'retry',\n      isInProgress: 'is-in-progress',\n      makeThumb: 'make-thumb',\n      md5File: 'md5-file',\n      getDimension: 'get-dimension',\n      addButton: 'add-btn',\n      predictRuntimeType: 'predict-runtime-type',\n      refresh: 'refresh',\n      disable: 'disable',\n      enable: 'enable',\n      reset: 'reset'\n    }, function( fn, command ) {\n      Uploader.prototype[ fn ] = function() {\n        return this.request( command, arguments );\n      };\n    });\n    \n    $.extend( Uploader.prototype, {\n      state: 'pending',\n    \n      _init: function( opts ) {\n        var me = this;\n    \n        me.request( 'init', opts, function() {\n          me.state = 'ready';\n          me.trigger('ready');\n        });\n      },\n    \n      /**\n             * 获取或者设置Uploader配置项。\n             * @method option\n             * @grammar option( key ) => *\n             * @grammar option( key, val ) => self\n             * @example\n             *\n             * // 初始状态图片上传前不会压缩\n             * var uploader = new WebUploader.Uploader({\n             *     compress: null;\n             * });\n             *\n             * // 修改后图片上传前，尝试将图片压缩到1600 * 1600\n             * uploader.option( 'compress', {\n             *     width: 1600,\n             *     height: 1600\n             * });\n             */\n      option: function( key, val ) {\n        var opts = this.options;\n    \n        // setter\n        if ( arguments.length > 1 ) {\n    \n          if ( $.isPlainObject( val ) &&\n                            $.isPlainObject( opts[ key ] ) ) {\n            $.extend( opts[ key ], val );\n          } else {\n            opts[ key ] = val;\n          }\n    \n        } else {    // getter\n          return key ? opts[ key ] : opts;\n        }\n      },\n    \n      /**\n             * 获取文件统计信息。返回一个包含一下信息的对象。\n             * * `successNum` 上传成功的文件数\n             * * `progressNum` 上传中的文件数\n             * * `cancelNum` 被删除的文件数\n             * * `invalidNum` 无效的文件数\n             * * `uploadFailNum` 上传失败的文件数\n             * * `queueNum` 还在队列中的文件数\n             * * `interruptNum` 被暂停的文件数\n             * @method getStats\n             * @grammar getStats() => Object\n             */\n      getStats: function() {\n        // return this._mgr.getStats.apply( this._mgr, arguments );\n        var stats = this.request('get-stats');\n    \n        return stats ? {\n          successNum: stats.numOfSuccess,\n          progressNum: stats.numOfProgress,\n    \n          // who care?\n          // queueFailNum: 0,\n          cancelNum: stats.numOfCancel,\n          invalidNum: stats.numOfInvalid,\n          uploadFailNum: stats.numOfUploadFailed,\n          queueNum: stats.numOfQueue,\n          interruptNum: stats.numofInterrupt\n        } : {};\n      },\n    \n      // 需要重写此方法来来支持opts.onEvent和instance.onEvent的处理器\n      trigger: function( type/*, args...*/ ) {\n        var args = [].slice.call( arguments, 1 ),\n          opts = this.options,\n          name = 'on' + type.substring( 0, 1 ).toUpperCase() +\n                        type.substring( 1 );\n    \n        if (\n        // 调用通过on方法注册的handler.\n          Mediator.trigger.apply( this, arguments ) === false ||\n    \n                        // 调用opts.onEvent\n                        $.isFunction( opts[ name ] ) &&\n                        opts[ name ].apply( this, args ) === false ||\n    \n                        // 调用this.onEvent\n                        $.isFunction( this[ name ] ) &&\n                        this[ name ].apply( this, args ) === false ||\n    \n                        // 广播所有uploader的事件。\n                        Mediator.trigger.apply( Mediator,\n                        \t[ this, type ].concat( args ) ) === false ) {\n    \n          return false;\n        }\n    \n        return true;\n      },\n    \n      /**\n             * 销毁 webuploader 实例\n             * @method destroy\n             * @grammar destroy() => undefined\n             */\n      destroy: function() {\n        this.request( 'destroy', arguments );\n        this.off();\n      },\n    \n      // widgets/widget.js将补充此方法的详细文档。\n      request: Base.noop\n    });\n    \n    /**\n         * 创建Uploader实例，等同于new Uploader( opts );\n         * @method create\n         * @class Base\n         * @static\n         * @grammar Base.create( opts ) => Uploader\n         */\n    Base.create = Uploader.create = function( opts ) {\n      return new Uploader( opts );\n    };\n    \n    // 暴露Uploader，可以通过它来扩展业务逻辑。\n    Base.Uploader = Uploader;\n    \n    return Uploader;\n  });\n  /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n  define('runtime/runtime',[\n    'base',\n    'mediator'\n  ], function( Base, Mediator ) {\n    \n    var $ = Base.$,\n      factories = {},\n    \n      // 获取对象的第一个key\n      getFirstKey = function( obj ) {\n        for ( var key in obj ) {\n          if ( obj.hasOwnProperty( key ) ) {\n            return key;\n          }\n        }\n        return null;\n      };\n    \n    // 接口类。\n    function Runtime( options ) {\n      this.options = $.extend({\n        container: document.body\n      }, options );\n      this.uid = Base.guid('rt_');\n    }\n    \n    $.extend( Runtime.prototype, {\n    \n      getContainer: function() {\n        var opts = this.options,\n          parent, container;\n    \n        if ( this._container ) {\n          return this._container;\n        }\n    \n        parent = $( opts.container || document.body );\n        container = $( document.createElement('div') );\n    \n        container.attr( 'id', 'rt_' + this.uid );\n        container.css({\n          position: 'absolute',\n          top: '0px',\n          left: '0px',\n          width: '100%',\n          height: '100%',\n          overflow: 'hidden'\n        });\n    \n        parent.append( container );\n        parent.addClass('webuploader-container');\n        this._container = container;\n        this._parent = parent;\n        return container;\n      },\n    \n      init: Base.noop,\n      exec: Base.noop,\n    \n      destroy: function() {\n        this._container && this._container.remove();\n        this._parent && this._parent.removeClass('webuploader-container');\n        this.off();\n      }\n    });\n    \n    Runtime.orders = 'html5,flash';\n    \n    \n    /**\n         * 添加Runtime实现。\n         * @param {String} type    类型\n         * @param {Runtime} factory 具体Runtime实现。\n         */\n    Runtime.addRuntime = function( type, factory ) {\n      factories[ type ] = factory;\n    };\n    \n    Runtime.hasRuntime = function( type ) {\n      return !!(type ? factories[ type ] : getFirstKey( factories ));\n    };\n    \n    Runtime.create = function( opts, orders ) {\n      var type, runtime;\n    \n      orders = orders || Runtime.orders;\n      $.each( orders.split( /\\s*,\\s*/g ), function() {\n        if ( factories[ this ] ) {\n          type = this;\n          return false;\n        }\n      });\n    \n      type = type || getFirstKey( factories );\n    \n      if ( !type ) {\n        throw new Error('Runtime Error');\n      }\n    \n      runtime = new factories[ type ]( opts );\n      return runtime;\n    };\n    \n    Mediator.installTo( Runtime.prototype );\n    return Runtime;\n  });\n    \n  /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n  define('runtime/client',[\n    'base',\n    'mediator',\n    'runtime/runtime'\n  ], function( Base, Mediator, Runtime ) {\n    \n    var cache;\n    \n    cache = (function() {\n      var obj = {};\n    \n      return {\n        add: function( runtime ) {\n          obj[ runtime.uid ] = runtime;\n        },\n    \n        get: function( ruid, standalone ) {\n          var i;\n    \n          if ( ruid ) {\n            return obj[ ruid ];\n          }\n    \n          for ( i in obj ) {\n            // 有些类型不能重用，比如filepicker.\n            if ( standalone && obj[ i ].__standalone ) {\n              continue;\n            }\n    \n            return obj[ i ];\n          }\n    \n          return null;\n        },\n    \n        remove: function( runtime ) {\n          delete obj[ runtime.uid ];\n        }\n      };\n    })();\n    \n    function RuntimeClient( component, standalone ) {\n      var deferred = Base.Deferred(),\n        runtime;\n    \n      this.uid = Base.guid('client_');\n    \n      // 允许runtime没有初始化之前，注册一些方法在初始化后执行。\n      this.runtimeReady = function( cb ) {\n        return deferred.done( cb );\n      };\n    \n      this.connectRuntime = function( opts, cb ) {\n    \n        // already connected.\n        if ( runtime ) {\n          throw new Error('already connected!');\n        }\n    \n        deferred.done( cb );\n    \n        if ( typeof opts === 'string' && cache.get( opts ) ) {\n          runtime = cache.get( opts );\n        }\n    \n        // 像filePicker只能独立存在，不能公用。\n        runtime = runtime || cache.get( null, standalone );\n    \n        // 需要创建\n        if ( !runtime ) {\n          runtime = Runtime.create( opts, opts.runtimeOrder );\n          runtime.__promise = deferred.promise();\n          runtime.once( 'ready', deferred.resolve );\n          runtime.init();\n          cache.add( runtime );\n          runtime.__client = 1;\n        } else {\n          // 来自cache\n          Base.$.extend( runtime.options, opts );\n          runtime.__promise.then( deferred.resolve );\n          runtime.__client++;\n        }\n    \n        standalone && (runtime.__standalone = standalone);\n        return runtime;\n      };\n    \n      this.getRuntime = function() {\n        return runtime;\n      };\n    \n      this.disconnectRuntime = function() {\n        if ( !runtime ) {\n          return;\n        }\n    \n        runtime.__client--;\n    \n        if ( runtime.__client <= 0 ) {\n          cache.remove( runtime );\n          delete runtime.__promise;\n          runtime.destroy();\n        }\n    \n        runtime = null;\n      };\n    \n      this.exec = function() {\n        if ( !runtime ) {\n          return;\n        }\n    \n        var args = Base.slice( arguments );\n        component && args.unshift( component );\n    \n        return runtime.exec.apply( this, args );\n      };\n    \n      this.getRuid = function() {\n        return runtime && runtime.uid;\n      };\n    \n      this.destroy = (function( destroy ) {\n        return function() {\n          destroy && destroy.apply( this, arguments );\n          this.trigger('destroy');\n          this.off();\n          this.exec('destroy');\n          this.disconnectRuntime();\n        };\n      })( this.destroy );\n    }\n    \n    Mediator.installTo( RuntimeClient.prototype );\n    return RuntimeClient;\n  });\n  /**\n     * @fileOverview 错误信息\n     */\n  define('lib/dnd',[\n    'base',\n    'mediator',\n    'runtime/client'\n  ], function( Base, Mediator, RuntimeClent ) {\n    \n    var $ = Base.$;\n    \n    function DragAndDrop( opts ) {\n      opts = this.options = $.extend({}, DragAndDrop.options, opts );\n    \n      opts.container = $( opts.container );\n    \n      if ( !opts.container.length ) {\n        return;\n      }\n    \n      RuntimeClent.call( this, 'DragAndDrop' );\n    }\n    \n    DragAndDrop.options = {\n      accept: null,\n      disableGlobalDnd: false\n    };\n    \n    Base.inherits( RuntimeClent, {\n      constructor: DragAndDrop,\n    \n      init: function() {\n        var me = this;\n    \n        me.connectRuntime( me.options, function() {\n          me.exec('init');\n          me.trigger('ready');\n        });\n      }\n    });\n    \n    Mediator.installTo( DragAndDrop.prototype );\n    \n    return DragAndDrop;\n  });\n  /**\n     * @fileOverview 组件基类。\n     */\n  define('widgets/widget',[\n    'base',\n    'uploader'\n  ], function( Base, Uploader ) {\n    \n    var $ = Base.$,\n      _init = Uploader.prototype._init,\n      _destroy = Uploader.prototype.destroy,\n      IGNORE = {},\n      widgetClass = [];\n    \n    function isArrayLike( obj ) {\n      if ( !obj ) {\n        return false;\n      }\n    \n      var length = obj.length,\n        type = $.type( obj );\n    \n      if ( obj.nodeType === 1 && length ) {\n        return true;\n      }\n    \n      return type === 'array' || type !== 'function' && type !== 'string' &&\n                    (length === 0 || typeof length === 'number' && length > 0 &&\n                    (length - 1) in obj);\n    }\n    \n    function Widget( uploader ) {\n      this.owner = uploader;\n      this.options = uploader.options;\n    }\n    \n    $.extend( Widget.prototype, {\n    \n      init: Base.noop,\n    \n      // 类Backbone的事件监听声明，监听uploader实例上的事件\n      // widget直接无法监听事件，事件只能通过uploader来传递\n      invoke: function( apiName, args ) {\n    \n        /*\n                    {\n                        'make-thumb': 'makeThumb'\n                    }\n                 */\n        var map = this.responseMap;\n    \n        // 如果无API响应声明则忽略\n        if ( !map || !(apiName in map) || !(map[ apiName ] in this) ||\n                        !$.isFunction( this[ map[ apiName ] ] ) ) {\n    \n          return IGNORE;\n        }\n    \n        return this[ map[ apiName ] ].apply( this, args );\n    \n      },\n    \n      /**\n             * 发送命令。当传入`callback`或者`handler`中返回`promise`时。返回一个当所有`handler`中的promise都完成后完成的新`promise`。\n             * @method request\n             * @grammar request( command, args ) => * | Promise\n             * @grammar request( command, args, callback ) => Promise\n             * @for  Uploader\n             */\n      request: function() {\n        return this.owner.request.apply( this.owner, arguments );\n      }\n    });\n    \n    // 扩展Uploader.\n    $.extend( Uploader.prototype, {\n    \n      /**\n             * @property {String | Array} [disableWidgets=undefined]\n             * @namespace options\n             * @for Uploader\n             * @description 默认所有 Uploader.register 了的 widget 都会被加载，如果禁用某一部分，请通过此 option 指定黑名单。\n             */\n    \n      // 覆写_init用来初始化widgets\n      _init: function() {\n        var me = this,\n          widgets = me._widgets = [],\n          deactives = me.options.disableWidgets || '';\n    \n        $.each( widgetClass, function( _, klass ) {\n          (!deactives || !~deactives.indexOf( klass._name )) &&\n                        widgets.push( new klass( me ) );\n        });\n    \n        return _init.apply( me, arguments );\n      },\n    \n      request: function( apiName, args, callback ) {\n        var i = 0,\n          widgets = this._widgets,\n          len = widgets && widgets.length,\n          rlts = [],\n          dfds = [],\n          widget, rlt, promise, key;\n    \n        args = isArrayLike( args ) ? args : [ args ];\n    \n        for ( ; i < len; i++ ) {\n          widget = widgets[ i ];\n          rlt = widget.invoke( apiName, args );\n    \n          if ( rlt !== IGNORE ) {\n    \n            // Deferred对象\n            if ( Base.isPromise( rlt ) ) {\n              dfds.push( rlt );\n            } else {\n              rlts.push( rlt );\n            }\n          }\n        }\n    \n        // 如果有callback，则用异步方式。\n        if ( callback || dfds.length ) {\n          promise = Base.when.apply( Base, dfds );\n          key = promise.pipe ? 'pipe' : 'then';\n    \n          // 很重要不能删除。删除了会死循环。\n          // 保证执行顺序。让callback总是在下一个 tick 中执行。\n          return promise[ key ](function() {\n            var deferred = Base.Deferred(),\n              args = arguments;\n    \n            if ( args.length === 1 ) {\n              args = args[ 0 ];\n            }\n    \n            setTimeout(function() {\n              deferred.resolve( args );\n            }, 1 );\n    \n            return deferred.promise();\n          })[ callback ? key : 'done' ]( callback || Base.noop );\n        } else {\n          return rlts[ 0 ];\n        }\n      },\n    \n      destroy: function() {\n        _destroy.apply( this, arguments );\n        this._widgets = null;\n      }\n    });\n    \n    /**\n         * 添加组件\n         * @grammar Uploader.register(proto);\n         * @grammar Uploader.register(map, proto);\n         * @param  {object} responseMap API 名称与函数实现的映射\n         * @param  {object} proto 组件原型，构造函数通过 constructor 属性定义\n         * @method Uploader.register\n         * @for Uploader\n         * @example\n         * Uploader.register({\n         *     'make-thumb': 'makeThumb'\n         * }, {\n         *     init: function( options ) {},\n         *     makeThumb: function() {}\n         * });\n         *\n         * Uploader.register({\n         *     'make-thumb': function() {\n         *         \n         *     }\n         * });\n         */\n    Uploader.register = Widget.register = function( responseMap, widgetProto ) {\n      var map = { init: 'init', destroy: 'destroy', name: 'anonymous' },\n        klass;\n    \n      if ( arguments.length === 1 ) {\n        widgetProto = responseMap;\n    \n        // 自动生成 map 表。\n        $.each(widgetProto, function(key) {\n          if ( key[0] === '_' || key === 'name' ) {\n            key === 'name' && (map.name = widgetProto.name);\n            return;\n          }\n    \n          map[key.replace(/[A-Z]/g, '-$&').toLowerCase()] = key;\n        });\n    \n      } else {\n        map = $.extend( map, responseMap );\n      }\n    \n      widgetProto.responseMap = map;\n      klass = Base.inherits( Widget, widgetProto );\n      klass._name = map.name;\n      widgetClass.push( klass );\n    \n      return klass;\n    };\n    \n    /**\n         * 删除插件，只有在注册时指定了名字的才能被删除。\n         * @grammar Uploader.unRegister(name);\n         * @param  {string} name 组件名字\n         * @method Uploader.unRegister\n         * @for Uploader\n         * @example\n         *\n         * Uploader.register({\n         *     name: 'custom',\n         *     \n         *     'make-thumb': function() {\n         *         \n         *     }\n         * });\n         *\n         * Uploader.unRegister('custom');\n         */\n    Uploader.unRegister = Widget.unRegister = function( name ) {\n      if ( !name || name === 'anonymous' ) {\n        return;\n      }\n            \n      // 删除指定的插件。\n      for ( var i = widgetClass.length; i--; ) {\n        if ( widgetClass[i]._name === name ) {\n          widgetClass.splice(i, 1);\n        }\n      }\n    };\n    \n    return Widget;\n  });\n  /**\n     * @fileOverview DragAndDrop Widget。\n     */\n  define('widgets/filednd',[\n    'base',\n    'uploader',\n    'lib/dnd',\n    'widgets/widget'\n  ], function( Base, Uploader, Dnd ) {\n    var $ = Base.$;\n    \n    Uploader.options.dnd = '';\n    \n    /**\n         * @property {Selector} [dnd=undefined]  指定Drag And Drop拖拽的容器，如果不指定，则不启动。\n         * @namespace options\n         * @for Uploader\n         */\n        \n    /**\n         * @property {Selector} [disableGlobalDnd=false]  是否禁掉整个页面的拖拽功能，如果不禁用，图片拖进来的时候会默认被浏览器打开。\n         * @namespace options\n         * @for Uploader\n         */\n    \n    /**\n         * @event dndAccept\n         * @param {DataTransferItemList} items DataTransferItem\n         * @description 阻止此事件可以拒绝某些类型的文件拖入进来。目前只有 chrome 提供这样的 API，且只能通过 mime-type 验证。\n         * @for  Uploader\n         */\n    return Uploader.register({\n      name: 'dnd',\n            \n      init: function( opts ) {\n    \n        if ( !opts.dnd ||\n                        this.request('predict-runtime-type') !== 'html5' ) {\n          return;\n        }\n    \n        var me = this,\n          deferred = Base.Deferred(),\n          options = $.extend({}, {\n            disableGlobalDnd: opts.disableGlobalDnd,\n            container: opts.dnd,\n            accept: opts.accept\n          }),\n          dnd;\n    \n        this.dnd = dnd = new Dnd( options );\n    \n        dnd.once( 'ready', deferred.resolve );\n        dnd.on( 'drop', function( files ) {\n          me.request( 'add-file', [ files ]);\n        });\n    \n        // 检测文件是否全部允许添加。\n        dnd.on( 'accept', function( items ) {\n          return me.owner.trigger( 'dndAccept', items );\n        });\n    \n        dnd.init();\n    \n        return deferred.promise();\n      },\n    \n      destroy: function() {\n        this.dnd && this.dnd.destroy();\n      }\n    });\n  });\n    \n  /**\n     * @fileOverview 错误信息\n     */\n  define('lib/filepaste',[\n    'base',\n    'mediator',\n    'runtime/client'\n  ], function( Base, Mediator, RuntimeClent ) {\n    \n    var $ = Base.$;\n    \n    function FilePaste( opts ) {\n      opts = this.options = $.extend({}, opts );\n      opts.container = $( opts.container || document.body );\n      RuntimeClent.call( this, 'FilePaste' );\n    }\n    \n    Base.inherits( RuntimeClent, {\n      constructor: FilePaste,\n    \n      init: function() {\n        var me = this;\n    \n        me.connectRuntime( me.options, function() {\n          me.exec('init');\n          me.trigger('ready');\n        });\n      }\n    });\n    \n    Mediator.installTo( FilePaste.prototype );\n    \n    return FilePaste;\n  });\n  /**\n     * @fileOverview 组件基类。\n     */\n  define('widgets/filepaste',[\n    'base',\n    'uploader',\n    'lib/filepaste',\n    'widgets/widget'\n  ], function( Base, Uploader, FilePaste ) {\n    var $ = Base.$;\n    \n    /**\n         * @property {Selector} [paste=undefined]  指定监听paste事件的容器，如果不指定，不启用此功能。此功能为通过粘贴来添加截屏的图片。建议设置为`document.body`.\n         * @namespace options\n         * @for Uploader\n         */\n    return Uploader.register({\n      name: 'paste',\n            \n      init: function( opts ) {\n    \n        if ( !opts.paste ||\n                        this.request('predict-runtime-type') !== 'html5' ) {\n          return;\n        }\n    \n        var me = this,\n          deferred = Base.Deferred(),\n          options = $.extend({}, {\n            container: opts.paste,\n            accept: opts.accept\n          }),\n          paste;\n    \n        this.paste = paste = new FilePaste( options );\n    \n        paste.once( 'ready', deferred.resolve );\n        paste.on( 'paste', function( files ) {\n          me.owner.request( 'add-file', [ files ]);\n        });\n        paste.init();\n    \n        return deferred.promise();\n      },\n    \n      destroy: function() {\n        this.paste && this.paste.destroy();\n      }\n    });\n  });\n  /**\n     * @fileOverview Blob\n     */\n  define('lib/blob',[\n    'base',\n    'runtime/client'\n  ], function( Base, RuntimeClient ) {\n    \n    function Blob( ruid, source ) {\n      var me = this;\n    \n      me.source = source;\n      me.ruid = ruid;\n      this.size = source.size || 0;\n    \n      // 如果没有指定 mimetype, 但是知道文件后缀。\n      if ( !source.type && this.ext &&\n                    ~'jpg,jpeg,png,gif,bmp'.indexOf( this.ext ) ) {\n        this.type = 'image/' + (this.ext === 'jpg' ? 'jpeg' : this.ext);\n      } else {\n        this.type = source.type || 'application/octet-stream';\n      }\n    \n      RuntimeClient.call( me, 'Blob' );\n      this.uid = source.uid || this.uid;\n    \n      if ( ruid ) {\n        me.connectRuntime( ruid );\n      }\n    }\n    \n    Base.inherits( RuntimeClient, {\n      constructor: Blob,\n    \n      slice: function( start, end ) {\n        return this.exec( 'slice', start, end );\n      },\n    \n      getSource: function() {\n        return this.source;\n      }\n    });\n    \n    return Blob;\n  });\n  /**\n     * 为了统一化Flash的File和HTML5的File而存在。\n     * 以至于要调用Flash里面的File，也可以像调用HTML5版本的File一下。\n     * @fileOverview File\n     */\n  define('lib/file',[\n    'base',\n    'lib/blob'\n  ], function( Base, Blob ) {\n    \n    var uid = 1,\n      rExt = /\\.([^.]+)$/;\n    \n    function File( ruid, file ) {\n      var ext;\n    \n      this.name = file.name || ('untitled' + uid++);\n      ext = rExt.exec( file.name ) ? RegExp.$1.toLowerCase() : '';\n    \n      // todo 支持其他类型文件的转换。\n      // 如果有 mimetype, 但是文件名里面没有找出后缀规律\n      if ( !ext && file.type ) {\n        ext = /\\/(jpg|jpeg|png|gif|bmp)$/i.exec( file.type ) ?\n          RegExp.$1.toLowerCase() : '';\n        this.name += '.' + ext;\n      }\n    \n      this.ext = ext;\n      this.lastModifiedDate = file.lastModifiedDate ||\n                    (new Date()).toLocaleString();\n    \n      Blob.apply( this, arguments );\n    }\n    \n    return Base.inherits( Blob, File );\n  });\n    \n  /**\n     * @fileOverview 错误信息\n     */\n  define('lib/filepicker',[\n    'base',\n    'runtime/client',\n    'lib/file'\n  ], function( Base, RuntimeClent, File ) {\n    \n    var $ = Base.$;\n    \n    function FilePicker( opts ) {\n      opts = this.options = $.extend({}, FilePicker.options, opts );\n    \n      opts.container = $( opts.id );\n    \n      if ( !opts.container.length ) {\n        throw new Error('按钮指定错误');\n      }\n    \n      opts.innerHTML = opts.innerHTML || opts.label ||\n                    opts.container.html() || '';\n    \n      opts.button = $( opts.button || document.createElement('div') );\n      opts.button.html( opts.innerHTML );\n      opts.container.html( opts.button );\n    \n      RuntimeClent.call( this, 'FilePicker', true );\n    }\n    \n    FilePicker.options = {\n      button: null,\n      container: null,\n      label: null,\n      innerHTML: null,\n      multiple: true,\n      accept: null,\n      name: 'file'\n    };\n    \n    Base.inherits( RuntimeClent, {\n      constructor: FilePicker,\n    \n      init: function() {\n        var me = this,\n          opts = me.options,\n          button = opts.button;\n    \n        button.addClass('webuploader-pick');\n    \n        me.on( 'all', function( type ) {\n          var files;\n    \n          switch ( type ) {\n          case 'mouseenter':\n            button.addClass('webuploader-pick-hover');\n            break;\n    \n          case 'mouseleave':\n            button.removeClass('webuploader-pick-hover');\n            break;\n    \n          case 'change':\n            files = me.exec('getFiles');\n            me.trigger( 'select', $.map( files, function( file ) {\n              file = new File( me.getRuid(), file );\n    \n              // 记录来源。\n              file._refer = opts.container;\n              return file;\n            }), opts.container );\n            break;\n          }\n        });\n    \n        me.connectRuntime( opts, function() {\n          me.refresh();\n          me.exec( 'init', opts );\n          me.trigger('ready');\n        });\n    \n        this._resizeHandler = Base.bindFn( this.refresh, this );\n        $( window ).on( 'resize', this._resizeHandler );\n      },\n    \n      refresh: function() {\n        var shimContainer = this.getRuntime().getContainer(),\n          button = this.options.button,\n          width = button.outerWidth ?\n            button.outerWidth() : button.width(),\n    \n          height = button.outerHeight ?\n            button.outerHeight() : button.height(),\n    \n          pos = button.offset();\n    \n        width && height && shimContainer.css({\n          bottom: 'auto',\n          right: 'auto',\n          width: width + 'px',\n          height: height + 'px'\n        }).offset( pos );\n      },\n    \n      enable: function() {\n        var btn = this.options.button;\n    \n        btn.removeClass('webuploader-pick-disable');\n        this.refresh();\n      },\n    \n      disable: function() {\n        var btn = this.options.button;\n    \n        this.getRuntime().getContainer().css({\n          top: '-99999px'\n        });\n    \n        btn.addClass('webuploader-pick-disable');\n      },\n    \n      destroy: function() {\n        var btn = this.options.button;\n        $( window ).off( 'resize', this._resizeHandler );\n        btn.removeClass('webuploader-pick-disable webuploader-pick-hover ' +\n                    'webuploader-pick');\n      }\n    });\n    \n    return FilePicker;\n  });\n    \n  /**\n     * @fileOverview 文件选择相关\n     */\n  define('widgets/filepicker',[\n    'base',\n    'uploader',\n    'lib/filepicker',\n    'widgets/widget'\n  ], function( Base, Uploader, FilePicker ) {\n    var $ = Base.$;\n    \n    $.extend( Uploader.options, {\n    \n      /**\n             * @property {Selector | Object} [pick=undefined]\n             * @namespace options\n             * @for Uploader\n             * @description 指定选择文件的按钮容器，不指定则不创建按钮。\n             *\n             * * `id` {Seletor|dom} 指定选择文件的按钮容器，不指定则不创建按钮。**注意** 这里虽然写的是 id, 但是不是只支持 id, 还支持 class, 或者 dom 节点。\n             * * `label` {String} 请采用 `innerHTML` 代替\n             * * `innerHTML` {String} 指定按钮文字。不指定时优先从指定的容器中看是否自带文字。\n             * * `multiple` {Boolean} 是否开起同时选择多个文件能力。\n             */\n      pick: null,\n    \n      /**\n             * @property {Arroy} [accept=null]\n             * @namespace options\n             * @for Uploader\n             * @description 指定接受哪些类型的文件。 由于目前还有ext转mimeType表，所以这里需要分开指定。\n             *\n             * * `title` {String} 文字描述\n             * * `extensions` {String} 允许的文件后缀，不带点，多个用逗号分割。\n             * * `mimeTypes` {String} 多个用逗号分割。\n             *\n             * 如：\n             *\n             * ```\n             * {\n             *     title: 'Images',\n             *     extensions: 'gif,jpg,jpeg,bmp,png',\n             *     mimeTypes: 'image/*'\n             * }\n             * ```\n             */\n      accept: null/*{\n                title: 'Images',\n                extensions: 'gif,jpg,jpeg,bmp,png',\n                mimeTypes: 'image/*'\n            }*/\n    });\n    \n    return Uploader.register({\n      name: 'picker',\n    \n      init: function( opts ) {\n        this.pickers = [];\n        return opts.pick && this.addBtn( opts.pick );\n      },\n    \n      refresh: function() {\n        $.each( this.pickers, function() {\n          this.refresh();\n        });\n      },\n    \n      /**\n             * @method addButton\n             * @for Uploader\n             * @grammar addButton( pick ) => Promise\n             * @description\n             * 添加文件选择按钮，如果一个按钮不够，需要调用此方法来添加。参数跟[options.pick](#WebUploader:Uploader:options)一致。\n             * @example\n             * uploader.addButton({\n             *     id: '#btnContainer',\n             *     innerHTML: '选择文件'\n             * });\n             */\n      addBtn: function( pick ) {\n        var me = this,\n          opts = me.options,\n          accept = opts.accept,\n          promises = [];\n    \n        if ( !pick ) {\n          return;\n        }\n    \n        $.isPlainObject( pick ) || (pick = {\n          id: pick\n        });\n    \n        $( pick.id ).each(function() {\n          var options, picker, deferred;\n    \n          deferred = Base.Deferred();\n    \n          options = $.extend({}, pick, {\n            accept: $.isPlainObject( accept ) ? [ accept ] : accept,\n            swf: opts.swf,\n            runtimeOrder: opts.runtimeOrder,\n            id: this\n          });\n    \n          picker = new FilePicker( options );\n    \n          picker.once( 'ready', deferred.resolve );\n          picker.on( 'select', function( files ) {\n            me.owner.request( 'add-file', [ files ]);\n          });\n          picker.init();\n    \n          me.pickers.push( picker );\n    \n          promises.push( deferred.promise() );\n        });\n    \n        return Base.when.apply( Base, promises );\n      },\n    \n      disable: function() {\n        $.each( this.pickers, function() {\n          this.disable();\n        });\n      },\n    \n      enable: function() {\n        $.each( this.pickers, function() {\n          this.enable();\n        });\n      },\n    \n      destroy: function() {\n        $.each( this.pickers, function() {\n          this.destroy();\n        });\n        this.pickers = null;\n      }\n    });\n  });\n  /**\n     * @fileOverview Image\n     */\n  define('lib/image',[\n    'base',\n    'runtime/client',\n    'lib/blob'\n  ], function( Base, RuntimeClient, Blob ) {\n    var $ = Base.$;\n    \n    // 构造器。\n    function Image( opts ) {\n      this.options = $.extend({}, Image.options, opts );\n      RuntimeClient.call( this, 'Image' );\n    \n      this.on( 'load', function() {\n        this._info = this.exec('info');\n        this._meta = this.exec('meta');\n      });\n    }\n    \n    // 默认选项。\n    Image.options = {\n    \n      // 默认的图片处理质量\n      quality: 90,\n    \n      // 是否裁剪\n      crop: false,\n    \n      // 是否保留头部信息\n      preserveHeaders: false,\n    \n      // 是否允许放大。\n      allowMagnify: false\n    };\n    \n    // 继承RuntimeClient.\n    Base.inherits( RuntimeClient, {\n      constructor: Image,\n    \n      info: function( val ) {\n    \n        // setter\n        if ( val ) {\n          this._info = val;\n          return this;\n        }\n    \n        // getter\n        return this._info;\n      },\n    \n      meta: function( val ) {\n    \n        // setter\n        if ( val ) {\n          this._meta = val;\n          return this;\n        }\n    \n        // getter\n        return this._meta;\n      },\n    \n      loadFromBlob: function( blob ) {\n        var me = this,\n          ruid = blob.getRuid();\n    \n        this.connectRuntime( ruid, function() {\n          me.exec( 'init', me.options );\n          me.exec( 'loadFromBlob', blob );\n        });\n      },\n    \n      resize: function() {\n        var args = Base.slice( arguments );\n        return this.exec.apply( this, [ 'resize' ].concat( args ) );\n      },\n    \n      crop: function() {\n        var args = Base.slice( arguments );\n        return this.exec.apply( this, [ 'crop' ].concat( args ) );\n      },\n    \n      getAsDataUrl: function( type ) {\n        return this.exec( 'getAsDataUrl', type );\n      },\n    \n      getAsBlob: function( type ) {\n        var blob = this.exec( 'getAsBlob', type );\n    \n        return new Blob( this.getRuid(), blob );\n      }\n    });\n    \n    return Image;\n  });\n  /**\n     * @fileOverview 图片操作, 负责预览图片和上传前压缩图片\n     */\n  define('widgets/image',[\n    'base',\n    'uploader',\n    'lib/image',\n    'widgets/widget'\n  ], function( Base, Uploader, Image ) {\n    \n    var $ = Base.$,\n      throttle;\n    \n    // 根据要处理的文件大小来节流，一次不能处理太多，会卡。\n    throttle = (function( max ) {\n      var occupied = 0,\n        waiting = [],\n        tick = function() {\n          var item;\n    \n          while ( waiting.length && occupied < max ) {\n            item = waiting.shift();\n            occupied += item[ 0 ];\n            item[ 1 ]();\n          }\n        };\n    \n      return function( emiter, size, cb ) {\n        waiting.push([ size, cb ]);\n        emiter.once( 'destroy', function() {\n          occupied -= size;\n          setTimeout( tick, 1 );\n        });\n        setTimeout( tick, 1 );\n      };\n    })( 5 * 1024 * 1024 );\n    \n    $.extend( Uploader.options, {\n    \n      /**\n             * @property {Object} [thumb]\n             * @namespace options\n             * @for Uploader\n             * @description 配置生成缩略图的选项。\n             *\n             * 默认为：\n             *\n             * ```javascript\n             * {\n             *     width: 110,\n             *     height: 110,\n             *\n             *     // 图片质量，只有type为`image/jpeg`的时候才有效。\n             *     quality: 70,\n             *\n             *     // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.\n             *     allowMagnify: true,\n             *\n             *     // 是否允许裁剪。\n             *     crop: true,\n             *\n             *     // 为空的话则保留原有图片格式。\n             *     // 否则强制转换成指定的类型。\n             *     type: 'image/jpeg'\n             * }\n             * ```\n             */\n      thumb: {\n        width: 110,\n        height: 110,\n        quality: 70,\n        allowMagnify: true,\n        crop: true,\n        preserveHeaders: false,\n    \n        // 为空的话则保留原有图片格式。\n        // 否则强制转换成指定的类型。\n        // IE 8下面 base64 大小不能超过 32K 否则预览失败，而非 jpeg 编码的图片很可\n        // 能会超过 32k, 所以这里设置成预览的时候都是 image/jpeg\n        type: 'image/jpeg'\n      },\n    \n      /**\n             * @property {Object} [compress]\n             * @namespace options\n             * @for Uploader\n             * @description 配置压缩的图片的选项。如果此选项为`false`, 则图片在上传前不进行压缩。\n             *\n             * 默认为：\n             *\n             * ```javascript\n             * {\n             *     width: 1600,\n             *     height: 1600,\n             *\n             *     // 图片质量，只有type为`image/jpeg`的时候才有效。\n             *     quality: 90,\n             *\n             *     // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.\n             *     allowMagnify: false,\n             *\n             *     // 是否允许裁剪。\n             *     crop: false,\n             *\n             *     // 是否保留头部meta信息。\n             *     preserveHeaders: true,\n             *\n             *     // 如果发现压缩后文件大小比原来还大，则使用原来图片\n             *     // 此属性可能会影响图片自动纠正功能\n             *     noCompressIfLarger: false,\n             *\n             *     // 单位字节，如果图片大小小于此值，不会采用压缩。\n             *     compressSize: 0\n             * }\n             * ```\n             */\n      compress: {\n        width: 1600,\n        height: 1600,\n        quality: 90,\n        allowMagnify: false,\n        crop: false,\n        preserveHeaders: true\n      }\n    });\n    \n    return Uploader.register({\n    \n      name: 'image',\n    \n    \n      /**\n             * 生成缩略图，此过程为异步，所以需要传入`callback`。\n             * 通常情况在图片加入队里后调用此方法来生成预览图以增强交互效果。\n             *\n             * 当 width 或者 height 的值介于 0 - 1 时，被当成百分比使用。\n             *\n             * `callback`中可以接收到两个参数。\n             * * 第一个为error，如果生成缩略图有错误，此error将为真。\n             * * 第二个为ret, 缩略图的Data URL值。\n             *\n             * **注意**\n             * Date URL在IE6/7中不支持，所以不用调用此方法了，直接显示一张暂不支持预览图片好了。\n             * 也可以借助服务端，将 base64 数据传给服务端，生成一个临时文件供预览。\n             *\n             * @method makeThumb\n             * @grammar makeThumb( file, callback ) => undefined\n             * @grammar makeThumb( file, callback, width, height ) => undefined\n             * @for Uploader\n             * @example\n             *\n             * uploader.on( 'fileQueued', function( file ) {\n             *     var $li = ...;\n             *\n             *     uploader.makeThumb( file, function( error, ret ) {\n             *         if ( error ) {\n             *             $li.text('预览错误');\n             *         } else {\n             *             $li.append('<img alt=\"\" src=\"' + ret + '\" />');\n             *         }\n             *     });\n             *\n             * });\n             */\n      makeThumb: function( file, cb, width, height ) {\n        var opts, image;\n    \n        file = this.request( 'get-file', file );\n    \n        // 只预览图片格式。\n        if ( !file.type.match( /^image/ ) ) {\n          cb( true );\n          return;\n        }\n    \n        opts = $.extend({}, this.options.thumb );\n    \n        // 如果传入的是object.\n        if ( $.isPlainObject( width ) ) {\n          opts = $.extend( opts, width );\n          width = null;\n        }\n    \n        width = width || opts.width;\n        height = height || opts.height;\n    \n        image = new Image( opts );\n    \n        image.once( 'load', function() {\n          file._info = file._info || image.info();\n          file._meta = file._meta || image.meta();\n    \n          // 如果 width 的值介于 0 - 1\n          // 说明设置的是百分比。\n          if ( width <= 1 && width > 0 ) {\n            width = file._info.width * width;\n          }\n    \n          // 同样的规则应用于 height\n          if ( height <= 1 && height > 0 ) {\n            height = file._info.height * height;\n          }\n    \n          image.resize( width, height );\n        });\n    \n        // 当 resize 完后\n        image.once( 'complete', function() {\n          cb( false, image.getAsDataUrl( opts.type ) );\n          image.destroy();\n        });\n    \n        image.once( 'error', function( reason ) {\n          cb( reason || true );\n          image.destroy();\n        });\n    \n        throttle( image, file.source.size, function() {\n          file._info && image.info( file._info );\n          file._meta && image.meta( file._meta );\n          image.loadFromBlob( file.source );\n        });\n      },\n    \n      beforeSendFile: function( file ) {\n        var opts = this.options.compress || this.options.resize,\n          compressSize = opts && opts.compressSize || 0,\n          noCompressIfLarger = opts && opts.noCompressIfLarger || false,\n          image, deferred;\n    \n        file = this.request( 'get-file', file );\n    \n        // 只压缩 jpeg 图片格式。\n        // gif 可能会丢失针\n        // bmp png 基本上尺寸都不大，且压缩比比较小。\n        if ( !opts || !~'image/jpeg,image/jpg'.indexOf( file.type ) ||\n                        file.size < compressSize ||\n                        file._compressed ) {\n          return;\n        }\n    \n        opts = $.extend({}, opts );\n        deferred = Base.Deferred();\n    \n        image = new Image( opts );\n    \n        deferred.always(function() {\n          image.destroy();\n          image = null;\n        });\n        image.once( 'error', deferred.reject );\n        image.once( 'load', function() {\n          var width = opts.width,\n            height = opts.height;\n    \n          file._info = file._info || image.info();\n          file._meta = file._meta || image.meta();\n    \n          // 如果 width 的值介于 0 - 1\n          // 说明设置的是百分比。\n          if ( width <= 1 && width > 0 ) {\n            width = file._info.width * width;\n          }\n    \n          // 同样的规则应用于 height\n          if ( height <= 1 && height > 0 ) {\n            height = file._info.height * height;\n          }\n    \n          image.resize( width, height );\n        });\n    \n        image.once( 'complete', function() {\n          var blob, size;\n    \n          // 移动端 UC / qq 浏览器的无图模式下\n          // ctx.getImageData 处理大图的时候会报 Exception\n          // INDEX_SIZE_ERR: DOM Exception 1\n          try {\n            blob = image.getAsBlob( opts.type );\n    \n            size = file.size;\n    \n            // 如果压缩后，比原来还大则不用压缩后的。\n            if ( !noCompressIfLarger || blob.size < size ) {\n              // file.source.destroy && file.source.destroy();\n              file.source = blob;\n              file.size = blob.size;\n    \n              file.trigger( 'resize', blob.size, size );\n            }\n    \n            // 标记，避免重复压缩。\n            file._compressed = true;\n            deferred.resolve();\n          } catch ( e ) {\n            // 出错了直接继续，让其上传原始图片\n            deferred.resolve();\n          }\n        });\n    \n        file._info && image.info( file._info );\n        file._meta && image.meta( file._meta );\n    \n        image.loadFromBlob( file.source );\n        return deferred.promise();\n      }\n    });\n  });\n  /**\n     * @fileOverview 文件属性封装\n     */\n  define('file',[\n    'base',\n    'mediator'\n  ], function( Base, Mediator ) {\n    \n    var $ = Base.$,\n      idPrefix = 'WU_FILE_',\n      idSuffix = 0,\n      rExt = /\\.([^.]+)$/,\n      statusMap = {};\n    \n    function gid() {\n      return idPrefix + idSuffix++;\n    }\n    \n    /**\n         * 文件类\n         * @class File\n         * @constructor 构造函数\n         * @grammar new File( source ) => File\n         * @param {Lib.File} source [lib.File](#Lib.File)实例, 此source对象是带有Runtime信息的。\n         */\n    function WUFile( source ) {\n    \n      /**\n             * 文件名，包括扩展名（后缀）\n             * @property name\n             * @type {string}\n             */\n      this.name = source.name || 'Untitled';\n    \n      /**\n             * 文件体积（字节）\n             * @property size\n             * @type {uint}\n             * @default 0\n             */\n      this.size = source.size || 0;\n    \n      /**\n             * 文件MIMETYPE类型，与文件类型的对应关系请参考[http://t.cn/z8ZnFny](http://t.cn/z8ZnFny)\n             * @property type\n             * @type {string}\n             * @default 'application/octet-stream'\n             */\n      this.type = source.type || 'application/octet-stream';\n    \n      /**\n             * 文件最后修改日期\n             * @property lastModifiedDate\n             * @type {int}\n             * @default 当前时间戳\n             */\n      this.lastModifiedDate = source.lastModifiedDate || (new Date() * 1);\n    \n      /**\n             * 文件ID，每个对象具有唯一ID，与文件名无关\n             * @property id\n             * @type {string}\n             */\n      this.id = gid();\n    \n      /**\n             * 文件扩展名，通过文件名获取，例如test.png的扩展名为png\n             * @property ext\n             * @type {string}\n             */\n      this.ext = rExt.exec( this.name ) ? RegExp.$1 : '';\n    \n    \n      /**\n             * 状态文字说明。在不同的status语境下有不同的用途。\n             * @property statusText\n             * @type {string}\n             */\n      this.statusText = '';\n    \n      // 存储文件状态，防止通过属性直接修改\n      statusMap[ this.id ] = WUFile.Status.INITED;\n    \n      this.source = source;\n      this.loaded = 0;\n    \n      this.on( 'error', function( msg ) {\n        this.setStatus( WUFile.Status.ERROR, msg );\n      });\n    }\n    \n    $.extend( WUFile.prototype, {\n    \n      /**\n             * 设置状态，状态变化时会触发`change`事件。\n             * @method setStatus\n             * @grammar setStatus( status[, statusText] );\n             * @param {File.Status|String} status [文件状态值](#WebUploader:File:File.Status)\n             * @param {String} [statusText=''] 状态说明，常在error时使用，用http, abort,server等来标记是由于什么原因导致文件错误。\n             */\n      setStatus: function( status, text ) {\n    \n        var prevStatus = statusMap[ this.id ];\n    \n        typeof text !== 'undefined' && (this.statusText = text);\n    \n        if ( status !== prevStatus ) {\n          statusMap[ this.id ] = status;\n          /**\n                     * 文件状态变化\n                     * @event statuschange\n                     */\n          this.trigger( 'statuschange', status, prevStatus );\n        }\n    \n      },\n    \n      /**\n             * 获取文件状态\n             * @return {File.Status}\n             * @example\n                     文件状态具体包括以下几种类型：\n                     {\n                         // 初始化\n                        INITED:     0,\n                        // 已入队列\n                        QUEUED:     1,\n                        // 正在上传\n                        PROGRESS:     2,\n                        // 上传出错\n                        ERROR:         3,\n                        // 上传成功\n                        COMPLETE:     4,\n                        // 上传取消\n                        CANCELLED:     5\n                    }\n             */\n      getStatus: function() {\n        return statusMap[ this.id ];\n      },\n    \n      /**\n             * 获取文件原始信息。\n             * @return {*}\n             */\n      getSource: function() {\n        return this.source;\n      },\n    \n      destroy: function() {\n        this.off();\n        delete statusMap[ this.id ];\n      }\n    });\n    \n    Mediator.installTo( WUFile.prototype );\n    \n    /**\n         * 文件状态值，具体包括以下几种类型：\n         * * `inited` 初始状态\n         * * `queued` 已经进入队列, 等待上传\n         * * `progress` 上传中\n         * * `complete` 上传完成。\n         * * `error` 上传出错，可重试\n         * * `interrupt` 上传中断，可续传。\n         * * `invalid` 文件不合格，不能重试上传。会自动从队列中移除。\n         * * `cancelled` 文件被移除。\n         * @property {Object} Status\n         * @namespace File\n         * @class File\n         * @static\n         */\n    WUFile.Status = {\n      INITED:     'inited',    // 初始状态\n      QUEUED:     'queued',    // 已经进入队列, 等待上传\n      PROGRESS:   'progress',    // 上传中\n      ERROR:      'error',    // 上传出错，可重试\n      COMPLETE:   'complete',    // 上传完成。\n      CANCELLED:  'cancelled',    // 上传取消。\n      INTERRUPT:  'interrupt',    // 上传中断，可续传。\n      INVALID:    'invalid'    // 文件不合格，不能重试上传。\n    };\n    \n    return WUFile;\n  });\n    \n  /**\n     * @fileOverview 文件队列\n     */\n  define('queue',[\n    'base',\n    'mediator',\n    'file'\n  ], function( Base, Mediator, WUFile ) {\n    \n    var $ = Base.$,\n      STATUS = WUFile.Status;\n    \n    /**\n         * 文件队列, 用来存储各个状态中的文件。\n         * @class Queue\n         * @extends Mediator\n         */\n    function Queue() {\n    \n      /**\n             * 统计文件数。\n             * * `numOfQueue` 队列中的文件数。\n             * * `numOfSuccess` 上传成功的文件数\n             * * `numOfCancel` 被取消的文件数\n             * * `numOfProgress` 正在上传中的文件数\n             * * `numOfUploadFailed` 上传错误的文件数。\n             * * `numOfInvalid` 无效的文件数。\n             * * `numofDeleted` 被移除的文件数。\n             * @property {Object} stats\n             */\n      this.stats = {\n        numOfQueue: 0,\n        numOfSuccess: 0,\n        numOfCancel: 0,\n        numOfProgress: 0,\n        numOfUploadFailed: 0,\n        numOfInvalid: 0,\n        numofDeleted: 0,\n        numofInterrupt: 0\n      };\n    \n      // 上传队列，仅包括等待上传的文件\n      this._queue = [];\n    \n      // 存储所有文件\n      this._map = {};\n    }\n    \n    $.extend( Queue.prototype, {\n    \n      /**\n             * 将新文件加入对队列尾部\n             *\n             * @method append\n             * @param  {File} file   文件对象\n             */\n      append: function( file ) {\n        this._queue.push( file );\n        this._fileAdded( file );\n        return this;\n      },\n    \n      /**\n             * 将新文件加入对队列头部\n             *\n             * @method prepend\n             * @param  {File} file   文件对象\n             */\n      prepend: function( file ) {\n        this._queue.unshift( file );\n        this._fileAdded( file );\n        return this;\n      },\n    \n      /**\n             * 获取文件对象\n             *\n             * @method getFile\n             * @param  {String} fileId   文件ID\n             * @return {File}\n             */\n      getFile: function( fileId ) {\n        if ( typeof fileId !== 'string' ) {\n          return fileId;\n        }\n        return this._map[ fileId ];\n      },\n    \n      /**\n             * 从队列中取出一个指定状态的文件。\n             * @grammar fetch( status ) => File\n             * @method fetch\n             * @param {String} status [文件状态值](#WebUploader:File:File.Status)\n             * @return {File} [File](#WebUploader:File)\n             */\n      fetch: function( status ) {\n        var len = this._queue.length,\n          i, file;\n    \n        status = status || STATUS.QUEUED;\n    \n        for ( i = 0; i < len; i++ ) {\n          file = this._queue[ i ];\n    \n          if ( status === file.getStatus() ) {\n            return file;\n          }\n        }\n    \n        return null;\n      },\n    \n      /**\n             * 对队列进行排序，能够控制文件上传顺序。\n             * @grammar sort( fn ) => undefined\n             * @method sort\n             * @param {Function} fn 排序方法\n             */\n      sort: function( fn ) {\n        if ( typeof fn === 'function' ) {\n          this._queue.sort( fn );\n        }\n      },\n    \n      /**\n             * 获取指定类型的文件列表, 列表中每一个成员为[File](#WebUploader:File)对象。\n             * @grammar getFiles( [status1[, status2 ...]] ) => Array\n             * @method getFiles\n             * @param {String} [status] [文件状态值](#WebUploader:File:File.Status)\n             */\n      getFiles: function() {\n        var sts = [].slice.call( arguments, 0 ),\n          ret = [],\n          i = 0,\n          len = this._queue.length,\n          file;\n    \n        for ( ; i < len; i++ ) {\n          file = this._queue[ i ];\n    \n          if ( sts.length && !~$.inArray( file.getStatus(), sts ) ) {\n            continue;\n          }\n    \n          ret.push( file );\n        }\n    \n        return ret;\n      },\n    \n      /**\n             * 在队列中删除文件。\n             * @grammar removeFile( file ) => Array\n             * @method removeFile\n             * @param {File} 文件对象。\n             */\n      removeFile: function( file ) {\n        var me = this,\n          existing = this._map[ file.id ];\n    \n        if ( existing ) {\n          delete this._map[ file.id ];\n          file.destroy();\n          this.stats.numofDeleted++;\n        }\n      },\n    \n      _fileAdded: function( file ) {\n        var me = this,\n          existing = this._map[ file.id ];\n    \n        if ( !existing ) {\n          this._map[ file.id ] = file;\n    \n          file.on( 'statuschange', function( cur, pre ) {\n            me._onFileStatusChange( cur, pre );\n          });\n        }\n      },\n    \n      _onFileStatusChange: function( curStatus, preStatus ) {\n        var stats = this.stats;\n    \n        switch ( preStatus ) {\n        case STATUS.PROGRESS:\n          stats.numOfProgress--;\n          break;\n    \n        case STATUS.QUEUED:\n          stats.numOfQueue --;\n          break;\n    \n        case STATUS.ERROR:\n          stats.numOfUploadFailed--;\n          break;\n    \n        case STATUS.INVALID:\n          stats.numOfInvalid--;\n          break;\n    \n        case STATUS.INTERRUPT:\n          stats.numofInterrupt--;\n          break;\n        }\n    \n        switch ( curStatus ) {\n        case STATUS.QUEUED:\n          stats.numOfQueue++;\n          break;\n    \n        case STATUS.PROGRESS:\n          stats.numOfProgress++;\n          break;\n    \n        case STATUS.ERROR:\n          stats.numOfUploadFailed++;\n          break;\n    \n        case STATUS.COMPLETE:\n          stats.numOfSuccess++;\n          break;\n    \n        case STATUS.CANCELLED:\n          stats.numOfCancel++;\n          break;\n    \n    \n        case STATUS.INVALID:\n          stats.numOfInvalid++;\n          break;\n    \n        case STATUS.INTERRUPT:\n          stats.numofInterrupt++;\n          break;\n        }\n      }\n    \n    });\n    \n    Mediator.installTo( Queue.prototype );\n    \n    return Queue;\n  });\n  /**\n     * @fileOverview 队列\n     */\n  define('widgets/queue',[\n    'base',\n    'uploader',\n    'queue',\n    'file',\n    'lib/file',\n    'runtime/client',\n    'widgets/widget'\n  ], function( Base, Uploader, Queue, WUFile, File, RuntimeClient ) {\n    \n    var $ = Base.$,\n      rExt = /\\.\\w+$/,\n      Status = WUFile.Status;\n    \n    return Uploader.register({\n      name: 'queue',\n    \n      init: function( opts ) {\n        var me = this,\n          deferred, len, i, item, arr, accept, runtime;\n    \n        if ( $.isPlainObject( opts.accept ) ) {\n          opts.accept = [ opts.accept ];\n        }\n    \n        // accept中的中生成匹配正则。\n        if ( opts.accept ) {\n          arr = [];\n    \n          for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n            item = opts.accept[ i ].extensions;\n            item && arr.push( item );\n          }\n    \n          if ( arr.length ) {\n            accept = '\\\\.' + arr.join(',')\n              .replace( /,/g, '$|\\\\.' )\n              .replace( /\\*/g, '.*' ) + '$';\n          }\n    \n          me.accept = new RegExp( accept, 'i' );\n        }\n    \n        me.queue = new Queue();\n        me.stats = me.queue.stats;\n    \n        // 如果当前不是html5运行时，那就算了。\n        // 不执行后续操作\n        if ( this.request('predict-runtime-type') !== 'html5' ) {\n          return;\n        }\n    \n        // 创建一个 html5 运行时的 placeholder\n        // 以至于外部添加原生 File 对象的时候能正确包裹一下供 webuploader 使用。\n        deferred = Base.Deferred();\n        this.placeholder = runtime = new RuntimeClient('Placeholder');\n        runtime.connectRuntime({\n          runtimeOrder: 'html5'\n        }, function() {\n          me._ruid = runtime.getRuid();\n          deferred.resolve();\n        });\n        return deferred.promise();\n      },\n    \n    \n      // 为了支持外部直接添加一个原生File对象。\n      _wrapFile: function( file ) {\n        if ( !(file instanceof WUFile) ) {\n    \n          if ( !(file instanceof File) ) {\n            if ( !this._ruid ) {\n              throw new Error('Can\\'t add external files.');\n            }\n            file = new File( this._ruid, file );\n          }\n    \n          file = new WUFile( file );\n        }\n    \n        return file;\n      },\n    \n      // 判断文件是否可以被加入队列\n      acceptFile: function( file ) {\n        var invalid = !file || !file.size || this.accept &&\n    \n                        // 如果名字中有后缀，才做后缀白名单处理。\n                        rExt.exec( file.name ) && !this.accept.test( file.name );\n    \n        return !invalid;\n      },\n    \n    \n      /**\n             * @event beforeFileQueued\n             * @param {File} file File对象\n             * @description 当文件被加入队列之前触发，此事件的handler返回值为`false`，则此文件不会被添加进入队列。\n             * @for  Uploader\n             */\n    \n      /**\n             * @event fileQueued\n             * @param {File} file File对象\n             * @description 当文件被加入队列以后触发。\n             * @for  Uploader\n             */\n    \n      _addFile: function( file ) {\n        var me = this;\n    \n        file = me._wrapFile( file );\n    \n        // 不过类型判断允许不允许，先派送 `beforeFileQueued`\n        if ( !me.owner.trigger( 'beforeFileQueued', file ) ) {\n          return;\n        }\n    \n        // 类型不匹配，则派送错误事件，并返回。\n        if ( !me.acceptFile( file ) ) {\n          me.owner.trigger( 'error', 'Q_TYPE_DENIED', file );\n          return;\n        }\n    \n        me.queue.append( file );\n        me.owner.trigger( 'fileQueued', file );\n        return file;\n      },\n    \n      getFile: function( fileId ) {\n        return this.queue.getFile( fileId );\n      },\n    \n      /**\n             * @event filesQueued\n             * @param {File} files 数组，内容为原始File(lib/File）对象。\n             * @description 当一批文件添加进队列以后触发。\n             * @for  Uploader\n             */\n            \n      /**\n             * @property {Boolean} [auto=false]\n             * @namespace options\n             * @for Uploader\n             * @description 设置为 true 后，不需要手动调用上传，有文件选择即开始上传。\n             * \n             */\n    \n      /**\n             * @method addFiles\n             * @grammar addFiles( file ) => undefined\n             * @grammar addFiles( [file1, file2 ...] ) => undefined\n             * @param {Array of File or File} [files] Files 对象 数组\n             * @description 添加文件到队列\n             * @for  Uploader\n             */\n      addFile: function( files ) {\n        var me = this;\n    \n        if ( !files.length ) {\n          files = [ files ];\n        }\n    \n        files = $.map( files, function( file ) {\n          return me._addFile( file );\n        });\n    \n        me.owner.trigger( 'filesQueued', files );\n    \n        if ( me.options.auto ) {\n          setTimeout(function() {\n            me.request('start-upload');\n          }, 20 );\n        }\n      },\n    \n      getStats: function() {\n        return this.stats;\n      },\n    \n      /**\n             * @event fileDequeued\n             * @param {File} file File对象\n             * @description 当文件被移除队列后触发。\n             * @for  Uploader\n             */\n    \n      /**\n             * @method removeFile\n             * @grammar removeFile( file ) => undefined\n             * @grammar removeFile( id ) => undefined\n             * @grammar removeFile( file, true ) => undefined\n             * @grammar removeFile( id, true ) => undefined\n             * @param {File|id} file File对象或这File对象的id\n             * @description 移除某一文件, 默认只会标记文件状态为已取消，如果第二个参数为 `true` 则会从 queue 中移除。\n             * @for  Uploader\n             * @example\n             *\n             * $li.on('click', '.remove-this', function() {\n             *     uploader.removeFile( file );\n             * })\n             */\n      removeFile: function( file, remove ) {\n        var me = this;\n    \n        file = file.id ? file : me.queue.getFile( file );\n    \n        this.request( 'cancel-file', file );\n    \n        if ( remove ) {\n          this.queue.removeFile( file );\n        }\n      },\n    \n      /**\n             * @method getFiles\n             * @grammar getFiles() => Array\n             * @grammar getFiles( status1, status2, status... ) => Array\n             * @description 返回指定状态的文件集合，不传参数将返回所有状态的文件。\n             * @for  Uploader\n             * @example\n             * console.log( uploader.getFiles() );    // => all files\n             * console.log( uploader.getFiles('error') )    // => all error files.\n             */\n      getFiles: function() {\n        return this.queue.getFiles.apply( this.queue, arguments );\n      },\n    \n      fetchFile: function() {\n        return this.queue.fetch.apply( this.queue, arguments );\n      },\n    \n      /**\n             * @method retry\n             * @grammar retry() => undefined\n             * @grammar retry( file ) => undefined\n             * @description 重试上传，重试指定文件，或者从出错的文件开始重新上传。\n             * @for  Uploader\n             * @example\n             * function retry() {\n             *     uploader.retry();\n             * }\n             */\n      retry: function( file, noForceStart ) {\n        var me = this,\n          files, i, len;\n    \n        if ( file ) {\n          file = file.id ? file : me.queue.getFile( file );\n          file.setStatus( Status.QUEUED );\n          noForceStart || me.request('start-upload');\n          return;\n        }\n    \n        files = me.queue.getFiles( Status.ERROR );\n        i = 0;\n        len = files.length;\n    \n        for ( ; i < len; i++ ) {\n          file = files[ i ];\n          file.setStatus( Status.QUEUED );\n        }\n    \n        me.request('start-upload');\n      },\n    \n      /**\n             * @method sort\n             * @grammar sort( fn ) => undefined\n             * @description 排序队列中的文件，在上传之前调整可以控制上传顺序。\n             * @for  Uploader\n             */\n      sortFiles: function() {\n        return this.queue.sort.apply( this.queue, arguments );\n      },\n    \n      /**\n             * @event reset\n             * @description 当 uploader 被重置的时候触发。\n             * @for  Uploader\n             */\n    \n      /**\n             * @method reset\n             * @grammar reset() => undefined\n             * @description 重置uploader。目前只重置了队列。\n             * @for  Uploader\n             * @example\n             * uploader.reset();\n             */\n      reset: function() {\n        this.owner.trigger('reset');\n        this.queue = new Queue();\n        this.stats = this.queue.stats;\n      },\n    \n      destroy: function() {\n        this.reset();\n        this.placeholder && this.placeholder.destroy();\n      }\n    });\n    \n  });\n  /**\n     * @fileOverview 添加获取Runtime相关信息的方法。\n     */\n  define('widgets/runtime',[\n    'uploader',\n    'runtime/runtime',\n    'widgets/widget'\n  ], function( Uploader, Runtime ) {\n    \n    Uploader.support = function() {\n      return Runtime.hasRuntime.apply( Runtime, arguments );\n    };\n    \n    /**\n         * @property {Object} [runtimeOrder=html5,flash]\n         * @namespace options\n         * @for Uploader\n         * @description 指定运行时启动顺序。默认会想尝试 html5 是否支持，如果支持则使用 html5, 否则则使用 flash.\n         *\n         * 可以将此值设置成 `flash`，来强制使用 flash 运行时。\n         */\n    \n    return Uploader.register({\n      name: 'runtime',\n    \n      init: function() {\n        if ( !this.predictRuntimeType() ) {\n          throw Error('Runtime Error');\n        }\n      },\n    \n      /**\n             * 预测Uploader将采用哪个`Runtime`\n             * @grammar predictRuntimeType() => String\n             * @method predictRuntimeType\n             * @for  Uploader\n             */\n      predictRuntimeType: function() {\n        var orders = this.options.runtimeOrder || Runtime.orders,\n          type = this.type,\n          i, len;\n    \n        if ( !type ) {\n          orders = orders.split( /\\s*,\\s*/g );\n    \n          for ( i = 0, len = orders.length; i < len; i++ ) {\n            if ( Runtime.hasRuntime( orders[ i ] ) ) {\n              this.type = type = orders[ i ];\n              break;\n            }\n          }\n        }\n    \n        return type;\n      }\n    });\n  });\n  /**\n     * @fileOverview Transport\n     */\n  define('lib/transport',[\n    'base',\n    'runtime/client',\n    'mediator'\n  ], function( Base, RuntimeClient, Mediator ) {\n    \n    var $ = Base.$;\n    \n    function Transport( opts ) {\n      var me = this;\n    \n      opts = me.options = $.extend( true, {}, Transport.options, opts || {} );\n      RuntimeClient.call( this, 'Transport' );\n    \n      this._blob = null;\n      this._formData = opts.formData || {};\n      this._headers = opts.headers || {};\n    \n      this.on( 'progress', this._timeout );\n      this.on( 'load error', function() {\n        me.trigger( 'progress', 1 );\n        clearTimeout( me._timer );\n      });\n    }\n    \n    Transport.options = {\n      server: '',\n      method: 'POST',\n    \n      // 跨域时，是否允许携带cookie, 只有html5 runtime才有效\n      withCredentials: false,\n      fileVal: 'file',\n      timeout: 2 * 60 * 1000,    // 2分钟\n      formData: {},\n      headers: {},\n      sendAsBinary: false\n    };\n    \n    $.extend( Transport.prototype, {\n    \n      // 添加Blob, 只能添加一次，最后一次有效。\n      appendBlob: function( key, blob, filename ) {\n        var me = this,\n          opts = me.options;\n    \n        if ( me.getRuid() ) {\n          me.disconnectRuntime();\n        }\n    \n        // 连接到blob归属的同一个runtime.\n        me.connectRuntime( blob.ruid, function() {\n          me.exec('init');\n        });\n    \n        me._blob = blob;\n        opts.fileVal = key || opts.fileVal;\n        opts.filename = filename || opts.filename;\n      },\n    \n      // 添加其他字段\n      append: function( key, value ) {\n        if ( typeof key === 'object' ) {\n          $.extend( this._formData, key );\n        } else {\n          this._formData[ key ] = value;\n        }\n      },\n    \n      setRequestHeader: function( key, value ) {\n        if ( typeof key === 'object' ) {\n          $.extend( this._headers, key );\n        } else {\n          this._headers[ key ] = value;\n        }\n      },\n    \n      send: function( method ) {\n        this.exec( 'send', method );\n        this._timeout();\n      },\n    \n      abort: function() {\n        clearTimeout( this._timer );\n        return this.exec('abort');\n      },\n    \n      destroy: function() {\n        this.trigger('destroy');\n        this.off();\n        this.exec('destroy');\n        this.disconnectRuntime();\n      },\n    \n      getResponse: function() {\n        return this.exec('getResponse');\n      },\n    \n      getResponseAsJson: function() {\n        return this.exec('getResponseAsJson');\n      },\n    \n      getStatus: function() {\n        return this.exec('getStatus');\n      },\n    \n      _timeout: function() {\n        var me = this,\n          duration = me.options.timeout;\n    \n        if ( !duration ) {\n          return;\n        }\n    \n        clearTimeout( me._timer );\n        me._timer = setTimeout(function() {\n          me.abort();\n          me.trigger( 'error', 'timeout' );\n        }, duration );\n      }\n    \n    });\n    \n    // 让Transport具备事件功能。\n    Mediator.installTo( Transport.prototype );\n    \n    return Transport;\n  });\n  /**\n     * @fileOverview 负责文件上传相关。\n     */\n  define('widgets/upload',[\n    'base',\n    'uploader',\n    'file',\n    'lib/transport',\n    'widgets/widget'\n  ], function( Base, Uploader, WUFile, Transport ) {\n    \n    var $ = Base.$,\n      isPromise = Base.isPromise,\n      Status = WUFile.Status;\n    \n    // 添加默认配置项\n    $.extend( Uploader.options, {\n    \n    \n      /**\n             * @property {Boolean} [prepareNextFile=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否允许在文件传输时提前把下一个文件准备好。\n             * 对于一个文件的准备工作比较耗时，比如图片压缩，md5序列化。\n             * 如果能提前在当前文件传输期处理，可以节省总体耗时。\n             */\n      prepareNextFile: false,\n    \n      /**\n             * @property {Boolean} [chunked=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否要分片处理大文件上传。\n             */\n      chunked: false,\n    \n      /**\n             * @property {Boolean} [chunkSize=5242880]\n             * @namespace options\n             * @for Uploader\n             * @description 如果要分片，分多大一片？ 默认大小为5M.\n             */\n      chunkSize: 5 * 1024 * 1024,\n    \n      /**\n             * @property {Boolean} [chunkRetry=2]\n             * @namespace options\n             * @for Uploader\n             * @description 如果某个分片由于网络问题出错，允许自动重传多少次？\n             */\n      chunkRetry: 2,\n    \n      /**\n             * @property {Boolean} [threads=3]\n             * @namespace options\n             * @for Uploader\n             * @description 上传并发数。允许同时最大上传进程数。\n             */\n      threads: 3,\n    \n    \n      /**\n             * @property {Object} [formData={}]\n             * @namespace options\n             * @for Uploader\n             * @description 文件上传请求的参数表，每次发送都会发送此对象中的参数。\n             */\n      formData: {}\n    \n      /**\n             * @property {Object} [fileVal='file']\n             * @namespace options\n             * @for Uploader\n             * @description 设置文件上传域的name。\n             */\n    \n      /**\n             * @property {Object} [method='POST']\n             * @namespace options\n             * @for Uploader\n             * @description 文件上传方式，`POST`或者`GET`。\n             */\n    \n      /**\n             * @property {Object} [sendAsBinary=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否已二进制的流的方式发送文件，这样整个上传内容`php://input`都为文件内容，\n             * 其他参数在$_GET数组中。\n             */\n    });\n    \n    // 负责将文件切片。\n    function CuteFile( file, chunkSize ) {\n      var pending = [],\n        blob = file.source,\n        total = blob.size,\n        chunks = chunkSize ? Math.ceil( total / chunkSize ) : 1,\n        start = 0,\n        index = 0,\n        len, api;\n    \n      api = {\n        file: file,\n    \n        has: function() {\n          return !!pending.length;\n        },\n    \n        shift: function() {\n          return pending.shift();\n        },\n    \n        unshift: function( block ) {\n          pending.unshift( block );\n        }\n      };\n    \n      while ( index < chunks ) {\n        len = Math.min( chunkSize, total - start );\n    \n        pending.push({\n          file: file,\n          start: start,\n          end: chunkSize ? (start + len) : total,\n          total: total,\n          chunks: chunks,\n          chunk: index++,\n          cuted: api\n        });\n        start += len;\n      }\n    \n      file.blocks = pending.concat();\n      file.remaning = pending.length;\n    \n      return api;\n    }\n    \n    Uploader.register({\n      name: 'upload',\n    \n      init: function() {\n        var owner = this.owner,\n          me = this;\n    \n        this.runing = false;\n        this.progress = false;\n    \n        owner\n          .on( 'startUpload', function() {\n            me.progress = true;\n          })\n          .on( 'uploadFinished', function() {\n            me.progress = false;\n          });\n    \n        // 记录当前正在传的数据，跟threads相关\n        this.pool = [];\n    \n        // 缓存分好片的文件。\n        this.stack = [];\n    \n        // 缓存即将上传的文件。\n        this.pending = [];\n    \n        // 跟踪还有多少分片在上传中但是没有完成上传。\n        this.remaning = 0;\n        this.__tick = Base.bindFn( this._tick, this );\n    \n        owner.on( 'uploadComplete', function( file ) {\n    \n          // 把其他块取消了。\n          file.blocks && $.each( file.blocks, function( _, v ) {\n            v.transport && (v.transport.abort(), v.transport.destroy());\n            delete v.transport;\n          });\n    \n          delete file.blocks;\n          delete file.remaning;\n        });\n      },\n    \n      reset: function() {\n        this.request( 'stop-upload', true );\n        this.runing = false;\n        this.pool = [];\n        this.stack = [];\n        this.pending = [];\n        this.remaning = 0;\n        this._trigged = false;\n        this._promise = null;\n      },\n    \n      /**\n             * @event startUpload\n             * @description 当开始上传流程时触发。\n             * @for  Uploader\n             */\n    \n      /**\n             * 开始上传。此方法可以从初始状态调用开始上传流程，也可以从暂停状态调用，继续上传流程。\n             *\n             * 可以指定开始某一个文件。\n             * @grammar upload() => undefined\n             * @grammar upload( file | fileId) => undefined\n             * @method upload\n             * @for  Uploader\n             */\n      startUpload: function(file) {\n        var me = this;\n    \n        // 移出invalid的文件\n        $.each( me.request( 'get-files', Status.INVALID ), function() {\n          me.request( 'remove-file', this );\n        });\n    \n        // 如果指定了开始某个文件，则只开始指定文件。\n        if ( file ) {\n          file = file.id ? file : me.request( 'get-file', file );\n    \n          if (file.getStatus() === Status.INTERRUPT) {\n            $.each( me.pool, function( _, v ) {\n    \n              // 之前暂停过。\n              if (v.file !== file) {\n                return;\n              }\n    \n              v.transport && v.transport.send();\n            });\n    \n            file.setStatus( Status.QUEUED );\n          } else if (file.getStatus() === Status.PROGRESS) {\n            return;\n          } else {\n            file.setStatus( Status.QUEUED );\n          }\n        } else {\n          $.each( me.request( 'get-files', [ Status.INITED ] ), function() {\n            this.setStatus( Status.QUEUED );\n          });\n        }\n    \n        if ( me.runing ) {\n          return;\n        }\n    \n        me.runing = true;\n    \n        var files = [];\n    \n        // 如果有暂停的，则续传\n        $.each( me.pool, function( _, v ) {\n          var file = v.file;\n    \n          if ( file.getStatus() === Status.INTERRUPT ) {\n            files.push(file);\n            me._trigged = false;\n            v.transport && v.transport.send();\n          }\n        });\n    \n        var file;\n        while ( (file = files.shift()) ) {\n          file.setStatus( Status.PROGRESS );\n        }\n    \n        file || $.each( me.request( 'get-files',\n          Status.INTERRUPT ), function() {\n          this.setStatus( Status.PROGRESS );\n        });\n    \n        me._trigged = false;\n        Base.nextTick( me.__tick );\n        me.owner.trigger('startUpload');\n      },\n    \n      /**\n             * @event stopUpload\n             * @description 当开始上传流程暂停时触发。\n             * @for  Uploader\n             */\n    \n      /**\n             * 暂停上传。第一个参数为是否中断上传当前正在上传的文件。\n             *\n             * 如果第一个参数是文件，则只暂停指定文件。\n             * @grammar stop() => undefined\n             * @grammar stop( true ) => undefined\n             * @grammar stop( file ) => undefined\n             * @method stop\n             * @for  Uploader\n             */\n      stopUpload: function( file, interrupt ) {\n        var me = this;\n    \n        if (file === true) {\n          interrupt = file;\n          file = null;\n        }\n    \n        if ( me.runing === false ) {\n          return;\n        }\n    \n        // 如果只是暂停某个文件。\n        if ( file ) {\n          file = file.id ? file : me.request( 'get-file', file );\n    \n          if ( file.getStatus() !== Status.PROGRESS &&\n                            file.getStatus() !== Status.QUEUED ) {\n            return;\n          }\n    \n          file.setStatus( Status.INTERRUPT );\n          $.each( me.pool, function( _, v ) {\n    \n            // 只 abort 指定的文件。\n            if (v.file !== file) {\n              return;\n            }\n    \n            v.transport && v.transport.abort();\n            me._putback(v);\n            me._popBlock(v);\n          });\n    \n          return Base.nextTick( me.__tick );\n        }\n    \n        me.runing = false;\n    \n        if (this._promise && this._promise.file) {\n          this._promise.file.setStatus( Status.INTERRUPT );\n        }\n    \n        interrupt && $.each( me.pool, function( _, v ) {\n          v.transport && v.transport.abort();\n          v.file.setStatus( Status.INTERRUPT );\n        });\n    \n        me.owner.trigger('stopUpload');\n      },\n    \n      /**\n             * @method cancelFile\n             * @grammar cancelFile( file ) => undefined\n             * @grammar cancelFile( id ) => undefined\n             * @param {File|id} file File对象或这File对象的id\n             * @description 标记文件状态为已取消, 同时将中断文件传输。\n             * @for  Uploader\n             * @example\n             *\n             * $li.on('click', '.remove-this', function() {\n             *     uploader.cancelFile( file );\n             * })\n             */\n      cancelFile: function( file ) {\n        file = file.id ? file : this.request( 'get-file', file );\n    \n        // 如果正在上传。\n        file.blocks && $.each( file.blocks, function( _, v ) {\n          var _tr = v.transport;\n    \n          if ( _tr ) {\n            _tr.abort();\n            _tr.destroy();\n            delete v.transport;\n          }\n        });\n    \n        file.setStatus( Status.CANCELLED );\n        this.owner.trigger( 'fileDequeued', file );\n      },\n    \n      /**\n             * 判断`Uplaode`r是否正在上传中。\n             * @grammar isInProgress() => Boolean\n             * @method isInProgress\n             * @for  Uploader\n             */\n      isInProgress: function() {\n        return !!this.progress;\n      },\n    \n      _getStats: function() {\n        return this.request('get-stats');\n      },\n    \n      /**\n             * 掉过一个文件上传，直接标记指定文件为已上传状态。\n             * @grammar skipFile( file ) => undefined\n             * @method skipFile\n             * @for  Uploader\n             */\n      skipFile: function( file, status ) {\n        file = file.id ? file : this.request( 'get-file', file );\n    \n        file.setStatus( status || Status.COMPLETE );\n        file.skipped = true;\n    \n        // 如果正在上传。\n        file.blocks && $.each( file.blocks, function( _, v ) {\n          var _tr = v.transport;\n    \n          if ( _tr ) {\n            _tr.abort();\n            _tr.destroy();\n            delete v.transport;\n          }\n        });\n    \n        this.owner.trigger( 'uploadSkip', file );\n      },\n    \n      /**\n             * @event uploadFinished\n             * @description 当所有文件上传结束时触发。\n             * @for  Uploader\n             */\n      _tick: function() {\n        var me = this,\n          opts = me.options,\n          fn, val;\n    \n        // 上一个promise还没有结束，则等待完成后再执行。\n        if ( me._promise ) {\n          return me._promise.always( me.__tick );\n        }\n    \n        // 还有位置，且还有文件要处理的话。\n        if ( me.pool.length < opts.threads && (val = me._nextBlock()) ) {\n          me._trigged = false;\n    \n          fn = function( val ) {\n            me._promise = null;\n    \n            // 有可能是reject过来的，所以要检测val的类型。\n            val && val.file && me._startSend( val );\n            Base.nextTick( me.__tick );\n          };\n    \n          me._promise = isPromise( val ) ? val.always( fn ) : fn( val );\n    \n          // 没有要上传的了，且没有正在传输的了。\n        } else if ( !me.remaning && !me._getStats().numOfQueue &&\n                    !me._getStats().numofInterrupt ) {\n          me.runing = false;\n    \n          me._trigged || Base.nextTick(function() {\n            me.owner.trigger('uploadFinished');\n          });\n          me._trigged = true;\n        }\n      },\n    \n      _putback: function(block) {\n        var idx;\n    \n        block.cuted.unshift(block);\n        idx = this.stack.indexOf(block.cuted);\n    \n        if (!~idx) {\n          this.stack.unshift(block.cuted);\n        }\n      },\n    \n      _getStack: function() {\n        var i = 0,\n          act;\n    \n        while ( (act = this.stack[ i++ ]) ) {\n          if ( act.has() && act.file.getStatus() === Status.PROGRESS ) {\n            return act;\n          } else if (!act.has() ||\n                            act.file.getStatus() !== Status.PROGRESS &&\n                            act.file.getStatus() !== Status.INTERRUPT ) {\n    \n            // 把已经处理完了的，或者，状态为非 progress（上传中）、\n            // interupt（暂停中） 的移除。\n            this.stack.splice( --i, 1 );\n          }\n        }\n    \n        return null;\n      },\n    \n      _nextBlock: function() {\n        var me = this,\n          opts = me.options,\n          act, next, done, preparing;\n    \n        // 如果当前文件还有没有需要传输的，则直接返回剩下的。\n        if ( (act = this._getStack()) ) {\n    \n          // 是否提前准备下一个文件\n          if ( opts.prepareNextFile && !me.pending.length ) {\n            me._prepareNextFile();\n          }\n    \n          return act.shift();\n    \n          // 否则，如果正在运行，则准备下一个文件，并等待完成后返回下个分片。\n        } else if ( me.runing ) {\n    \n          // 如果缓存中有，则直接在缓存中取，没有则去queue中取。\n          if ( !me.pending.length && me._getStats().numOfQueue ) {\n            me._prepareNextFile();\n          }\n    \n          next = me.pending.shift();\n          done = function( file ) {\n            if ( !file ) {\n              return null;\n            }\n    \n            act = CuteFile( file, opts.chunked ? opts.chunkSize : 0 );\n            me.stack.push(act);\n            return act.shift();\n          };\n    \n          // 文件可能还在prepare中，也有可能已经完全准备好了。\n          if ( isPromise( next) ) {\n            preparing = next.file;\n            next = next[ next.pipe ? 'pipe' : 'then' ]( done );\n            next.file = preparing;\n            return next;\n          }\n    \n          return done( next );\n        }\n      },\n    \n    \n      /**\n             * @event uploadStart\n             * @param {File} file File对象\n             * @description 某个文件开始上传前触发，一个文件只会触发一次。\n             * @for  Uploader\n             */\n      _prepareNextFile: function() {\n        var me = this,\n          file = me.request('fetch-file'),\n          pending = me.pending,\n          promise;\n    \n        if ( file ) {\n          promise = me.request( 'before-send-file', file, function() {\n    \n            // 有可能文件被skip掉了。文件被skip掉后，状态坑定不是Queued.\n            if ( file.getStatus() === Status.PROGRESS ||\n                            file.getStatus() === Status.INTERRUPT ) {\n              return file;\n            }\n    \n            return me._finishFile( file );\n          });\n    \n          me.owner.trigger( 'uploadStart', file );\n          file.setStatus( Status.PROGRESS );\n    \n          promise.file = file;\n    \n          // 如果还在pending中，则替换成文件本身。\n          promise.done(function() {\n            var idx = $.inArray( promise, pending );\n    \n            ~idx && pending.splice( idx, 1, file );\n          });\n    \n          // befeore-send-file的钩子就有错误发生。\n          promise.fail(function( reason ) {\n            file.setStatus( Status.ERROR, reason );\n            me.owner.trigger( 'uploadError', file, reason );\n            me.owner.trigger( 'uploadComplete', file );\n          });\n    \n          pending.push( promise );\n        }\n      },\n    \n      // 让出位置了，可以让其他分片开始上传\n      _popBlock: function( block ) {\n        var idx = $.inArray( block, this.pool );\n    \n        this.pool.splice( idx, 1 );\n        block.file.remaning--;\n        this.remaning--;\n      },\n    \n      // 开始上传，可以被掉过。如果promise被reject了，则表示跳过此分片。\n      _startSend: function( block ) {\n        var me = this,\n          file = block.file,\n          promise;\n    \n        // 有可能在 before-send-file 的 promise 期间改变了文件状态。\n        // 如：暂停，取消\n        // 我们不能中断 promise, 但是可以在 promise 完后，不做上传操作。\n        if ( file.getStatus() !== Status.PROGRESS ) {\n    \n          // 如果是中断，则还需要放回去。\n          if (file.getStatus() === Status.INTERRUPT) {\n            me._putback(block);\n          }\n    \n          return;\n        }\n    \n        me.pool.push( block );\n        me.remaning++;\n    \n        // 如果没有分片，则直接使用原始的。\n        // 不会丢失content-type信息。\n        block.blob = block.chunks === 1 ? file.source :\n          file.source.slice( block.start, block.end );\n    \n        // hook, 每个分片发送之前可能要做些异步的事情。\n        promise = me.request( 'before-send', block, function() {\n    \n          // 有可能文件已经上传出错了，所以不需要再传输了。\n          if ( file.getStatus() === Status.PROGRESS ) {\n            me._doSend( block );\n          } else {\n            me._popBlock( block );\n            Base.nextTick( me.__tick );\n          }\n        });\n    \n        // 如果为fail了，则跳过此分片。\n        promise.fail(function() {\n          if ( file.remaning === 1 ) {\n            me._finishFile( file ).always(function() {\n              block.percentage = 1;\n              me._popBlock( block );\n              me.owner.trigger( 'uploadComplete', file );\n              Base.nextTick( me.__tick );\n            });\n          } else {\n            block.percentage = 1;\n            me.updateFileProgress( file );\n            me._popBlock( block );\n            Base.nextTick( me.__tick );\n          }\n        });\n      },\n    \n    \n      /**\n             * @event uploadBeforeSend\n             * @param {Object} object\n             * @param {Object} data 默认的上传参数，可以扩展此对象来控制上传参数。\n             * @param {Object} headers 可以扩展此对象来控制上传头部。\n             * @description 当某个文件的分块在发送前触发，主要用来询问是否要添加附带参数，大文件在开起分片上传的前提下此事件可能会触发多次。\n             * @for  Uploader\n             */\n    \n      /**\n             * @event uploadAccept\n             * @param {Object} object\n             * @param {Object} ret 服务端的返回数据，json格式，如果服务端不是json格式，从ret._raw中取数据，自行解析。\n             * @description 当某个文件上传到服务端响应后，会派送此事件来询问服务端响应是否有效。如果此事件handler返回值为`false`, 则此文件将派送`server`类型的`uploadError`事件。\n             * @for  Uploader\n             */\n    \n      /**\n             * @event uploadProgress\n             * @param {File} file File对象\n             * @param {Number} percentage 上传进度\n             * @description 上传过程中触发，携带上传进度。\n             * @for  Uploader\n             */\n    \n    \n      /**\n             * @event uploadError\n             * @param {File} file File对象\n             * @param {String} reason 出错的code\n             * @description 当文件上传出错时触发。\n             * @for  Uploader\n             */\n    \n      /**\n             * @event uploadSuccess\n             * @param {File} file File对象\n             * @param {Object} response 服务端返回的数据\n             * @description 当文件上传成功时触发。\n             * @for  Uploader\n             */\n    \n      /**\n             * @event uploadComplete\n             * @param {File} [file] File对象\n             * @description 不管成功或者失败，文件上传完成时触发。\n             * @for  Uploader\n             */\n    \n      // 做上传操作。\n      _doSend: function( block ) {\n        var me = this,\n          owner = me.owner,\n          opts = me.options,\n          file = block.file,\n          tr = new Transport( opts ),\n          data = $.extend({}, opts.formData ),\n          headers = $.extend({}, opts.headers ),\n          requestAccept, ret;\n    \n        block.transport = tr;\n    \n        tr.on( 'destroy', function() {\n          delete block.transport;\n          me._popBlock( block );\n          Base.nextTick( me.__tick );\n        });\n    \n        // 广播上传进度。以文件为单位。\n        tr.on( 'progress', function( percentage ) {\n          block.percentage = percentage;\n          me.updateFileProgress( file );\n        });\n    \n        // 用来询问，是否返回的结果是有错误的。\n        requestAccept = function( reject ) {\n          var fn;\n    \n          ret = tr.getResponseAsJson() || {};\n          ret._raw = tr.getResponse();\n          fn = function( value ) {\n            reject = value;\n          };\n    \n          // 服务端响应了，不代表成功了，询问是否响应正确。\n          if ( !owner.trigger( 'uploadAccept', block, ret, fn ) ) {\n            reject = reject || 'server';\n          }\n    \n          return reject;\n        };\n    \n        // 尝试重试，然后广播文件上传出错。\n        tr.on( 'error', function( type, flag ) {\n          block.retried = block.retried || 0;\n    \n          // 自动重试\n          if ( block.chunks > 1 && ~'http,abort'.indexOf( type ) &&\n                            block.retried < opts.chunkRetry ) {\n    \n            block.retried++;\n            tr.send();\n    \n          } else {\n    \n            // http status 500 ~ 600\n            if ( !flag && type === 'server' ) {\n              type = requestAccept( type );\n            }\n    \n            file.setStatus( Status.ERROR, type );\n            owner.trigger( 'uploadError', file, type );\n            owner.trigger( 'uploadComplete', file );\n          }\n        });\n    \n        // 上传成功\n        tr.on( 'load', function() {\n          var reason;\n    \n          // 如果非预期，转向上传出错。\n          if ( (reason = requestAccept()) ) {\n            tr.trigger( 'error', reason, true );\n            return;\n          }\n    \n          // 全部上传完成。\n          if ( file.remaning === 1 ) {\n            me._finishFile( file, ret );\n          } else {\n            tr.destroy();\n          }\n        });\n    \n        // 配置默认的上传字段。\n        data = $.extend( data, {\n          id: file.id,\n          name: file.name,\n          type: file.type,\n          lastModifiedDate: file.lastModifiedDate,\n          size: file.size\n        });\n    \n        block.chunks > 1 && $.extend( data, {\n          chunks: block.chunks,\n          chunk: block.chunk\n        });\n    \n        // 在发送之间可以添加字段什么的。。。\n        // 如果默认的字段不够使用，可以通过监听此事件来扩展\n        owner.trigger( 'uploadBeforeSend', block, data, headers );\n    \n        // 开始发送。\n        tr.appendBlob( opts.fileVal, block.blob, file.name );\n        tr.append( data );\n        tr.setRequestHeader( headers );\n        tr.send();\n      },\n    \n      // 完成上传。\n      _finishFile: function( file, ret, hds ) {\n        var owner = this.owner;\n    \n        return owner\n          .request( 'after-send-file', arguments, function() {\n            file.setStatus( Status.COMPLETE );\n            owner.trigger( 'uploadSuccess', file, ret, hds );\n          })\n          .fail(function( reason ) {\n    \n            // 如果外部已经标记为invalid什么的，不再改状态。\n            if ( file.getStatus() === Status.PROGRESS ) {\n              file.setStatus( Status.ERROR, reason );\n            }\n    \n            owner.trigger( 'uploadError', file, reason );\n          })\n          .always(function() {\n            owner.trigger( 'uploadComplete', file );\n          });\n      },\n    \n      updateFileProgress: function(file) {\n        var totalPercent = 0,\n          uploaded = 0;\n    \n        if (!file.blocks) {\n          return;\n        }\n    \n        $.each( file.blocks, function( _, v ) {\n          uploaded += (v.percentage || 0) * (v.end - v.start);\n        });\n    \n        totalPercent = uploaded / file.size;\n        this.owner.trigger( 'uploadProgress', file, totalPercent || 0 );\n      }\n    \n    });\n  });\n  /**\n     * @fileOverview 各种验证，包括文件总大小是否超出、单文件是否超出和文件是否重复。\n     */\n    \n  define('widgets/validator',[\n    'base',\n    'uploader',\n    'file',\n    'widgets/widget'\n  ], function( Base, Uploader, WUFile ) {\n    \n    var $ = Base.$,\n      validators = {},\n      api;\n    \n    /**\n         * @event error\n         * @param {String} type 错误类型。\n         * @description 当validate不通过时，会以派送错误事件的形式通知调用者。通过`upload.on('error', handler)`可以捕获到此类错误，目前有以下错误会在特定的情况下派送错来。\n         *\n         * * `Q_EXCEED_NUM_LIMIT` 在设置了`fileNumLimit`且尝试给`uploader`添加的文件数量超出这个值时派送。\n         * * `Q_EXCEED_SIZE_LIMIT` 在设置了`Q_EXCEED_SIZE_LIMIT`且尝试给`uploader`添加的文件总大小超出这个值时派送。\n         * * `Q_TYPE_DENIED` 当文件类型不满足时触发。。\n         * @for  Uploader\n         */\n    \n    // 暴露给外面的api\n    api = {\n    \n      // 添加验证器\n      addValidator: function( type, cb ) {\n        validators[ type ] = cb;\n      },\n    \n      // 移除验证器\n      removeValidator: function( type ) {\n        delete validators[ type ];\n      }\n    };\n    \n    // 在Uploader初始化的时候启动Validators的初始化\n    Uploader.register({\n      name: 'validator',\n    \n      init: function() {\n        var me = this;\n        Base.nextTick(function() {\n          $.each( validators, function() {\n            this.call( me.owner );\n          });\n        });\n      }\n    });\n    \n    /**\n         * @property {int} [fileNumLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证文件总数量, 超出则不允许加入队列。\n         */\n    api.addValidator( 'fileNumLimit', function() {\n      var uploader = this,\n        opts = uploader.options,\n        count = 0,\n        max = parseInt( opts.fileNumLimit, 10 ),\n        flag = true;\n    \n      if ( !max ) {\n        return;\n      }\n    \n      uploader.on( 'beforeFileQueued', function( file ) {\n    \n        if ( count >= max && flag ) {\n          flag = false;\n          this.trigger( 'error', 'Q_EXCEED_NUM_LIMIT', max, file );\n          setTimeout(function() {\n            flag = true;\n          }, 1 );\n        }\n    \n        return count >= max ? false : true;\n      });\n    \n      uploader.on( 'fileQueued', function() {\n        count++;\n      });\n    \n      uploader.on( 'fileDequeued', function() {\n        count--;\n      });\n    \n      uploader.on( 'reset', function() {\n        count = 0;\n      });\n    });\n    \n    \n    /**\n         * @property {int} [fileSizeLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证文件总大小是否超出限制, 超出则不允许加入队列。\n         */\n    api.addValidator( 'fileSizeLimit', function() {\n      var uploader = this,\n        opts = uploader.options,\n        count = 0,\n        max = parseInt( opts.fileSizeLimit, 10 ),\n        flag = true;\n    \n      if ( !max ) {\n        return;\n      }\n    \n      uploader.on( 'beforeFileQueued', function( file ) {\n        var invalid = count + file.size > max;\n    \n        if ( invalid && flag ) {\n          flag = false;\n          this.trigger( 'error', 'Q_EXCEED_SIZE_LIMIT', max, file );\n          setTimeout(function() {\n            flag = true;\n          }, 1 );\n        }\n    \n        return invalid ? false : true;\n      });\n    \n      uploader.on( 'fileQueued', function( file ) {\n        count += file.size;\n      });\n    \n      uploader.on( 'fileDequeued', function( file ) {\n        count -= file.size;\n      });\n    \n      uploader.on( 'reset', function() {\n        count = 0;\n      });\n    });\n    \n    /**\n         * @property {int} [fileSingleSizeLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证单个文件大小是否超出限制, 超出则不允许加入队列。\n         */\n    api.addValidator( 'fileSingleSizeLimit', function() {\n      var uploader = this,\n        opts = uploader.options,\n        max = opts.fileSingleSizeLimit;\n    \n      if ( !max ) {\n        return;\n      }\n    \n      uploader.on( 'beforeFileQueued', function( file ) {\n    \n        if ( file.size > max ) {\n          file.setStatus( WUFile.Status.INVALID, 'exceed_size' );\n          this.trigger( 'error', 'F_EXCEED_SIZE', max, file );\n          return false;\n        }\n    \n      });\n    \n    });\n    \n    /**\n         * @property {Boolean} [duplicate=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 去重， 根据文件名字、文件大小和最后修改时间来生成hash Key.\n         */\n    api.addValidator( 'duplicate', function() {\n      var uploader = this,\n        opts = uploader.options,\n        mapping = {};\n    \n      if ( opts.duplicate ) {\n        return;\n      }\n    \n      function hashString( str ) {\n        var hash = 0,\n          i = 0,\n          len = str.length,\n          _char;\n    \n        for ( ; i < len; i++ ) {\n          _char = str.charCodeAt( i );\n          hash = _char + (hash << 6) + (hash << 16) - hash;\n        }\n    \n        return hash;\n      }\n    \n      uploader.on( 'beforeFileQueued', function( file ) {\n        var hash = file.__hash || (file.__hash = hashString( file.name +\n                        file.size + file.lastModifiedDate ));\n    \n        // 已经重复了\n        if ( mapping[ hash ] ) {\n          this.trigger( 'error', 'F_DUPLICATE', file );\n          return false;\n        }\n      });\n    \n      uploader.on( 'fileQueued', function( file ) {\n        var hash = file.__hash;\n    \n        hash && (mapping[ hash ] = true);\n      });\n    \n      uploader.on( 'fileDequeued', function( file ) {\n        var hash = file.__hash;\n    \n        hash && (delete mapping[ hash ]);\n      });\n    \n      uploader.on( 'reset', function() {\n        mapping = {};\n      });\n    });\n    \n    return api;\n  });\n    \n  /**\n     * @fileOverview Md5\n     */\n  define('lib/md5',[\n    'runtime/client',\n    'mediator'\n  ], function( RuntimeClient, Mediator ) {\n    \n    function Md5() {\n      RuntimeClient.call( this, 'Md5' );\n    }\n    \n    // 让 Md5 具备事件功能。\n    Mediator.installTo( Md5.prototype );\n    \n    Md5.prototype.loadFromBlob = function( blob ) {\n      var me = this;\n    \n      if ( me.getRuid() ) {\n        me.disconnectRuntime();\n      }\n    \n      // 连接到blob归属的同一个runtime.\n      me.connectRuntime( blob.ruid, function() {\n        me.exec('init');\n        me.exec( 'loadFromBlob', blob );\n      });\n    };\n    \n    Md5.prototype.getResult = function() {\n      return this.exec('getResult');\n    };\n    \n    return Md5;\n  });\n  /**\n     * @fileOverview 图片操作, 负责预览图片和上传前压缩图片\n     */\n  define('widgets/md5',[\n    'base',\n    'uploader',\n    'lib/md5',\n    'lib/blob',\n    'widgets/widget'\n  ], function( Base, Uploader, Md5, Blob ) {\n    \n    return Uploader.register({\n      name: 'md5',\n    \n    \n      /**\n             * 计算文件 md5 值，返回一个 promise 对象，可以监听 progress 进度。\n             *\n             *\n             * @method md5File\n             * @grammar md5File( file[, start[, end]] ) => promise\n             * @for Uploader\n             * @example\n             *\n             * uploader.on( 'fileQueued', function( file ) {\n             *     var $li = ...;\n             *\n             *     uploader.md5File( file )\n             *\n             *         // 及时显示进度\n             *         .progress(function(percentage) {\n             *             console.log('Percentage:', percentage);\n             *         })\n             *\n             *         // 完成\n             *         .then(function(val) {\n             *             console.log('md5 result:', val);\n             *         });\n             *\n             * });\n             */\n      md5File: function( file, start, end ) {\n        var md5 = new Md5(),\n          deferred = Base.Deferred(),\n          blob = (file instanceof Blob) ? file :\n            this.request( 'get-file', file ).source;\n    \n        md5.on( 'progress load', function( e ) {\n          e = e || {};\n          deferred.notify( e.total ? e.loaded / e.total : 1 );\n        });\n    \n        md5.on( 'complete', function() {\n          deferred.resolve( md5.getResult() );\n        });\n    \n        md5.on( 'error', function( reason ) {\n          deferred.reject( reason );\n        });\n    \n        if ( arguments.length > 1 ) {\n          start = start || 0;\n          end = end || 0;\n          start < 0 && (start = blob.size + start);\n          end < 0 && (end = blob.size + end);\n          end = Math.min( end, blob.size );\n          blob = blob.slice( start, end );\n        }\n    \n        md5.loadFromBlob( blob );\n    \n        return deferred.promise();\n      }\n    });\n  });\n  /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n  define('runtime/compbase',[],function() {\n    \n    function CompBase( owner, runtime ) {\n    \n      this.owner = owner;\n      this.options = owner.options;\n    \n      this.getRuntime = function() {\n        return runtime;\n      };\n    \n      this.getRuid = function() {\n        return runtime.uid;\n      };\n    \n      this.trigger = function() {\n        return owner.trigger.apply( owner, arguments );\n      };\n    }\n    \n    return CompBase;\n  });\n  /**\n     * @fileOverview Html5Runtime\n     */\n  define('runtime/html5/runtime',[\n    'base',\n    'runtime/runtime',\n    'runtime/compbase'\n  ], function( Base, Runtime, CompBase ) {\n    \n    var type = 'html5',\n      components = {};\n    \n    function Html5Runtime() {\n      var pool = {},\n        me = this,\n        destroy = this.destroy;\n    \n      Runtime.apply( me, arguments );\n      me.type = type;\n    \n    \n      // 这个方法的调用者，实际上是RuntimeClient\n      me.exec = function( comp, fn/*, args...*/) {\n        var client = this,\n          uid = client.uid,\n          args = Base.slice( arguments, 2 ),\n          instance;\n    \n        if ( components[ comp ] ) {\n          instance = pool[ uid ] = pool[ uid ] ||\n                            new components[ comp ]( client, me );\n    \n          if ( instance[ fn ] ) {\n            return instance[ fn ].apply( instance, args );\n          }\n        }\n      };\n    \n      me.destroy = function() {\n        // @todo 删除池子中的所有实例\n        return destroy && destroy.apply( this, arguments );\n      };\n    }\n    \n    Base.inherits( Runtime, {\n      constructor: Html5Runtime,\n    \n      // 不需要连接其他程序，直接执行callback\n      init: function() {\n        var me = this;\n        setTimeout(function() {\n          me.trigger('ready');\n        }, 1 );\n      }\n    \n    });\n    \n    // 注册Components\n    Html5Runtime.register = function( name, component ) {\n      var klass = components[ name ] = Base.inherits( CompBase, component );\n      return klass;\n    };\n    \n    // 注册html5运行时。\n    // 只有在支持的前提下注册。\n    if ( window.Blob && window.FileReader && window.DataView ) {\n      Runtime.addRuntime( type, Html5Runtime );\n    }\n    \n    return Html5Runtime;\n  });\n  /**\n     * @fileOverview Blob Html实现\n     */\n  define('runtime/html5/blob',[\n    'runtime/html5/runtime',\n    'lib/blob'\n  ], function( Html5Runtime, Blob ) {\n    \n    return Html5Runtime.register( 'Blob', {\n      slice: function( start, end ) {\n        var blob = this.owner.source,\n          slice = blob.slice || blob.webkitSlice || blob.mozSlice;\n    \n        blob = slice.call( blob, start, end );\n    \n        return new Blob( this.getRuid(), blob );\n      }\n    });\n  });\n  /**\n     * @fileOverview FilePaste\n     */\n  define('runtime/html5/dnd',[\n    'base',\n    'runtime/html5/runtime',\n    'lib/file'\n  ], function( Base, Html5Runtime, File ) {\n    \n    var $ = Base.$,\n      prefix = 'webuploader-dnd-';\n    \n    return Html5Runtime.register( 'DragAndDrop', {\n      init: function() {\n        var elem = this.elem = this.options.container;\n    \n        this.dragEnterHandler = Base.bindFn( this._dragEnterHandler, this );\n        this.dragOverHandler = Base.bindFn( this._dragOverHandler, this );\n        this.dragLeaveHandler = Base.bindFn( this._dragLeaveHandler, this );\n        this.dropHandler = Base.bindFn( this._dropHandler, this );\n        this.dndOver = false;\n    \n        elem.on( 'dragenter', this.dragEnterHandler );\n        elem.on( 'dragover', this.dragOverHandler );\n        elem.on( 'dragleave', this.dragLeaveHandler );\n        elem.on( 'drop', this.dropHandler );\n    \n        if ( this.options.disableGlobalDnd ) {\n          $( document ).on( 'dragover', this.dragOverHandler );\n          $( document ).on( 'drop', this.dropHandler );\n        }\n      },\n    \n      _dragEnterHandler: function( e ) {\n        var me = this,\n          denied = me._denied || false,\n          items;\n    \n        e = e.originalEvent || e;\n    \n        if ( !me.dndOver ) {\n          me.dndOver = true;\n    \n          // 注意只有 chrome 支持。\n          items = e.dataTransfer.items;\n    \n          if ( items && items.length ) {\n            me._denied = denied = !me.trigger( 'accept', items );\n          }\n    \n          me.elem.addClass( prefix + 'over' );\n          me.elem[ denied ? 'addClass' :\n            'removeClass' ]( prefix + 'denied' );\n        }\n    \n        e.dataTransfer.dropEffect = denied ? 'none' : 'copy';\n    \n        return false;\n      },\n    \n      _dragOverHandler: function( e ) {\n        // 只处理框内的。\n        var parentElem = this.elem.parent().get( 0 );\n        if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\n          return false;\n        }\n    \n        clearTimeout( this._leaveTimer );\n        this._dragEnterHandler.call( this, e );\n    \n        return false;\n      },\n    \n      _dragLeaveHandler: function() {\n        var me = this,\n          handler;\n    \n        handler = function() {\n          me.dndOver = false;\n          me.elem.removeClass( prefix + 'over ' + prefix + 'denied' );\n        };\n    \n        clearTimeout( me._leaveTimer );\n        me._leaveTimer = setTimeout( handler, 100 );\n        return false;\n      },\n    \n      _dropHandler: function( e ) {\n        var me = this,\n          ruid = me.getRuid(),\n          parentElem = me.elem.parent().get( 0 ),\n          dataTransfer, data;\n    \n        // 只处理框内的。\n        if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\n          return false;\n        }\n    \n        e = e.originalEvent || e;\n        dataTransfer = e.dataTransfer;\n    \n        // 如果是页面内拖拽，还不能处理，不阻止事件。\n        // 此处 ie11 下会报参数错误，\n        try {\n          data = dataTransfer.getData('text/html');\n        } catch( err ) {\n        }\n    \n        me.dndOver = false;\n        me.elem.removeClass( prefix + 'over' );\n    \n        if ( data || !dataTransfer ) {\n          return;\n        }\n    \n        me._getTansferFiles( dataTransfer, function( results ) {\n          me.trigger( 'drop', $.map( results, function( file ) {\n            return new File( ruid, file );\n          }) );\n        });\n    \n        return false;\n      },\n    \n      // 如果传入 callback 则去查看文件夹，否则只管当前文件夹。\n      _getTansferFiles: function( dataTransfer, callback ) {\n        var results  = [],\n          promises = [],\n          items, files, file, item, i, len, canAccessFolder;\n    \n        items = dataTransfer.items;\n        files = dataTransfer.files;\n    \n        canAccessFolder = !!(items && items[ 0 ].webkitGetAsEntry);\n    \n        for ( i = 0, len = files.length; i < len; i++ ) {\n          file = files[ i ];\n          item = items && items[ i ];\n    \n          if ( canAccessFolder && item.webkitGetAsEntry().isDirectory ) {\n    \n            promises.push( this._traverseDirectoryTree(\n              item.webkitGetAsEntry(), results ) );\n          } else {\n            results.push( file );\n          }\n        }\n    \n        Base.when.apply( Base, promises ).done(function() {\n    \n          if ( !results.length ) {\n            return;\n          }\n    \n          callback( results );\n        });\n      },\n    \n      _traverseDirectoryTree: function( entry, results ) {\n        var deferred = Base.Deferred(),\n          me = this;\n    \n        if ( entry.isFile ) {\n          entry.file(function( file ) {\n            results.push( file );\n            deferred.resolve();\n          });\n        } else if ( entry.isDirectory ) {\n          entry.createReader().readEntries(function( entries ) {\n            var len = entries.length,\n              promises = [],\n              arr = [],    // 为了保证顺序。\n              i;\n    \n            for ( i = 0; i < len; i++ ) {\n              promises.push( me._traverseDirectoryTree(\n                entries[ i ], arr ) );\n            }\n    \n            Base.when.apply( Base, promises ).then(function() {\n              results.push.apply( results, arr );\n              deferred.resolve();\n            }, deferred.reject );\n          });\n        }\n    \n        return deferred.promise();\n      },\n    \n      destroy: function() {\n        var elem = this.elem;\n    \n        // 还没 init 就调用 destroy\n        if (!elem) {\n          return;\n        }\n    \n        elem.off( 'dragenter', this.dragEnterHandler );\n        elem.off( 'dragover', this.dragOverHandler );\n        elem.off( 'dragleave', this.dragLeaveHandler );\n        elem.off( 'drop', this.dropHandler );\n    \n        if ( this.options.disableGlobalDnd ) {\n          $( document ).off( 'dragover', this.dragOverHandler );\n          $( document ).off( 'drop', this.dropHandler );\n        }\n      }\n    });\n  });\n    \n  /**\n     * @fileOverview FilePaste\n     */\n  define('runtime/html5/filepaste',[\n    'base',\n    'runtime/html5/runtime',\n    'lib/file'\n  ], function( Base, Html5Runtime, File ) {\n    \n    return Html5Runtime.register( 'FilePaste', {\n      init: function() {\n        var opts = this.options,\n          elem = this.elem = opts.container,\n          accept = '.*',\n          arr, i, len, item;\n    \n        // accetp的mimeTypes中生成匹配正则。\n        if ( opts.accept ) {\n          arr = [];\n    \n          for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n            item = opts.accept[ i ].mimeTypes;\n            item && arr.push( item );\n          }\n    \n          if ( arr.length ) {\n            accept = arr.join(',');\n            accept = accept.replace( /,/g, '|' ).replace( /\\*/g, '.*' );\n          }\n        }\n        this.accept = accept = new RegExp( accept, 'i' );\n        this.hander = Base.bindFn( this._pasteHander, this );\n        elem.on( 'paste', this.hander );\n      },\n    \n      _pasteHander: function( e ) {\n        var allowed = [],\n          ruid = this.getRuid(),\n          items, item, blob, i, len;\n    \n        e = e.originalEvent || e;\n        items = e.clipboardData.items;\n    \n        for ( i = 0, len = items.length; i < len; i++ ) {\n          item = items[ i ];\n    \n          if ( item.kind !== 'file' || !(blob = item.getAsFile()) ) {\n            continue;\n          }\n    \n          allowed.push( new File( ruid, blob ) );\n        }\n    \n        if ( allowed.length ) {\n          // 不阻止非文件粘贴（文字粘贴）的事件冒泡\n          e.preventDefault();\n          e.stopPropagation();\n          this.trigger( 'paste', allowed );\n        }\n      },\n    \n      destroy: function() {\n        this.elem.off( 'paste', this.hander );\n      }\n    });\n  });\n    \n  /**\n     * @fileOverview FilePicker\n     */\n  define('runtime/html5/filepicker',[\n    'base',\n    'runtime/html5/runtime'\n  ], function( Base, Html5Runtime ) {\n    \n    var $ = Base.$;\n    \n    return Html5Runtime.register( 'FilePicker', {\n      init: function() {\n        var container = this.getRuntime().getContainer(),\n          me = this,\n          owner = me.owner,\n          opts = me.options,\n          label = this.label = $( document.createElement('label') ),\n          input =  this.input = $( document.createElement('input') ),\n          arr, i, len, mouseHandler, inputChange;\n    \n        input.attr( 'type', 'file' );\n        input.attr( 'name', opts.name );\n        input.addClass('webuploader-element-invisible');\n    \n        label.on( 'click', function() {\n          input.trigger('click');\n        });\n    \n        label.css({\n          opacity: 0,\n          width: '100%',\n          height: '100%',\n          display: 'block',\n          cursor: 'pointer',\n          background: '#ffffff'\n        });\n    \n        if ( opts.multiple ) {\n          input.attr( 'multiple', 'multiple' );\n        }\n    \n        // @todo Firefox不支持单独指定后缀\n        if ( opts.accept && opts.accept.length > 0 ) {\n          arr = [];\n    \n          for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n            arr.push( opts.accept[ i ].mimeTypes );\n          }\n    \n          input.attr( 'accept', arr.join(',') );\n        }\n    \n        container.append( input );\n        container.append( label );\n    \n        mouseHandler = function( e ) {\n          owner.trigger( e.type );\n        };\n\n        inputChange = function( e ) {\n                \tvar clone;\n                \tme.files = e.target.files;\n    \n          // reset input\n          clone = this.cloneNode( true );\n          clone.value = null;\n          this.parentNode.replaceChild( clone, this );\n    \n          input.off();\n          input = $( clone ).on( 'change', inputChange )\n            .on( 'mouseenter mouseleave', mouseHandler );\n    \n          owner.trigger('change');\n        };\n    \n        input.on( 'change', inputChange);\n    \n        label.on( 'mouseenter mouseleave', mouseHandler );\n    \n      },\n    \n    \n      getFiles: function() {\n        return this.files;\n      },\n    \n      destroy: function() {\n        this.input.off();\n        this.label.off();\n      }\n    });\n  });\n    \n  /**\n     * Terms:\n     *\n     * Uint8Array, FileReader, BlobBuilder, atob, ArrayBuffer\n     * @fileOverview Image控件\n     */\n  define('runtime/html5/util',[\n    'base'\n  ], function( Base ) {\n    \n    var urlAPI = window.createObjectURL && window ||\n                window.URL && URL.revokeObjectURL && URL ||\n                window.webkitURL,\n      createObjectURL = Base.noop,\n      revokeObjectURL = createObjectURL;\n    \n    if ( urlAPI ) {\n    \n      // 更安全的方式调用，比如android里面就能把context改成其他的对象。\n      createObjectURL = function() {\n        return urlAPI.createObjectURL.apply( urlAPI, arguments );\n      };\n    \n      revokeObjectURL = function() {\n        return urlAPI.revokeObjectURL.apply( urlAPI, arguments );\n      };\n    }\n    \n    return {\n      createObjectURL: createObjectURL,\n      revokeObjectURL: revokeObjectURL,\n    \n      dataURL2Blob: function( dataURI ) {\n        var byteStr, intArray, ab, i, mimetype, parts;\n    \n        parts = dataURI.split(',');\n    \n        if ( ~parts[ 0 ].indexOf('base64') ) {\n          byteStr = atob( parts[ 1 ] );\n        } else {\n          byteStr = decodeURIComponent( parts[ 1 ] );\n        }\n    \n        ab = new ArrayBuffer( byteStr.length );\n        intArray = new Uint8Array( ab );\n    \n        for ( i = 0; i < byteStr.length; i++ ) {\n          intArray[ i ] = byteStr.charCodeAt( i );\n        }\n    \n        mimetype = parts[ 0 ].split(':')[ 1 ].split(';')[ 0 ];\n    \n        return this.arrayBufferToBlob( ab, mimetype );\n      },\n    \n      dataURL2ArrayBuffer: function( dataURI ) {\n        var byteStr, intArray, i, parts;\n    \n        parts = dataURI.split(',');\n    \n        if ( ~parts[ 0 ].indexOf('base64') ) {\n          byteStr = atob( parts[ 1 ] );\n        } else {\n          byteStr = decodeURIComponent( parts[ 1 ] );\n        }\n    \n        intArray = new Uint8Array( byteStr.length );\n    \n        for ( i = 0; i < byteStr.length; i++ ) {\n          intArray[ i ] = byteStr.charCodeAt( i );\n        }\n    \n        return intArray.buffer;\n      },\n    \n      arrayBufferToBlob: function( buffer, type ) {\n        var builder = window.BlobBuilder || window.WebKitBlobBuilder,\n          bb;\n    \n        // android不支持直接new Blob, 只能借助blobbuilder.\n        if ( builder ) {\n          bb = new builder();\n          bb.append( buffer );\n          return bb.getBlob( type );\n        }\n    \n        return new Blob([ buffer ], type ? { type: type } : {} );\n      },\n    \n      // 抽出来主要是为了解决android下面canvas.toDataUrl不支持jpeg.\n      // 你得到的结果是png.\n      canvasToDataUrl: function( canvas, type, quality ) {\n        return canvas.toDataURL( type, quality / 100 );\n      },\n    \n      // imagemeat会复写这个方法，如果用户选择加载那个文件了的话。\n      parseMeta: function( blob, callback ) {\n        callback( false, {});\n      },\n    \n      // imagemeat会复写这个方法，如果用户选择加载那个文件了的话。\n      updateImageHead: function( data ) {\n        return data;\n      }\n    };\n  });\n    \n  /**\n     * Terms:\n     *\n     * Uint8Array, FileReader, BlobBuilder, atob, ArrayBuffer\n     * @fileOverview Image控件\n     */\n  define('runtime/html5/imagemeta',[\n    'runtime/html5/util'\n  ], function( Util ) {\n    \n    var api;\n    \n    api = {\n      parsers: {\n        0xffe1: []\n      },\n    \n      maxMetaDataSize: 262144,\n    \n      parse: function( blob, cb ) {\n        var me = this,\n          fr = new FileReader();\n    \n        fr.onload = function() {\n          cb( false, me._parse( this.result ) );\n          fr = fr.onload = fr.onerror = null;\n        };\n    \n        fr.onerror = function( e ) {\n          cb( e.message );\n          fr = fr.onload = fr.onerror = null;\n        };\n    \n        blob = blob.slice( 0, me.maxMetaDataSize );\n        fr.readAsArrayBuffer( blob.getSource() );\n      },\n    \n      _parse: function( buffer, noParse ) {\n        if ( buffer.byteLength < 6 ) {\n          return;\n        }\n    \n        var dataview = new DataView( buffer ),\n          offset = 2,\n          maxOffset = dataview.byteLength - 4,\n          headLength = offset,\n          ret = {},\n          markerBytes, markerLength, parsers, i;\n    \n        if ( dataview.getUint16( 0 ) === 0xffd8 ) {\n    \n          while ( offset < maxOffset ) {\n            markerBytes = dataview.getUint16( offset );\n    \n            if ( markerBytes >= 0xffe0 && markerBytes <= 0xffef ||\n                                markerBytes === 0xfffe ) {\n    \n              markerLength = dataview.getUint16( offset + 2 ) + 2;\n    \n              if ( offset + markerLength > dataview.byteLength ) {\n                break;\n              }\n    \n              parsers = api.parsers[ markerBytes ];\n    \n              if ( !noParse && parsers ) {\n                for ( i = 0; i < parsers.length; i += 1 ) {\n                  parsers[ i ].call( api, dataview, offset,\n                    markerLength, ret );\n                }\n              }\n    \n              offset += markerLength;\n              headLength = offset;\n            } else {\n              break;\n            }\n          }\n    \n          if ( headLength > 6 ) {\n            if ( buffer.slice ) {\n              ret.imageHead = buffer.slice( 2, headLength );\n            } else {\n              // Workaround for IE10, which does not yet\n              // support ArrayBuffer.slice:\n              ret.imageHead = new Uint8Array( buffer )\n                .subarray( 2, headLength );\n            }\n          }\n        }\n    \n        return ret;\n      },\n    \n      updateImageHead: function( buffer, head ) {\n        var data = this._parse( buffer, true ),\n          buf1, buf2, bodyoffset;\n    \n    \n        bodyoffset = 2;\n        if ( data.imageHead ) {\n          bodyoffset = 2 + data.imageHead.byteLength;\n        }\n    \n        if ( buffer.slice ) {\n          buf2 = buffer.slice( bodyoffset );\n        } else {\n          buf2 = new Uint8Array( buffer ).subarray( bodyoffset );\n        }\n    \n        buf1 = new Uint8Array( head.byteLength + 2 + buf2.byteLength );\n    \n        buf1[ 0 ] = 0xFF;\n        buf1[ 1 ] = 0xD8;\n        buf1.set( new Uint8Array( head ), 2 );\n        buf1.set( new Uint8Array( buf2 ), head.byteLength + 2 );\n    \n        return buf1.buffer;\n      }\n    };\n    \n    Util.parseMeta = function() {\n      return api.parse.apply( api, arguments );\n    };\n    \n    Util.updateImageHead = function() {\n      return api.updateImageHead.apply( api, arguments );\n    };\n    \n    return api;\n  });\n  /**\n     * 代码来自于：https://github.com/blueimp/JavaScript-Load-Image\n     * 暂时项目中只用了orientation.\n     *\n     * 去除了 Exif Sub IFD Pointer, GPS Info IFD Pointer, Exif Thumbnail.\n     * @fileOverview EXIF解析\n     */\n    \n  // Sample\n  // ====================================\n  // Make : Apple\n  // Model : iPhone 4S\n  // Orientation : 1\n  // XResolution : 72 [72/1]\n  // YResolution : 72 [72/1]\n  // ResolutionUnit : 2\n  // Software : QuickTime 7.7.1\n  // DateTime : 2013:09:01 22:53:55\n  // ExifIFDPointer : 190\n  // ExposureTime : 0.058823529411764705 [1/17]\n  // FNumber : 2.4 [12/5]\n  // ExposureProgram : Normal program\n  // ISOSpeedRatings : 800\n  // ExifVersion : 0220\n  // DateTimeOriginal : 2013:09:01 22:52:51\n  // DateTimeDigitized : 2013:09:01 22:52:51\n  // ComponentsConfiguration : YCbCr\n  // ShutterSpeedValue : 4.058893515764426\n  // ApertureValue : 2.5260688216892597 [4845/1918]\n  // BrightnessValue : -0.3126686601998395\n  // MeteringMode : Pattern\n  // Flash : Flash did not fire, compulsory flash mode\n  // FocalLength : 4.28 [107/25]\n  // SubjectArea : [4 values]\n  // FlashpixVersion : 0100\n  // ColorSpace : 1\n  // PixelXDimension : 2448\n  // PixelYDimension : 3264\n  // SensingMethod : One-chip color area sensor\n  // ExposureMode : 0\n  // WhiteBalance : Auto white balance\n  // FocalLengthIn35mmFilm : 35\n  // SceneCaptureType : Standard\n  define('runtime/html5/imagemeta/exif',[\n    'base',\n    'runtime/html5/imagemeta'\n  ], function( Base, ImageMeta ) {\n    \n    var EXIF = {};\n    \n    EXIF.ExifMap = function() {\n      return this;\n    };\n    \n    EXIF.ExifMap.prototype.map = {\n      'Orientation': 0x0112\n    };\n    \n    EXIF.ExifMap.prototype.get = function( id ) {\n      return this[ id ] || this[ this.map[ id ] ];\n    };\n    \n    EXIF.exifTagTypes = {\n      // byte, 8-bit unsigned int:\n      1: {\n        getValue: function( dataView, dataOffset ) {\n          return dataView.getUint8( dataOffset );\n        },\n        size: 1\n      },\n    \n      // ascii, 8-bit byte:\n      2: {\n        getValue: function( dataView, dataOffset ) {\n          return String.fromCharCode( dataView.getUint8( dataOffset ) );\n        },\n        size: 1,\n        ascii: true\n      },\n    \n      // short, 16 bit int:\n      3: {\n        getValue: function( dataView, dataOffset, littleEndian ) {\n          return dataView.getUint16( dataOffset, littleEndian );\n        },\n        size: 2\n      },\n    \n      // long, 32 bit int:\n      4: {\n        getValue: function( dataView, dataOffset, littleEndian ) {\n          return dataView.getUint32( dataOffset, littleEndian );\n        },\n        size: 4\n      },\n    \n      // rational = two long values,\n      // first is numerator, second is denominator:\n      5: {\n        getValue: function( dataView, dataOffset, littleEndian ) {\n          return dataView.getUint32( dataOffset, littleEndian ) /\n                        dataView.getUint32( dataOffset + 4, littleEndian );\n        },\n        size: 8\n      },\n    \n      // slong, 32 bit signed int:\n      9: {\n        getValue: function( dataView, dataOffset, littleEndian ) {\n          return dataView.getInt32( dataOffset, littleEndian );\n        },\n        size: 4\n      },\n    \n      // srational, two slongs, first is numerator, second is denominator:\n      10: {\n        getValue: function( dataView, dataOffset, littleEndian ) {\n          return dataView.getInt32( dataOffset, littleEndian ) /\n                        dataView.getInt32( dataOffset + 4, littleEndian );\n        },\n        size: 8\n      }\n    };\n    \n    // undefined, 8-bit byte, value depending on field:\n    EXIF.exifTagTypes[ 7 ] = EXIF.exifTagTypes[ 1 ];\n    \n    EXIF.getExifValue = function( dataView, tiffOffset, offset, type, length,\n      littleEndian ) {\n    \n      var tagType = EXIF.exifTagTypes[ type ],\n        tagSize, dataOffset, values, i, str, c;\n    \n      if ( !tagType ) {\n        Base.log('Invalid Exif data: Invalid tag type.');\n        return;\n      }\n    \n      tagSize = tagType.size * length;\n    \n      // Determine if the value is contained in the dataOffset bytes,\n      // or if the value at the dataOffset is a pointer to the actual data:\n      dataOffset = tagSize > 4 ? tiffOffset + dataView.getUint32( offset + 8,\n        littleEndian ) : (offset + 8);\n    \n      if ( dataOffset + tagSize > dataView.byteLength ) {\n        Base.log('Invalid Exif data: Invalid data offset.');\n        return;\n      }\n    \n      if ( length === 1 ) {\n        return tagType.getValue( dataView, dataOffset, littleEndian );\n      }\n    \n      values = [];\n    \n      for ( i = 0; i < length; i += 1 ) {\n        values[ i ] = tagType.getValue( dataView,\n          dataOffset + i * tagType.size, littleEndian );\n      }\n    \n      if ( tagType.ascii ) {\n        str = '';\n    \n        // Concatenate the chars:\n        for ( i = 0; i < values.length; i += 1 ) {\n          c = values[ i ];\n    \n          // Ignore the terminating NULL byte(s):\n          if ( c === '\\u0000' ) {\n            break;\n          }\n          str += c;\n        }\n    \n        return str;\n      }\n      return values;\n    };\n    \n    EXIF.parseExifTag = function( dataView, tiffOffset, offset, littleEndian,\n      data ) {\n    \n      var tag = dataView.getUint16( offset, littleEndian );\n      data.exif[ tag ] = EXIF.getExifValue( dataView, tiffOffset, offset,\n        dataView.getUint16( offset + 2, littleEndian ),    // tag type\n        dataView.getUint32( offset + 4, littleEndian ),    // tag length\n        littleEndian );\n    };\n    \n    EXIF.parseExifTags = function( dataView, tiffOffset, dirOffset,\n      littleEndian, data ) {\n    \n      var tagsNumber, dirEndOffset, i;\n    \n      if ( dirOffset + 6 > dataView.byteLength ) {\n        Base.log('Invalid Exif data: Invalid directory offset.');\n        return;\n      }\n    \n      tagsNumber = dataView.getUint16( dirOffset, littleEndian );\n      dirEndOffset = dirOffset + 2 + 12 * tagsNumber;\n    \n      if ( dirEndOffset + 4 > dataView.byteLength ) {\n        Base.log('Invalid Exif data: Invalid directory size.');\n        return;\n      }\n    \n      for ( i = 0; i < tagsNumber; i += 1 ) {\n        this.parseExifTag( dataView, tiffOffset,\n          dirOffset + 2 + 12 * i,    // tag offset\n          littleEndian, data );\n      }\n    \n      // Return the offset to the next directory:\n      return dataView.getUint32( dirEndOffset, littleEndian );\n    };\n    \n    // EXIF.getExifThumbnail = function(dataView, offset, length) {\n    //     var hexData,\n    //         i,\n    //         b;\n    //     if (!length || offset + length > dataView.byteLength) {\n    //         Base.log('Invalid Exif data: Invalid thumbnail data.');\n    //         return;\n    //     }\n    //     hexData = [];\n    //     for (i = 0; i < length; i += 1) {\n    //         b = dataView.getUint8(offset + i);\n    //         hexData.push((b < 16 ? '0' : '') + b.toString(16));\n    //     }\n    //     return 'data:image/jpeg,%' + hexData.join('%');\n    // };\n    \n    EXIF.parseExifData = function( dataView, offset, length, data ) {\n    \n      var tiffOffset = offset + 10,\n        littleEndian, dirOffset;\n    \n      // Check for the ASCII code for \"Exif\" (0x45786966):\n      if ( dataView.getUint32( offset + 4 ) !== 0x45786966 ) {\n        // No Exif data, might be XMP data instead\n        return;\n      }\n      if ( tiffOffset + 8 > dataView.byteLength ) {\n        Base.log('Invalid Exif data: Invalid segment size.');\n        return;\n      }\n    \n      // Check for the two null bytes:\n      if ( dataView.getUint16( offset + 8 ) !== 0x0000 ) {\n        Base.log('Invalid Exif data: Missing byte alignment offset.');\n        return;\n      }\n    \n      // Check the byte alignment:\n      switch ( dataView.getUint16( tiffOffset ) ) {\n      case 0x4949:\n        littleEndian = true;\n        break;\n    \n      case 0x4D4D:\n        littleEndian = false;\n        break;\n    \n      default:\n        Base.log('Invalid Exif data: Invalid byte alignment marker.');\n        return;\n      }\n    \n      // Check for the TIFF tag marker (0x002A):\n      if ( dataView.getUint16( tiffOffset + 2, littleEndian ) !== 0x002A ) {\n        Base.log('Invalid Exif data: Missing TIFF marker.');\n        return;\n      }\n    \n      // Retrieve the directory offset bytes, usually 0x00000008 or 8 decimal:\n      dirOffset = dataView.getUint32( tiffOffset + 4, littleEndian );\n      // Create the exif object to store the tags:\n      data.exif = new EXIF.ExifMap();\n      // Parse the tags of the main image directory and retrieve the\n      // offset to the next directory, usually the thumbnail directory:\n      dirOffset = EXIF.parseExifTags( dataView, tiffOffset,\n        tiffOffset + dirOffset, littleEndian, data );\n    \n      // 尝试读取缩略图\n      // if ( dirOffset ) {\n      //     thumbnailData = {exif: {}};\n      //     dirOffset = EXIF.parseExifTags(\n      //         dataView,\n      //         tiffOffset,\n      //         tiffOffset + dirOffset,\n      //         littleEndian,\n      //         thumbnailData\n      //     );\n    \n      //     // Check for JPEG Thumbnail offset:\n      //     if (thumbnailData.exif[0x0201]) {\n      //         data.exif.Thumbnail = EXIF.getExifThumbnail(\n      //             dataView,\n      //             tiffOffset + thumbnailData.exif[0x0201],\n      //             thumbnailData.exif[0x0202] // Thumbnail data length\n      //         );\n      //     }\n      // }\n    };\n    \n    ImageMeta.parsers[ 0xffe1 ].push( EXIF.parseExifData );\n    return EXIF;\n  });\n  /**\n     * 这个方式性能不行，但是可以解决android里面的toDataUrl的bug\n     * android里面toDataUrl('image/jpege')得到的结果却是png.\n     *\n     * 所以这里没辙，只能借助这个工具\n     * @fileOverview jpeg encoder\n     */\n  define('runtime/html5/jpegencoder',[], function( require, exports, module ) {\n    \n    /*\n          Copyright (c) 2008, Adobe Systems Incorporated\n          All rights reserved.\n    \n          Redistribution and use in source and binary forms, with or without\n          modification, are permitted provided that the following conditions are\n          met:\n    \n          * Redistributions of source code must retain the above copyright notice,\n            this list of conditions and the following disclaimer.\n    \n          * Redistributions in binary form must reproduce the above copyright\n            notice, this list of conditions and the following disclaimer in the\n            documentation and/or other materials provided with the distribution.\n    \n          * Neither the name of Adobe Systems Incorporated nor the names of its\n            contributors may be used to endorse or promote products derived from\n            this software without specific prior written permission.\n    \n          THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS\n          IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,\n          THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n          PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n          CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n          EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n          PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n          PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\n          LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n          NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n          SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n        */\n    /*\n        JPEG encoder ported to JavaScript and optimized by Andreas Ritter, www.bytestrom.eu, 11/2009\n    \n        Basic GUI blocking jpeg encoder\n        */\n    \n    function JPEGEncoder(quality) {\n      var self = this;\n      var fround = Math.round;\n      var ffloor = Math.floor;\n      var YTable = new Array(64);\n      var UVTable = new Array(64);\n      var fdtbl_Y = new Array(64);\n      var fdtbl_UV = new Array(64);\n      var YDC_HT;\n      var UVDC_HT;\n      var YAC_HT;\n      var UVAC_HT;\n    \n      var bitcode = new Array(65535);\n      var category = new Array(65535);\n      var outputfDCTQuant = new Array(64);\n      var DU = new Array(64);\n      var byteout = [];\n      var bytenew = 0;\n      var bytepos = 7;\n    \n      var YDU = new Array(64);\n      var UDU = new Array(64);\n      var VDU = new Array(64);\n      var clt = new Array(256);\n      var RGB_YUV_TABLE = new Array(2048);\n      var currentQuality;\n    \n      var ZigZag = [\n        0, 1, 5, 6,14,15,27,28,\n        2, 4, 7,13,16,26,29,42,\n        3, 8,12,17,25,30,41,43,\n        9,11,18,24,31,40,44,53,\n        10,19,23,32,39,45,52,54,\n        20,22,33,38,46,51,55,60,\n        21,34,37,47,50,56,59,61,\n        35,36,48,49,57,58,62,63\n      ];\n    \n      var std_dc_luminance_nrcodes = [0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];\n      var std_dc_luminance_values = [0,1,2,3,4,5,6,7,8,9,10,11];\n      var std_ac_luminance_nrcodes = [0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,0x7d];\n      var std_ac_luminance_values = [\n        0x01,0x02,0x03,0x00,0x04,0x11,0x05,0x12,\n        0x21,0x31,0x41,0x06,0x13,0x51,0x61,0x07,\n        0x22,0x71,0x14,0x32,0x81,0x91,0xa1,0x08,\n        0x23,0x42,0xb1,0xc1,0x15,0x52,0xd1,0xf0,\n        0x24,0x33,0x62,0x72,0x82,0x09,0x0a,0x16,\n        0x17,0x18,0x19,0x1a,0x25,0x26,0x27,0x28,\n        0x29,0x2a,0x34,0x35,0x36,0x37,0x38,0x39,\n        0x3a,0x43,0x44,0x45,0x46,0x47,0x48,0x49,\n        0x4a,0x53,0x54,0x55,0x56,0x57,0x58,0x59,\n        0x5a,0x63,0x64,0x65,0x66,0x67,0x68,0x69,\n        0x6a,0x73,0x74,0x75,0x76,0x77,0x78,0x79,\n        0x7a,0x83,0x84,0x85,0x86,0x87,0x88,0x89,\n        0x8a,0x92,0x93,0x94,0x95,0x96,0x97,0x98,\n        0x99,0x9a,0xa2,0xa3,0xa4,0xa5,0xa6,0xa7,\n        0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,0xb5,0xb6,\n        0xb7,0xb8,0xb9,0xba,0xc2,0xc3,0xc4,0xc5,\n        0xc6,0xc7,0xc8,0xc9,0xca,0xd2,0xd3,0xd4,\n        0xd5,0xd6,0xd7,0xd8,0xd9,0xda,0xe1,0xe2,\n        0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,0xea,\n        0xf1,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,\n        0xf9,0xfa\n      ];\n    \n      var std_dc_chrominance_nrcodes = [0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];\n      var std_dc_chrominance_values = [0,1,2,3,4,5,6,7,8,9,10,11];\n      var std_ac_chrominance_nrcodes = [0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,0x77];\n      var std_ac_chrominance_values = [\n        0x00,0x01,0x02,0x03,0x11,0x04,0x05,0x21,\n        0x31,0x06,0x12,0x41,0x51,0x07,0x61,0x71,\n        0x13,0x22,0x32,0x81,0x08,0x14,0x42,0x91,\n        0xa1,0xb1,0xc1,0x09,0x23,0x33,0x52,0xf0,\n        0x15,0x62,0x72,0xd1,0x0a,0x16,0x24,0x34,\n        0xe1,0x25,0xf1,0x17,0x18,0x19,0x1a,0x26,\n        0x27,0x28,0x29,0x2a,0x35,0x36,0x37,0x38,\n        0x39,0x3a,0x43,0x44,0x45,0x46,0x47,0x48,\n        0x49,0x4a,0x53,0x54,0x55,0x56,0x57,0x58,\n        0x59,0x5a,0x63,0x64,0x65,0x66,0x67,0x68,\n        0x69,0x6a,0x73,0x74,0x75,0x76,0x77,0x78,\n        0x79,0x7a,0x82,0x83,0x84,0x85,0x86,0x87,\n        0x88,0x89,0x8a,0x92,0x93,0x94,0x95,0x96,\n        0x97,0x98,0x99,0x9a,0xa2,0xa3,0xa4,0xa5,\n        0xa6,0xa7,0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,\n        0xb5,0xb6,0xb7,0xb8,0xb9,0xba,0xc2,0xc3,\n        0xc4,0xc5,0xc6,0xc7,0xc8,0xc9,0xca,0xd2,\n        0xd3,0xd4,0xd5,0xd6,0xd7,0xd8,0xd9,0xda,\n        0xe2,0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,\n        0xea,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,\n        0xf9,0xfa\n      ];\n    \n      function initQuantTables(sf){\n        var YQT = [\n          16, 11, 10, 16, 24, 40, 51, 61,\n          12, 12, 14, 19, 26, 58, 60, 55,\n          14, 13, 16, 24, 40, 57, 69, 56,\n          14, 17, 22, 29, 51, 87, 80, 62,\n          18, 22, 37, 56, 68,109,103, 77,\n          24, 35, 55, 64, 81,104,113, 92,\n          49, 64, 78, 87,103,121,120,101,\n          72, 92, 95, 98,112,100,103, 99\n        ];\n    \n        for (var i = 0; i < 64; i++) {\n          var t = ffloor((YQT[i]*sf+50)/100);\n          if (t < 1) {\n            t = 1;\n          } else if (t > 255) {\n            t = 255;\n          }\n          YTable[ZigZag[i]] = t;\n        }\n        var UVQT = [\n          17, 18, 24, 47, 99, 99, 99, 99,\n          18, 21, 26, 66, 99, 99, 99, 99,\n          24, 26, 56, 99, 99, 99, 99, 99,\n          47, 66, 99, 99, 99, 99, 99, 99,\n          99, 99, 99, 99, 99, 99, 99, 99,\n          99, 99, 99, 99, 99, 99, 99, 99,\n          99, 99, 99, 99, 99, 99, 99, 99,\n          99, 99, 99, 99, 99, 99, 99, 99\n        ];\n        for (var j = 0; j < 64; j++) {\n          var u = ffloor((UVQT[j]*sf+50)/100);\n          if (u < 1) {\n            u = 1;\n          } else if (u > 255) {\n            u = 255;\n          }\n          UVTable[ZigZag[j]] = u;\n        }\n        var aasf = [\n          1.0, 1.387039845, 1.306562965, 1.175875602,\n          1.0, 0.785694958, 0.541196100, 0.275899379\n        ];\n        var k = 0;\n        for (var row = 0; row < 8; row++)\n        {\n          for (var col = 0; col < 8; col++)\n          {\n            fdtbl_Y[k]  = (1.0 / (YTable [ZigZag[k]] * aasf[row] * aasf[col] * 8.0));\n            fdtbl_UV[k] = (1.0 / (UVTable[ZigZag[k]] * aasf[row] * aasf[col] * 8.0));\n            k++;\n          }\n        }\n      }\n    \n      function computeHuffmanTbl(nrcodes, std_table){\n        var codevalue = 0;\n        var pos_in_table = 0;\n        var HT = new Array();\n        for (var k = 1; k <= 16; k++) {\n          for (var j = 1; j <= nrcodes[k]; j++) {\n            HT[std_table[pos_in_table]] = [];\n            HT[std_table[pos_in_table]][0] = codevalue;\n            HT[std_table[pos_in_table]][1] = k;\n            pos_in_table++;\n            codevalue++;\n          }\n          codevalue*=2;\n        }\n        return HT;\n      }\n    \n      function initHuffmanTbl()\n      {\n        YDC_HT = computeHuffmanTbl(std_dc_luminance_nrcodes,std_dc_luminance_values);\n        UVDC_HT = computeHuffmanTbl(std_dc_chrominance_nrcodes,std_dc_chrominance_values);\n        YAC_HT = computeHuffmanTbl(std_ac_luminance_nrcodes,std_ac_luminance_values);\n        UVAC_HT = computeHuffmanTbl(std_ac_chrominance_nrcodes,std_ac_chrominance_values);\n      }\n    \n      function initCategoryNumber()\n      {\n        var nrlower = 1;\n        var nrupper = 2;\n        for (var cat = 1; cat <= 15; cat++) {\n          //Positive numbers\n          for (var nr = nrlower; nr<nrupper; nr++) {\n            category[32767+nr] = cat;\n            bitcode[32767+nr] = [];\n            bitcode[32767+nr][1] = cat;\n            bitcode[32767+nr][0] = nr;\n          }\n          //Negative numbers\n          for (var nrneg =-(nrupper-1); nrneg<=-nrlower; nrneg++) {\n            category[32767+nrneg] = cat;\n            bitcode[32767+nrneg] = [];\n            bitcode[32767+nrneg][1] = cat;\n            bitcode[32767+nrneg][0] = nrupper-1+nrneg;\n          }\n          nrlower <<= 1;\n          nrupper <<= 1;\n        }\n      }\n    \n      function initRGBYUVTable() {\n        for(var i = 0; i < 256;i++) {\n          RGB_YUV_TABLE[i]            =  19595 * i;\n          RGB_YUV_TABLE[(i+ 256)>>0]  =  38470 * i;\n          RGB_YUV_TABLE[(i+ 512)>>0]  =   7471 * i + 0x8000;\n          RGB_YUV_TABLE[(i+ 768)>>0]  = -11059 * i;\n          RGB_YUV_TABLE[(i+1024)>>0]  = -21709 * i;\n          RGB_YUV_TABLE[(i+1280)>>0]  =  32768 * i + 0x807FFF;\n          RGB_YUV_TABLE[(i+1536)>>0]  = -27439 * i;\n          RGB_YUV_TABLE[(i+1792)>>0]  = - 5329 * i;\n        }\n      }\n    \n      // IO functions\n      function writeBits(bs)\n      {\n        var value = bs[0];\n        var posval = bs[1]-1;\n        while ( posval >= 0 ) {\n          if (value & (1 << posval) ) {\n            bytenew |= (1 << bytepos);\n          }\n          posval--;\n          bytepos--;\n          if (bytepos < 0) {\n            if (bytenew == 0xFF) {\n              writeByte(0xFF);\n              writeByte(0);\n            }\n            else {\n              writeByte(bytenew);\n            }\n            bytepos=7;\n            bytenew=0;\n          }\n        }\n      }\n    \n      function writeByte(value)\n      {\n        byteout.push(clt[value]); // write char directly instead of converting later\n      }\n    \n      function writeWord(value)\n      {\n        writeByte((value>>8)&0xFF);\n        writeByte((value   )&0xFF);\n      }\n    \n      // DCT & quantization core\n      function fDCTQuant(data, fdtbl)\n      {\n        var d0, d1, d2, d3, d4, d5, d6, d7;\n        /* Pass 1: process rows. */\n        var dataOff=0;\n        var i;\n        var I8 = 8;\n        var I64 = 64;\n        for (i=0; i<I8; ++i)\n        {\n          d0 = data[dataOff];\n          d1 = data[dataOff+1];\n          d2 = data[dataOff+2];\n          d3 = data[dataOff+3];\n          d4 = data[dataOff+4];\n          d5 = data[dataOff+5];\n          d6 = data[dataOff+6];\n          d7 = data[dataOff+7];\n    \n          var tmp0 = d0 + d7;\n          var tmp7 = d0 - d7;\n          var tmp1 = d1 + d6;\n          var tmp6 = d1 - d6;\n          var tmp2 = d2 + d5;\n          var tmp5 = d2 - d5;\n          var tmp3 = d3 + d4;\n          var tmp4 = d3 - d4;\n    \n          /* Even part */\n          var tmp10 = tmp0 + tmp3;    /* phase 2 */\n          var tmp13 = tmp0 - tmp3;\n          var tmp11 = tmp1 + tmp2;\n          var tmp12 = tmp1 - tmp2;\n    \n          data[dataOff] = tmp10 + tmp11; /* phase 3 */\n          data[dataOff+4] = tmp10 - tmp11;\n    \n          var z1 = (tmp12 + tmp13) * 0.707106781; /* c4 */\n          data[dataOff+2] = tmp13 + z1; /* phase 5 */\n          data[dataOff+6] = tmp13 - z1;\n    \n          /* Odd part */\n          tmp10 = tmp4 + tmp5; /* phase 2 */\n          tmp11 = tmp5 + tmp6;\n          tmp12 = tmp6 + tmp7;\n    \n          /* The rotator is modified from fig 4-8 to avoid extra negations. */\n          var z5 = (tmp10 - tmp12) * 0.382683433; /* c6 */\n          var z2 = 0.541196100 * tmp10 + z5; /* c2-c6 */\n          var z4 = 1.306562965 * tmp12 + z5; /* c2+c6 */\n          var z3 = tmp11 * 0.707106781; /* c4 */\n    \n          var z11 = tmp7 + z3;    /* phase 5 */\n          var z13 = tmp7 - z3;\n    \n          data[dataOff+5] = z13 + z2; /* phase 6 */\n          data[dataOff+3] = z13 - z2;\n          data[dataOff+1] = z11 + z4;\n          data[dataOff+7] = z11 - z4;\n    \n          dataOff += 8; /* advance pointer to next row */\n        }\n    \n        /* Pass 2: process columns. */\n        dataOff = 0;\n        for (i=0; i<I8; ++i)\n        {\n          d0 = data[dataOff];\n          d1 = data[dataOff + 8];\n          d2 = data[dataOff + 16];\n          d3 = data[dataOff + 24];\n          d4 = data[dataOff + 32];\n          d5 = data[dataOff + 40];\n          d6 = data[dataOff + 48];\n          d7 = data[dataOff + 56];\n    \n          var tmp0p2 = d0 + d7;\n          var tmp7p2 = d0 - d7;\n          var tmp1p2 = d1 + d6;\n          var tmp6p2 = d1 - d6;\n          var tmp2p2 = d2 + d5;\n          var tmp5p2 = d2 - d5;\n          var tmp3p2 = d3 + d4;\n          var tmp4p2 = d3 - d4;\n    \n          /* Even part */\n          var tmp10p2 = tmp0p2 + tmp3p2;  /* phase 2 */\n          var tmp13p2 = tmp0p2 - tmp3p2;\n          var tmp11p2 = tmp1p2 + tmp2p2;\n          var tmp12p2 = tmp1p2 - tmp2p2;\n    \n          data[dataOff] = tmp10p2 + tmp11p2; /* phase 3 */\n          data[dataOff+32] = tmp10p2 - tmp11p2;\n    \n          var z1p2 = (tmp12p2 + tmp13p2) * 0.707106781; /* c4 */\n          data[dataOff+16] = tmp13p2 + z1p2; /* phase 5 */\n          data[dataOff+48] = tmp13p2 - z1p2;\n    \n          /* Odd part */\n          tmp10p2 = tmp4p2 + tmp5p2; /* phase 2 */\n          tmp11p2 = tmp5p2 + tmp6p2;\n          tmp12p2 = tmp6p2 + tmp7p2;\n    \n          /* The rotator is modified from fig 4-8 to avoid extra negations. */\n          var z5p2 = (tmp10p2 - tmp12p2) * 0.382683433; /* c6 */\n          var z2p2 = 0.541196100 * tmp10p2 + z5p2; /* c2-c6 */\n          var z4p2 = 1.306562965 * tmp12p2 + z5p2; /* c2+c6 */\n          var z3p2 = tmp11p2 * 0.707106781; /* c4 */\n    \n          var z11p2 = tmp7p2 + z3p2;  /* phase 5 */\n          var z13p2 = tmp7p2 - z3p2;\n    \n          data[dataOff+40] = z13p2 + z2p2; /* phase 6 */\n          data[dataOff+24] = z13p2 - z2p2;\n          data[dataOff+ 8] = z11p2 + z4p2;\n          data[dataOff+56] = z11p2 - z4p2;\n    \n          dataOff++; /* advance pointer to next column */\n        }\n    \n        // Quantize/descale the coefficients\n        var fDCTQuant;\n        for (i=0; i<I64; ++i)\n        {\n          // Apply the quantization and scaling factor & Round to nearest integer\n          fDCTQuant = data[i]*fdtbl[i];\n          outputfDCTQuant[i] = (fDCTQuant > 0.0) ? ((fDCTQuant + 0.5)|0) : ((fDCTQuant - 0.5)|0);\n          //outputfDCTQuant[i] = fround(fDCTQuant);\n    \n        }\n        return outputfDCTQuant;\n      }\n    \n      function writeAPP0()\n      {\n        writeWord(0xFFE0); // marker\n        writeWord(16); // length\n        writeByte(0x4A); // J\n        writeByte(0x46); // F\n        writeByte(0x49); // I\n        writeByte(0x46); // F\n        writeByte(0); // = \"JFIF\",'\\0'\n        writeByte(1); // versionhi\n        writeByte(1); // versionlo\n        writeByte(0); // xyunits\n        writeWord(1); // xdensity\n        writeWord(1); // ydensity\n        writeByte(0); // thumbnwidth\n        writeByte(0); // thumbnheight\n      }\n    \n      function writeSOF0(width, height)\n      {\n        writeWord(0xFFC0); // marker\n        writeWord(17);   // length, truecolor YUV JPG\n        writeByte(8);    // precision\n        writeWord(height);\n        writeWord(width);\n        writeByte(3);    // nrofcomponents\n        writeByte(1);    // IdY\n        writeByte(0x11); // HVY\n        writeByte(0);    // QTY\n        writeByte(2);    // IdU\n        writeByte(0x11); // HVU\n        writeByte(1);    // QTU\n        writeByte(3);    // IdV\n        writeByte(0x11); // HVV\n        writeByte(1);    // QTV\n      }\n    \n      function writeDQT()\n      {\n        writeWord(0xFFDB); // marker\n        writeWord(132);    // length\n        writeByte(0);\n        for (var i=0; i<64; i++) {\n          writeByte(YTable[i]);\n        }\n        writeByte(1);\n        for (var j=0; j<64; j++) {\n          writeByte(UVTable[j]);\n        }\n      }\n    \n      function writeDHT()\n      {\n        writeWord(0xFFC4); // marker\n        writeWord(0x01A2); // length\n    \n        writeByte(0); // HTYDCinfo\n        for (var i=0; i<16; i++) {\n          writeByte(std_dc_luminance_nrcodes[i+1]);\n        }\n        for (var j=0; j<=11; j++) {\n          writeByte(std_dc_luminance_values[j]);\n        }\n    \n        writeByte(0x10); // HTYACinfo\n        for (var k=0; k<16; k++) {\n          writeByte(std_ac_luminance_nrcodes[k+1]);\n        }\n        for (var l=0; l<=161; l++) {\n          writeByte(std_ac_luminance_values[l]);\n        }\n    \n        writeByte(1); // HTUDCinfo\n        for (var m=0; m<16; m++) {\n          writeByte(std_dc_chrominance_nrcodes[m+1]);\n        }\n        for (var n=0; n<=11; n++) {\n          writeByte(std_dc_chrominance_values[n]);\n        }\n    \n        writeByte(0x11); // HTUACinfo\n        for (var o=0; o<16; o++) {\n          writeByte(std_ac_chrominance_nrcodes[o+1]);\n        }\n        for (var p=0; p<=161; p++) {\n          writeByte(std_ac_chrominance_values[p]);\n        }\n      }\n    \n      function writeSOS()\n      {\n        writeWord(0xFFDA); // marker\n        writeWord(12); // length\n        writeByte(3); // nrofcomponents\n        writeByte(1); // IdY\n        writeByte(0); // HTY\n        writeByte(2); // IdU\n        writeByte(0x11); // HTU\n        writeByte(3); // IdV\n        writeByte(0x11); // HTV\n        writeByte(0); // Ss\n        writeByte(0x3f); // Se\n        writeByte(0); // Bf\n      }\n    \n      function processDU(CDU, fdtbl, DC, HTDC, HTAC){\n        var EOB = HTAC[0x00];\n        var M16zeroes = HTAC[0xF0];\n        var pos;\n        var I16 = 16;\n        var I63 = 63;\n        var I64 = 64;\n        var DU_DCT = fDCTQuant(CDU, fdtbl);\n        //ZigZag reorder\n        for (var j=0;j<I64;++j) {\n          DU[ZigZag[j]]=DU_DCT[j];\n        }\n        var Diff = DU[0] - DC; DC = DU[0];\n        //Encode DC\n        if (Diff==0) {\n          writeBits(HTDC[0]); // Diff might be 0\n        } else {\n          pos = 32767+Diff;\n          writeBits(HTDC[category[pos]]);\n          writeBits(bitcode[pos]);\n        }\n        //Encode ACs\n        var end0pos = 63; // was const... which is crazy\n        for (; (end0pos>0)&&(DU[end0pos]==0); end0pos--) {}\n        //end0pos = first element in reverse order !=0\n        if ( end0pos == 0) {\n          writeBits(EOB);\n          return DC;\n        }\n        var i = 1;\n        var lng;\n        while ( i <= end0pos ) {\n          var startpos = i;\n          for (; (DU[i]==0) && (i<=end0pos); ++i) {}\n          var nrzeroes = i-startpos;\n          if ( nrzeroes >= I16 ) {\n            lng = nrzeroes>>4;\n            for (var nrmarker=1; nrmarker <= lng; ++nrmarker)\n              writeBits(M16zeroes);\n            nrzeroes = nrzeroes&0xF;\n          }\n          pos = 32767+DU[i];\n          writeBits(HTAC[(nrzeroes<<4)+category[pos]]);\n          writeBits(bitcode[pos]);\n          i++;\n        }\n        if ( end0pos != I63 ) {\n          writeBits(EOB);\n        }\n        return DC;\n      }\n    \n      function initCharLookupTable(){\n        var sfcc = String.fromCharCode;\n        for(var i=0; i < 256; i++){ ///// ACHTUNG // 255\n          clt[i] = sfcc(i);\n        }\n      }\n    \n      this.encode = function(image,quality) // image data object\n      {\n        // var time_start = new Date().getTime();\n    \n        if(quality) setQuality(quality);\n    \n        // Initialize bit writer\n        byteout = new Array();\n        bytenew=0;\n        bytepos=7;\n    \n        // Add JPEG headers\n        writeWord(0xFFD8); // SOI\n        writeAPP0();\n        writeDQT();\n        writeSOF0(image.width,image.height);\n        writeDHT();\n        writeSOS();\n    \n    \n        // Encode 8x8 macroblocks\n        var DCY=0;\n        var DCU=0;\n        var DCV=0;\n    \n        bytenew=0;\n        bytepos=7;\n    \n    \n        this.encode.displayName = '_encode_';\n    \n        var imageData = image.data;\n        var width = image.width;\n        var height = image.height;\n    \n        var quadWidth = width*4;\n        var tripleWidth = width*3;\n    \n        var x, y = 0;\n        var r, g, b;\n        var start,p, col,row,pos;\n        while(y < height){\n          x = 0;\n          while(x < quadWidth){\n            start = quadWidth * y + x;\n            p = start;\n            col = -1;\n            row = 0;\n    \n            for(pos=0; pos < 64; pos++){\n              row = pos >> 3;// /8\n              col = ( pos & 7 ) * 4; // %8\n              p = start + ( row * quadWidth ) + col;\n    \n              if(y+row >= height){ // padding bottom\n                p-= (quadWidth*(y+1+row-height));\n              }\n    \n              if(x+col >= quadWidth){ // padding right\n                p-= ((x+col) - quadWidth +4);\n              }\n    \n              r = imageData[ p++ ];\n              g = imageData[ p++ ];\n              b = imageData[ p++ ];\n    \n    \n              /* // calculate YUV values dynamically\n                            YDU[pos]=((( 0.29900)*r+( 0.58700)*g+( 0.11400)*b))-128; //-0x80\n                            UDU[pos]=(((-0.16874)*r+(-0.33126)*g+( 0.50000)*b));\n                            VDU[pos]=((( 0.50000)*r+(-0.41869)*g+(-0.08131)*b));\n                            */\n    \n              // use lookup table (slightly faster)\n              YDU[pos] = ((RGB_YUV_TABLE[r]             + RGB_YUV_TABLE[(g +  256)>>0] + RGB_YUV_TABLE[(b +  512)>>0]) >> 16)-128;\n              UDU[pos] = ((RGB_YUV_TABLE[(r +  768)>>0] + RGB_YUV_TABLE[(g + 1024)>>0] + RGB_YUV_TABLE[(b + 1280)>>0]) >> 16)-128;\n              VDU[pos] = ((RGB_YUV_TABLE[(r + 1280)>>0] + RGB_YUV_TABLE[(g + 1536)>>0] + RGB_YUV_TABLE[(b + 1792)>>0]) >> 16)-128;\n    \n            }\n    \n            DCY = processDU(YDU, fdtbl_Y, DCY, YDC_HT, YAC_HT);\n            DCU = processDU(UDU, fdtbl_UV, DCU, UVDC_HT, UVAC_HT);\n            DCV = processDU(VDU, fdtbl_UV, DCV, UVDC_HT, UVAC_HT);\n            x+=32;\n          }\n          y+=8;\n        }\n    \n    \n        ////////////////////////////////////////////////////////////////\n    \n        // Do the bit alignment of the EOI marker\n        if ( bytepos >= 0 ) {\n          var fillbits = [];\n          fillbits[1] = bytepos+1;\n          fillbits[0] = (1<<(bytepos+1))-1;\n          writeBits(fillbits);\n        }\n    \n        writeWord(0xFFD9); //EOI\n    \n        var jpegDataUri = 'data:image/jpeg;base64,' + btoa(byteout.join(''));\n    \n        byteout = [];\n    \n        // benchmarking\n        // var duration = new Date().getTime() - time_start;\n        // console.log('Encoding time: '+ currentQuality + 'ms');\n        //\n    \n        return jpegDataUri;\n      };\n    \n      function setQuality(quality){\n        if (quality <= 0) {\n          quality = 1;\n        }\n        if (quality > 100) {\n          quality = 100;\n        }\n    \n        if(currentQuality == quality) return; // don't recalc if unchanged\n    \n        var sf = 0;\n        if (quality < 50) {\n          sf = Math.floor(5000 / quality);\n        } else {\n          sf = Math.floor(200 - quality*2);\n        }\n    \n        initQuantTables(sf);\n        currentQuality = quality;\n        // console.log('Quality set to: '+quality +'%');\n      }\n    \n      function init(){\n        // var time_start = new Date().getTime();\n        if(!quality) quality = 50;\n        // Create tables\n        initCharLookupTable();\n        initHuffmanTbl();\n        initCategoryNumber();\n        initRGBYUVTable();\n    \n        setQuality(quality);\n        // var duration = new Date().getTime() - time_start;\n        // console.log('Initialization '+ duration + 'ms');\n      }\n    \n      init();\n    \n    }\n    \n    JPEGEncoder.encode = function( data, quality ) {\n      var encoder = new JPEGEncoder( quality );\n    \n      return encoder.encode( data );\n    };\n    \n    return JPEGEncoder;\n  });\n  /**\n     * @fileOverview Fix android canvas.toDataUrl bug.\n     */\n  define('runtime/html5/androidpatch',[\n    'runtime/html5/util',\n    'runtime/html5/jpegencoder',\n    'base'\n  ], function( Util, encoder, Base ) {\n    var origin = Util.canvasToDataUrl,\n      supportJpeg;\n    \n    Util.canvasToDataUrl = function( canvas, type, quality ) {\n      var ctx, w, h, fragement, parts;\n    \n      // 非android手机直接跳过。\n      if ( !Base.os.android ) {\n        return origin.apply( null, arguments );\n      }\n    \n      // 检测是否canvas支持jpeg导出，根据数据格式来判断。\n      // JPEG 前两位分别是：255, 216\n      if ( type === 'image/jpeg' && typeof supportJpeg === 'undefined' ) {\n        fragement = origin.apply( null, arguments );\n    \n        parts = fragement.split(',');\n    \n        if ( ~parts[ 0 ].indexOf('base64') ) {\n          fragement = atob( parts[ 1 ] );\n        } else {\n          fragement = decodeURIComponent( parts[ 1 ] );\n        }\n    \n        fragement = fragement.substring( 0, 2 );\n    \n        supportJpeg = fragement.charCodeAt( 0 ) === 255 &&\n                        fragement.charCodeAt( 1 ) === 216;\n      }\n    \n      // 只有在android环境下才修复\n      if ( type === 'image/jpeg' && !supportJpeg ) {\n        w = canvas.width;\n        h = canvas.height;\n        ctx = canvas.getContext('2d');\n    \n        return encoder.encode( ctx.getImageData( 0, 0, w, h ), quality );\n      }\n    \n      return origin.apply( null, arguments );\n    };\n  });\n  /**\n     * @fileOverview Image\n     */\n  define('runtime/html5/image',[\n    'base',\n    'runtime/html5/runtime',\n    'runtime/html5/util'\n  ], function( Base, Html5Runtime, Util ) {\n    \n    var BLANK = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D';\n    \n    return Html5Runtime.register( 'Image', {\n    \n      // flag: 标记是否被修改过。\n      modified: false,\n    \n      init: function() {\n        var me = this,\n          img = new Image();\n    \n        img.onload = function() {\n    \n          me._info = {\n            type: me.type,\n            width: this.width,\n            height: this.height\n          };\n    \n          // 读取meta信息。\n          if ( !me._metas && 'image/jpeg' === me.type ) {\n            Util.parseMeta( me._blob, function( error, ret ) {\n              me._metas = ret;\n              me.owner.trigger('load');\n            });\n          } else {\n            me.owner.trigger('load');\n          }\n        };\n    \n        img.onerror = function() {\n          me.owner.trigger('error');\n        };\n    \n        me._img = img;\n      },\n    \n      loadFromBlob: function( blob ) {\n        var me = this,\n          img = me._img;\n    \n        me._blob = blob;\n        me.type = blob.type;\n        img.src = Util.createObjectURL( blob.getSource() );\n        me.owner.once( 'load', function() {\n          Util.revokeObjectURL( img.src );\n        });\n      },\n    \n      resize: function( width, height ) {\n        var canvas = this._canvas ||\n                        (this._canvas = document.createElement('canvas'));\n    \n        this._resize( this._img, canvas, width, height );\n        this._blob = null;    // 没用了，可以删掉了。\n        this.modified = true;\n        this.owner.trigger( 'complete', 'resize' );\n      },\n    \n      crop: function( x, y, w, h, s ) {\n        var cvs = this._canvas ||\n                        (this._canvas = document.createElement('canvas')),\n          opts = this.options,\n          img = this._img,\n          iw = img.naturalWidth,\n          ih = img.naturalHeight,\n          orientation = this.getOrientation();\n    \n        s = s || 1;\n    \n        // todo 解决 orientation 的问题。\n        // values that require 90 degree rotation\n        // if ( ~[ 5, 6, 7, 8 ].indexOf( orientation ) ) {\n    \n        //     switch ( orientation ) {\n        //         case 6:\n        //             tmp = x;\n        //             x = y;\n        //             y = iw * s - tmp - w;\n        //             console.log(ih * s, tmp, w)\n        //             break;\n        //     }\n    \n        //     (w ^= h, h ^= w, w ^= h);\n        // }\n    \n        cvs.width = w;\n        cvs.height = h;\n    \n        opts.preserveHeaders || this._rotate2Orientaion( cvs, orientation );\n        this._renderImageToCanvas( cvs, img, -x, -y, iw * s, ih * s );\n    \n        this._blob = null;    // 没用了，可以删掉了。\n        this.modified = true;\n        this.owner.trigger( 'complete', 'crop' );\n      },\n    \n      getAsBlob: function( type ) {\n        var blob = this._blob,\n          opts = this.options,\n          canvas;\n    \n        type = type || this.type;\n    \n        // blob需要重新生成。\n        if ( this.modified || this.type !== type ) {\n          canvas = this._canvas;\n    \n          if ( type === 'image/jpeg' ) {\n    \n            blob = Util.canvasToDataUrl( canvas, type, opts.quality );\n    \n            if ( opts.preserveHeaders && this._metas &&\n                                this._metas.imageHead ) {\n    \n              blob = Util.dataURL2ArrayBuffer( blob );\n              blob = Util.updateImageHead( blob,\n                this._metas.imageHead );\n              blob = Util.arrayBufferToBlob( blob, type );\n              return blob;\n            }\n          } else {\n            blob = Util.canvasToDataUrl( canvas, type );\n          }\n    \n          blob = Util.dataURL2Blob( blob );\n        }\n    \n        return blob;\n      },\n    \n      getAsDataUrl: function( type ) {\n        var opts = this.options;\n    \n        type = type || this.type;\n    \n        if ( type === 'image/jpeg' ) {\n          return Util.canvasToDataUrl( this._canvas, type, opts.quality );\n        } else {\n          return this._canvas.toDataURL( type );\n        }\n      },\n    \n      getOrientation: function() {\n        return this._metas && this._metas.exif &&\n                        this._metas.exif.get('Orientation') || 1;\n      },\n    \n      info: function( val ) {\n    \n        // setter\n        if ( val ) {\n          this._info = val;\n          return this;\n        }\n    \n        // getter\n        return this._info;\n      },\n    \n      meta: function( val ) {\n    \n        // setter\n        if ( val ) {\n          this._meta = val;\n          return this;\n        }\n    \n        // getter\n        return this._meta;\n      },\n    \n      destroy: function() {\n        var canvas = this._canvas;\n        this._img.onload = null;\n    \n        if ( canvas ) {\n          canvas.getContext('2d')\n            .clearRect( 0, 0, canvas.width, canvas.height );\n          canvas.width = canvas.height = 0;\n          this._canvas = null;\n        }\n    \n        // 释放内存。非常重要，否则释放不了image的内存。\n        this._img.src = BLANK;\n        this._img = this._blob = null;\n      },\n    \n      _resize: function( img, cvs, width, height ) {\n        var opts = this.options,\n          naturalWidth = img.width,\n          naturalHeight = img.height,\n          orientation = this.getOrientation(),\n          scale, w, h, x, y;\n    \n        // values that require 90 degree rotation\n        if ( ~[ 5, 6, 7, 8 ].indexOf( orientation ) ) {\n    \n          // 交换width, height的值。\n          width ^= height;\n          height ^= width;\n          width ^= height;\n        }\n    \n        scale = Math[ opts.crop ? 'max' : 'min' ]( width / naturalWidth,\n          height / naturalHeight );\n    \n        // 不允许放大。\n        opts.allowMagnify || (scale = Math.min( 1, scale ));\n    \n        w = naturalWidth * scale;\n        h = naturalHeight * scale;\n    \n        if ( opts.crop ) {\n          cvs.width = width;\n          cvs.height = height;\n        } else {\n          cvs.width = w;\n          cvs.height = h;\n        }\n    \n        x = (cvs.width - w) / 2;\n        y = (cvs.height - h) / 2;\n    \n        opts.preserveHeaders || this._rotate2Orientaion( cvs, orientation );\n    \n        this._renderImageToCanvas( cvs, img, x, y, w, h );\n      },\n    \n      _rotate2Orientaion: function( canvas, orientation ) {\n        var width = canvas.width,\n          height = canvas.height,\n          ctx = canvas.getContext('2d');\n    \n        switch ( orientation ) {\n        case 5:\n        case 6:\n        case 7:\n        case 8:\n          canvas.width = height;\n          canvas.height = width;\n          break;\n        }\n    \n        switch ( orientation ) {\n        case 2:    // horizontal flip\n          ctx.translate( width, 0 );\n          ctx.scale( -1, 1 );\n          break;\n    \n        case 3:    // 180 rotate left\n          ctx.translate( width, height );\n          ctx.rotate( Math.PI );\n          break;\n    \n        case 4:    // vertical flip\n          ctx.translate( 0, height );\n          ctx.scale( 1, -1 );\n          break;\n    \n        case 5:    // vertical flip + 90 rotate right\n          ctx.rotate( 0.5 * Math.PI );\n          ctx.scale( 1, -1 );\n          break;\n    \n        case 6:    // 90 rotate right\n          ctx.rotate( 0.5 * Math.PI );\n          ctx.translate( 0, -height );\n          break;\n    \n        case 7:    // horizontal flip + 90 rotate right\n          ctx.rotate( 0.5 * Math.PI );\n          ctx.translate( width, -height );\n          ctx.scale( -1, 1 );\n          break;\n    \n        case 8:    // 90 rotate left\n          ctx.rotate( -0.5 * Math.PI );\n          ctx.translate( -width, 0 );\n          break;\n        }\n      },\n    \n      // https://github.com/stomita/ios-imagefile-megapixel/\n      // blob/master/src/megapix-image.js\n      _renderImageToCanvas: (function() {\n    \n        // 如果不是ios, 不需要这么复杂！\n        if ( !Base.os.ios ) {\n          return function( canvas ) {\n            var args = Base.slice( arguments, 1 ),\n              ctx = canvas.getContext('2d');\n    \n            ctx.drawImage.apply( ctx, args );\n          };\n        }\n    \n        /**\n                 * Detecting vertical squash in loaded image.\n                 * Fixes a bug which squash image vertically while drawing into\n                 * canvas for some images.\n                 */\n        function detectVerticalSquash( img, iw, ih ) {\n          var canvas = document.createElement('canvas'),\n            ctx = canvas.getContext('2d'),\n            sy = 0,\n            ey = ih,\n            py = ih,\n            data, alpha, ratio;\n    \n    \n          canvas.width = 1;\n          canvas.height = ih;\n          ctx.drawImage( img, 0, 0 );\n          data = ctx.getImageData( 0, 0, 1, ih ).data;\n    \n          // search image edge pixel position in case\n          // it is squashed vertically.\n          while ( py > sy ) {\n            alpha = data[ (py - 1) * 4 + 3 ];\n    \n            if ( alpha === 0 ) {\n              ey = py;\n            } else {\n              sy = py;\n            }\n    \n            py = (ey + sy) >> 1;\n          }\n    \n          ratio = (py / ih);\n          return (ratio === 0) ? 1 : ratio;\n        }\n    \n        // fix ie7 bug\n        // http://stackoverflow.com/questions/11929099/\n        // html5-canvas-drawimage-ratio-bug-ios\n        if ( Base.os.ios >= 7 ) {\n          return function( canvas, img, x, y, w, h ) {\n            var iw = img.naturalWidth,\n              ih = img.naturalHeight,\n              vertSquashRatio = detectVerticalSquash( img, iw, ih );\n    \n            return canvas.getContext('2d').drawImage( img, 0, 0,\n              iw * vertSquashRatio, ih * vertSquashRatio,\n              x, y, w, h );\n          };\n        }\n    \n        /**\n                 * Detect subsampling in loaded image.\n                 * In iOS, larger images than 2M pixels may be\n                 * subsampled in rendering.\n                 */\n        function detectSubsampling( img ) {\n          var iw = img.naturalWidth,\n            ih = img.naturalHeight,\n            canvas, ctx;\n    \n          // subsampling may happen overmegapixel image\n          if ( iw * ih > 1024 * 1024 ) {\n            canvas = document.createElement('canvas');\n            canvas.width = canvas.height = 1;\n            ctx = canvas.getContext('2d');\n            ctx.drawImage( img, -iw + 1, 0 );\n    \n            // subsampled image becomes half smaller in rendering size.\n            // check alpha channel value to confirm image is covering\n            // edge pixel or not. if alpha value is 0\n            // image is not covering, hence subsampled.\n            return ctx.getImageData( 0, 0, 1, 1 ).data[ 3 ] === 0;\n          } else {\n            return false;\n          }\n        }\n    \n    \n        return function( canvas, img, x, y, width, height ) {\n          var iw = img.naturalWidth,\n            ih = img.naturalHeight,\n            ctx = canvas.getContext('2d'),\n            subsampled = detectSubsampling( img ),\n            doSquash = this.type === 'image/jpeg',\n            d = 1024,\n            sy = 0,\n            dy = 0,\n            tmpCanvas, tmpCtx, vertSquashRatio, dw, dh, sx, dx;\n    \n          if ( subsampled ) {\n            iw /= 2;\n            ih /= 2;\n          }\n    \n          ctx.save();\n          tmpCanvas = document.createElement('canvas');\n          tmpCanvas.width = tmpCanvas.height = d;\n    \n          tmpCtx = tmpCanvas.getContext('2d');\n          vertSquashRatio = doSquash ?\n            detectVerticalSquash( img, iw, ih ) : 1;\n    \n          dw = Math.ceil( d * width / iw );\n          dh = Math.ceil( d * height / ih / vertSquashRatio );\n    \n          while ( sy < ih ) {\n            sx = 0;\n            dx = 0;\n            while ( sx < iw ) {\n              tmpCtx.clearRect( 0, 0, d, d );\n              tmpCtx.drawImage( img, -sx, -sy );\n              ctx.drawImage( tmpCanvas, 0, 0, d, d,\n                x + dx, y + dy, dw, dh );\n              sx += d;\n              dx += dw;\n            }\n            sy += d;\n            dy += dh;\n          }\n          ctx.restore();\n          tmpCanvas = tmpCtx = null;\n        };\n      })()\n    });\n  });\n  /**\n     * @fileOverview Transport\n     * @todo 支持chunked传输，优势：\n     * 可以将大文件分成小块，挨个传输，可以提高大文件成功率，当失败的时候，也只需要重传那小部分，\n     * 而不需要重头再传一次。另外断点续传也需要用chunked方式。\n     */\n  define('runtime/html5/transport',[\n    'base',\n    'runtime/html5/runtime'\n  ], function( Base, Html5Runtime ) {\n    \n    var noop = Base.noop,\n      $ = Base.$;\n    \n    return Html5Runtime.register( 'Transport', {\n      init: function() {\n        this._status = 0;\n        this._response = null;\n      },\n    \n      send: function() {\n        var owner = this.owner,\n          opts = this.options,\n          xhr = this._initAjax(),\n          blob = owner._blob,\n          server = opts.server,\n          formData, binary, fr;\n    \n        if ( opts.sendAsBinary ) {\n          server += (/\\?/.test( server ) ? '&' : '?') +\n                            $.param( owner._formData );\n    \n          binary = blob.getSource();\n        } else {\n          formData = new FormData();\n          $.each( owner._formData, function( k, v ) {\n            formData.append( k, v );\n          });\n    \n          formData.append( opts.fileVal, blob.getSource(),\n            opts.filename || owner._formData.name || '' );\n        }\n    \n        if ( opts.withCredentials && 'withCredentials' in xhr ) {\n          xhr.open( opts.method, server, true );\n          xhr.withCredentials = true;\n        } else {\n          xhr.open( opts.method, server );\n        }\n    \n        this._setRequestHeader( xhr, opts.headers );\n    \n        if ( binary ) {\n          // 强制设置成 content-type 为文件流。\n          xhr.overrideMimeType &&\n                            xhr.overrideMimeType('application/octet-stream');\n    \n          // android直接发送blob会导致服务端接收到的是空文件。\n          // bug详情。\n          // https://code.google.com/p/android/issues/detail?id=39882\n          // 所以先用fileReader读取出来再通过arraybuffer的方式发送。\n          if ( Base.os.android ) {\n            fr = new FileReader();\n    \n            fr.onload = function() {\n              xhr.send( this.result );\n              fr = fr.onload = null;\n            };\n    \n            fr.readAsArrayBuffer( binary );\n          } else {\n            xhr.send( binary );\n          }\n        } else {\n          xhr.send( formData );\n        }\n      },\n    \n      getResponse: function() {\n        return this._response;\n      },\n    \n      getResponseAsJson: function() {\n        return this._parseJson( this._response );\n      },\n    \n      getStatus: function() {\n        return this._status;\n      },\n    \n      abort: function() {\n        var xhr = this._xhr;\n    \n        if ( xhr ) {\n          xhr.upload.onprogress = noop;\n          xhr.onreadystatechange = noop;\n          xhr.abort();\n    \n          this._xhr = xhr = null;\n        }\n      },\n    \n      destroy: function() {\n        this.abort();\n      },\n    \n      _initAjax: function() {\n        var me = this,\n          xhr = new XMLHttpRequest(),\n          opts = this.options;\n    \n        if ( opts.withCredentials && !('withCredentials' in xhr) &&\n                        typeof XDomainRequest !== 'undefined' ) {\n          xhr = new XDomainRequest();\n        }\n    \n        xhr.upload.onprogress = function( e ) {\n          var percentage = 0;\n    \n          if ( e.lengthComputable ) {\n            percentage = e.loaded / e.total;\n          }\n    \n          return me.trigger( 'progress', percentage );\n        };\n    \n        xhr.onreadystatechange = function() {\n    \n          if ( xhr.readyState !== 4 ) {\n            return;\n          }\n    \n          xhr.upload.onprogress = noop;\n          xhr.onreadystatechange = noop;\n          me._xhr = null;\n          me._status = xhr.status;\n    \n          if ( xhr.status >= 200 && xhr.status < 300 ) {\n            me._response = xhr.responseText;\n            return me.trigger('load');\n          } else if ( xhr.status >= 500 && xhr.status < 600 ) {\n            me._response = xhr.responseText;\n            return me.trigger( 'error', 'server' );\n          }\n    \n    \n          return me.trigger( 'error', me._status ? 'http' : 'abort' );\n        };\n    \n        me._xhr = xhr;\n        return xhr;\n      },\n    \n      _setRequestHeader: function( xhr, headers ) {\n        $.each( headers, function( key, val ) {\n          xhr.setRequestHeader( key, val );\n        });\n      },\n    \n      _parseJson: function( str ) {\n        var json;\n    \n        try {\n          json = JSON.parse( str );\n        } catch ( ex ) {\n          json = {};\n        }\n    \n        return json;\n      }\n    });\n  });\n  /**\n     * @fileOverview  Transport flash实现\n     */\n  define('runtime/html5/md5',[\n    'runtime/html5/runtime'\n  ], function( FlashRuntime ) {\n    \n    /*\n         * Fastest md5 implementation around (JKM md5)\n         * Credits: Joseph Myers\n         *\n         * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n         * @see http://jsperf.com/md5-shootout/7\n         */\n    \n    /* this function is much faster,\n          so if possible we use it. Some IEs\n          are the only ones I know of that\n          need the idiotic second function,\n          generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n      },\n    \n      cmn = function (q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n      },\n    \n      ff = function (a, b, c, d, x, s, t) {\n        return cmn((b & c) | ((~b) & d), a, b, x, s, t);\n      },\n    \n      gg = function (a, b, c, d, x, s, t) {\n        return cmn((b & d) | (c & (~d)), a, b, x, s, t);\n      },\n    \n      hh = function (a, b, c, d, x, s, t) {\n        return cmn(b ^ c ^ d, a, b, x, s, t);\n      },\n    \n      ii = function (a, b, c, d, x, s, t) {\n        return cmn(c ^ (b | (~d)), a, b, x, s, t);\n      },\n    \n      md5cycle = function (x, k) {\n        var a = x[0],\n          b = x[1],\n          c = x[2],\n          d = x[3];\n    \n        a = ff(a, b, c, d, k[0], 7, -680876936);\n        d = ff(d, a, b, c, k[1], 12, -389564586);\n        c = ff(c, d, a, b, k[2], 17, 606105819);\n        b = ff(b, c, d, a, k[3], 22, -1044525330);\n        a = ff(a, b, c, d, k[4], 7, -176418897);\n        d = ff(d, a, b, c, k[5], 12, 1200080426);\n        c = ff(c, d, a, b, k[6], 17, -1473231341);\n        b = ff(b, c, d, a, k[7], 22, -45705983);\n        a = ff(a, b, c, d, k[8], 7, 1770035416);\n        d = ff(d, a, b, c, k[9], 12, -1958414417);\n        c = ff(c, d, a, b, k[10], 17, -42063);\n        b = ff(b, c, d, a, k[11], 22, -1990404162);\n        a = ff(a, b, c, d, k[12], 7, 1804603682);\n        d = ff(d, a, b, c, k[13], 12, -40341101);\n        c = ff(c, d, a, b, k[14], 17, -1502002290);\n        b = ff(b, c, d, a, k[15], 22, 1236535329);\n    \n        a = gg(a, b, c, d, k[1], 5, -165796510);\n        d = gg(d, a, b, c, k[6], 9, -1069501632);\n        c = gg(c, d, a, b, k[11], 14, 643717713);\n        b = gg(b, c, d, a, k[0], 20, -373897302);\n        a = gg(a, b, c, d, k[5], 5, -701558691);\n        d = gg(d, a, b, c, k[10], 9, 38016083);\n        c = gg(c, d, a, b, k[15], 14, -660478335);\n        b = gg(b, c, d, a, k[4], 20, -405537848);\n        a = gg(a, b, c, d, k[9], 5, 568446438);\n        d = gg(d, a, b, c, k[14], 9, -1019803690);\n        c = gg(c, d, a, b, k[3], 14, -187363961);\n        b = gg(b, c, d, a, k[8], 20, 1163531501);\n        a = gg(a, b, c, d, k[13], 5, -1444681467);\n        d = gg(d, a, b, c, k[2], 9, -51403784);\n        c = gg(c, d, a, b, k[7], 14, 1735328473);\n        b = gg(b, c, d, a, k[12], 20, -1926607734);\n    \n        a = hh(a, b, c, d, k[5], 4, -378558);\n        d = hh(d, a, b, c, k[8], 11, -2022574463);\n        c = hh(c, d, a, b, k[11], 16, 1839030562);\n        b = hh(b, c, d, a, k[14], 23, -35309556);\n        a = hh(a, b, c, d, k[1], 4, -1530992060);\n        d = hh(d, a, b, c, k[4], 11, 1272893353);\n        c = hh(c, d, a, b, k[7], 16, -155497632);\n        b = hh(b, c, d, a, k[10], 23, -1094730640);\n        a = hh(a, b, c, d, k[13], 4, 681279174);\n        d = hh(d, a, b, c, k[0], 11, -358537222);\n        c = hh(c, d, a, b, k[3], 16, -722521979);\n        b = hh(b, c, d, a, k[6], 23, 76029189);\n        a = hh(a, b, c, d, k[9], 4, -640364487);\n        d = hh(d, a, b, c, k[12], 11, -421815835);\n        c = hh(c, d, a, b, k[15], 16, 530742520);\n        b = hh(b, c, d, a, k[2], 23, -995338651);\n    \n        a = ii(a, b, c, d, k[0], 6, -198630844);\n        d = ii(d, a, b, c, k[7], 10, 1126891415);\n        c = ii(c, d, a, b, k[14], 15, -1416354905);\n        b = ii(b, c, d, a, k[5], 21, -57434055);\n        a = ii(a, b, c, d, k[12], 6, 1700485571);\n        d = ii(d, a, b, c, k[3], 10, -1894986606);\n        c = ii(c, d, a, b, k[10], 15, -1051523);\n        b = ii(b, c, d, a, k[1], 21, -2054922799);\n        a = ii(a, b, c, d, k[8], 6, 1873313359);\n        d = ii(d, a, b, c, k[15], 10, -30611744);\n        c = ii(c, d, a, b, k[6], 15, -1560198380);\n        b = ii(b, c, d, a, k[13], 21, 1309151649);\n        a = ii(a, b, c, d, k[4], 6, -145523070);\n        d = ii(d, a, b, c, k[11], 10, -1120210379);\n        c = ii(c, d, a, b, k[2], 15, 718787259);\n        b = ii(b, c, d, a, k[9], 21, -343485551);\n    \n        x[0] = add32(a, x[0]);\n        x[1] = add32(b, x[1]);\n        x[2] = add32(c, x[2]);\n        x[3] = add32(d, x[3]);\n      },\n    \n      /* there needs to be support for Unicode here,\n           * unless we pretend that we can redefine the MD-5\n           * algorithm for multi-byte characters (perhaps\n           * by adding every four 16-bit characters and\n           * shortening the sum to 32 bits). Otherwise\n           * I suggest performing MD-5 as if every character\n           * was two bytes--e.g., 0040 0025 = @%--but then\n           * how will an ordinary MD-5 sum be matched?\n           * There is no way to standardize text to something\n           * like UTF-8 before transformation; speed cost is\n           * utterly prohibitive. The JavaScript standard\n           * itself needs to look at this: it should start\n           * providing access to strings as preformed UTF-8\n           * 8-bit unsigned value arrays.\n           */\n      md5blk = function (s) {\n        var md5blks = [],\n          i; /* Andy King said do it this way. */\n    \n        for (i = 0; i < 64; i += 4) {\n          md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n      },\n    \n      md5blk_array = function (a) {\n        var md5blks = [],\n          i; /* Andy King said do it this way. */\n    \n        for (i = 0; i < 64; i += 4) {\n          md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n      },\n    \n      md51 = function (s) {\n        var n = s.length,\n          state = [1732584193, -271733879, -1732584194, 271733878],\n          i,\n          length,\n          tail,\n          tmp,\n          lo,\n          hi;\n    \n        for (i = 64; i <= n; i += 64) {\n          md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n          tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n          md5cycle(state, tail);\n          for (i = 0; i < 16; i += 1) {\n            tail[i] = 0;\n          }\n        }\n    \n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n    \n        tail[14] = lo;\n        tail[15] = hi;\n    \n        md5cycle(state, tail);\n        return state;\n      },\n    \n      md51_array = function (a) {\n        var n = a.length,\n          state = [1732584193, -271733879, -1732584194, 271733878],\n          i,\n          length,\n          tail,\n          tmp,\n          lo,\n          hi;\n    \n        for (i = 64; i <= n; i += 64) {\n          md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n    \n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n    \n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n          tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n    \n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n          md5cycle(state, tail);\n          for (i = 0; i < 16; i += 1) {\n            tail[i] = 0;\n          }\n        }\n    \n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n    \n        tail[14] = lo;\n        tail[15] = hi;\n    \n        md5cycle(state, tail);\n    \n        return state;\n      },\n    \n      hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'],\n    \n      rhex = function (n) {\n        var s = '',\n          j;\n        for (j = 0; j < 4; j += 1) {\n          s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n      },\n    \n      hex = function (x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n          x[i] = rhex(x[i]);\n        }\n        return x.join('');\n      },\n    \n      md5 = function (s) {\n        return hex(md51(s));\n      },\n    \n    \n    \n      ////////////////////////////////////////////////////////////////////////////\n    \n      /**\n         * SparkMD5 OOP implementation.\n         *\n         * Use this class to perform an incremental md5, otherwise use the\n         * static methods instead.\n         */\n      SparkMD5 = function () {\n        // call reset to init the instance\n        this.reset();\n      };\n    \n    \n    // In some cases the fast add32 function cannot be used..\n    if (md5('hello') !== '5d41402abc4b2a76b9719d911017c592') {\n      add32 = function (x, y) {\n        var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n          msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n        return (msw << 16) | (lsw & 0xFFFF);\n      };\n    }\n    \n    \n    /**\n         * Appends a string.\n         * A conversion will be applied if an utf8 string is detected.\n         *\n         * @param {String} str The string to be appended\n         *\n         * @return {SparkMD5} The instance itself\n         */\n    SparkMD5.prototype.append = function (str) {\n      // converts the string to utf8 bytes if necessary\n      if (/[\\u0080-\\uFFFF]/.test(str)) {\n        str = unescape(encodeURIComponent(str));\n      }\n    \n      // then append as binary\n      this.appendBinary(str);\n    \n      return this;\n    };\n    \n    /**\n         * Appends a binary string.\n         *\n         * @param {String} contents The binary string to be appended\n         *\n         * @return {SparkMD5} The instance itself\n         */\n    SparkMD5.prototype.appendBinary = function (contents) {\n      this._buff += contents;\n      this._length += contents.length;\n    \n      var length = this._buff.length,\n        i;\n    \n      for (i = 64; i <= length; i += 64) {\n        md5cycle(this._state, md5blk(this._buff.substring(i - 64, i)));\n      }\n    \n      this._buff = this._buff.substr(i - 64);\n    \n      return this;\n    };\n    \n    /**\n         * Finishes the incremental computation, reseting the internal state and\n         * returning the result.\n         * Use the raw parameter to obtain the raw result instead of the hex one.\n         *\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n    SparkMD5.prototype.end = function (raw) {\n      var buff = this._buff,\n        length = buff.length,\n        i,\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n        ret;\n    \n      for (i = 0; i < length; i += 1) {\n        tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n      }\n    \n      this._finish(tail, length);\n      ret = raw ? this._state : hex(this._state);\n    \n      this.reset();\n    \n      return ret;\n    };\n    \n    /**\n         * Finish the final calculation based on the tail.\n         *\n         * @param {Array}  tail   The tail (will be modified)\n         * @param {Number} length The length of the remaining buffer\n         */\n    SparkMD5.prototype._finish = function (tail, length) {\n      var i = length,\n        tmp,\n        lo,\n        hi;\n    \n      tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n      if (i > 55) {\n        md5cycle(this._state, tail);\n        for (i = 0; i < 16; i += 1) {\n          tail[i] = 0;\n        }\n      }\n    \n      // Do the final computation based on the tail and length\n      // Beware that the final length may not fit in 32 bits so we take care of that\n      tmp = this._length * 8;\n      tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n      lo = parseInt(tmp[2], 16);\n      hi = parseInt(tmp[1], 16) || 0;\n    \n      tail[14] = lo;\n      tail[15] = hi;\n      md5cycle(this._state, tail);\n    };\n    \n    /**\n         * Resets the internal state of the computation.\n         *\n         * @return {SparkMD5} The instance itself\n         */\n    SparkMD5.prototype.reset = function () {\n      this._buff = '';\n      this._length = 0;\n      this._state = [1732584193, -271733879, -1732584194, 271733878];\n    \n      return this;\n    };\n    \n    /**\n         * Releases memory used by the incremental buffer and other aditional\n         * resources. If you plan to use the instance again, use reset instead.\n         */\n    SparkMD5.prototype.destroy = function () {\n      delete this._state;\n      delete this._buff;\n      delete this._length;\n    };\n    \n    \n    /**\n         * Performs the md5 hash on a string.\n         * A conversion will be applied if utf8 string is detected.\n         *\n         * @param {String}  str The string\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n    SparkMD5.hash = function (str, raw) {\n      // converts the string to utf8 bytes if necessary\n      if (/[\\u0080-\\uFFFF]/.test(str)) {\n        str = unescape(encodeURIComponent(str));\n      }\n    \n      var hash = md51(str);\n    \n      return raw ? hash : hex(hash);\n    };\n    \n    /**\n         * Performs the md5 hash on a binary string.\n         *\n         * @param {String}  content The binary string\n         * @param {Boolean} raw     True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n    SparkMD5.hashBinary = function (content, raw) {\n      var hash = md51(content);\n    \n      return raw ? hash : hex(hash);\n    };\n    \n    /**\n         * SparkMD5 OOP implementation for array buffers.\n         *\n         * Use this class to perform an incremental md5 ONLY for array buffers.\n         */\n    SparkMD5.ArrayBuffer = function () {\n      // call reset to init the instance\n      this.reset();\n    };\n    \n    ////////////////////////////////////////////////////////////////////////////\n    \n    /**\n         * Appends an array buffer.\n         *\n         * @param {ArrayBuffer} arr The array to be appended\n         *\n         * @return {SparkMD5.ArrayBuffer} The instance itself\n         */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n      // TODO: we could avoid the concatenation here but the algorithm would be more complex\n      //       if you find yourself needing extra performance, please make a PR.\n      var buff = this._concatArrayBuffer(this._buff, arr),\n        length = buff.length,\n        i;\n    \n      this._length += arr.byteLength;\n    \n      for (i = 64; i <= length; i += 64) {\n        md5cycle(this._state, md5blk_array(buff.subarray(i - 64, i)));\n      }\n    \n      // Avoids IE10 weirdness (documented above)\n      this._buff = (i - 64) < length ? buff.subarray(i - 64) : new Uint8Array(0);\n    \n      return this;\n    };\n    \n    /**\n         * Finishes the incremental computation, reseting the internal state and\n         * returning the result.\n         * Use the raw parameter to obtain the raw result instead of the hex one.\n         *\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n      var buff = this._buff,\n        length = buff.length,\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n        i,\n        ret;\n    \n      for (i = 0; i < length; i += 1) {\n        tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n      }\n    \n      this._finish(tail, length);\n      ret = raw ? this._state : hex(this._state);\n    \n      this.reset();\n    \n      return ret;\n    };\n    \n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n    \n    /**\n         * Resets the internal state of the computation.\n         *\n         * @return {SparkMD5.ArrayBuffer} The instance itself\n         */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n      this._buff = new Uint8Array(0);\n      this._length = 0;\n      this._state = [1732584193, -271733879, -1732584194, 271733878];\n    \n      return this;\n    };\n    \n    /**\n         * Releases memory used by the incremental buffer and other aditional\n         * resources. If you plan to use the instance again, use reset instead.\n         */\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n    \n    /**\n         * Concats two array buffers, returning a new one.\n         *\n         * @param  {ArrayBuffer} first  The first array buffer\n         * @param  {ArrayBuffer} second The second array buffer\n         *\n         * @return {ArrayBuffer} The new array buffer\n         */\n    SparkMD5.ArrayBuffer.prototype._concatArrayBuffer = function (first, second) {\n      var firstLength = first.length,\n        result = new Uint8Array(firstLength + second.byteLength);\n    \n      result.set(first);\n      result.set(new Uint8Array(second), firstLength);\n    \n      return result;\n    };\n    \n    /**\n         * Performs the md5 hash on an array buffer.\n         *\n         * @param {ArrayBuffer} arr The array buffer\n         * @param {Boolean}     raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n      var hash = md51_array(new Uint8Array(arr));\n    \n      return raw ? hash : hex(hash);\n    };\n        \n    return FlashRuntime.register( 'Md5', {\n      init: function() {\n        // do nothing.\n      },\n    \n      loadFromBlob: function( file ) {\n        var blob = file.getSource(),\n          chunkSize = 2 * 1024 * 1024,\n          chunks = Math.ceil( blob.size / chunkSize ),\n          chunk = 0,\n          owner = this.owner,\n          spark = new SparkMD5.ArrayBuffer(),\n          me = this,\n          blobSlice = blob.mozSlice || blob.webkitSlice || blob.slice,\n          loadNext, fr;\n    \n        fr = new FileReader();\n    \n        loadNext = function() {\n          var start, end;\n    \n          start = chunk * chunkSize;\n          end = Math.min( start + chunkSize, blob.size );\n    \n          fr.onload = function( e ) {\n            spark.append( e.target.result );\n            owner.trigger( 'progress', {\n              total: file.size,\n              loaded: end\n            });\n          };\n    \n          fr.onloadend = function() {\n            fr.onloadend = fr.onload = null;\n    \n            if ( ++chunk < chunks ) {\n              setTimeout( loadNext, 1 );\n            } else {\n              setTimeout(function(){\n                owner.trigger('load');\n                me.result = spark.end();\n                loadNext = file = blob = spark = null;\n                owner.trigger('complete');\n              }, 50 );\n            }\n          };\n    \n          fr.readAsArrayBuffer( blobSlice.call( blob, start, end ) );\n        };\n    \n        loadNext();\n      },\n    \n      getResult: function() {\n        return this.result;\n      }\n    });\n  });\n  /**\n     * @fileOverview FlashRuntime\n     */\n  define('runtime/flash/runtime',[\n    'base',\n    'runtime/runtime',\n    'runtime/compbase'\n  ], function( Base, Runtime, CompBase ) {\n    \n    var $ = Base.$,\n      type = 'flash',\n      components = {};\n    \n    \n    function getFlashVersion() {\n      var version;\n    \n      try {\n        version = navigator.plugins[ 'Shockwave Flash' ];\n        version = version.description;\n      } catch ( ex ) {\n        try {\n          version = new ActiveXObject('ShockwaveFlash.ShockwaveFlash')\n            .GetVariable('$version');\n        } catch ( ex2 ) {\n          version = '0.0';\n        }\n      }\n      version = version.match( /\\d+/g );\n      return parseFloat( version[ 0 ] + '.' + version[ 1 ], 10 );\n    }\n    \n    function FlashRuntime() {\n      var pool = {},\n        clients = {},\n        destroy = this.destroy,\n        me = this,\n        jsreciver = Base.guid('webuploader_');\n    \n      Runtime.apply( me, arguments );\n      me.type = type;\n    \n    \n      // 这个方法的调用者，实际上是RuntimeClient\n      me.exec = function( comp, fn/*, args...*/ ) {\n        var client = this,\n          uid = client.uid,\n          args = Base.slice( arguments, 2 ),\n          instance;\n    \n        clients[ uid ] = client;\n    \n        if ( components[ comp ] ) {\n          if ( !pool[ uid ] ) {\n            pool[ uid ] = new components[ comp ]( client, me );\n          }\n    \n          instance = pool[ uid ];\n    \n          if ( instance[ fn ] ) {\n            return instance[ fn ].apply( instance, args );\n          }\n        }\n    \n        return me.flashExec.apply( client, arguments );\n      };\n    \n      function handler( evt, obj ) {\n        var type = evt.type || evt,\n          parts, uid;\n    \n        parts = type.split('::');\n        uid = parts[ 0 ];\n        type = parts[ 1 ];\n    \n        // console.log.apply( console, arguments );\n    \n        if ( type === 'Ready' && uid === me.uid ) {\n          me.trigger('ready');\n        } else if ( clients[ uid ] ) {\n          clients[ uid ].trigger( type.toLowerCase(), evt, obj );\n        }\n    \n        // Base.log( evt, obj );\n      }\n    \n      // flash的接受器。\n      window[ jsreciver ] = function() {\n        var args = arguments;\n    \n        // 为了能捕获得到。\n        setTimeout(function() {\n          handler.apply( null, args );\n        }, 1 );\n      };\n    \n      this.jsreciver = jsreciver;\n    \n      this.destroy = function() {\n        // @todo 删除池子中的所有实例\n        return destroy && destroy.apply( this, arguments );\n      };\n    \n      this.flashExec = function( comp, fn ) {\n        var flash = me.getFlash(),\n          args = Base.slice( arguments, 2 );\n    \n        return flash.exec( this.uid, comp, fn, args );\n      };\n    \n      // @todo\n    }\n    \n    Base.inherits( Runtime, {\n      constructor: FlashRuntime,\n    \n      init: function() {\n        var container = this.getContainer(),\n          opts = this.options,\n          html;\n    \n        // if not the minimal height, shims are not initialized\n        // in older browsers (e.g FF3.6, IE6,7,8, Safari 4.0,5.0, etc)\n        container.css({\n          position: 'absolute',\n          top: '-8px',\n          left: '-8px',\n          width: '9px',\n          height: '9px',\n          overflow: 'hidden'\n        });\n    \n        // insert flash object\n        html = '<object id=\"' + this.uid + '\" type=\"application/' +\n                        'x-shockwave-flash\" data=\"' +  opts.swf + '\" ';\n    \n        if ( Base.browser.ie ) {\n          html += 'classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" ';\n        }\n    \n        html += 'width=\"100%\" height=\"100%\" style=\"outline:0\">'  +\n                    '<param name=\"movie\" value=\"' + opts.swf + '\" />' +\n                    '<param name=\"flashvars\" value=\"uid=' + this.uid +\n                    '&jsreciver=' + this.jsreciver + '\" />' +\n                    '<param name=\"wmode\" value=\"transparent\" />' +\n                    '<param name=\"allowscriptaccess\" value=\"always\" />' +\n                '</object>';\n    \n        container.html( html );\n      },\n    \n      getFlash: function() {\n        if ( this._flash ) {\n          return this._flash;\n        }\n    \n        this._flash = $( '#' + this.uid ).get( 0 );\n        return this._flash;\n      }\n    \n    });\n    \n    FlashRuntime.register = function( name, component ) {\n      component = components[ name ] = Base.inherits( CompBase, $.extend({\n    \n        // @todo fix this later\n        flashExec: function() {\n          var owner = this.owner,\n            runtime = this.getRuntime();\n    \n          return runtime.flashExec.apply( owner, arguments );\n        }\n      }, component ) );\n    \n      return component;\n    };\n    \n    if ( getFlashVersion() >= 11.4 ) {\n      Runtime.addRuntime( type, FlashRuntime );\n    }\n    \n    return FlashRuntime;\n  });\n  /**\n     * @fileOverview FilePicker\n     */\n  define('runtime/flash/filepicker',[\n    'base',\n    'runtime/flash/runtime'\n  ], function( Base, FlashRuntime ) {\n    var $ = Base.$;\n    \n    return FlashRuntime.register( 'FilePicker', {\n      init: function( opts ) {\n        var copy = $.extend({}, opts ),\n          len, i;\n    \n        // 修复Flash再没有设置title的情况下无法弹出flash文件选择框的bug.\n        len = copy.accept && copy.accept.length;\n        for (  i = 0; i < len; i++ ) {\n          if ( !copy.accept[ i ].title ) {\n            copy.accept[ i ].title = 'Files';\n          }\n        }\n    \n        delete copy.button;\n        delete copy.id;\n        delete copy.container;\n    \n        this.flashExec( 'FilePicker', 'init', copy );\n      },\n    \n      destroy: function() {\n        this.flashExec( 'FilePicker', 'destroy' );\n      }\n    });\n  });\n  /**\n     * @fileOverview 图片压缩\n     */\n  define('runtime/flash/image',[\n    'runtime/flash/runtime'\n  ], function( FlashRuntime ) {\n    \n    return FlashRuntime.register( 'Image', {\n      // init: function( options ) {\n      //     var owner = this.owner;\n    \n      //     this.flashExec( 'Image', 'init', options );\n      //     owner.on( 'load', function() {\n      //         debugger;\n      //     });\n      // },\n    \n      loadFromBlob: function( blob ) {\n        var owner = this.owner;\n    \n        owner.info() && this.flashExec( 'Image', 'info', owner.info() );\n        owner.meta() && this.flashExec( 'Image', 'meta', owner.meta() );\n    \n        this.flashExec( 'Image', 'loadFromBlob', blob.uid );\n      }\n    });\n  });\n  /**\n     * @fileOverview  Transport flash实现\n     */\n  define('runtime/flash/transport',[\n    'base',\n    'runtime/flash/runtime',\n    'runtime/client'\n  ], function( Base, FlashRuntime, RuntimeClient ) {\n    var $ = Base.$;\n    \n    return FlashRuntime.register( 'Transport', {\n      init: function() {\n        this._status = 0;\n        this._response = null;\n        this._responseJson = null;\n      },\n    \n      send: function() {\n        var owner = this.owner,\n          opts = this.options,\n          xhr = this._initAjax(),\n          blob = owner._blob,\n          server = opts.server,\n          binary;\n    \n        xhr.connectRuntime( blob.ruid );\n    \n        if ( opts.sendAsBinary ) {\n          server += (/\\?/.test( server ) ? '&' : '?') +\n                            $.param( owner._formData );\n    \n          binary = blob.uid;\n        } else {\n          $.each( owner._formData, function( k, v ) {\n            xhr.exec( 'append', k, v );\n          });\n    \n          xhr.exec( 'appendBlob', opts.fileVal, blob.uid,\n            opts.filename || owner._formData.name || '' );\n        }\n    \n        this._setRequestHeader( xhr, opts.headers );\n        xhr.exec( 'send', {\n          method: opts.method,\n          url: server,\n          forceURLStream: opts.forceURLStream,\n          mimeType: 'application/octet-stream'\n        }, binary );\n      },\n    \n      getStatus: function() {\n        return this._status;\n      },\n    \n      getResponse: function() {\n        return this._response || '';\n      },\n    \n      getResponseAsJson: function() {\n        return this._responseJson;\n      },\n    \n      abort: function() {\n        var xhr = this._xhr;\n    \n        if ( xhr ) {\n          xhr.exec('abort');\n          xhr.destroy();\n          this._xhr = xhr = null;\n        }\n      },\n    \n      destroy: function() {\n        this.abort();\n      },\n    \n      _initAjax: function() {\n        var me = this,\n          xhr = new RuntimeClient('XMLHttpRequest');\n    \n        xhr.on( 'uploadprogress progress', function( e ) {\n          var percent = e.loaded / e.total;\n          percent = Math.min( 1, Math.max( 0, percent ) );\n          return me.trigger( 'progress', percent );\n        });\n    \n        xhr.on( 'load', function() {\n          var status = xhr.exec('getStatus'),\n            readBody = false,\n            err = '',\n            p;\n    \n          xhr.off();\n          me._xhr = null;\n    \n          if ( status >= 200 && status < 300 ) {\n            readBody = true;\n          } else if ( status >= 500 && status < 600 ) {\n            readBody = true;\n            err = 'server';\n          } else {\n            err = 'http';\n          }\n    \n          if ( readBody ) {\n            me._response = xhr.exec('getResponse');\n            me._response = decodeURIComponent( me._response );\n    \n            // flash 处理可能存在 bug, 没辙只能靠 js 了\n            // try {\n            //     me._responseJson = xhr.exec('getResponseAsJson');\n            // } catch ( error ) {\n                            \n            p = window.JSON && window.JSON.parse || function( s ) {\n              try {\n                return new Function('return ' + s).call();\n              } catch ( err ) {\n                return {};\n              }\n            };\n            me._responseJson  = me._response ? p(me._response) : {};\n                            \n            // }\n          }\n                    \n          xhr.destroy();\n          xhr = null;\n    \n          return err ? me.trigger( 'error', err ) : me.trigger('load');\n        });\n    \n        xhr.on( 'error', function() {\n          xhr.off();\n          me._xhr = null;\n          me.trigger( 'error', 'http' );\n        });\n    \n        me._xhr = xhr;\n        return xhr;\n      },\n    \n      _setRequestHeader: function( xhr, headers ) {\n        $.each( headers, function( key, val ) {\n          xhr.exec( 'setRequestHeader', key, val );\n        });\n      }\n    });\n  });\n  /**\n     * @fileOverview Blob Html实现\n     */\n  define('runtime/flash/blob',[\n    'runtime/flash/runtime',\n    'lib/blob'\n  ], function( FlashRuntime, Blob ) {\n    \n    return FlashRuntime.register( 'Blob', {\n      slice: function( start, end ) {\n        var blob = this.flashExec( 'Blob', 'slice', start, end );\n    \n        return new Blob( blob.uid, blob );\n      }\n    });\n  });\n  /**\n     * @fileOverview  Md5 flash实现\n     */\n  define('runtime/flash/md5',[\n    'runtime/flash/runtime'\n  ], function( FlashRuntime ) {\n        \n    return FlashRuntime.register( 'Md5', {\n      init: function() {\n        // do nothing.\n      },\n    \n      loadFromBlob: function( blob ) {\n        return this.flashExec( 'Md5', 'loadFromBlob', blob.uid );\n      }\n    });\n  });\n  /**\n     * @fileOverview 完全版本。\n     */\n  define('preset/all',[\n    'base',\n    \n    // widgets\n    'widgets/filednd',\n    'widgets/filepaste',\n    'widgets/filepicker',\n    'widgets/image',\n    'widgets/queue',\n    'widgets/runtime',\n    'widgets/upload',\n    'widgets/validator',\n    'widgets/md5',\n    \n    // runtimes\n    // html5\n    'runtime/html5/blob',\n    'runtime/html5/dnd',\n    'runtime/html5/filepaste',\n    'runtime/html5/filepicker',\n    'runtime/html5/imagemeta/exif',\n    'runtime/html5/androidpatch',\n    'runtime/html5/image',\n    'runtime/html5/transport',\n    'runtime/html5/md5',\n    \n    // flash\n    'runtime/flash/filepicker',\n    'runtime/flash/image',\n    'runtime/flash/transport',\n    'runtime/flash/blob',\n    'runtime/flash/md5'\n  ], function( Base ) {\n    return Base;\n  });\n  /**\n     * @fileOverview 日志组件，主要用来收集错误信息，可以帮助 webuploader 更好的定位问题和发展。\n     *\n     * 如果您不想要启用此功能，请在打包的时候去掉 log 模块。\n     *\n     * 或者可以在初始化的时候通过 options.disableWidgets 属性禁用。\n     *\n     * 如：\n     * WebUploader.create({\n     *     ...\n     *\n     *     disableWidgets: 'log',\n     *\n     *     ...\n     * })\n     */\n  define('widgets/log',[\n    'base',\n    'uploader',\n    'widgets/widget'\n  ], function( Base, Uploader ) {\n    var $ = Base.$,\n      logUrl = ' http://static.tieba.baidu.com/tb/pms/img/st.gif??',\n      product = (location.hostname || location.host || 'protected').toLowerCase(),\n    \n      // 只针对 baidu 内部产品用户做统计功能。\n      enable = product && /baidu/i.exec(product),\n      base;\n    \n    if (!enable) {\n      return;\n    }\n    \n    base = {\n      dv: 3,\n      master: 'webuploader',\n      online: /test/.exec(product) ? 0 : 1,\n      module: '',\n      product: product,\n      type: 0\n    };\n    \n    function send(data) {\n      var obj = $.extend({}, base, data),\n        url = logUrl.replace(/^(.*)\\?/, '$1' + $.param( obj )),\n        image = new Image();\n    \n      image.src = url;\n    }\n    \n    return Uploader.register({\n      name: 'log',\n    \n      init: function() {\n        var owner = this.owner,\n          count = 0,\n          size = 0;\n    \n        owner\n          .on('error', function(code) {\n            send({\n              type: 2,\n              c_error_code: code\n            });\n          })\n          .on('uploadError', function(file, reason) {\n            send({\n              type: 2,\n              c_error_code: 'UPLOAD_ERROR',\n              c_reason: '' + reason\n            });\n          })\n          .on('uploadComplete', function(file) {\n            count++;\n            size += file.size;\n          }).\n          on('uploadFinished', function() {\n            send({\n              c_count: count,\n              c_size: size\n            });\n            count = size = 0;\n          });\n    \n        send({\n          c_usage: 1\n        });\n      }\n    });\n  });\n  /**\n     * @fileOverview Uploader上传类\n     */\n  define('webuploader',[\n    'preset/all',\n    'widgets/log'\n  ], function( preset ) {\n    return preset;\n  });\n  return require('webuploader');\n});\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/common/fex-webuploader/webuploader.js"],"sourceRoot":""}