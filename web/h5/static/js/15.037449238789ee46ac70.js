webpackJsonp([15],{Jpvt:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("Dd8w"),i=s.n(a),o=s("NYxO"),n=s("SQAI"),r=s("oHlh"),c=s("gyMJ"),u={components:{eCourse:r.a,coupon:n.a},data:function(){return{course:{availableCoupons:[],courseSet:{cover:{}}},activeItemIndex:-1,showList:!1,itemData:null,couponNumber:0,targetType:this.$route.query.targetType,targetId:this.$route.params.id}},computed:i()({},Object(o.mapState)({isLoading:function(t){return t.isLoading}}),{total:function(){if(!this.itemData)return this.course.totalPrice;var t="minus"===this.itemData.type,e=this.itemData.rate,s=this.course.totalPrice;return t?Math.max(s-e,0).toFixed(2):Number(s*e*.1).toFixed(2)},couponMoney:function(){if(this.itemData){var t="discount"===this.itemData.type,e=this.itemData.rate;return t&&(e=Number(this.course.totalPrice-this.course.totalPrice*this.itemData.rate*.1).toFixed(2)),this.couponNumber=e,e}},couponShow:function(){return this.couponNumber?"-￥"+this.couponNumber:this.course.availableCoupons.length+"张可用"},getValidity:function(){return this.$route.query.expiryScope||"永久有效"}}),created:function(){var t=this;c.a.confirmOrder({data:{targetType:this.targetType,targetId:this.targetId}}).then(function(e){t.course=e})},methods:{handleSubmit:function(){var t=this;0!=this.total?this.$router.push({name:"pay",query:{id:this.targetId,targetType:this.targetType},params:{couponCode:this.itemData?this.itemData.code:""}}):c.a.createOrder({data:{targetType:this.targetType,targetId:this.targetId,isOrderCreate:1,couponCode:this.itemData?this.itemData.code:""}}).then(function(){t.$router.push({path:"/"+t.targetType+"/"+t.targetId})})},disuse:function(){this.showList=!1,this.activeItemIndex=-1,this.itemData=null,this.couponNumber=0},chooseItem:function(t){this.activeItemIndex=t.index,this.itemData=t.itemData,this.showList=!1}}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"order"},[s("div",{staticClass:"goods-info"},[t.isLoading?s("e-loading"):t._e(),t._v(" "),Object.keys(t.course).length>0?s("e-course",{attrs:{type:"confirmOrder",order:t.course,course:t.course}}):t._e(),t._v(" "),s("div",{staticClass:"order-coupon"},[s("div",{staticClass:"coupon-column",on:{click:function(e){t.showList=!0}}},[s("span",[t._v("优惠券")]),t._v(" "),s("span",{staticClass:"red"},[t._v(t._s(t.couponShow))])]),t._v(" "),s("van-popup",{staticClass:"full-height-popup coupon-popup",attrs:{position:"bottom",overlay:!1},model:{value:t.showList,callback:function(e){t.showList=e},expression:"showList"}},[s("van-nav-bar",{staticClass:"nav-bar",attrs:{title:"优惠券","left-arrow":!0},on:{"click-left":t.disuse}}),t._v(" "),s("div",{class:["btn-coupon-exit",{active:t.activeItemIndex<0}],on:{click:t.disuse}},[t._v("不使用优惠\n          "),s("i",{staticClass:"h5-icon h5-icon-circle"}),t._v(" "),s("i",{staticClass:"h5-icon h5-icon-check"})]),t._v(" "),s("div",{staticClass:"coupon-popup__content"},t._l(t.course.availableCoupons,function(e,a){return s("coupon",{key:a,attrs:{coupon:e,index:a,active:t.activeItemIndex,showButton:!1,showSelecet:!0},on:{chooseItem:t.chooseItem}})})),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.course.availableCoupons.length,expression:"!course.availableCoupons.length"}],staticClass:"coupon-empty"},[s("img",{staticClass:"empty-img",attrs:{src:"static/images/coupon_empty.png"}}),t._v(" "),s("div",{staticClass:"empty-text"},[t._v("暂无优惠券")])])],1)],1),t._v(" "),s("div",{staticClass:"order-goods-item"},[s("span",[t._v("学习有效期")]),t._v(" "),s("span",{staticClass:"gray-dark",domProps:{innerHTML:t._s(t.getValidity)}})])],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.itemData,expression:"itemData"}],staticClass:"order-accounts"},[s("div",{staticClass:"mb20 title-18"},[t._v("结算")]),t._v(" "),s("div",{staticClass:"flex-between-item"},[s("span",{staticClass:"mbl"},[t._v("商品价格：")]),t._v(" "),s("span",{staticClass:"red"},[t._v("￥ "+t._s(t.course.totalPrice))])]),t._v(" "),s("div",{staticClass:"flex-between-item"},[s("span",{staticClass:"mbl"},[t._v("优惠券：")]),t._v(" "),s("span",{staticClass:"red"},[t._v("-￥ "+t._s(t.couponMoney))])]),t._v(" "),s("div",{staticClass:"flex-between-item"},[s("span",{staticClass:"mbl"},[t._v("应付：")]),t._v(" "),s("span",{staticClass:"red"},[t._v("￥ "+t._s(t.total))])])]),t._v(" "),s("van-button",{staticClass:"order-submit-bar submit-btn",attrs:{size:"small"},on:{click:t.handleSubmit}},[t._v("应付￥ "+t._s(t.total))])],1)},staticRenderFns:[]},p=s("VU/8")(u,l,!1,null,null,null);e.default=p.exports}});