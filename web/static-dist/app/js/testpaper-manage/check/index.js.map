{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/testpaper-manage/check/index.js"],"names":["$","validator","addMethod","value","element","isFloat","test","Number","data","format","Translator","trans","CheckTest","$container","checkContent","$form","find","$dialog","_initEvent","_init","_initValidate","isContinue","on","_showEssayInputEditor","event","_submitValidate","_quick2Question","_submit","_continue","_teacherSayFill","$shortTextarea","currentTarget","hasClass","preventDefault","stopPropagation","blur","$longTextarea","siblings","$textareaBtn","hide","show","editor","CKEDITOR","replace","attr","toolbar","fileSingleSizeLimit","app","filebrowserImageUploadUrl","updateElement","setTimeout","val","getData","change","focus","one","text","destroy","validate","length","each","rules","required","score","min","messages","$target","position","offset","document","scrollTop","top","scoreTotal","undefined","form","self","content","questionId","subjectiveScore","totalScore","html","modal","teacherSay","passedStatus","button","post","result","response","goto","window","location","href","reload","$option"],"mappings":"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","file":"app/js/testpaper-manage/check/index.js","sourcesContent":["import {\n  testpaperCardFixed,\n} from 'app/js/testpaper/widget/part';\n\n$.validator.addMethod('score',function(value,element){ \n  let isFloat = /^\\d+(\\.\\d)?$/.test(value);\n  if (!isFloat){\n    return false;\n  }\n\n  if (Number(value) <= Number($(element).data('score'))) {\n    return true;\n  } else {\n    return false;\n  }\n  \n}, $.validator.format(Translator.trans('activity.testpaper_manage.marking_validate_error_hint')));\n\nclass CheckTest\n{\n  constructor($container) {\n\n    this.$container = $container;\n    this.checkContent = {};\n    this.$form = $container.find('form');\n    this.$dialog = $container.find('#testpaper-checked-dialog');\n    this.validator = null;\n    this._initEvent();\n    this._init();\n    this._initValidate();\n    testpaperCardFixed();\n    this.isContinue = false;\n  }\n\n  _initEvent() {\n    this.$container.on('focusin','textarea',event=>this._showEssayInputEditor(event));\n    this.$container.on('click','[data-role=\"check-submit\"]',event=>this._submitValidate(event));\n    this.$container.on('click','*[data-anchor]',event=>this._quick2Question(event));\n    this.$dialog.on('click','[data-role=\"finish-check\"]',event=>this._submit(event));\n    this.$dialog.on('click','.js-next-check',event=>this._continue(event));\n    this.$dialog.on('change','select',event=>this._teacherSayFill(event));\n  }\n\n  _init() {\n\n  }\n\n  _showEssayInputEditor(event) {\n    let $shortTextarea = $(event.currentTarget);\n\n    if ($shortTextarea.hasClass('essay-teacher-say-short')) {\n      \n      event.preventDefault();\n      event.stopPropagation();\n      $(this).blur();\n      let $longTextarea = $shortTextarea.siblings('.essay-teacher-say-long');\n      let $textareaBtn = $longTextarea.siblings('.essay-teacher-say-btn');\n\n      $shortTextarea.hide();\n      $longTextarea.show();\n      $textareaBtn.show();\n\n      let editor = CKEDITOR.replace($longTextarea.attr('id'), {\n        toolbar: 'Minimal',\n        fileSingleSizeLimit: app.fileSingleSizeLimit,\n        filebrowserImageUploadUrl: $longTextarea.data('imageUploadUrl')\n      });\n\n      editor.on('blur', function() {\n        editor.updateElement();\n        setTimeout(function() {\n          $longTextarea.val(editor.getData());\n          $longTextarea.change();\n        }, 1);\n      });\n\n      editor.on('instanceReady', function() {\n        this.focus();\n\n        $textareaBtn.one('click', function() {\n          $shortTextarea.val($(editor.getData()).text());\n          editor.destroy();\n          $longTextarea.hide();\n          $textareaBtn.hide();\n          $shortTextarea.show();\n        });\n      });\n\n      editor.on('key', function(){\n        editor.updateElement();\n        setTimeout(function() {\n          $longTextarea.val(editor.getData());\n          $longTextarea.change();\n        }, 1);\n      });\n\n      editor.on('insertHtml', function() {\n        editor.updateElement();\n        setTimeout(function() {\n          $longTextarea.val(editor.getData());\n          $longTextarea.change();\n        }, 1);\n      });\n    }\n    \n  }\n\n  _initValidate() {\n    this.validator = this.$form.validate();\n\n    if ($('*[data-score]:visible').length > 0) {\n      $('*[data-score]:visible').each(function(){\n        $(this).rules('add',{\n          required:true,\n          score:true,\n          min:0,\n          messages: {    \n            required: Translator.trans('activity.testpaper_manage.required_error_hint'),    \n          } \n        });\n      });\n    }\n\n  }\n\n  _quick2Question(event) {\n    let $target = $(event.currentTarget); \n    let position = $($target.data('anchor')).offset();\n    $(document).scrollTop(position.top - 55);\n  }\n\n  _submitValidate() {\n    let scoreTotal = 0;\n\n    if (this.validator == undefined || this.validator.form()) {\n      let self = this;\n      $('*[data-score]').each(function(){\n        let content = {};\n        let questionId = $(this).data('id');\n        \n        content['score'] = Number($(this).val());\n        content['teacherSay'] = $('[name=\"teacherSay_'+questionId+'\"]').val();\n\n        self.checkContent[questionId] = content;\n        scoreTotal = scoreTotal + Number($(this).val());\n      });\n\n      let subjectiveScore = Number(this.$dialog.find('[name=\"objectiveScore\"]').val());\n      let totalScore = Number(scoreTotal) + subjectiveScore;\n\n      this.$dialog.find('#totalScore').html(totalScore);\n      this.$dialog.modal('show');\n    }\n\n\n  }\n\n  _continue(event) {\n    this.isContinue = true;\n    this._submit(event);\n  }\n\n  _submit(event) {\n\n    let $target = $(event.currentTarget);\n    let teacherSay = this.$dialog.find('textarea').val();\n    let passedStatus = this.$dialog.find('[name=\"passedStatus\"]:checked').val();\n\n    $target.button('loading');\n    $.post($target.data('postUrl'), {result:this.checkContent,teacherSay:teacherSay,passedStatus:passedStatus,isContinue:this.isContinue}, function(response) {\n      if (response.goto != '') {\n        window.location.href = response.goto;\n      } else {\n        window.location.reload();\n      }\n    });\n  }\n\n  _teacherSayFill(event) {\n    let $target = $(event.currentTarget);\n    let $option = $target.find('option:selected');\n\n    if ($option.val() == '') {\n      this.$dialog.find('textarea').val('');\n    } else {\n      this.$dialog.find('textarea').val($option.text());\n    }\n  }\n}\n\nnew CheckTest($('.js-testpaper-container'));\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/testpaper-manage/check/index.js"],"sourceRoot":""}