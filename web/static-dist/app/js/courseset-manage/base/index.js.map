{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/courseset-manage/base/index.js","webpack:///./app/Resources/static-src/app/js/courseset-manage/base/detail.js","webpack:///./app/Resources/static-src/app/js/courseset-manage/base/base.js"],"names":["Base","detail","element","$element","$","formId","data","btnId","$form","$btn","uploadUrl","init","submitForm","initCkeditor","self","editor","CKEDITOR","replace","allowedContent","toolbar","fileSingleSizeLimit","app","filebrowserImageUploadUrl","on","val","getData","validator","form","validate","rules","summary","ckeditor_maxlength","click","submit","Detail","initValidator","initTags","closest","$oldSummary","currentDom","ajax","title","maxlength","required","depends","trim","course_title","subtitle","submitHandler","settings","$isCoursesSummaryEmpty","$newSummary","length","find","cd","confirm","Translator","trans","content","okText","cancelText","savePost","submitSuccess","message","type","window","location","reload","button","post","attr","serializeArray","error","submitError","$tags","select2","url","dataType","quietMillis","term","page","q","page_limit","results","console","log","map","item","id","name","initSelection","callback","split","each","push","formatSelection","formatResult","formatNoMatches","formatSearching","multiple","maximumSelectionSize","placeholder","width","createSearchChoice"],"mappings":"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","file":"app/js/courseset-manage/base/index.js","sourcesContent":["import Base from './base';\n\nnew Base('#courseset-summary-field');\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/courseset-manage/base/index.js","export default class detail {\n  constructor(element) {\n    this.$element = $(element);\n    this.formId = $(element).data('form');\n    this.btnId = $(element).data('button');\n    this.$form = $(`#${this.formId}`);\n    this.$btn = $(`#${this.btnId}`);\n    this.uploadUrl = this.$element.data('imageUploadUrl');\n    this.init();\n  }\n\n  init() {\n    this.submitForm();\n    this.initCkeditor();\n  }\n\n  initCkeditor() {\n    let self = this;\n    self.editor = CKEDITOR.replace('summary', {\n      allowedContent: true,\n      toolbar: 'Detail',\n      fileSingleSizeLimit: app.fileSingleSizeLimit,\n      filebrowserImageUploadUrl: this.uploadUrl\n    });\n\n    self.editor.on('blur', () => {\n      this.$element.val(self.editor.getData());\n      self.validator.form();\n    });\n  }\n\n  submitForm() {\n    this.validator = this.$form.validate({\n      rules: {\n        summary: {\n          ckeditor_maxlength: 10000,\n        }\n      }\n    });\n    this.$btn.click(() => {\n      this.$element.val(this.editor.getData());\n      if (this.validator.form()) {\n        this.$form.submit();\n      }\n    });\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/courseset-manage/base/detail.js","import Detail from './detail';\n\nexport default class Base {\n  constructor(element) {\n    this.init();\n    this.detail = new Detail(element);\n  }\n\n  init() {\n    this.initValidator();\n    this.initTags();\n  }\n\n  initValidator() {\n    const self = this;\n    const $form = $('#title').closest('form');\n    let $oldSummary = $('#courseset-summary-field').val();\n    const validator = $form.validate({\n      currentDom: '#courseset-base-submit',\n      ajax: true,\n      rules: {\n        title: {\n          maxlength: 60,\n          required: {\n            depends () {\n              $(this).val($.trim($(this).val()));\n              return true;\n            }\n          },\n          course_title: true\n        },\n        subtitle: {\n          maxlength: 50,\n          required: {\n            depends () {\n              $(this).val($.trim($(this).val()));\n              return false;\n            }\n          },\n          course_title: true\n        }\n      },\n      submitHandler: function(form){\n        let $form = $(form);\n        let settings = this.settings;\n        let $btn = $(settings.currentDom);\n        let $isCoursesSummaryEmpty = $form.data('value');\n        let $newSummary = $('#courseset-summary-field').val();\n        if (!$btn.length) {\n          $btn = $(form).find('[type=\"submit\"]');\n        }\n        if ($isCoursesSummaryEmpty == 1 && $newSummary != '' && $newSummary != $oldSummary) {\n          cd.confirm({\n            title: Translator.trans('course_set.manage.operation_hint'),\n            content: Translator.trans('course_set.manage.courseset_summary_operation_hint'),\n            okText: Translator.trans('site.confirm'),\n            cancelText: Translator.trans('site.cancel'),\n          }).on('ok', () => {\n            self.savePost(form, settings);\n          });\n        } else {\n          self.savePost(form, settings);\n        }\n      },\n      submitSuccess: (data) => {\n        cd.message({ type: 'success', message: Translator.trans('site.save_success_hint') });\n        window.location.reload();\n      }\n    });\n  }\n\n  savePost(form, settings) {\n    let $form = $(form);\n    let $btn = $(settings.currentDom);\n    $btn.button('loading');\n    $.post($form.attr('action'), $form.serializeArray(), (data) => {\n      $btn.button('reset');\n      settings.submitSuccess(data);\n    }).error((data) => {\n      $btn.button('reset');\n      settings.submitError(data);\n    });\n  }\n\n  // 通用标签选择组件\n  initTags() {\n    const $tags = $('#tags');\n    $tags.select2({\n      ajax: {\n        url: $tags.data('url'),\n        dataType: 'json',\n        quietMillis: 500,\n        data (term, page) {\n          return {\n            q: term,\n            page_limit: 10\n          };\n        },\n        results (data) {\n          console.log(data);\n          return {\n            results: data.map((item) => {\n              return { id: item.name, name: item.name };\n            })\n          };\n        }\n      },\n      initSelection (element, callback) {\n        const data = [];\n        $(element.val().split(',')).each(function () {\n          data.push({\n            id: this,\n            name: this\n          });\n        });\n        callback(data);\n      },\n      formatSelection (item) {\n        return item.name;\n      },\n      formatResult (item) {\n        return item.name;\n      },\n      formatNoMatches: function() {\n        return Translator.trans('validate.tag_required_not_found_hint');\n      },\n      formatSearching: function() {\n        return Translator.trans('site.searching_hint');\n      },\n      multiple: true,\n      maximumSelectionSize: 20,\n      placeholder: Translator.trans('course_set.manage.tag_required_hint'),\n      width: 'off',\n      createSearchChoice () {\n        return null;\n      }\n    });\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/courseset-manage/base/base.js"],"sourceRoot":""}