{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/course-manage/student-expiryday/index.js"],"names":["Deadline","validator","init","initDatePicker","initRadioChange","initSelectChange","initValidator","$id","$picker","$","datetimepicker","format","language","document","documentElement","lang","minView","autoclose","endDate","Date","now","on","form","$form","$modal","parents","validate","rules","day","required","positive_integer","max","es_remote","type","data","waveType","val","messages","Translator","trans","click","post","attr","serialize","user_name","cd","message","name","modal","window","location","reload","updateType","$deadline","$day","elementRemoveRules","prop","elementAddRules","getDayRules","getDateRules","event","initUpdateType","$waveType","target","css","closest","addClass","flag","borderColor","$element","options","removeClass","$formGroup","find","remove","date","deadline"],"mappings":"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","file":"app/js/course-manage/student-expiryday/index.js","sourcesContent":["class Deadline {\n  constructor() {\n    this.validator = null;\n    this.init();\n  }\n  init() {\n    this.initDatePicker('#deadline');\n    this.initRadioChange();\n    this.initSelectChange();\n    this.initValidator();\n  }\n\n  initDatePicker($id) {\n    let $picker = $($id);\n    $picker.datetimepicker({\n      format: 'yyyy-mm-dd',\n      language: document.documentElement.lang,\n      minView: 2, //month\n      autoclose: true,\n      endDate: new Date(Date.now() + 86400 * 365 * 10 * 1000)\n    }).on('hide', () => {\n      this.validator.form();\n    });\n    $picker.datetimepicker('setStartDate', new Date());\n  }\n\n  initValidator() {\n    let $form = $('#deadline-set-form');\n    let $modal = $form.parents('.modal');\n\n\n    this.validator = $form.validate({\n      rules: {\n        day: {\n          required: true,\n          positive_integer: true,\n          max: 7300,\n          es_remote: {\n            type: 'get',\n            data: {\n              waveType: function () {\n                return $('[name=waveType]').val();\n              },\n              day: function () {\n                return $('[name=day]').val();\n              },\n            }\n          }\n        }\n      },\n      messages: {\n        day: {\n          required: Translator.trans('validate.modify_days'),\n          max: Translator.trans('validate.modify_day_number'),\n          es_remote: Translator.trans('course_manage.student_expiryday_extend_error_hint_day'),\n        }\n      }\n    });\n\n    $('.js-save-deadline-set-form').click(() => {\n      if (this.validator && this.validator.form()) {\n        $.post($form.attr('action'), $form.serialize(), function () {\n          let user_name = $('#submit').data('user');\n          cd.message({ type: 'success', message: Translator.trans('course_manage.student_expiryday_extend_success_hint', { name: user_name }) });\n          $modal.modal('hide');\n          window.location.reload();\n        });\n      }\n    });\n  }\n\n  initUpdateType() {\n    const updateType = $('[name=\"updateType\"]:checked').val();\n    const $deadline = $('[name=\"deadline\"]');\n    const $day = $('[name=\"day\"]');\n    this.elementRemoveRules($deadline);\n    this.elementRemoveRules($day);\n    switch (updateType) {\n    case 'day':\n      $deadline.prop('disabled', true).val('');\n      this.elementAddRules($day, this.getDayRules());\n      break;\n    case 'date':\n      $deadline.prop('disabled', false);\n      $day.val(0);\n      $('[name=\"waveType\"]').val('plus');\n      this.elementAddRules($deadline, this.getDateRules());\n      break;\n    default:\n      break;\n    }\n  }\n\n  initRadioChange() {\n    $('input[name=\"updateType\"]').on('change', (event) => {\n      this.initUpdateType();\n    });\n  }\n\n  initSelectChange() {\n    const $waveType = $('[name=\"waveType\"]');\n    $waveType.on('change', (event) => {\n      if (!this.validator.form()) {\n        $(event.target).css('border-color', '#ed3e3e');\n      }\n    }).on('blur', (event) => {\n      if (!this.validator.form()) {\n        $(event.target).closest('.form-group').addClass('has-error');\n      }\n    });\n    $('[name=\"day\"]').on('blur', (event) => {\n      const flag = this.validator.form();\n      const borderColor = flag ? '#e1e1e1' : '';\n      $waveType.css('border-color', borderColor);\n    });\n  }\n\n  elementAddRules($element, options) {\n    $element.rules('add', options);\n  }\n\n  elementRemoveRules($element) {\n    $element.rules('remove');\n    $element.removeClass('form-control-error');\n    const $formGroup = $element.closest('.form-group');\n    $formGroup.removeClass('has-error');\n    $formGroup.find('.jq-validate-error').remove();\n  }\n\n  getDayRules() {\n    return {\n      required: true,\n      positive_integer: true,\n      es_remote: {\n        type: 'get',\n        data: {\n          waveType: function () {\n            return $('[name=waveType]').val();\n          },\n          day: function () {\n            return $('[name=day]').val();\n          },\n        }\n      },\n      messages: {\n        es_remote: Translator.trans('course_manage.student_expiryday_extend_error_hint_day'),\n      }\n    };\n  }\n\n  getDateRules() {\n    return {\n      required: true,\n      date: true,\n      es_remote: {\n        type: 'get',\n        data: {\n          deadline: function () {\n            return $('[name=deadline]').val();\n          }\n        }\n      },\n      messages: {\n        es_remote: Translator.trans('course_manage.student_expiryday_extend_error_hint_date'),\n        required: Translator.trans('validate.modify_date'),\n      }\n    };\n  }\n}\nnew Deadline();\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/course-manage/student-expiryday/index.js"],"sourceRoot":""}