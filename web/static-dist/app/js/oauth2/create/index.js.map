{"version":3,"sources":["webpack:///external \"jQuery\"","webpack:///./app/Resources/static-src/app/js/oauth2/create/create.js","webpack:///./app/Resources/static-src/app/js/oauth2/create/count-down.js","webpack:///./app/Resources/static-src/app/js/oauth2/create/index.js","webpack:///./app/Resources/static-src/app/common/form.js"],"names":["Create","$form","$","$btn","validator","dragCaptchaToken","smsToken","$sendBtn","drag","length","Drag","limitType","init","setValidateRule","initValidator","smsSend","submitForm","removeSmsErrorTip","dragEvent","addMethod","value","element","indexOf","format","Translator","trans","self","on","data","attr","token","hasClass","addDragCaptchaRules","rules","username","required","byte_minlength","byte_maxlength","nickname","chinese_alphanumeric","es_remote","type","invitedCode","reg_inviteCode","password","minlength","maxlength","spaceNoSupport","confirmPassword","equalTo","sms_code","unsigned_integer","rangelength","agree_policy","validate","messages","$captchaCode","click","event","smsSended","ajaxSetup","global","mobile","text","phrase","val","Api","sms","send","then","res","catch","initDragCaptcha","removeClass","$target","target","form","button","html","smsCode","captchaToken","errorTip","post","response","success","window","location","href","url","prev","addClass","append","error","focus","$tip","remove","$timeLeft","$smsCode","$fetchBtnText","countDown","num","refreshTimeLeft","leftTime","setTimeout","removeAttr","enterSubmit","$formDom","$btnDom","keypress","e","which","trigger","preventDefault"],"mappings":"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","file":"app/js/oauth2/create/index.js","sourcesContent":["module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = app/js/main app/js/v2/demo/index app/js/activity-manage/doc/index app/js/activity-manage/download/index app/js/activity-manage/flash/index app/js/activity-manage/homework/index app/js/activity-manage/ppt/index app/js/activity-manage/video/index app/js/article/detail/index app/js/attachment/index app/js/auth/captcha-modal/index app/js/auth/password-reset/index app/js/auth/register/index app/js/batch-upload/index app/js/card/card-receive/index app/js/card/index/index app/js/cashier/index app/js/cashier/modal/index app/js/classroom-manage/set-picture/index app/js/classroom-manage/student-expiryday/index app/js/classroom-manage/student-import/index app/js/classroom-manage/students-create/index app/js/classroom-manage/students-manage/index app/js/classroom/buy-modal/index app/js/classroom/index app/js/classroom/thread-form/index app/js/classroom/thread-show/index app/js/coin/invite-code/index app/js/course-chapter-manage/index app/js/course-manage-file/index/index app/js/course-manage/batch-create/index app/js/course-manage/lesson-manage/default/index app/js/course-manage/lesson-manage/normal/index app/js/course-manage/live-replay/upload/index app/js/course-manage/overview/index app/js/course-manage/student-import/index app/js/course/buy-modal/index app/js/course/thread-show/index app/js/courseset/show/index app/js/exporter/index app/js/group/index app/js/group/logo/index app/js/group/thread-add/index app/js/live-course/explore/index app/js/material-lib/index/index app/js/material-lib/share-history/index app/js/media-manage/index app/js/activity-manage/audio/index app/js/mobile-bind/index app/js/my/order-refund-apply/index app/js/my/order-refund/index app/js/my/order/index app/js/oauth2/create/index app/js/open-course-manage/add-material/index app/js/open-course-manage/lesson-modal/index app/js/open-course/index app/js/open-course/member-sms/index app/js/order/coupon-item/index app/js/order/create-sms/index app/js/order/create/index app/js/pay/select/index app/js/pay/show-mobile-modal/index app/js/player/index app/js/question-manage/form/index app/js/review/list/index app/js/search/index app/js/settings/avatar-crop-modal/index app/js/settings/bind-mobile/index app/js/settings/email/index app/js/settings/find_pay_password_by_sms/index app/js/settings/find-pay-password/index app/js/settings/password/index app/js/settings/pay-password-modal/index app/js/settings/pay-password/index app/js/settings/profile/index app/js/settings/reset-pay-password/index app/js/settings/security-questions/index app/js/settings/security/index app/js/settings/setup-password/index app/js/settings/setup/index app/js/settings/update-pay-password/index app/js/settings/user-profile/index app/js/subject/index app/js/task-manage/create/index app/js/task/plugin/note/index app/js/task/plugin/question/index app/js/testpaper-manage/create/index app/js/testpaper-manage/index app/js/testpaper-manage/questions/index app/js/testpaper/do-test/exercise/index app/js/testpaper/do-test/normal/index app/js/testpaper/result/index app/js/thread/user-info-modal/index app/js/user/fill-info/index app/js/message/show/index","import { enterSubmit } from 'app/common/form';\nimport notify from 'common/notify';\nimport { countDown } from './count-down';\nimport Api from 'common/api';\nimport Drag from 'app/common/drag';\n\nexport default class Create {\n  constructor() {\n    this.$form = $('#third-party-create-account-form');\n    this.$btn = $('.js-submit-btn');\n    this.validator = null;\n    this.dragCaptchaToken = '';\n    this.smsToken = null;\n    this.$sendBtn = $('.js-sms-send');\n    this.drag = $('#drag-btn').length ? new Drag($('#drag-btn'), $('.js-jigsaw'), {\n      limitType: 'bind_register'\n    }) : false;\n    this.init();\n  }\n\n  init() {\n    this.setValidateRule();\n    this.initValidator();\n    this.smsSend();\n    this.submitForm();\n    this.removeSmsErrorTip();\n    this.dragEvent();\n  }\n\n  setValidateRule() {\n    $.validator.addMethod('spaceNoSupport', function (value, element) {\n      return value.indexOf(' ') < 0;\n    }, $.validator.format(Translator.trans('validate.have_spaces')));\n  }\n\n  dragEvent() {\n    let self = this;\n    if (this.drag) {\n      this.drag.on('success', function(data){\n        self.$sendBtn.attr('disabled', false);\n        self.dragCaptchaToken = data.token;\n      });\n    }\n    \n    if (!$('.js-drag-jigsaw').hasClass('hidden')) {\n      this.addDragCaptchaRules();\n    }\n  }\n\n  initValidator() {\n    this.rules = {\n      username: {\n        required: true,\n        byte_minlength: 4,\n        byte_maxlength: 18,\n        nickname: true,\n        chinese_alphanumeric: true,\n        es_remote: {\n          type: 'get',\n        }\n      },\n      invitedCode: {\n        required: false,\n        reg_inviteCode: true,\n        es_remote: {\n          type: 'get'\n        }\n      },\n      password: {\n        required: true,\n        minlength: 5,\n        maxlength: 20,\n        spaceNoSupport: true,\n      },\n      confirmPassword: {\n        required: true,\n        equalTo: '#password',\n      },\n      sms_code: {\n        required: true,\n        unsigned_integer: true,\n        rangelength: [6, 6],\n      },\n      agree_policy: {\n        required: true,\n      },\n    };\n\n    this.validator = this.$form.validate({\n      rules: this.rules,\n      messages: {\n        sms_code: {\n          required: Translator.trans('site.captcha_code.required'),\n          rangelength: Translator.trans('validate.sms_code.message')\n        },\n        agree_policy: {\n          required: Translator.trans('validate.valid_policy_input.message'),\n        },\n      }\n    });\n  }\n\n  smsSend() {\n    let self = this;\n    const $captchaCode = $('#captcha_code');\n    if (!this.$sendBtn.length) {\n      return;\n    }\n    \n    this.$sendBtn.click((event) => {\n      if (!self.smsSended) {\n        //手机发送验证码，第一次时，需要验证码时，不需要提示\n        $.ajaxSetup({global: false});\n        self.smsSended = true;\n      }\n      \n      self.$sendBtn.attr('disabled', true);\n      let data = {\n        type: 'register',\n        mobile: $('.js-account').text(),\n        dragCaptchaToken: this.dragCaptchaToken,\n        phrase: $captchaCode.val()\n      };\n\n      Api.sms.send({ data: data }).then((res) => {\n        $.ajaxSetup({global: true});\n        this.smsToken = res.smsToken;\n        countDown(120);\n      }).catch((res) => {\n        if (self.drag) {\n          $.ajaxSetup({global: true});\n          self.addDragCaptchaRules();\n          self.drag.initDragCaptcha();\n          $('.js-drag-jigsaw').removeClass('hidden');\n        }\n      });\n    });\n  }\n\n  submitForm() {\n    this.$btn.click((event) => {\n      const $target = $(event.target);\n      if (!this.validator.form()) {\n        return;\n      }\n      $target.button('loading');\n      let data = {\n        nickname: $('#username').val(),\n        password: $('#password').val(),\n        mobile: $('.js-account').html(),\n        smsToken: this.smsToken,\n        smsCode: $('#sms-code').val(),\n        captchaToken: this.captchaToken,\n        phrase: $('#captcha_code').val(),\n        dragCaptchaToken: $('[name=\"dragCaptchaToken\"]').val(),\n        invitedCode: $('#invitedCode').length > 0 ? $('#invitedCode').val() : '',\n      };\n      const errorTip = Translator.trans('oauth.send.sms_code_error_tip');\n      $.post($target.data('url'), data, (response) => {\n        $target.button('reset');\n        if (response.success === 1) {\n          window.location.href = response.url;\n        } else {\n          if (!$('.js-password-error').length) {\n            $target.prev().addClass('has-error').append(`<p id=\"password-error\" class=\"form-error-message js-password-error\">${errorTip}</p>`);\n          }\n        }\n      }).error((response) => {\n        $target.button('reset');\n      });\n    });\n\n    enterSubmit(this.$form, this.$btn);\n  }\n\n  addDragCaptchaRules() {\n    $('[name=\"dragCaptchaToken\"]').rules('add', {\n      required: true,\n      messages: {\n        required: Translator.trans('auth.register.drag_captcha_tips')\n      }\n    });\n  }\n\n  removeSmsErrorTip() {\n    $('#sms-code').focus(() => {\n      const $tip = $('.js-password-error');\n      if ($tip.length) {\n        $tip.remove();\n      }\n    });\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/oauth2/create/create.js","import notify from 'common/notify';\nconst $timeLeft = $('.js-time-left');\nconst $smsCode = $('.js-sms-send');\nconst $fetchBtnText = $('.js-fetch-btn-text');\n\nexport const countDown = (num) => {\n  $timeLeft.html(num);\n  $fetchBtnText.html(Translator.trans('site.data.get_sms_code_again_btn'));\n  notify('success', Translator.trans('site.data.get_sms_code_success_hint'));\n  refreshTimeLeft();\n};\n\nconst refreshTimeLeft = () => {\n  let leftTime = $timeLeft.text();\n  $timeLeft.html(leftTime - 1);\n  if (leftTime - 1 > 0) {\n    $smsCode.attr('disabled', true);\n    setTimeout(refreshTimeLeft, 1000);\n  } else {\n    $timeLeft.html('');\n    $fetchBtnText.html(Translator.trans('oauth.send.validate_message'));\n    $smsCode.removeAttr('disabled');\n  }\n};\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/oauth2/create/count-down.js","import Create from './create';\nnew Create();\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/oauth2/create/index.js","const enterSubmit = ($formDom, $btnDom) => {\n  $formDom.keypress((e) => {\n    if (e.which == 13) {\n      $btnDom.trigger('click');\n      e.preventDefault();\n    }\n  });\n};\n\nexport {\n  enterSubmit\n};\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/common/form.js"],"sourceRoot":""}