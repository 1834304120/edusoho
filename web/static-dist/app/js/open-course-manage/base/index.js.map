{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/open-course-manage/base/base.js","webpack:///./app/Resources/static-src/app/js/open-course-manage/base/index.js"],"names":["Base","initSelect2","initCkeditor","initValidator","initCategory","$","select2","ajax","url","app","arguments","tagMatchUrl","dataType","quietMillis","data","term","page","q","page_limit","results","each","index","item","push","id","name","initSelection","element","callback","val","split","formatSelection","formatResult","formatSearching","Translator","trans","width","multiple","maximumSelectionSize","placeholder","createSearchChoice","$form","validator","validate","currentDom","rules","title","required","maxlength","trim","course_title","startTime","after_now","es_remote","type","clientTime","timeLength","positive_integer","length","messages","submitSuccess","cd","message","window","location","reload","click","form","editor","getData","submit","$helpTip","html","addClass","attr","now","Date","datetimepicker","autoclose","language","document","documentElement","lang","on","ev","self","CKEDITOR","replace","allowedContent","toolbar","fileSingleSizeLimit","filebrowserImageUploadUrl","treeview","dropdownAutoWidth","treeviewInitState","placeholderOption"],"mappings":"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","file":"app/js/open-course-manage/base/index.js","sourcesContent":["export default class Base {\n  constructor() {\n    this.initSelect2();\n    this.initCkeditor();\n    this.initValidator();\n    this.initCategory();\n  }\n\n  initSelect2() {\n    $('#course_tags').select2({\n      ajax: {\n        url: app.arguments.tagMatchUrl + '#',\n        dataType: 'json',\n        quietMillis: 100,\n        data: function (term, page) {\n          return {\n            q: term,\n            page_limit: 10\n          };\n        },\n        results: function (data) {\n          var results = [];\n          $.each(data, function (index, item) {\n\n            results.push({\n              id: item.name,\n              name: item.name\n            });\n          });\n\n          return {\n            results: results\n          };\n\n        }\n      },\n      initSelection: function (element, callback) {\n        var data = [];\n        $(element.val().split(',')).each(function () {\n          data.push({\n            id: this,\n            name: this\n          });\n        });\n        callback(data);\n      },\n      formatSelection: function (item) {\n        return item.name;\n      },\n      formatResult: function (item) {\n        return item.name;\n      },\n      formatSearching: function () {\n        return Translator.trans('open_course.load_search_hint');\n      },\n      width: 'off',\n      multiple: true,\n      maximumSelectionSize: 20,\n      placeholder: Translator.trans('open_course.tag_required_hint'),\n      createSearchChoice: function () {\n        return null;\n      },\n    });\n  }\n\n  initValidator() {\n    let $form = $('#course-form');\n    let validator = $form.validate({\n      currentDom: '#course-create-btn',\n      ajax: true,\n      rules: {\n        title: {\n          required: true,\n          maxlength: 60,\n          trim: true,\n          course_title: true,\n        },\n        startTime: {\n          required: true,\n          after_now: true,\n          es_remote: {\n            type: 'post',\n            data: {\n              clientTime: function () {\n                return $('[name=startTime]').val();\n              }\n            }\n          }\n        },\n        timeLength: {\n          required: true,\n          positive_integer: true,\n          es_remote: {\n            type: 'get',\n            data: {                     //要传递的数据\n              startTime: function () {\n                return $('[name=startTime]').val();\n              },\n              length: function () {\n                return $('[name=timeLength]').val();\n              },\n            }\n          }\n        }\n      },\n      messages: {\n        startTime: {\n          es_remote: Translator.trans('validate.after_now.message')\n        }\n      },\n      submitSuccess: (data) => {\n        cd.message({ type: 'success', message: Translator.trans('site.save_success_hint') });\n        window.location.reload();\n      }\n    });\n\n    $('#course-create-btn').click(() => {\n      if (validator.form()) {\n        $('#course-about-field').val(this.editor.getData());\n        $form.submit();\n      }\n    });\n\n    if (!$form.data('update')) {\n      const $helpTip = $('.js-time-help-tip');\n      $helpTip.html(Translator.trans('open_course.live_time_can_not_edit_bint')).addClass('color-danger');\n      $('[name=startTime]').attr('disabled', true);\n      $('#live-length-field').attr('disabled', true);\n    } else {\n      $('[name=startTime]').attr('disabled', false);\n    }\n\n    let now = new Date();\n\n    $('[name=startTime]').datetimepicker({\n      autoclose: true,\n      language: document.documentElement.lang\n    }).on('hide', function (ev) {\n      validator.element('[name=startTime]');\n    });\n    $('[name=startTime]').datetimepicker('setStartDate', now);\n  }\n\n  initCkeditor() {\n    let self = this;\n    if ($('#course-about-field').length > 0) {\n      self.editor = CKEDITOR.replace('course-about-field', {\n        allowedContent: true,\n        toolbar: 'Detail',\n        fileSingleSizeLimit: app.fileSingleSizeLimit,\n        filebrowserImageUploadUrl: $('#course-about-field').data('imageUploadUrl')\n      });\n    }\n  }\n\n  initCategory() {\n    $('[data-role=\"tree-select\"], [name=\"categoryId\"]').select2({\n      treeview: true,\n      dropdownAutoWidth: true,\n      treeviewInitState: 'collapsed',\n      placeholderOption: 'first'\n      // treeviewInitState: 'expanded'\n    });\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/open-course-manage/base/base.js","import Base from './base';\n\nnew Base($('#course-create-btn'));\n\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/open-course-manage/base/index.js"],"sourceRoot":""}