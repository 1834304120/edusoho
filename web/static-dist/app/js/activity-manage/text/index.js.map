{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/activity-manage/text/text.js","webpack:///./app/Resources/static-src/app/js/activity-manage/text/index.js","webpack:///./app/Resources/static-src/app/js/activity-manage/editor.js"],"names":["Text","props","_init","_inItStep2form","_inItStep3form","_lanuchAutoSave","$","on","event","$btn","currentTarget","content","data","editor","setData","remove","$step2_form","validator","validate","rules","title","required","maxlength","trim","course_title","$content","_contentCache","val","$title","parent","document","_originTitle","text","setInterval","_saveDraft","getData","needSave","post","done","date","Date","now","Translator","trans","getHours","getMinutes","getSeconds","createdTime","$step3_form","finishDetail","positive_integer","max","messages","initEditor","$item","CKEDITOR","replace","toolbar","fileSingleSizeLimit","app","filebrowserImageUploadUrl","filebrowserFlashUploadUrl","allowedContent","height","console","log","form"],"mappings":"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","file":"app/js/activity-manage/text/index.js","sourcesContent":["import { initEditor } from '../editor';\nimport 'store';\nexport default class Text {\n  constructor(props) {\n    this._init();\n  }\n\n  _init() {\n    this._inItStep2form();\n    this._inItStep3form();\n    this._lanuchAutoSave();\n\n    $('.js-continue-edit').on('click', (event) => {\n      const $btn = $(event.currentTarget);\n      const content = $btn.data('content');\n      this.editor.setData(content);\n      $btn.remove();\n    });\n  }\n\n  _inItStep2form() {\n    const $step2_form = $('#step2-form');\n    let validator = $step2_form.data('validator');\n    validator = $step2_form.validate({\n      rules: {\n        title: {\n          required: true,\n          maxlength: 50,\n          trim: true,\n          course_title: true,\n        },\n        content: {\n          required: true,\n          trim: true,\n        },\n      },\n    });\n    const $content = $('[name=\"content\"]');\n    this.editor = initEditor($content, validator);\n    this._contentCache = $content.val();\n  }\n\n  _lanuchAutoSave() {\n    const $title = $('#modal .modal-title', parent.document);\n    this._originTitle = $title.text();\n    setInterval(() => {\n      this._saveDraft();\n    }, 5000);\n  }\n\n  _saveDraft() {\n    const content = this.editor.getData();\n    const needSave = content !== this._contentCache;\n    if (!needSave) {\n      return;\n    }\n    const $content = $('[name=\"content\"]');\n    $.post($content.data('saveDraftUrl'), { content: content })\n      .done(() => {\n        const date = new Date(); //日期对象\n        const $title = $('#modal .modal-title', parent.document);\n        const now = Translator.trans('site.date_format_his', {'hours': date.getHours(), 'minutes': date.getMinutes(), 'seconds': date.getSeconds()});\n        $title.text(this._originTitle + Translator.trans('activity.text_manage.save_draft_hint', { createdTime: now }));\n        this._contentCache = content;\n      });\n  }\n\n  _inItStep3form() {\n    const $step3_form = $('#step3-form');\n    let validator = $step3_form.data('validator');\n    validator = $step3_form.validate({\n      rules: {\n        finishDetail: {\n          required: true,\n          positive_integer: true,\n          max: 300,\n        },\n      },\n      messages: {\n        finishDetail: {\n          required: Translator.trans('activity.text_manage.finish_detail_required_error_hint'),\n        },\n      },\n    });\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/text/text.js","import Text from './text';\n\nnew Text();\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/text/index.js","export const initEditor = ($item, validator) => {\n  \n  var editor = CKEDITOR.replace('text-content-field', {\n    toolbar: 'Task',\n    fileSingleSizeLimit: app.fileSingleSizeLimit,\n    filebrowserImageUploadUrl: $('#text-content-field').data('imageUploadUrl'),\n    filebrowserFlashUploadUrl: $('#text-content-field').data('flashUploadUrl'),\n    allowedContent: true,\n    height: 300,\n  });\n  \n  editor.on('change', () => {\n    console.log('change');\n    $item.val(editor.getData());\n    if (validator) {\n      validator.form();\n    }\n  });\n\n  //fix ie11 中文输入\n  editor.on('blur', () => {\n    console.log('blur');\n    $item.val(editor.getData());\n    if (validator) {\n      validator.form();\n    }\n  });\n\n  return editor;\n};\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/editor.js"],"sourceRoot":""}