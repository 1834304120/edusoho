{"version":3,"sources":["webpack:///external \"jQuery\"","webpack:///./app/Resources/static-src/app/js/mobile-bind/index.js","webpack:///./app/Resources/static-src/app/js/mobile-bind/mobile-bind.js"],"names":["MobileBind","$form","$","$smsCode","find","drag","initCheckCookie","dragEvent","initValidator","initMobileCodeSendBtn","self","on","token","removeClass","attr","key","data","Cookies","get","Date","getDate","length","Drag","limitType","modal","set","validator","validate","currentDom","ajax","rules","password","required","es_remote","type","mobile","phone","callback","bool","removeAttr","sms_code","unsigned_integer","messages","Translator","trans","submitSuccess","message","submitError","responseJSON","SmsSender","element","url","smsType","captcha","captchaValidated","captchaNum","preSmsSend","error","initDragCaptcha","additionalAction","ackResponse"],"mappings":"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","file":"app/js/mobile-bind/index.js","sourcesContent":["module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = app/js/main app/js/v2/demo/index app/js/activity-manage/doc/index app/js/activity-manage/download/index app/js/activity-manage/flash/index app/js/activity-manage/homework/index app/js/activity-manage/ppt/index app/js/activity-manage/video/index app/js/article/detail/index app/js/attachment/index app/js/auth/captcha-modal/index app/js/auth/password-reset/index app/js/auth/register/index app/js/batch-upload/index app/js/card/card-receive/index app/js/card/index/index app/js/cashier/index app/js/cashier/modal/index app/js/classroom-manage/set-picture/index app/js/classroom-manage/student-expiryday/index app/js/classroom-manage/student-import/index app/js/classroom-manage/students-create/index app/js/classroom-manage/students-manage/index app/js/classroom/buy-modal/index app/js/classroom/index app/js/classroom/thread-form/index app/js/classroom/thread-show/index app/js/coin/invite-code/index app/js/course-chapter-manage/index app/js/course-manage-file/index/index app/js/course-manage/batch-create/index app/js/course-manage/lesson-manage/default/index app/js/course-manage/lesson-manage/normal/index app/js/course-manage/live-replay/upload/index app/js/course-manage/overview/index app/js/course-manage/student-import/index app/js/course/buy-modal/index app/js/course/thread-show/index app/js/courseset/show/index app/js/exporter/index app/js/group/index app/js/group/logo/index app/js/group/thread-add/index app/js/live-course/explore/index app/js/material-lib/index/index app/js/material-lib/share-history/index app/js/media-manage/index app/js/activity-manage/audio/index app/js/mobile-bind/index app/js/my/order-refund-apply/index app/js/my/order-refund/index app/js/my/order/index app/js/oauth2/create/index app/js/open-course-manage/add-material/index app/js/open-course-manage/lesson-modal/index app/js/open-course/index app/js/open-course/member-sms/index app/js/order/coupon-item/index app/js/order/create-sms/index app/js/order/create/index app/js/pay/select/index app/js/pay/show-mobile-modal/index app/js/player/index app/js/question-manage/form/index app/js/review/list/index app/js/search/index app/js/settings/avatar-crop-modal/index app/js/settings/bind-mobile/index app/js/settings/email/index app/js/settings/find_pay_password_by_sms/index app/js/settings/find-pay-password/index app/js/settings/password/index app/js/settings/pay-password-modal/index app/js/settings/pay-password/index app/js/settings/profile/index app/js/settings/reset-pay-password/index app/js/settings/security-questions/index app/js/settings/security/index app/js/settings/setup-password/index app/js/settings/setup/index app/js/settings/update-pay-password/index app/js/settings/user-profile/index app/js/subject/index app/js/task-manage/create/index app/js/task/plugin/note/index app/js/task/plugin/question/index app/js/testpaper-manage/create/index app/js/testpaper-manage/index app/js/testpaper-manage/questions/index app/js/testpaper/do-test/exercise/index app/js/testpaper/do-test/normal/index app/js/testpaper/result/index app/js/thread/user-info-modal/index app/js/user/fill-info/index app/js/message/show/index","import MobileBind from './mobile-bind';\n\nnew MobileBind();\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/mobile-bind/index.js","import SmsSender from 'app/common/widget/sms-sender';\nimport Cookies from 'js-cookie';\nimport notify from 'common/notify';\nimport Drag from 'app/common/drag';\n\nexport default class MobileBind {\n  constructor() {\n    this.$form = $('#mobile-bind-form');\n    this.$smsCode = this.$form.find('.js-sms-send');\n    this.drag = null;\n    this.initCheckCookie();\n    this.dragEvent();\n    this.initValidator();\n    this.initMobileCodeSendBtn();\n  }\n\n  dragEvent() {\n    let self = this;\n    if (this.drag) {\n      this.drag.on('success', function(token){\n        self.$smsCode.removeClass('disabled').attr('disabled', false);\n      });\n    }\n  }\n\n  initCheckCookie() {\n    let key = this.$form.data('userId') + '-last-login-in';\n\n    if (!Cookies.get(key) || Cookies.get(key) != new Date().getDate()) {\n      this.drag = $('#drag-btn').length ? new Drag($('#drag-btn'), $('.js-jigsaw'), {\n        limitType: 'web_register'\n      }) : null\n      $('#mobile-bind-modal').modal('show');\n      Cookies.set(key, new Date().getDate());\n    }\n  }\n\n  initValidator() {\n    let self = this;\n\n    this.validator = this.$form.validate({\n      currentDom: '#submit-btn',\n      ajax: true,\n      rules: {\n        password: {\n          required: true,\n          es_remote: {\n            type: 'post'\n          },\n        },\n        mobile: {\n          required: true,\n          phone: true,\n          es_remote: {\n            type: 'get',\n            callback: (bool) => {\n              if (bool) {\n                self.$smsCode.removeAttr('disabled');\n              } else {\n                self.$smsCode.attr('disabled', true);\n              }\n            }\n          },\n        },\n        sms_code: {\n          required: true,\n          unsigned_integer: true,\n          es_remote: {\n            type: 'get',\n          },\n        },\n      },\n      messages: {\n        sms_code: {\n          required: Translator.trans('site.captcha_code.required')\n        }\n      },\n      submitSuccess(data) {\n        notify('success', Translator.trans(data.message));\n        $('.modal').modal('hide');\n      },\n      submitError(data) {\n        notify('danger',  Translator.trans(data.responseJSON.message));\n      }\n    });\n  }\n\n  initMobileCodeSendBtn() {\n    let self = this;\n\n    this.$smsCode.on('click', function () {\n      self.$smsCode.attr('disabled', true);\n      new SmsSender({\n        element: '.js-sms-send',\n        url: self.$smsCode.data('url'),\n        smsType: 'sms_bind',\n        captcha: true,\n        captchaValidated: true,\n        captchaNum: 'dragCaptchaToken',\n        preSmsSend: function() {\n          return true;\n        },\n        error: function(error) {\n          self.drag.initDragCaptcha();\n        },\n        additionalAction: function(ackResponse) {\n          if (ackResponse == 'captchaRequired') {\n            self.$smsCode.attr('disabled', true);\n            $('.js-drag-jigsaw').removeClass('hidden');\n            if(self.drag) {\n              self.drag.initDragCaptcha();\n            }\n            return true;\n          }\n          return false;\n        }\n      });\n    });\n  }\n\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/mobile-bind/mobile-bind.js"],"sourceRoot":""}