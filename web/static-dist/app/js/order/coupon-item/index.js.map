{"version":3,"sources":["webpack:///external \"jQuery\"","webpack:///./app/Resources/static-src/app/js/order/coupon-item/coupon.js","webpack:///./app/Resources/static-src/app/js/order/coupon-item/index.js"],"names":["Coupon","props","$form","$","form","$couponCode","find","$productType","$productId","$price","$errorMessage","$deductAmountLabel","$couponCodeLabel","$selectCouponBtn","init","initEvent","on","useCoupon","event","cancelCoupon","inputCode","selectCoupon","$this","currentTarget","val","errorMessage","code","data","button","validate","useable","message","priceType","coinRate","coinName","deductAmount","parseFloat","toFixed","useCouponAfter","text","toggleShow","trigger","Translator","trans","show","$parent","parent","hasClass","addClass","hide","removeClass","callback","ajax","url","type","done","$selectCoupon","$selectedCoupon","cd","radio","el"],"mappings":"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","file":"app/js/order/coupon-item/index.js","sourcesContent":["module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = app/js/main app/js/v2/demo/index app/js/activity-manage/doc/index app/js/activity-manage/download/index app/js/activity-manage/flash/index app/js/activity-manage/homework/index app/js/activity-manage/ppt/index app/js/activity-manage/video/index app/js/article/detail/index app/js/attachment/index app/js/auth/captcha-modal/index app/js/auth/password-reset/index app/js/auth/register/index app/js/batch-upload/index app/js/card/card-receive/index app/js/card/index/index app/js/cashier/index app/js/cashier/modal/index app/js/classroom-manage/set-picture/index app/js/classroom-manage/student-expiryday/index app/js/classroom-manage/student-import/index app/js/classroom-manage/students-create/index app/js/classroom-manage/students-manage/index app/js/classroom/buy-modal/index app/js/classroom/index app/js/classroom/thread-form/index app/js/classroom/thread-show/index app/js/coin/invite-code/index app/js/course-chapter-manage/index app/js/course-manage-file/index/index app/js/course-manage/batch-create/index app/js/course-manage/lesson-manage/default/index app/js/course-manage/lesson-manage/normal/index app/js/course-manage/live-replay/upload/index app/js/course-manage/overview/index app/js/course-manage/student-import/index app/js/course/buy-modal/index app/js/course/thread-show/index app/js/courseset/show/index app/js/exporter/index app/js/group/index app/js/group/logo/index app/js/group/thread-add/index app/js/live-course/explore/index app/js/material-lib/index/index app/js/material-lib/share-history/index app/js/media-manage/index app/js/activity-manage/audio/index app/js/mobile-bind/index app/js/my/order-refund-apply/index app/js/my/order-refund/index app/js/my/order/index app/js/oauth2/create/index app/js/open-course-manage/add-material/index app/js/open-course-manage/lesson-modal/index app/js/open-course/index app/js/open-course/member-sms/index app/js/order/coupon-item/index app/js/order/create-sms/index app/js/order/create/index app/js/pay/select/index app/js/pay/show-mobile-modal/index app/js/player/index app/js/question-manage/form/index app/js/review/list/index app/js/search/index app/js/settings/avatar-crop-modal/index app/js/settings/bind-mobile/index app/js/settings/email/index app/js/settings/find_pay_password_by_sms/index app/js/settings/find-pay-password/index app/js/settings/password/index app/js/settings/pay-password-modal/index app/js/settings/pay-password/index app/js/settings/profile/index app/js/settings/reset-pay-password/index app/js/settings/security-questions/index app/js/settings/security/index app/js/settings/setup-password/index app/js/settings/setup/index app/js/settings/update-pay-password/index app/js/settings/user-profile/index app/js/subject/index app/js/task-manage/create/index app/js/task/plugin/note/index app/js/task/plugin/question/index app/js/testpaper-manage/create/index app/js/testpaper-manage/index app/js/testpaper-manage/questions/index app/js/testpaper/do-test/exercise/index app/js/testpaper/do-test/normal/index app/js/testpaper/result/index app/js/thread/user-info-modal/index app/js/user/fill-info/index app/js/message/show/index","import notify from 'common/notify';\n\nclass Coupon {\n  constructor(props) {\n    Object.assign(this, {\n      \n    }, props);\n\n    this.$form = $(this.form);\n\n    this.$couponCode = this.$form.find('input[name=\"couponCode\"]');\n    this.$productType = this.$form.find('input[name=\"targetType\"]');\n    this.$productId = this.$form.find('input[name=\"targetId\"]');\n    this.$price = this.$form.find('input[name=\"price\"]');\n\n    this.$errorMessage = this.$form.find('#coupon-error-message');\n\n    this.$deductAmountLabel = this.$form.find('#deduct-amount-label');\n    this.$couponCodeLabel = this.$form.find('#coupon-code-label');\n\n    this.$selectCouponBtn = this.$form.find('#select-coupon-btn');\n\n    this.init();\n  }\n\n  init() {\n    this.initEvent();\n  }\n\n  initEvent() {\n    const $form = this.$form;\n\n    $form.on('click', '#use-coupon-btn', event => this.useCoupon(event));\n    $form.on('click', '#cancel-use-coupon-btn', event => this.cancelCoupon(event));\n    $form.on('change', 'input[name=\"couponCode\"]', event => this.inputCode(event));\n\n    this.selectCoupon();\n  }\n\n  inputCode(event) {\n    const $this = $(event.currentTarget);\n\n    if ($this.val()) {\n      this.errorMessage();\n    }\n  }\n\n  useCoupon(event) {\n    const $this = $(event.currentTarget);\n    const code = this.$couponCode.val();\n    if (!code) {\n      this.errorMessage(this.$couponCode.data('display'));\n      return;\n    }\n\n    $this.button('loading');\n\n    this.validate(event, (data) => {\n      $this.button('reset');\n      if (data.useable == 'no') {\n        this.errorMessage(data.message);\n      } else {\n        const priceType = this.$form.data('price-type');\n        const coinRate = this.$form.data('coin-rate');\n        const coinName = this.$form.data('coin-name');\n\n        let deductAmount = (data['type'] == 'discount') ? this.$price.val() * (1 - data['rate'] / 10) : data['rate'];\n        \n        if (priceType === 'coin') {\n          deductAmount = parseFloat(parseFloat(deductAmount) * parseFloat(coinRate)).toFixed(2) + ' ' + coinName;\n        } else {\n          deductAmount = '￥' + parseFloat(deductAmount).toFixed(2);\n        }\n\n        this.useCouponAfter(deductAmount, code);\n      }\n    });\n  }\n\n  useCouponAfter(deductAmount, code) {\n    this.$deductAmountLabel.text(deductAmount);\n    this.$couponCodeLabel.text(code);\n\n    this.toggleShow('use');\n\n    this.$form.trigger('calculatePrice');\n    this.$form.trigger('addPriceItem', ['coupon-price', Translator.trans('order.create.coupon_deduction'), deductAmount]);\n  }\n\n  cancelCoupon(event) {\n    this.$couponCode.val('');\n    this.$form.trigger('calculatePrice');\n    this.$form.trigger('removePriceItem', ['coupon-price']);\n    this.toggleShow('cancel');\n  }\n\n  errorMessage(text) {\n    if (text) {\n      this.$errorMessage.text(text).show();\n      let $parent = this.$errorMessage.parent('.cd-form-group');\n      if (!$parent.hasClass('has-error')) {\n        $parent.addClass('has-error');\n      }\n    } else {\n      this.$errorMessage.text('').hide().parent('.cd-form-group.has-error').removeClass('has-error');\n    }\n  }\n\n  validate(event, callback) {\n    const $this = $(event.currentTarget);\n\n    const data = {\n      'code': this.$couponCode.val(),\n      'targetType': this.$productType.val(),\n      'targetId': this.$productId.val(),\n      'price': this.$price.val()\n    };\n\n    $.ajax({\n      url: $this.data('url'),\n      type: 'POST',\n      data,\n    }).done((data) => {\n      if (typeof callback === 'function') {\n        callback(data);\n      }\n    });\n  }\n\n  toggleShow(type) {\n    const $selectCoupon = this.$form.find('#order-center-coupon__select');\n    const $selectedCoupon = this.$form.find('#order-center-coupon__selected');\n\n    if (type === 'use') {\n      $selectCoupon.hide();\n      $selectedCoupon.show();\n    } else if (type === 'cancel') {\n      $selectCoupon.show();\n      $selectedCoupon.hide();\n    }\n  }\n\n  selectCoupon() {\n    cd.radio({\n      el: '.js-existing-coupon',\n    }).on('change', (event) => {\n      const $this = $(event.currentTarget);\n      const code = $this.data('code');\n      const deductAmount = $this.data('deductAmount');\n      this.$couponCode.val(code);\n\n      this.$selectCouponBtn.trigger('click');\n\n      this.useCouponAfter(deductAmount, code);\n    });\n  }\n\n}\n\nexport default Coupon;\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/order/coupon-item/coupon.js","import Coupon from './coupon';\n\nnew Coupon({\n  form: '#order-create-form'\n});\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/order/coupon-item/index.js"],"sourceRoot":""}