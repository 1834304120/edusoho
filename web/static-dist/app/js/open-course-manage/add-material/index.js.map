{"version":3,"sources":["webpack:///external \"jQuery\"","webpack:///./app/Resources/static-src/app/js/open-course-manage/add-material/index.js","webpack:///./app/Resources/static-src/app/js/open-course-manage/add-material/add-material.js"],"names":["AddMaterial","$form","$","initForm","bindEvent","initFileChooser","validator2","validate","currentDom","ajax","rules","link","fileId","messages","Translator","trans","submitHandler","form","settings","$btn","button","post","attr","serializeArray","done","data","append","find","val","text","fail","click","submit","remove","on","event","deleteItem","addLink","$target","currentTarget","$parent","closest","confirm","$verifyLink","linkVal","$materials","isValidated","valid","fileSelect","file","$media","name","media","JSON","parse","id","fileChooser","FileChooser"],"mappings":"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","file":"app/js/open-course-manage/add-material/index.js","sourcesContent":["module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = app/js/main app/js/v2/demo/index app/js/activity-manage/doc/index app/js/activity-manage/download/index app/js/activity-manage/flash/index app/js/activity-manage/homework/index app/js/activity-manage/ppt/index app/js/activity-manage/video/index app/js/article/detail/index app/js/attachment/index app/js/auth/captcha-modal/index app/js/auth/password-reset/index app/js/auth/register/index app/js/batch-upload/index app/js/card/card-receive/index app/js/card/index/index app/js/cashier/index app/js/cashier/modal/index app/js/classroom-manage/set-picture/index app/js/classroom-manage/student-expiryday/index app/js/classroom-manage/student-import/index app/js/classroom-manage/students-create/index app/js/classroom-manage/students-manage/index app/js/classroom/buy-modal/index app/js/classroom/index app/js/classroom/thread-form/index app/js/classroom/thread-show/index app/js/coin/invite-code/index app/js/course-chapter-manage/index app/js/course-manage-file/index/index app/js/course-manage/batch-create/index app/js/course-manage/lesson-manage/default/index app/js/course-manage/lesson-manage/normal/index app/js/course-manage/live-replay/upload/index app/js/course-manage/overview/index app/js/course-manage/student-import/index app/js/course/buy-modal/index app/js/course/thread-show/index app/js/courseset/show/index app/js/exporter/index app/js/group/index app/js/group/logo/index app/js/group/thread-add/index app/js/live-course/explore/index app/js/material-lib/index/index app/js/material-lib/share-history/index app/js/media-manage/index app/js/activity-manage/audio/index app/js/mobile-bind/index app/js/my/order-refund-apply/index app/js/my/order-refund/index app/js/my/order/index app/js/oauth2/create/index app/js/open-course-manage/add-material/index app/js/open-course-manage/lesson-modal/index app/js/open-course/index app/js/open-course/member-sms/index app/js/order/coupon-item/index app/js/order/create-sms/index app/js/order/create/index app/js/pay/select/index app/js/pay/show-mobile-modal/index app/js/player/index app/js/question-manage/form/index app/js/review/list/index app/js/search/index app/js/settings/avatar-crop-modal/index app/js/settings/bind-mobile/index app/js/settings/email/index app/js/settings/find_pay_password_by_sms/index app/js/settings/find-pay-password/index app/js/settings/password/index app/js/settings/pay-password-modal/index app/js/settings/pay-password/index app/js/settings/profile/index app/js/settings/reset-pay-password/index app/js/settings/security-questions/index app/js/settings/security/index app/js/settings/setup-password/index app/js/settings/setup/index app/js/settings/update-pay-password/index app/js/settings/user-profile/index app/js/subject/index app/js/task-manage/create/index app/js/task/plugin/note/index app/js/task/plugin/question/index app/js/testpaper-manage/create/index app/js/testpaper-manage/index app/js/testpaper-manage/questions/index app/js/testpaper/do-test/exercise/index app/js/testpaper/do-test/normal/index app/js/testpaper/result/index app/js/thread/user-info-modal/index app/js/user/fill-info/index app/js/message/show/index","import AddMaterial from './add-material.js';\n\nnew AddMaterial();\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/open-course-manage/add-material/index.js","import FileChooser from 'app/js/file-chooser/file-choose';\nimport notify from 'common/notify';\nimport { isEmpty } from 'common/utils';\nimport { chooserUiOpen } from 'app/js/activity-manage/widget/chooser-ui';\n\nexport default class AddMaterial {\n  constructor() {\n    this.$form = $('#course-material-form');\n    this.initForm();\n    this.bindEvent();\n    this.initFileChooser();\n  }\n\n  initForm() {\n    const validator2 = this.$form.validate({\n      currentDom: '.js-add-file-list',\n      ajax: true,\n      rules: {\n        link: 'url',\n        fileId: 'required'\n      },\n      messages: {\n        link: Translator.trans('activity.download_manage.link_error_hint'),\n        fileId: Translator.trans('activity.download_manage.materials_error_hint')\n      },\n      submitHandler(form) {\n        const $form = $(form);\n        const settings = this.settings;\n        const $btn = $(settings.currentDom);\n        $btn.button('loading');\n        $.post($form.attr('action'), $form.serializeArray())\n          .done((data) => {\n            notify('success', Translator.trans('activity.download_manage.materials_or_link_success'));\n            $('#material-list').append(data);\n            $btn.button('reset');\n            $form.find('#materials').val('');\n            $form.find('#link').val('');\n            $form.find('#verifyLink').val('');\n            $form.find('#media').val('');\n            $form.find('#file-summary').val('');\n            $form.find('.js-current-file').text('');\n          }).fail(() => {\n            $btn.button('reset');\n            notify('warning', Translator.trans('activity.download_manage.materials_or_link_fail'));\n          });\n      }\n    });\n\n    $('.js-add-file-list').click(() => {\n      if (validator2.form()) {\n        this.$form.submit();\n      } else {\n        $('#link').val('');\n        $('#materials-error').remove();\n        notify('danger', Translator.trans('activity.download_manage.materials_or_link_error_hint'));\n      }\n    });\n\n    this.$form.data('validator', validator2);\n  }\n\n  bindEvent() {\n    this.$form.on('click', '.js-btn-delete', (event) => this.deleteItem(event));\n    this.$form.on('click', '.js-video-import', () => this.addLink());\n  }\n\n  deleteItem(event) {\n    const $target = $(event.currentTarget);\n    const $parent = $target.closest('li');\n\n    if (!confirm(Translator.trans('activity.download_manage.materials_or_link_confirm_delete'))) {\n      return;\n    }\n\n    $.post($target.data('url'), () => {\n      $parent.remove();\n      notify('success', Translator.trans('activity.download_manage.materials_or_link_delete'));\n    });\n  }\n\n  addLink() {\n    const $verifyLink = $('#verifyLink');\n    const linkVal = $('#link').val();\n    const $materials = $('#materials');\n    const isValidated = this.$form.data('validator').valid();\n\n    if (isValidated && linkVal) {\n      $materials.val(0);\n      $verifyLink.val(linkVal);\n    } else {\n      $('#link').val('');\n      $verifyLink.val('');\n      $materials.val('');\n    }\n\n    $('.js-current-file').text($verifyLink.val());\n  }\n\n  initFileChooser() {\n    const fileSelect = (file) => {\n      const $media = $('#media');\n      const $materials = $('#materials');\n\n      $media.val(JSON.stringify(file));\n      chooserUiOpen();\n      $('.js-current-file').text(file.name);\n      let media = isEmpty($media.val()) ? Object.create(null) : JSON.parse($media.val());\n      $materials.val(media.id);\n    };\n\n    const fileChooser = new FileChooser();\n    fileChooser.on('select', fileSelect);\n  }\n\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/open-course-manage/add-material/add-material.js"],"sourceRoot":""}