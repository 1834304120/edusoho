{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/question-manage/read/common.js","webpack:///./app/Resources/static-src/app/js/testpaper-manage/read/index.js"],"names":["registerEvent","$importBox","fileName","$form","$","$uploadBtn","$inputFile","$uploadFileBox","uploadFileBoxEl","document","getElementById","$oldTemplate","$step1View","$step2View","$step3View","$step2Btns","$step3Btns","on","fileList","e","currentTarget","files","length","name","arr","split","pop","join","readFile","FormData","dragleave","preventDefault","stopPropagation","drop","dragenter","dragover","addEventListener","toggleClass","removeClass","dataTransfer","data","append","url","attr","type","button","ajax","cache","processData","contentType","success","res","readSuccessCallBack","readErrorCallBack","error","err","val","responseJSON","console","log","window","location","href","addClass","html","click","replace","done","resp","$modal"],"mappings":"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","file":"app/js/testpaper-manage/read/index.js","sourcesContent":["const registerEvent = function($importBox) {\n  let fileName;\n  let $form = $('#import-step-form');\n\n  let $uploadBtn = $('#upload-btn');\n  let $inputFile = $('#form_file');\n  let $uploadFileBox = $('#upload-file-box');\n  let uploadFileBoxEl = document.getElementById('upload-file-box');\n  let $oldTemplate = $('#old-template-btn');\n  let $step1View = $('.js-step1-view');\n  let $step2View = $('.js-step2-view');\n  let $step3View = $('.js-step3-view');\n  let $step2Btns = $('.js-step2-btn');\n  let $step3Btns = $('.js-step3-btn');\n\n  $inputFile.on('change', e => {\n    let fileList = e.currentTarget.files;\n\n    if (fileList.length === 0) {\n      return false;\n    }\n\n    fileName = fileList[0].name;\n    let arr = fileName.split('.');\n    arr.pop();\n    fileName = arr.join('.');\n    readFile(new FormData($form[0]));\n  });\n  // 拖拽上传\n  $uploadFileBox.on({\n    dragleave: function(e) { // 拖出\n      e.preventDefault();\n      e.stopPropagation();\n    },\n    drop: function(e) { // 拖进后释放\n      e.preventDefault();\n      e.stopPropagation();\n    },\n    dragenter: function(e) {    //拖进\n      e.preventDefault();\n      e.stopPropagation();\n    },\n    dragover: function(e) {    //拖着不动\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  });\n\n  uploadFileBoxEl.addEventListener('dragenter', function(e) {\n    $uploadFileBox.toggleClass('bg-primary-light');\n  }, false);\n\n  uploadFileBoxEl.addEventListener('dragleave', function(e) {\n    $uploadFileBox.toggleClass('bg-primary-light');\n  }, false);\n\n  uploadFileBoxEl.addEventListener('drop', function(e) {\n    $uploadFileBox.removeClass('bg-primary-light');\n    const fileList = e.dataTransfer.files;\n\n    if (fileList.length === 0) {\n      return false;\n    }\n\n    fileName = fileList[0].name;\n    let arr = fileName.split('.');\n    arr.pop();\n    fileName = arr.join('.');\n    let data = new FormData();\n    data.append('importFile', fileList[0]);\n\n    readFile(data);\n  }, false);\n\n  // 读取文件\n  function readFile(data) {\n    if(!data) {\n      return false;\n    }\n\n    let url = $form.attr('action');\n    let type = $form.attr('method');\n\n    $uploadBtn.button('loading');\n    $.ajax({\n      type: type,\n      url: url,\n      data: data,\n      cache: false,\n      processData: false,\n      contentType: false,\n      success: function(res) {\n        $uploadBtn.button('reset');\n        if (res.success === true) {\n          readSuccessCallBack(res);\n        } else {\n          readErrorCallBack(res);\n        }\n      },\n      error: function(err) {\n        $uploadBtn.button('reset');\n        $inputFile.val('');\n        err = err.responseJSON.error;\n        console.log('Read error:', err);\n      }\n    });\n  }\n\n  function readSuccessCallBack(res) {\n    window.location.href = res.url;\n  }\n\n  // 读取失败回调\n  function readErrorCallBack(res) {\n    $oldTemplate.addClass('hidden');\n    $step1View.addClass('hidden');\n    $step3View.html(res).removeClass('hidden');\n    $step3Btns.removeClass('hidden');\n  }\n\n  $oldTemplate.click(function() {\n    let url = $form.attr('action');\n    url = url.replace(/read/g, 'plumber');\n\n    $.ajax({\n      type: 'get',\n      url: url,\n    }).done(function(resp) {\n      let $modal = $('#modal');\n      $modal.html(resp);\n    });\n  });\n\n  // 重新上传\n  $('#re-import-btn').click(function() {\n    $oldTemplate.removeClass('hidden');\n    $step1View.removeClass('hidden');\n    $step2View.addClass('hidden');\n    $step3View.addClass('hidden');\n    $step2Btns.addClass('hidden');\n    $step3Btns.addClass('hidden');\n    $inputFile.val('');\n  });\n};\n\nexport {\n  registerEvent\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/question-manage/read/common.js","import { registerEvent } from '../../question-manage/read/common';\n\nlet $importBox = $('#import-testpaper-box');\nregisterEvent($importBox);\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/testpaper-manage/read/index.js"],"sourceRoot":""}