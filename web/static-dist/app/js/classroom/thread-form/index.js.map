{"version":3,"sources":["webpack:///external \"jQuery\"","webpack:///./app/Resources/static-src/common/es-webuploader.js","webpack:///./app/Resources/static-src/common/fex-webuploader/Uploader.swf","webpack:///./app/Resources/static-src/app/js/classroom/thread-form/index.js","webpack:///./app/Resources/static-src/common/fex-webuploader/webuploader.js"],"names":["EsWebUploader","option","self","config","fileSizeLimit","type","fileInput","title","Translator","trans","formData","accept","extensions","mimeTypes","uploader","fileVal","element","$","onFileQueued","onUploadSuccess","ele","WebUploader","create","swf","SWF_PATH","server","app","uploadUrl","pick","id","attr","multiple","extend","token","data","_csrf_token","auto","fileNumLimit","resize","compress","on","file","console","log","response","removeFile","cd","message","$form","validator","validate","rules","required","trim","editor","CKEDITOR","replace","toolbar","fileSingleSizeLimit","filebrowserImageUploadUrl","val","getData","form","threadType","find","positive_integer","visible_character","DateAndTime","datetimepicker","language","document","documentElement","lang","autoclose","format","minView","ev","Date","url","AttachmentActions","root","factory","modules","_require","deps","callback","args","len","i","getModule","length","push","apply","_define","arguments","setModule","module","exports","returned","undefined","Error","exportsTo","obj","key","host","parts","part","last","ucFirst","str","charAt","toUpperCase","substr","hasOwnProperty","split","pop","shift","makeExport","dollar","__dollar","origin","define","noConflict","window","require","jQuery","Zepto","_","Deferred","when","isPromise","anything","then","promise","noop","call","Function","uncurryThis","fn","bindFn","context","createObject","proto","f","prototype","version","browser","ua","ret","webkit","match","chrome","ie","firefox","safari","opera","parseFloat","navigator","userAgent","os","android","ios","inherits","Super","protos","staticProtos","child","constructor","__super__","nextTick","cb","setTimeout","slice","guid","counter","prefix","toString","Math","floor","random","formatSize","size","pointLength","units","unit","toFixed","Base","separator","findHandlers","arr","name","grep","handler","e","_cb","ctx","eachEvent","events","iterator","each","triggerHanders","stoped","ctx2","me","set","_events","once","off","trigger","allEvents","installTo","Mediator","Uploader","opts","options","_init","upload","stop","getFile","getFiles","addFile","addFiles","sort","cancelFile","skipFile","retry","isInProgress","makeThumb","md5File","getDimension","addButton","predictRuntimeType","refresh","disable","enable","reset","command","request","state","isPlainObject","getStats","stats","successNum","numOfSuccess","progressNum","numOfProgress","cancelNum","numOfCancel","invalidNum","numOfInvalid","uploadFailNum","numOfUploadFailed","queueNum","numOfQueue","interruptNum","numofInterrupt","substring","isFunction","concat","destroy","factories","getFirstKey","Runtime","container","body","uid","getContainer","parent","_container","createElement","css","position","top","left","width","height","overflow","append","addClass","_parent","init","exec","remove","removeClass","orders","addRuntime","hasRuntime","runtime","cache","add","get","ruid","standalone","__standalone","RuntimeClient","component","deferred","runtimeReady","done","connectRuntime","runtimeOrder","__promise","resolve","__client","getRuntime","disconnectRuntime","unshift","getRuid","RuntimeClent","DragAndDrop","disableGlobalDnd","_destroy","IGNORE","widgetClass","isArrayLike","nodeType","Widget","owner","invoke","apiName","map","responseMap","widgets","_widgets","deactives","disableWidgets","klass","indexOf","_name","rlts","dfds","widget","rlt","pipe","register","widgetProto","toLowerCase","unRegister","splice","Dnd","dnd","files","items","FilePaste","paste","Blob","source","ext","start","end","getSource","rExt","File","RegExp","$1","lastModifiedDate","toLocaleString","FilePicker","innerHTML","label","html","button","_refer","_resizeHandler","shimContainer","outerWidth","outerHeight","pos","offset","bottom","right","btn","pickers","addBtn","promises","picker","Image","_info","_meta","quality","crop","preserveHeaders","allowMagnify","info","meta","loadFromBlob","blob","getAsDataUrl","getAsBlob","throttle","max","occupied","waiting","tick","item","emiter","thumb","image","reason","beforeSendFile","compressSize","noCompressIfLarger","_compressed","always","reject","idPrefix","idSuffix","statusMap","gid","WUFile","statusText","Status","INITED","loaded","msg","setStatus","ERROR","status","text","prevStatus","getStatus","QUEUED","PROGRESS","COMPLETE","CANCELLED","INTERRUPT","INVALID","STATUS","Queue","numofDeleted","_queue","_map","_fileAdded","prepend","fileId","fetch","sts","inArray","existing","cur","pre","_onFileStatusChange","curStatus","preStatus","join","queue","placeholder","_ruid","_wrapFile","acceptFile","invalid","test","_addFile","fetchFile","noForceStart","sortFiles","support","Transport","_blob","_formData","_headers","headers","_timeout","clearTimeout","_timer","method","withCredentials","timeout","sendAsBinary","appendBlob","filename","value","setRequestHeader","send","abort","getResponse","getResponseAsJson","duration","prepareNextFile","chunked","chunkSize","chunkRetry","threads","CuteFile","pending","total","chunks","ceil","index","api","has","block","min","chunk","cuted","blocks","remaning","runing","progress","pool","stack","__tick","_tick","v","transport","_trigged","_promise","startUpload","stopUpload","interrupt","_putback","_popBlock","_tr","_getStats","skipped","_nextBlock","_startSend","idx","_getStack","act","next","preparing","_prepareNextFile","_finishFile","fail","_doSend","percentage","updateFileProgress","tr","requestAccept","_raw","flag","retried","hds","totalPercent","uploaded","validators","addValidator","removeValidator","count","parseInt","mapping","duplicate","hashString","hash","_char","charCodeAt","__hash","Md5","getResult","md5","notify","CompBase","components","Html5Runtime","comp","client","instance","FileReader","DataView","webkitSlice","mozSlice","elem","dragEnterHandler","_dragEnterHandler","dragOverHandler","_dragOverHandler","dragLeaveHandler","_dragLeaveHandler","dropHandler","_dropHandler","dndOver","denied","_denied","originalEvent","dataTransfer","dropEffect","parentElem","contains","currentTarget","_leaveTimer","err","_getTansferFiles","results","canAccessFolder","webkitGetAsEntry","isDirectory","_traverseDirectoryTree","entry","isFile","createReader","readEntries","entries","hander","_pasteHander","allowed","clipboardData","kind","getAsFile","preventDefault","stopPropagation","input","mouseHandler","inputChange","opacity","display","cursor","background","clone","target","cloneNode","parentNode","replaceChild","urlAPI","createObjectURL","URL","revokeObjectURL","webkitURL","dataURL2Blob","dataURI","byteStr","intArray","ab","mimetype","atob","decodeURIComponent","ArrayBuffer","Uint8Array","arrayBufferToBlob","dataURL2ArrayBuffer","buffer","builder","BlobBuilder","WebKitBlobBuilder","bb","getBlob","canvasToDataUrl","canvas","toDataURL","parseMeta","updateImageHead","Util","parsers","maxMetaDataSize","parse","fr","onload","_parse","result","onerror","readAsArrayBuffer","noParse","byteLength","dataview","maxOffset","headLength","markerBytes","markerLength","getUint16","imageHead","subarray","head","buf1","buf2","bodyoffset","ImageMeta","EXIF","ExifMap","exifTagTypes","getValue","dataView","dataOffset","getUint8","String","fromCharCode","ascii","littleEndian","getUint32","getInt32","getExifValue","tiffOffset","tagType","tagSize","values","c","parseExifTag","tag","exif","parseExifTags","dirOffset","tagsNumber","dirEndOffset","parseExifData","JPEGEncoder","fround","round","ffloor","YTable","Array","UVTable","fdtbl_Y","fdtbl_UV","YDC_HT","UVDC_HT","YAC_HT","UVAC_HT","bitcode","category","outputfDCTQuant","DU","byteout","bytenew","bytepos","YDU","UDU","VDU","clt","RGB_YUV_TABLE","currentQuality","ZigZag","std_dc_luminance_nrcodes","std_dc_luminance_values","std_ac_luminance_nrcodes","std_ac_luminance_values","std_dc_chrominance_nrcodes","std_dc_chrominance_values","std_ac_chrominance_nrcodes","std_ac_chrominance_values","initQuantTables","sf","YQT","t","UVQT","j","u","aasf","k","row","col","computeHuffmanTbl","nrcodes","std_table","codevalue","pos_in_table","HT","initHuffmanTbl","initCategoryNumber","nrlower","nrupper","cat","nr","nrneg","initRGBYUVTable","writeBits","bs","posval","writeByte","writeWord","fDCTQuant","fdtbl","d0","d1","d2","d3","d4","d5","d6","d7","dataOff","I8","I64","tmp0","tmp7","tmp1","tmp6","tmp2","tmp5","tmp3","tmp4","tmp10","tmp13","tmp11","tmp12","z1","z5","z2","z4","z3","z11","z13","tmp0p2","tmp7p2","tmp1p2","tmp6p2","tmp2p2","tmp5p2","tmp3p2","tmp4p2","tmp10p2","tmp13p2","tmp11p2","tmp12p2","z1p2","z5p2","z2p2","z4p2","z3p2","z11p2","z13p2","writeAPP0","writeSOF0","writeDQT","writeDHT","l","m","n","o","p","writeSOS","processDU","CDU","DC","HTDC","HTAC","EOB","M16zeroes","I16","I63","DU_DCT","Diff","end0pos","lng","startpos","nrzeroes","nrmarker","initCharLookupTable","sfcc","encode","setQuality","DCY","DCU","DCV","displayName","imageData","quadWidth","tripleWidth","x","y","r","g","b","fillbits","jpegDataUri","btoa","encoder","supportJpeg","w","h","fragement","getContext","getImageData","BLANK","modified","img","_metas","error","_img","src","_canvas","_resize","s","cvs","iw","naturalWidth","ih","naturalHeight","orientation","getOrientation","_rotate2Orientaion","_renderImageToCanvas","clearRect","scale","translate","rotate","PI","drawImage","detectVerticalSquash","sy","ey","py","alpha","ratio","vertSquashRatio","detectSubsampling","subsampled","doSquash","d","dy","tmpCanvas","tmpCtx","dw","dh","sx","dx","save","restore","_status","_response","xhr","_initAjax","binary","param","FormData","open","_setRequestHeader","overrideMimeType","_parseJson","_xhr","onprogress","onreadystatechange","XMLHttpRequest","XDomainRequest","lengthComputable","readyState","responseText","json","JSON","ex","FlashRuntime","add32","a","cmn","q","ff","gg","hh","ii","md5cycle","md5blk","md5blks","md5blk_array","md51","tail","tmp","lo","hi","md51_array","hex_chr","rhex","hex","SparkMD5","lsw","msw","unescape","encodeURIComponent","appendBinary","contents","_buff","_length","_state","raw","buff","_finish","hashBinary","content","_concatArrayBuffer","first","second","firstLength","spark","blobSlice","loadNext","onloadend","getFlashVersion","plugins","description","ActiveXObject","GetVariable","ex2","clients","jsreciver","flashExec","evt","flash","getFlash","_flash","copy","_responseJson","forceURLStream","mimeType","percent","readBody","logUrl","product","location","hostname","base","dv","master","online","code","c_error_code","c_reason","c_count","c_size","c_usage","preset"],"mappings":"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","file":"app/js/classroom/thread-form/index.js","sourcesContent":["module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = app/js/main app/js/v2/demo/index app/js/activity-manage/doc/index app/js/activity-manage/download/index app/js/activity-manage/flash/index app/js/activity-manage/homework/index app/js/activity-manage/ppt/index app/js/activity-manage/video/index app/js/article/detail/index app/js/attachment/index app/js/auth/captcha-modal/index app/js/auth/password-reset/index app/js/auth/register/index app/js/batch-upload/index app/js/card/card-receive/index app/js/card/index/index app/js/cashier/index app/js/cashier/modal/index app/js/classroom-manage/set-picture/index app/js/classroom-manage/student-expiryday/index app/js/classroom-manage/student-import/index app/js/classroom-manage/students-create/index app/js/classroom-manage/students-manage/index app/js/classroom/buy-modal/index app/js/classroom/index app/js/classroom/thread-form/index app/js/classroom/thread-show/index app/js/coin/invite-code/index app/js/course-chapter-manage/index app/js/course-manage-file/index/index app/js/course-manage/batch-create/index app/js/course-manage/lesson-manage/default/index app/js/course-manage/lesson-manage/normal/index app/js/course-manage/live-replay/upload/index app/js/course-manage/overview/index app/js/course-manage/student-import/index app/js/course/buy-modal/index app/js/course/thread-show/index app/js/courseset/show/index app/js/exporter/index app/js/group/index app/js/group/logo/index app/js/group/thread-add/index app/js/live-course/explore/index app/js/material-lib/index/index app/js/material-lib/share-history/index app/js/media-manage/index app/js/activity-manage/audio/index app/js/mobile-bind/index app/js/my/order-refund-apply/index app/js/my/order-refund/index app/js/my/order/index app/js/oauth2/create/index app/js/open-course-manage/add-material/index app/js/open-course-manage/lesson-modal/index app/js/open-course/index app/js/open-course/member-sms/index app/js/order/coupon-item/index app/js/order/create-sms/index app/js/order/create/index app/js/pay/select/index app/js/pay/show-mobile-modal/index app/js/player/index app/js/question-manage/form/index app/js/review/list/index app/js/search/index app/js/settings/avatar-crop-modal/index app/js/settings/bind-mobile/index app/js/settings/email/index app/js/settings/find_pay_password_by_sms/index app/js/settings/find-pay-password/index app/js/settings/password/index app/js/settings/pay-password-modal/index app/js/settings/pay-password/index app/js/settings/profile/index app/js/settings/reset-pay-password/index app/js/settings/security-questions/index app/js/settings/security/index app/js/settings/setup-password/index app/js/settings/setup/index app/js/settings/update-pay-password/index app/js/settings/user-profile/index app/js/subject/index app/js/task-manage/create/index app/js/task/plugin/note/index app/js/task/plugin/question/index app/js/testpaper-manage/create/index app/js/testpaper-manage/index app/js/testpaper-manage/questions/index app/js/testpaper/do-test/exercise/index app/js/testpaper/do-test/normal/index app/js/testpaper/result/index app/js/thread/user-info-modal/index app/js/user/fill-info/index app/js/message/show/index","import WebUploader from './fex-webuploader/webuploader.js';\nimport SWF_PATH from './fex-webuploader/Uploader.swf';\n\nclass EsWebUploader {\n  constructor(option) {\n    let self = this;\n    let config = Object.assign({}, {\n      fileSizeLimit: 2 * 1024 * 1024,\n      type: '',\n      fileInput: '',\n      title: Translator.trans('uploader.title'),\n      formData: {},\n      accept: {\n        title: 'Images',\n        extensions: 'gif,jpg,jpeg,png,ico',\n        mimeTypes: 'image/png,image/jpg,image/jpeg,imge/bmp,image/gif'\n      },\n      uploader: null,\n      fileVal: 'file',\n      element: $(option.element)\n    }, option);\n\n    this.onFileQueued = config.onFileQueued || this.onFileQueued;\n    this.onUploadSuccess = config.onUploadSuccess || this.onUploadSuccess;\n\n    let ele = $(config.element);\n    let uploader = WebUploader.create({\n      swf: SWF_PATH,\n      server: app.uploadUrl, // 配置参见script_boot.html.twig\n      pick: {\n        id: '#' + ele.attr('id'),\n        multiple: false\n      },\n      formData: $.extend(config.formData, {\n        token: ele.data('uploadToken'),\n        _csrf_token: $('meta[name=csrf-token]').attr('content')\n      }),\n      accept: config.accept,\n      auto: true,\n      fileNumLimit: 1,\n      fileSizeLimit: config.fileSizeLimit,\n      resize: false,\n      compress: false\n    });\n\n    uploader.on('fileQueued', function(file) {\n      console.log('fileQueued :', file);\n      self.onFileQueued(file);\n    });\n\n    uploader.on('uploadSuccess', function(file, response) {\n      console.log('uploadSuccess: ', file, response);\n      self.onUploadSuccess(file, response);\n      uploader.removeFile(file, true);\n    });\n    uploader.on('uploadError', function(file, response) {\n      console.log('uploadError : ', file, response);\n      cd.message({type: 'danger', message: Translator.trans('uploader.error_hint')});\n    });\n\n    uploader.on('error', function(type) {\n      console.log('error : ', type);\n      switch (type) {\n      case 'Q_EXCEED_SIZE_LIMIT':\n        cd.message({type: 'danger', message: Translator.trans('uploader.size_limit_hint')});\n        break;\n      case 'Q_EXCEED_NUM_LIMIT':\n        cd.message({type: 'danger', message: Translator.trans('uploader.num_limit_hint')});\n        break;\n      case 'Q_TYPE_DENIED':\n        cd.message({type: 'danger', message: Translator.trans('uploader.type_denied_limit_hint')});\n        break;\n      default:\n        break;\n      }\n    });\n  }\n\n  onFileQueued() {\n    //override it if you need\n  }\n\n  onUploadSuccess() {\n    //override it if you need\n  }\n}\n\nexport default EsWebUploader;\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/common/es-webuploader.js","module.exports = __webpack_public_path__ + \"app/media/Uploader.swf\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./app/Resources/static-src/common/fex-webuploader/Uploader.swf\n// module id = a3b7dceb380ae7ceeae3\n// module chunks = app/js/classroom-manage/set-picture/index app/js/classroom/thread-form/index app/js/group/logo/index app/js/settings/user-profile/index","import AttachmentActions from 'app/js/attachment/widget/attachment-actions';\nimport EsWebUploader from 'common/es-webuploader';\n\nlet $form = $('#thread-form');\nlet validator = $form.validate({\n  rules: {\n    'title': {\n      required: true,\n      trim: true,\n    },\n    'content': {\n      required: true,\n    }\n  }\n});\n\nlet editor = CKEDITOR.replace('thread_content', {\n  toolbar: 'Thread',\n  fileSingleSizeLimit: app.fileSingleSizeLimit,\n  filebrowserImageUploadUrl: $('#thread_content').data('imageUploadUrl')\n});\n\neditor.on('change', () => {\n  $('#thread_content').val(editor.getData());\n  validator.form();\n});\neditor.on('blur', () => {\n  $('#thread_content').val(editor.getData());\n  validator.form();\n});\n\nlet threadType = $form.find('[name=\"type\"]').val();\n\nif (threadType == 'event') {\n  $form.find('[name=\"maxUsers\"]').rules('add', {\n    positive_integer: true\n  });\n  $form.find('[name=\"location\"]').rules('add', {\n    visible_character: true\n  });\n  $form.find('[name=\"startTime\"]').rules('add', {\n    required: true,\n    DateAndTime: true\n  });\n\n  $form.find('[name=\"startTime\"]').datetimepicker({\n    language: document.documentElement.lang,\n    autoclose: true,\n    format: 'yyyy-mm-dd hh:ii',\n    minView: 'hour',\n  }).on('hide', function (ev) {\n    $form.validate('[name=startTime]');\n  });\n  $form.find('[name=\"startTime\"]').datetimepicker('setStartDate', new Date);\n  \n  new EsWebUploader({\n    element: '#js-activity-uploader',\n    onUploadSuccess: function(file, response) {\n      $form.find('[name=actvityPicture]').val(response.url);\n      cd.message({type: 'success', message: Translator.trans('site.upload_success_hint')});\n    }\n  });\n}\n\n\nnew AttachmentActions($form);\n\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/classroom/thread-form/index.js","\n/*! WebUploader 0.1.5 */\n\n\n/**\n * @fileOverview 让内部各个部件的代码可以用[amd](https://github.com/amdjs/amdjs-api/wiki/AMD)模块定义方式组织起来。\n *\n * AMD API 内部的简单不完全实现，请忽略。只有当WebUploader被合并成一个文件的时候才会引入。\n */\n/**\n  * rewrite malianbo@howzhi.com\n  * https://github.com/fex-team/webuploader 这里提供的实现，存在arguments.callee这样的代码，由于上述代码已被ES5废弃，Babel使用严格模式编译时会出错。\n  * 参见：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/arguments/callee\n  *\n  */\n(function( root, factory ) {\n  var modules = {},\n\n    // 内部require, 简单不完全实现。\n    // https://github.com/amdjs/amdjs-api/wiki/require\n    _require = function( deps, callback ) {\n      var args, len, i;\n\n      // 如果deps不是数组，则直接返回指定module\n      if ( typeof deps === 'string' ) {\n        return getModule( deps );\n      } else {\n        args = [];\n        for( len = deps.length, i = 0; i < len; i++ ) {\n          args.push( getModule( deps[ i ] ) );\n        }\n\n        return callback.apply( null, args );\n      }\n    },\n\n    // 内部define，暂时不支持不指定id.\n    _define = function( id, deps, factory ) {\n      if ( arguments.length === 2 ) {\n        factory = deps;\n        deps = null;\n      }\n\n      _require( deps || [], function() {\n        setModule( id, factory, arguments );\n      });\n    },\n\n    // 设置module, 兼容CommonJs写法。\n    setModule = function( id, factory, args ) {\n      var module = {\n          exports: factory\n        },\n        returned;\n\n      if ( typeof factory === 'function' ) {\n        args.length || (args = [ _require, module.exports, module ]);\n        returned = factory.apply( null, args );\n        returned !== undefined && (module.exports = returned);\n      }\n\n      modules[ id ] = module.exports;\n    },\n\n    // 根据id获取module\n    getModule = function( id ) {\n      var module = modules[ id ] || root[ id ];\n\n      if ( !module ) {\n        throw new Error( '`' + id + '` is undefined' );\n      }\n\n      return module;\n    },\n\n    // 将所有modules，将路径ids装换成对象。\n    exportsTo = function( obj ) {\n      var key, host, parts, part, last, ucFirst;\n\n      // make the first character upper case.\n      ucFirst = function( str ) {\n        return str && (str.charAt( 0 ).toUpperCase() + str.substr( 1 ));\n      };\n\n      for ( key in modules ) {\n        host = obj;\n\n        if ( !modules.hasOwnProperty( key ) ) {\n          continue;\n        }\n\n        parts = key.split('/');\n        last = ucFirst( parts.pop() );\n\n        while( (part = ucFirst( parts.shift() )) ) {\n          host[ part ] = host[ part ] || {};\n          host = host[ part ];\n        }\n\n        host[ last ] = modules[ key ];\n      }\n\n      return obj;\n    },\n\n    makeExport = function( dollar ) {\n      root.__dollar = dollar;\n\n      // exports every module.\n      return exportsTo( factory( root, _define, _require ) );\n    },\n\n    origin;\n\n  if ( typeof module === 'object' && typeof module.exports === 'object' ) {\n\n    // For CommonJS and CommonJS-like environments where a proper window is present,\n    module.exports = makeExport();\n  } else if ( typeof define === 'function' && define.amd ) {\n\n    // Allow using this built library as an AMD module\n    // in another project. That other project will only\n    // see this AMD call, not the internal modules in\n    // the closure below.\n    define([ 'jquery' ], makeExport );\n  } else {\n\n    // Browser globals case. Just assign the\n    // result to a property on the global.\n    origin = root.WebUploader;\n    root.WebUploader = makeExport();\n    root.WebUploader.noConflict = function() {\n      root.WebUploader = origin;\n    };\n  }\n})( window, function( window, define, require ) {\n\n\n  /**\n     * @fileOverview jQuery or Zepto\n     */\n  define('dollar-third',[],function() {\n    var $ = window.__dollar || window.jQuery || window.Zepto;\n    \n    if ( !$ ) {\n      throw new Error('jQuery or Zepto not found!');\n    }\n    \n    return $;\n  });\n  /**\n     * @fileOverview Dom 操作相关\n     */\n  define('dollar',[\n    'dollar-third'\n  ], function( _ ) {\n    return _;\n  });\n  /**\n     * @fileOverview 使用jQuery的Promise\n     */\n  define('promise-third',[\n    'dollar'\n  ], function( $ ) {\n    return {\n      Deferred: $.Deferred,\n      when: $.when,\n    \n      isPromise: function( anything ) {\n        return anything && typeof anything.then === 'function';\n      }\n    };\n  });\n  /**\n     * @fileOverview Promise/A+\n     */\n  define('promise',[\n    'promise-third'\n  ], function( _ ) {\n    return _;\n  });\n  /**\n     * @fileOverview 基础类方法。\n     */\n    \n  /**\n     * Web Uploader内部类的详细说明，以下提及的功能类，都可以在`WebUploader`这个变量中访问到。\n     *\n     * As you know, Web Uploader的每个文件都是用过[AMD](https://github.com/amdjs/amdjs-api/wiki/AMD)规范中的`define`组织起来的, 每个Module都会有个module id.\n     * 默认module id为该文件的路径，而此路径将会转化成名字空间存放在WebUploader中。如：\n     *\n     * * module `base`：WebUploader.Base\n     * * module `file`: WebUploader.File\n     * * module `lib/dnd`: WebUploader.Lib.Dnd\n     * * module `runtime/html5/dnd`: WebUploader.Runtime.Html5.Dnd\n     *\n     *\n     * 以下文档中对类的使用可能省略掉了`WebUploader`前缀。\n     * @module WebUploader\n     * @title WebUploader API文档\n     */\n  define('base',[\n    'dollar',\n    'promise'\n  ], function( $, promise ) {\n    \n    var noop = function() {},\n      call = Function.call;\n    \n    // http://jsperf.com/uncurrythis\n    // 反科里化\n    function uncurryThis( fn ) {\n      return function() {\n        return call.apply( fn, arguments );\n      };\n    }\n    \n    function bindFn( fn, context ) {\n      return function() {\n        return fn.apply( context, arguments );\n      };\n    }\n    \n    function createObject( proto ) {\n      var f;\n    \n      if ( Object.create ) {\n        return Object.create( proto );\n      } else {\n        f = function() {};\n        f.prototype = proto;\n        return new f();\n      }\n    }\n    \n    \n    /**\n         * 基础类，提供一些简单常用的方法。\n         * @class Base\n         */\n    return {\n    \n      /**\n             * @property {String} version 当前版本号。\n             */\n      version: '0.1.5',\n    \n      /**\n             * @property {jQuery|Zepto} $ 引用依赖的jQuery或者Zepto对象。\n             */\n      $: $,\n    \n      Deferred: promise.Deferred,\n    \n      isPromise: promise.isPromise,\n    \n      when: promise.when,\n    \n      /**\n             * @description  简单的浏览器检查结果。\n             *\n             * * `webkit`  webkit版本号，如果浏览器为非webkit内核，此属性为`undefined`。\n             * * `chrome`  chrome浏览器版本号，如果浏览器为chrome，此属性为`undefined`。\n             * * `ie`  ie浏览器版本号，如果浏览器为非ie，此属性为`undefined`。**暂不支持ie10+**\n             * * `firefox`  firefox浏览器版本号，如果浏览器为非firefox，此属性为`undefined`。\n             * * `safari`  safari浏览器版本号，如果浏览器为非safari，此属性为`undefined`。\n             * * `opera`  opera浏览器版本号，如果浏览器为非opera，此属性为`undefined`。\n             *\n             * @property {Object} [browser]\n             */\n      browser: (function( ua ) {\n        var ret = {},\n          webkit = ua.match( /WebKit\\/([\\d.]+)/ ),\n          chrome = ua.match( /Chrome\\/([\\d.]+)/ ) ||\n                        ua.match( /CriOS\\/([\\d.]+)/ ),\n    \n          ie = ua.match( /MSIE\\s([\\d\\.]+)/ ) ||\n                        ua.match( /(?:trident)(?:.*rv:([\\w.]+))?/i ),\n          firefox = ua.match( /Firefox\\/([\\d.]+)/ ),\n          safari = ua.match( /Safari\\/([\\d.]+)/ ),\n          opera = ua.match( /OPR\\/([\\d.]+)/ );\n    \n        webkit && (ret.webkit = parseFloat( webkit[ 1 ] ));\n        chrome && (ret.chrome = parseFloat( chrome[ 1 ] ));\n        ie && (ret.ie = parseFloat( ie[ 1 ] ));\n        firefox && (ret.firefox = parseFloat( firefox[ 1 ] ));\n        safari && (ret.safari = parseFloat( safari[ 1 ] ));\n        opera && (ret.opera = parseFloat( opera[ 1 ] ));\n    \n        return ret;\n      })( navigator.userAgent ),\n    \n      /**\n             * @description  操作系统检查结果。\n             *\n             * * `android`  如果在android浏览器环境下，此值为对应的android版本号，否则为`undefined`。\n             * * `ios` 如果在ios浏览器环境下，此值为对应的ios版本号，否则为`undefined`。\n             * @property {Object} [os]\n             */\n      os: (function( ua ) {\n        var ret = {},\n    \n          // osx = !!ua.match( /\\(Macintosh\\; Intel / ),\n          android = ua.match( /(?:Android);?[\\s\\/]+([\\d.]+)?/ ),\n          ios = ua.match( /(?:iPad|iPod|iPhone).*OS\\s([\\d_]+)/ );\n    \n        // osx && (ret.osx = true);\n        android && (ret.android = parseFloat( android[ 1 ] ));\n        ios && (ret.ios = parseFloat( ios[ 1 ].replace( /_/g, '.' ) ));\n    \n        return ret;\n      })( navigator.userAgent ),\n    \n      /**\n             * 实现类与类之间的继承。\n             * @method inherits\n             * @grammar Base.inherits( super ) => child\n             * @grammar Base.inherits( super, protos ) => child\n             * @grammar Base.inherits( super, protos, statics ) => child\n             * @param  {Class} super 父类\n             * @param  {Object | Function} [protos] 子类或者对象。如果对象中包含constructor，子类将是用此属性值。\n             * @param  {Function} [protos.constructor] 子类构造器，不指定的话将创建个临时的直接执行父类构造器的方法。\n             * @param  {Object} [statics] 静态属性或方法。\n             * @return {Class} 返回子类。\n             * @example\n             * function Person() {\n             *     console.log( 'Super' );\n             * }\n             * Person.prototype.hello = function() {\n             *     console.log( 'hello' );\n             * };\n             *\n             * var Manager = Base.inherits( Person, {\n             *     world: function() {\n             *         console.log( 'World' );\n             *     }\n             * });\n             *\n             * // 因为没有指定构造器，父类的构造器将会执行。\n             * var instance = new Manager();    // => Super\n             *\n             * // 继承子父类的方法\n             * instance.hello();    // => hello\n             * instance.world();    // => World\n             *\n             * // 子类的__super__属性指向父类\n             * console.log( Manager.__super__ === Person );    // => true\n             */\n      inherits: function( Super, protos, staticProtos ) {\n        var child;\n    \n        if ( typeof protos === 'function' ) {\n          child = protos;\n          protos = null;\n        } else if ( protos && protos.hasOwnProperty('constructor') ) {\n          child = protos.constructor;\n        } else {\n          child = function() {\n            return Super.apply( this, arguments );\n          };\n        }\n    \n        // 复制静态方法\n        $.extend( true, child, Super, staticProtos || {} );\n    \n        /* jshint camelcase: false */\n    \n        // 让子类的__super__属性指向父类。\n        child.__super__ = Super.prototype;\n    \n        // 构建原型，添加原型方法或属性。\n        // 暂时用Object.create实现。\n        child.prototype = createObject( Super.prototype );\n        protos && $.extend( true, child.prototype, protos );\n    \n        return child;\n      },\n    \n      /**\n             * 一个不做任何事情的方法。可以用来赋值给默认的callback.\n             * @method noop\n             */\n      noop: noop,\n    \n      /**\n             * 返回一个新的方法，此方法将已指定的`context`来执行。\n             * @grammar Base.bindFn( fn, context ) => Function\n             * @method bindFn\n             * @example\n             * var doSomething = function() {\n             *         console.log( this.name );\n             *     },\n             *     obj = {\n             *         name: 'Object Name'\n             *     },\n             *     aliasFn = Base.bind( doSomething, obj );\n             *\n             *  aliasFn();    // => Object Name\n             *\n             */\n      bindFn: bindFn,\n    \n      /**\n             * 引用Console.log如果存在的话，否则引用一个[空函数noop](#WebUploader:Base.noop)。\n             * @grammar Base.log( args... ) => undefined\n             * @method log\n             */\n      log: (function() {\n        if ( window.console ) {\n          return bindFn( console.log, console );\n        }\n        return noop;\n      })(),\n    \n      nextTick: (function() {\n    \n        return function( cb ) {\n          setTimeout( cb, 1 );\n        };\n    \n        // @bug 当浏览器不在当前窗口时就停了。\n        // var next = window.requestAnimationFrame ||\n        //     window.webkitRequestAnimationFrame ||\n        //     window.mozRequestAnimationFrame ||\n        //     function( cb ) {\n        //         window.setTimeout( cb, 1000 / 60 );\n        //     };\n    \n        // // fix: Uncaught TypeError: Illegal invocation\n        // return bindFn( next, window );\n      })(),\n    \n      /**\n             * 被[uncurrythis](http://www.2ality.com/2011/11/uncurrying-this.html)的数组slice方法。\n             * 将用来将非数组对象转化成数组对象。\n             * @grammar Base.slice( target, start[, end] ) => Array\n             * @method slice\n             * @example\n             * function doSomthing() {\n             *     var args = Base.slice( arguments, 1 );\n             *     console.log( args );\n             * }\n             *\n             * doSomthing( 'ignored', 'arg2', 'arg3' );    // => Array [\"arg2\", \"arg3\"]\n             */\n      slice: uncurryThis( [].slice ),\n    \n      /**\n             * 生成唯一的ID\n             * @method guid\n             * @grammar Base.guid() => String\n             * @grammar Base.guid( prefx ) => String\n             */\n      guid: (function() {\n        var counter = 0;\n    \n        return function( prefix ) {\n          var guid = (+new Date()).toString( 32 ),\n            i = 0;\n    \n          for ( ; i < 5; i++ ) {\n            guid += Math.floor( Math.random() * 65535 ).toString( 32 );\n          }\n    \n          return (prefix || 'wu_') + guid + (counter++).toString( 32 );\n        };\n      })(),\n    \n      /**\n             * 格式化文件大小, 输出成带单位的字符串\n             * @method formatSize\n             * @grammar Base.formatSize( size ) => String\n             * @grammar Base.formatSize( size, pointLength ) => String\n             * @grammar Base.formatSize( size, pointLength, units ) => String\n             * @param {Number} size 文件大小\n             * @param {Number} [pointLength=2] 精确到的小数点数。\n             * @param {Array} [units=[ 'B', 'K', 'M', 'G', 'TB' ]] 单位数组。从字节，到千字节，一直往上指定。如果单位数组里面只指定了到了K(千字节)，同时文件大小大于M, 此方法的输出将还是显示成多少K.\n             * @example\n             * console.log( Base.formatSize( 100 ) );    // => 100B\n             * console.log( Base.formatSize( 1024 ) );    // => 1.00K\n             * console.log( Base.formatSize( 1024, 0 ) );    // => 1K\n             * console.log( Base.formatSize( 1024 * 1024 ) );    // => 1.00M\n             * console.log( Base.formatSize( 1024 * 1024 * 1024 ) );    // => 1.00G\n             * console.log( Base.formatSize( 1024 * 1024 * 1024, 0, ['B', 'KB', 'MB'] ) );    // => 1024MB\n             */\n      formatSize: function( size, pointLength, units ) {\n        var unit;\n    \n        units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\n    \n        while ( (unit = units.shift()) && size > 1024 ) {\n          size = size / 1024;\n        }\n    \n        return (unit === 'B' ? size : size.toFixed( pointLength || 2 )) +\n                        unit;\n      }\n    };\n  });\n  /**\n     * 事件处理类，可以独立使用，也可以扩展给对象使用。\n     * @fileOverview Mediator\n     */\n  define('mediator',[\n    'base'\n  ], function( Base ) {\n    var $ = Base.$,\n      slice = [].slice,\n      separator = /\\s+/,\n      protos;\n    \n    // 根据条件过滤出事件handlers.\n    function findHandlers( arr, name, callback, context ) {\n      return $.grep( arr, function( handler ) {\n        return handler &&\n                        (!name || handler.e === name) &&\n                        (!callback || handler.cb === callback ||\n                        handler.cb._cb === callback) &&\n                        (!context || handler.ctx === context);\n      });\n    }\n    \n    function eachEvent( events, callback, iterator ) {\n      // 不支持对象，只支持多个event用空格隔开\n      $.each( (events || '').split( separator ), function( _, key ) {\n        iterator( key, callback );\n      });\n    }\n    \n    function triggerHanders( events, args ) {\n      var stoped = false,\n        i = -1,\n        len = events.length,\n        handler;\n    \n      while ( ++i < len ) {\n        handler = events[ i ];\n    \n        if ( handler.cb.apply( handler.ctx2, args ) === false ) {\n          stoped = true;\n          break;\n        }\n      }\n    \n      return !stoped;\n    }\n    \n    protos = {\n    \n      /**\n             * 绑定事件。\n             *\n             * `callback`方法在执行时，arguments将会来源于trigger的时候携带的参数。如\n             * ```javascript\n             * var obj = {};\n             *\n             * // 使得obj有事件行为\n             * Mediator.installTo( obj );\n             *\n             * obj.on( 'testa', function( arg1, arg2 ) {\n             *     console.log( arg1, arg2 ); // => 'arg1', 'arg2'\n             * });\n             *\n             * obj.trigger( 'testa', 'arg1', 'arg2' );\n             * ```\n             *\n             * 如果`callback`中，某一个方法`return false`了，则后续的其他`callback`都不会被执行到。\n             * 切会影响到`trigger`方法的返回值，为`false`。\n             *\n             * `on`还可以用来添加一个特殊事件`all`, 这样所有的事件触发都会响应到。同时此类`callback`中的arguments有一个不同处，\n             * 就是第一个参数为`type`，记录当前是什么事件在触发。此类`callback`的优先级比脚低，会再正常`callback`执行完后触发。\n             * ```javascript\n             * obj.on( 'all', function( type, arg1, arg2 ) {\n             *     console.log( type, arg1, arg2 ); // => 'testa', 'arg1', 'arg2'\n             * });\n             * ```\n             *\n             * @method on\n             * @grammar on( name, callback[, context] ) => self\n             * @param  {String}   name     事件名，支持多个事件用空格隔开\n             * @param  {Function} callback 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             * @class Mediator\n             */\n      on: function( name, callback, context ) {\n        var me = this,\n          set;\n    \n        if ( !callback ) {\n          return this;\n        }\n    \n        set = this._events || (this._events = []);\n    \n        eachEvent( name, callback, function( name, callback ) {\n          var handler = { e: name };\n    \n          handler.cb = callback;\n          handler.ctx = context;\n          handler.ctx2 = context || me;\n          handler.id = set.length;\n    \n          set.push( handler );\n        });\n    \n        return this;\n      },\n    \n      /**\n             * 绑定事件，且当handler执行完后，自动解除绑定。\n             * @method once\n             * @grammar once( name, callback[, context] ) => self\n             * @param  {String}   name     事件名\n             * @param  {Function} callback 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             */\n      once: function( name, callback, context ) {\n        var me = this;\n    \n        if ( !callback ) {\n          return me;\n        }\n    \n        eachEvent( name, callback, function( name, callback ) {\n          var once = function() {\n            me.off( name, once );\n            return callback.apply( context || me, arguments );\n          };\n    \n          once._cb = callback;\n          me.on( name, once, context );\n        });\n    \n        return me;\n      },\n    \n      /**\n             * 解除事件绑定\n             * @method off\n             * @grammar off( [name[, callback[, context] ] ] ) => self\n             * @param  {String}   [name]     事件名\n             * @param  {Function} [callback] 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             */\n      off: function( name, cb, ctx ) {\n        var events = this._events;\n    \n        if ( !events ) {\n          return this;\n        }\n    \n        if ( !name && !cb && !ctx ) {\n          this._events = [];\n          return this;\n        }\n    \n        eachEvent( name, cb, function( name, cb ) {\n          $.each( findHandlers( events, name, cb, ctx ), function() {\n            delete events[ this.id ];\n          });\n        });\n    \n        return this;\n      },\n    \n      /**\n             * 触发事件\n             * @method trigger\n             * @grammar trigger( name[, args...] ) => self\n             * @param  {String}   type     事件名\n             * @param  {*} [...] 任意参数\n             * @return {Boolean} 如果handler中return false了，则返回false, 否则返回true\n             */\n      trigger: function( type ) {\n        var args, events, allEvents;\n    \n        if ( !this._events || !type ) {\n          return this;\n        }\n    \n        args = slice.call( arguments, 1 );\n        events = findHandlers( this._events, type );\n        allEvents = findHandlers( this._events, 'all' );\n    \n        return triggerHanders( events, args ) &&\n                        triggerHanders( allEvents, arguments );\n      }\n    };\n    \n    /**\n         * 中介者，它本身是个单例，但可以通过[installTo](#WebUploader:Mediator:installTo)方法，使任何对象具备事件行为。\n         * 主要目的是负责模块与模块之间的合作，降低耦合度。\n         *\n         * @class Mediator\n         */\n    return $.extend({\n    \n      /**\n             * 可以通过这个接口，使任何对象具备事件功能。\n             * @method installTo\n             * @param  {Object} obj 需要具备事件行为的对象。\n             * @return {Object} 返回obj.\n             */\n      installTo: function( obj ) {\n        return $.extend( obj, protos );\n      }\n    \n    }, protos );\n  });\n  /**\n     * @fileOverview Uploader上传类\n     */\n  define('uploader',[\n    'base',\n    'mediator'\n  ], function( Base, Mediator ) {\n    \n    var $ = Base.$;\n    \n    /**\n         * 上传入口类。\n         * @class Uploader\n         * @constructor\n         * @grammar new Uploader( opts ) => Uploader\n         * @example\n         * var uploader = WebUploader.Uploader({\n         *     swf: 'path_of_swf/Uploader.swf',\n         *\n         *     // 开起分片上传。\n         *     chunked: true\n         * });\n         */\n    function Uploader( opts ) {\n      this.options = $.extend( true, {}, Uploader.options, opts );\n      this._init( this.options );\n    }\n    \n    // default Options\n    // widgets中有相应扩展\n    Uploader.options = {};\n    Mediator.installTo( Uploader.prototype );\n    \n    // 批量添加纯命令式方法。\n    $.each({\n      upload: 'start-upload',\n      stop: 'stop-upload',\n      getFile: 'get-file',\n      getFiles: 'get-files',\n      addFile: 'add-file',\n      addFiles: 'add-file',\n      sort: 'sort-files',\n      removeFile: 'remove-file',\n      cancelFile: 'cancel-file',\n      skipFile: 'skip-file',\n      retry: 'retry',\n      isInProgress: 'is-in-progress',\n      makeThumb: 'make-thumb',\n      md5File: 'md5-file',\n      getDimension: 'get-dimension',\n      addButton: 'add-btn',\n      predictRuntimeType: 'predict-runtime-type',\n      refresh: 'refresh',\n      disable: 'disable',\n      enable: 'enable',\n      reset: 'reset'\n    }, function( fn, command ) {\n      Uploader.prototype[ fn ] = function() {\n        return this.request( command, arguments );\n      };\n    });\n    \n    $.extend( Uploader.prototype, {\n      state: 'pending',\n    \n      _init: function( opts ) {\n        var me = this;\n    \n        me.request( 'init', opts, function() {\n          me.state = 'ready';\n          me.trigger('ready');\n        });\n      },\n    \n      /**\n             * 获取或者设置Uploader配置项。\n             * @method option\n             * @grammar option( key ) => *\n             * @grammar option( key, val ) => self\n             * @example\n             *\n             * // 初始状态图片上传前不会压缩\n             * var uploader = new WebUploader.Uploader({\n             *     compress: null;\n             * });\n             *\n             * // 修改后图片上传前，尝试将图片压缩到1600 * 1600\n             * uploader.option( 'compress', {\n             *     width: 1600,\n             *     height: 1600\n             * });\n             */\n      option: function( key, val ) {\n        var opts = this.options;\n    \n        // setter\n        if ( arguments.length > 1 ) {\n    \n          if ( $.isPlainObject( val ) &&\n                            $.isPlainObject( opts[ key ] ) ) {\n            $.extend( opts[ key ], val );\n          } else {\n            opts[ key ] = val;\n          }\n    \n        } else {    // getter\n          return key ? opts[ key ] : opts;\n        }\n      },\n    \n      /**\n             * 获取文件统计信息。返回一个包含一下信息的对象。\n             * * `successNum` 上传成功的文件数\n             * * `progressNum` 上传中的文件数\n             * * `cancelNum` 被删除的文件数\n             * * `invalidNum` 无效的文件数\n             * * `uploadFailNum` 上传失败的文件数\n             * * `queueNum` 还在队列中的文件数\n             * * `interruptNum` 被暂停的文件数\n             * @method getStats\n             * @grammar getStats() => Object\n             */\n      getStats: function() {\n        // return this._mgr.getStats.apply( this._mgr, arguments );\n        var stats = this.request('get-stats');\n    \n        return stats ? {\n          successNum: stats.numOfSuccess,\n          progressNum: stats.numOfProgress,\n    \n          // who care?\n          // queueFailNum: 0,\n          cancelNum: stats.numOfCancel,\n          invalidNum: stats.numOfInvalid,\n          uploadFailNum: stats.numOfUploadFailed,\n          queueNum: stats.numOfQueue,\n          interruptNum: stats.numofInterrupt\n        } : {};\n      },\n    \n      // 需要重写此方法来来支持opts.onEvent和instance.onEvent的处理器\n      trigger: function( type/*, args...*/ ) {\n        var args = [].slice.call( arguments, 1 ),\n          opts = this.options,\n          name = 'on' + type.substring( 0, 1 ).toUpperCase() +\n                        type.substring( 1 );\n    \n        if (\n        // 调用通过on方法注册的handler.\n          Mediator.trigger.apply( this, arguments ) === false ||\n    \n                        // 调用opts.onEvent\n                        $.isFunction( opts[ name ] ) &&\n                        opts[ name ].apply( this, args ) === false ||\n    \n                        // 调用this.onEvent\n                        $.isFunction( this[ name ] ) &&\n                        this[ name ].apply( this, args ) === false ||\n    \n                        // 广播所有uploader的事件。\n                        Mediator.trigger.apply( Mediator,\n                        \t[ this, type ].concat( args ) ) === false ) {\n    \n          return false;\n        }\n    \n        return true;\n      },\n    \n      /**\n             * 销毁 webuploader 实例\n             * @method destroy\n             * @grammar destroy() => undefined\n             */\n      destroy: function() {\n        this.request( 'destroy', arguments );\n        this.off();\n      },\n    \n      // widgets/widget.js将补充此方法的详细文档。\n      request: Base.noop\n    });\n    \n    /**\n         * 创建Uploader实例，等同于new Uploader( opts );\n         * @method create\n         * @class Base\n         * @static\n         * @grammar Base.create( opts ) => Uploader\n         */\n    Base.create = Uploader.create = function( opts ) {\n      return new Uploader( opts );\n    };\n    \n    // 暴露Uploader，可以通过它来扩展业务逻辑。\n    Base.Uploader = Uploader;\n    \n    return Uploader;\n  });\n  /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n  define('runtime/runtime',[\n    'base',\n    'mediator'\n  ], function( Base, Mediator ) {\n    \n    var $ = Base.$,\n      factories = {},\n    \n      // 获取对象的第一个key\n      getFirstKey = function( obj ) {\n        for ( var key in obj ) {\n          if ( obj.hasOwnProperty( key ) ) {\n            return key;\n          }\n        }\n        return null;\n      };\n    \n    // 接口类。\n    function Runtime( options ) {\n      this.options = $.extend({\n        container: document.body\n      }, options );\n      this.uid = Base.guid('rt_');\n    }\n    \n    $.extend( Runtime.prototype, {\n    \n      getContainer: function() {\n        var opts = this.options,\n          parent, container;\n    \n        if ( this._container ) {\n          return this._container;\n        }\n    \n        parent = $( opts.container || document.body );\n        container = $( document.createElement('div') );\n    \n        container.attr( 'id', 'rt_' + this.uid );\n        container.css({\n          position: 'absolute',\n          top: '0px',\n          left: '0px',\n          width: '100%',\n          height: '100%',\n          overflow: 'hidden'\n        });\n    \n        parent.append( container );\n        parent.addClass('webuploader-container');\n        this._container = container;\n        this._parent = parent;\n        return container;\n      },\n    \n      init: Base.noop,\n      exec: Base.noop,\n    \n      destroy: function() {\n        this._container && this._container.remove();\n        this._parent && this._parent.removeClass('webuploader-container');\n        this.off();\n      }\n    });\n    \n    Runtime.orders = 'html5,flash';\n    \n    \n    /**\n         * 添加Runtime实现。\n         * @param {String} type    类型\n         * @param {Runtime} factory 具体Runtime实现。\n         */\n    Runtime.addRuntime = function( type, factory ) {\n      factories[ type ] = factory;\n    };\n    \n    Runtime.hasRuntime = function( type ) {\n      return !!(type ? factories[ type ] : getFirstKey( factories ));\n    };\n    \n    Runtime.create = function( opts, orders ) {\n      var type, runtime;\n    \n      orders = orders || Runtime.orders;\n      $.each( orders.split( /\\s*,\\s*/g ), function() {\n        if ( factories[ this ] ) {\n          type = this;\n          return false;\n        }\n      });\n    \n      type = type || getFirstKey( factories );\n    \n      if ( !type ) {\n        throw new Error('Runtime Error');\n      }\n    \n      runtime = new factories[ type ]( opts );\n      return runtime;\n    };\n    \n    Mediator.installTo( Runtime.prototype );\n    return Runtime;\n  });\n    \n  /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n  define('runtime/client',[\n    'base',\n    'mediator',\n    'runtime/runtime'\n  ], function( Base, Mediator, Runtime ) {\n    \n    var cache;\n    \n    cache = (function() {\n      var obj = {};\n    \n      return {\n        add: function( runtime ) {\n          obj[ runtime.uid ] = runtime;\n        },\n    \n        get: function( ruid, standalone ) {\n          var i;\n    \n          if ( ruid ) {\n            return obj[ ruid ];\n          }\n    \n          for ( i in obj ) {\n            // 有些类型不能重用，比如filepicker.\n            if ( standalone && obj[ i ].__standalone ) {\n              continue;\n            }\n    \n            return obj[ i ];\n          }\n    \n          return null;\n        },\n    \n        remove: function( runtime ) {\n          delete obj[ runtime.uid ];\n        }\n      };\n    })();\n    \n    function RuntimeClient( component, standalone ) {\n      var deferred = Base.Deferred(),\n        runtime;\n    \n      this.uid = Base.guid('client_');\n    \n      // 允许runtime没有初始化之前，注册一些方法在初始化后执行。\n      this.runtimeReady = function( cb ) {\n        return deferred.done( cb );\n      };\n    \n      this.connectRuntime = function( opts, cb ) {\n    \n        // already connected.\n        if ( runtime ) {\n          throw new Error('already connected!');\n        }\n    \n        deferred.done( cb );\n    \n        if ( typeof opts === 'string' && cache.get( opts ) ) {\n          runtime = cache.get( opts );\n        }\n    \n        // 像filePicker只能独立存在，不能公用。\n        runtime = runtime || cache.get( null, standalone );\n    \n        // 需要创建\n        if ( !runtime ) {\n          runtime = Runtime.create( opts, opts.runtimeOrder );\n          runtime.__promise = deferred.promise();\n          runtime.once( 'ready', deferred.resolve );\n          runtime.init();\n          cache.add( runtime );\n          runtime.__client = 1;\n        } else {\n          // 来自cache\n          Base.$.extend( runtime.options, opts );\n          runtime.__promise.then( deferred.resolve );\n          runtime.__client++;\n        }\n    \n        standalone && (runtime.__standalone = standalone);\n        return runtime;\n      };\n    \n      this.getRuntime = function() {\n        return runtime;\n      };\n    \n      this.disconnectRuntime = function() {\n        if ( !runtime ) {\n          return;\n        }\n    \n        runtime.__client--;\n    \n        if ( runtime.__client <= 0 ) {\n          cache.remove( runtime );\n          delete runtime.__promise;\n          runtime.destroy();\n        }\n    \n        runtime = null;\n      };\n    \n      this.exec = function() {\n        if ( !runtime ) {\n          return;\n        }\n    \n        var args = Base.slice( arguments );\n        component && args.unshift( component );\n    \n        return runtime.exec.apply( this, args );\n      };\n    \n      this.getRuid = function() {\n        return runtime && runtime.uid;\n      };\n    \n      this.destroy = (function( destroy ) {\n        return function() {\n          destroy && destroy.apply( this, arguments );\n          this.trigger('destroy');\n          this.off();\n          this.exec('destroy');\n          this.disconnectRuntime();\n        };\n      })( this.destroy );\n    }\n    \n    Mediator.installTo( RuntimeClient.prototype );\n    return RuntimeClient;\n  });\n  /**\n     * @fileOverview 错误信息\n     */\n  define('lib/dnd',[\n    'base',\n    'mediator',\n    'runtime/client'\n  ], function( Base, Mediator, RuntimeClent ) {\n    \n    var $ = Base.$;\n    \n    function DragAndDrop( opts ) {\n      opts = this.options = $.extend({}, DragAndDrop.options, opts );\n    \n      opts.container = $( opts.container );\n    \n      if ( !opts.container.length ) {\n        return;\n      }\n    \n      RuntimeClent.call( this, 'DragAndDrop' );\n    }\n    \n    DragAndDrop.options = {\n      accept: null,\n      disableGlobalDnd: false\n    };\n    \n    Base.inherits( RuntimeClent, {\n      constructor: DragAndDrop,\n    \n      init: function() {\n        var me = this;\n    \n        me.connectRuntime( me.options, function() {\n          me.exec('init');\n          me.trigger('ready');\n        });\n      }\n    });\n    \n    Mediator.installTo( DragAndDrop.prototype );\n    \n    return DragAndDrop;\n  });\n  /**\n     * @fileOverview 组件基类。\n     */\n  define('widgets/widget',[\n    'base',\n    'uploader'\n  ], function( Base, Uploader ) {\n    \n    var $ = Base.$,\n      _init = Uploader.prototype._init,\n      _destroy = Uploader.prototype.destroy,\n      IGNORE = {},\n      widgetClass = [];\n    \n    function isArrayLike( obj ) {\n      if ( !obj ) {\n        return false;\n      }\n    \n      var length = obj.length,\n        type = $.type( obj );\n    \n      if ( obj.nodeType === 1 && length ) {\n        return true;\n      }\n    \n      return type === 'array' || type !== 'function' && type !== 'string' &&\n                    (length === 0 || typeof length === 'number' && length > 0 &&\n                    (length - 1) in obj);\n    }\n    \n    function Widget( uploader ) {\n      this.owner = uploader;\n      this.options = uploader.options;\n    }\n    \n    $.extend( Widget.prototype, {\n    \n      init: Base.noop,\n    \n      // 类Backbone的事件监听声明，监听uploader实例上的事件\n      // widget直接无法监听事件，事件只能通过uploader来传递\n      invoke: function( apiName, args ) {\n    \n        /*\n                    {\n                        'make-thumb': 'makeThumb'\n                    }\n                 */\n        var map = this.responseMap;\n    \n        // 如果无API响应声明则忽略\n        if ( !map || !(apiName in map) || !(map[ apiName ] in this) ||\n                        !$.isFunction( this[ map[ apiName ] ] ) ) {\n    \n          return IGNORE;\n        }\n    \n        return this[ map[ apiName ] ].apply( this, args );\n    \n      },\n    \n      /**\n             * 发送命令。当传入`callback`或者`handler`中返回`promise`时。返回一个当所有`handler`中的promise都完成后完成的新`promise`。\n             * @method request\n             * @grammar request( command, args ) => * | Promise\n             * @grammar request( command, args, callback ) => Promise\n             * @for  Uploader\n             */\n      request: function() {\n        return this.owner.request.apply( this.owner, arguments );\n      }\n    });\n    \n    // 扩展Uploader.\n    $.extend( Uploader.prototype, {\n    \n      /**\n             * @property {String | Array} [disableWidgets=undefined]\n             * @namespace options\n             * @for Uploader\n             * @description 默认所有 Uploader.register 了的 widget 都会被加载，如果禁用某一部分，请通过此 option 指定黑名单。\n             */\n    \n      // 覆写_init用来初始化widgets\n      _init: function() {\n        var me = this,\n          widgets = me._widgets = [],\n          deactives = me.options.disableWidgets || '';\n    \n        $.each( widgetClass, function( _, klass ) {\n          (!deactives || !~deactives.indexOf( klass._name )) &&\n                        widgets.push( new klass( me ) );\n        });\n    \n        return _init.apply( me, arguments );\n      },\n    \n      request: function( apiName, args, callback ) {\n        var i = 0,\n          widgets = this._widgets,\n          len = widgets && widgets.length,\n          rlts = [],\n          dfds = [],\n          widget, rlt, promise, key;\n    \n        args = isArrayLike( args ) ? args : [ args ];\n    \n        for ( ; i < len; i++ ) {\n          widget = widgets[ i ];\n          rlt = widget.invoke( apiName, args );\n    \n          if ( rlt !== IGNORE ) {\n    \n            // Deferred对象\n            if ( Base.isPromise( rlt ) ) {\n              dfds.push( rlt );\n            } else {\n              rlts.push( rlt );\n            }\n          }\n        }\n    \n        // 如果有callback，则用异步方式。\n        if ( callback || dfds.length ) {\n          promise = Base.when.apply( Base, dfds );\n          key = promise.pipe ? 'pipe' : 'then';\n    \n          // 很重要不能删除。删除了会死循环。\n          // 保证执行顺序。让callback总是在下一个 tick 中执行。\n          return promise[ key ](function() {\n            var deferred = Base.Deferred(),\n              args = arguments;\n    \n            if ( args.length === 1 ) {\n              args = args[ 0 ];\n            }\n    \n            setTimeout(function() {\n              deferred.resolve( args );\n            }, 1 );\n    \n            return deferred.promise();\n          })[ callback ? key : 'done' ]( callback || Base.noop );\n        } else {\n          return rlts[ 0 ];\n        }\n      },\n    \n      destroy: function() {\n        _destroy.apply( this, arguments );\n        this._widgets = null;\n      }\n    });\n    \n    /**\n         * 添加组件\n         * @grammar Uploader.register(proto);\n         * @grammar Uploader.register(map, proto);\n         * @param  {object} responseMap API 名称与函数实现的映射\n         * @param  {object} proto 组件原型，构造函数通过 constructor 属性定义\n         * @method Uploader.register\n         * @for Uploader\n         * @example\n         * Uploader.register({\n         *     'make-thumb': 'makeThumb'\n         * }, {\n         *     init: function( options ) {},\n         *     makeThumb: function() {}\n         * });\n         *\n         * Uploader.register({\n         *     'make-thumb': function() {\n         *         \n         *     }\n         * });\n         */\n    Uploader.register = Widget.register = function( responseMap, widgetProto ) {\n      var map = { init: 'init', destroy: 'destroy', name: 'anonymous' },\n        klass;\n    \n      if ( arguments.length === 1 ) {\n        widgetProto = responseMap;\n    \n        // 自动生成 map 表。\n        $.each(widgetProto, function(key) {\n          if ( key[0] === '_' || key === 'name' ) {\n            key === 'name' && (map.name = widgetProto.name);\n            return;\n          }\n    \n          map[key.replace(/[A-Z]/g, '-$&').toLowerCase()] = key;\n        });\n    \n      } else {\n        map = $.extend( map, responseMap );\n      }\n    \n      widgetProto.responseMap = map;\n      klass = Base.inherits( Widget, widgetProto );\n      klass._name = map.name;\n      widgetClass.push( klass );\n    \n      return klass;\n    };\n    \n    /**\n         * 删除插件，只有在注册时指定了名字的才能被删除。\n         * @grammar Uploader.unRegister(name);\n         * @param  {string} name 组件名字\n         * @method Uploader.unRegister\n         * @for Uploader\n         * @example\n         *\n         * Uploader.register({\n         *     name: 'custom',\n         *     \n         *     'make-thumb': function() {\n         *         \n         *     }\n         * });\n         *\n         * Uploader.unRegister('custom');\n         */\n    Uploader.unRegister = Widget.unRegister = function( name ) {\n      if ( !name || name === 'anonymous' ) {\n        return;\n      }\n            \n      // 删除指定的插件。\n      for ( var i = widgetClass.length; i--; ) {\n        if ( widgetClass[i]._name === name ) {\n          widgetClass.splice(i, 1);\n        }\n      }\n    };\n    \n    return Widget;\n  });\n  /**\n     * @fileOverview DragAndDrop Widget。\n     */\n  define('widgets/filednd',[\n    'base',\n    'uploader',\n    'lib/dnd',\n    'widgets/widget'\n  ], function( Base, Uploader, Dnd ) {\n    var $ = Base.$;\n    \n    Uploader.options.dnd = '';\n    \n    /**\n         * @property {Selector} [dnd=undefined]  指定Drag And Drop拖拽的容器，如果不指定，则不启动。\n         * @namespace options\n         * @for Uploader\n         */\n        \n    /**\n         * @property {Selector} [disableGlobalDnd=false]  是否禁掉整个页面的拖拽功能，如果不禁用，图片拖进来的时候会默认被浏览器打开。\n         * @namespace options\n         * @for Uploader\n         */\n    \n    /**\n         * @event dndAccept\n         * @param {DataTransferItemList} items DataTransferItem\n         * @description 阻止此事件可以拒绝某些类型的文件拖入进来。目前只有 chrome 提供这样的 API，且只能通过 mime-type 验证。\n         * @for  Uploader\n         */\n    return Uploader.register({\n      name: 'dnd',\n            \n      init: function( opts ) {\n    \n        if ( !opts.dnd ||\n                        this.request('predict-runtime-type') !== 'html5' ) {\n          return;\n        }\n    \n        var me = this,\n          deferred = Base.Deferred(),\n          options = $.extend({}, {\n            disableGlobalDnd: opts.disableGlobalDnd,\n            container: opts.dnd,\n            accept: opts.accept\n          }),\n          dnd;\n    \n        this.dnd = dnd = new Dnd( options );\n    \n        dnd.once( 'ready', deferred.resolve );\n        dnd.on( 'drop', function( files ) {\n          me.request( 'add-file', [ files ]);\n        });\n    \n        // 检测文件是否全部允许添加。\n        dnd.on( 'accept', function( items ) {\n          return me.owner.trigger( 'dndAccept', items );\n        });\n    \n        dnd.init();\n    \n        return deferred.promise();\n      },\n    \n      destroy: function() {\n        this.dnd && this.dnd.destroy();\n      }\n    });\n  });\n    \n  /**\n     * @fileOverview 错误信息\n     */\n  define('lib/filepaste',[\n    'base',\n    'mediator',\n    'runtime/client'\n  ], function( Base, Mediator, RuntimeClent ) {\n    \n    var $ = Base.$;\n    \n    function FilePaste( opts ) {\n      opts = this.options = $.extend({}, opts );\n      opts.container = $( opts.container || document.body );\n      RuntimeClent.call( this, 'FilePaste' );\n    }\n    \n    Base.inherits( RuntimeClent, {\n      constructor: FilePaste,\n    \n      init: function() {\n        var me = this;\n    \n        me.connectRuntime( me.options, function() {\n          me.exec('init');\n          me.trigger('ready');\n        });\n      }\n    });\n    \n    Mediator.installTo( FilePaste.prototype );\n    \n    return FilePaste;\n  });\n  /**\n     * @fileOverview 组件基类。\n     */\n  define('widgets/filepaste',[\n    'base',\n    'uploader',\n    'lib/filepaste',\n    'widgets/widget'\n  ], function( Base, Uploader, FilePaste ) {\n    var $ = Base.$;\n    \n    /**\n         * @property {Selector} [paste=undefined]  指定监听paste事件的容器，如果不指定，不启用此功能。此功能为通过粘贴来添加截屏的图片。建议设置为`document.body`.\n         * @namespace options\n         * @for Uploader\n         */\n    return Uploader.register({\n      name: 'paste',\n            \n      init: function( opts ) {\n    \n        if ( !opts.paste ||\n                        this.request('predict-runtime-type') !== 'html5' ) {\n          return;\n        }\n    \n        var me = this,\n          deferred = Base.Deferred(),\n          options = $.extend({}, {\n            container: opts.paste,\n            accept: opts.accept\n          }),\n          paste;\n    \n        this.paste = paste = new FilePaste( options );\n    \n        paste.once( 'ready', deferred.resolve );\n        paste.on( 'paste', function( files ) {\n          me.owner.request( 'add-file', [ files ]);\n        });\n        paste.init();\n    \n        return deferred.promise();\n      },\n    \n      destroy: function() {\n        this.paste && this.paste.destroy();\n      }\n    });\n  });\n  /**\n     * @fileOverview Blob\n     */\n  define('lib/blob',[\n    'base',\n    'runtime/client'\n  ], function( Base, RuntimeClient ) {\n    \n    function Blob( ruid, source ) {\n      var me = this;\n    \n      me.source = source;\n      me.ruid = ruid;\n      this.size = source.size || 0;\n    \n      // 如果没有指定 mimetype, 但是知道文件后缀。\n      if ( !source.type && this.ext &&\n                    ~'jpg,jpeg,png,gif,bmp'.indexOf( this.ext ) ) {\n        this.type = 'image/' + (this.ext === 'jpg' ? 'jpeg' : this.ext);\n      } else {\n        this.type = source.type || 'application/octet-stream';\n      }\n    \n      RuntimeClient.call( me, 'Blob' );\n      this.uid = source.uid || this.uid;\n    \n      if ( ruid ) {\n        me.connectRuntime( ruid );\n      }\n    }\n    \n    Base.inherits( RuntimeClient, {\n      constructor: Blob,\n    \n      slice: function( start, end ) {\n        return this.exec( 'slice', start, end );\n      },\n    \n      getSource: function() {\n        return this.source;\n      }\n    });\n    \n    return Blob;\n  });\n  /**\n     * 为了统一化Flash的File和HTML5的File而存在。\n     * 以至于要调用Flash里面的File，也可以像调用HTML5版本的File一下。\n     * @fileOverview File\n     */\n  define('lib/file',[\n    'base',\n    'lib/blob'\n  ], function( Base, Blob ) {\n    \n    var uid = 1,\n      rExt = /\\.([^.]+)$/;\n    \n    function File( ruid, file ) {\n      var ext;\n    \n      this.name = file.name || ('untitled' + uid++);\n      ext = rExt.exec( file.name ) ? RegExp.$1.toLowerCase() : '';\n    \n      // todo 支持其他类型文件的转换。\n      // 如果有 mimetype, 但是文件名里面没有找出后缀规律\n      if ( !ext && file.type ) {\n        ext = /\\/(jpg|jpeg|png|gif|bmp)$/i.exec( file.type ) ?\n          RegExp.$1.toLowerCase() : '';\n        this.name += '.' + ext;\n      }\n    \n      this.ext = ext;\n      this.lastModifiedDate = file.lastModifiedDate ||\n                    (new Date()).toLocaleString();\n    \n      Blob.apply( this, arguments );\n    }\n    \n    return Base.inherits( Blob, File );\n  });\n    \n  /**\n     * @fileOverview 错误信息\n     */\n  define('lib/filepicker',[\n    'base',\n    'runtime/client',\n    'lib/file'\n  ], function( Base, RuntimeClent, File ) {\n    \n    var $ = Base.$;\n    \n    function FilePicker( opts ) {\n      opts = this.options = $.extend({}, FilePicker.options, opts );\n    \n      opts.container = $( opts.id );\n    \n      if ( !opts.container.length ) {\n        throw new Error('按钮指定错误');\n      }\n    \n      opts.innerHTML = opts.innerHTML || opts.label ||\n                    opts.container.html() || '';\n    \n      opts.button = $( opts.button || document.createElement('div') );\n      opts.button.html( opts.innerHTML );\n      opts.container.html( opts.button );\n    \n      RuntimeClent.call( this, 'FilePicker', true );\n    }\n    \n    FilePicker.options = {\n      button: null,\n      container: null,\n      label: null,\n      innerHTML: null,\n      multiple: true,\n      accept: null,\n      name: 'file'\n    };\n    \n    Base.inherits( RuntimeClent, {\n      constructor: FilePicker,\n    \n      init: function() {\n        var me = this,\n          opts = me.options,\n          button = opts.button;\n    \n        button.addClass('webuploader-pick');\n    \n        me.on( 'all', function( type ) {\n          var files;\n    \n          switch ( type ) {\n          case 'mouseenter':\n            button.addClass('webuploader-pick-hover');\n            break;\n    \n          case 'mouseleave':\n            button.removeClass('webuploader-pick-hover');\n            break;\n    \n          case 'change':\n            files = me.exec('getFiles');\n            me.trigger( 'select', $.map( files, function( file ) {\n              file = new File( me.getRuid(), file );\n    \n              // 记录来源。\n              file._refer = opts.container;\n              return file;\n            }), opts.container );\n            break;\n          }\n        });\n    \n        me.connectRuntime( opts, function() {\n          me.refresh();\n          me.exec( 'init', opts );\n          me.trigger('ready');\n        });\n    \n        this._resizeHandler = Base.bindFn( this.refresh, this );\n        $( window ).on( 'resize', this._resizeHandler );\n      },\n    \n      refresh: function() {\n        var shimContainer = this.getRuntime().getContainer(),\n          button = this.options.button,\n          width = button.outerWidth ?\n            button.outerWidth() : button.width(),\n    \n          height = button.outerHeight ?\n            button.outerHeight() : button.height(),\n    \n          pos = button.offset();\n    \n        width && height && shimContainer.css({\n          bottom: 'auto',\n          right: 'auto',\n          width: width + 'px',\n          height: height + 'px'\n        }).offset( pos );\n      },\n    \n      enable: function() {\n        var btn = this.options.button;\n    \n        btn.removeClass('webuploader-pick-disable');\n        this.refresh();\n      },\n    \n      disable: function() {\n        var btn = this.options.button;\n    \n        this.getRuntime().getContainer().css({\n          top: '-99999px'\n        });\n    \n        btn.addClass('webuploader-pick-disable');\n      },\n    \n      destroy: function() {\n        var btn = this.options.button;\n        $( window ).off( 'resize', this._resizeHandler );\n        btn.removeClass('webuploader-pick-disable webuploader-pick-hover ' +\n                    'webuploader-pick');\n      }\n    });\n    \n    return FilePicker;\n  });\n    \n  /**\n     * @fileOverview 文件选择相关\n     */\n  define('widgets/filepicker',[\n    'base',\n    'uploader',\n    'lib/filepicker',\n    'widgets/widget'\n  ], function( Base, Uploader, FilePicker ) {\n    var $ = Base.$;\n    \n    $.extend( Uploader.options, {\n    \n      /**\n             * @property {Selector | Object} [pick=undefined]\n             * @namespace options\n             * @for Uploader\n             * @description 指定选择文件的按钮容器，不指定则不创建按钮。\n             *\n             * * `id` {Seletor|dom} 指定选择文件的按钮容器，不指定则不创建按钮。**注意** 这里虽然写的是 id, 但是不是只支持 id, 还支持 class, 或者 dom 节点。\n             * * `label` {String} 请采用 `innerHTML` 代替\n             * * `innerHTML` {String} 指定按钮文字。不指定时优先从指定的容器中看是否自带文字。\n             * * `multiple` {Boolean} 是否开起同时选择多个文件能力。\n             */\n      pick: null,\n    \n      /**\n             * @property {Arroy} [accept=null]\n             * @namespace options\n             * @for Uploader\n             * @description 指定接受哪些类型的文件。 由于目前还有ext转mimeType表，所以这里需要分开指定。\n             *\n             * * `title` {String} 文字描述\n             * * `extensions` {String} 允许的文件后缀，不带点，多个用逗号分割。\n             * * `mimeTypes` {String} 多个用逗号分割。\n             *\n             * 如：\n             *\n             * ```\n             * {\n             *     title: 'Images',\n             *     extensions: 'gif,jpg,jpeg,bmp,png',\n             *     mimeTypes: 'image/*'\n             * }\n             * ```\n             */\n      accept: null/*{\n                title: 'Images',\n                extensions: 'gif,jpg,jpeg,bmp,png',\n                mimeTypes: 'image/*'\n            }*/\n    });\n    \n    return Uploader.register({\n      name: 'picker',\n    \n      init: function( opts ) {\n        this.pickers = [];\n        return opts.pick && this.addBtn( opts.pick );\n      },\n    \n      refresh: function() {\n        $.each( this.pickers, function() {\n          this.refresh();\n        });\n      },\n    \n      /**\n             * @method addButton\n             * @for Uploader\n             * @grammar addButton( pick ) => Promise\n             * @description\n             * 添加文件选择按钮，如果一个按钮不够，需要调用此方法来添加。参数跟[options.pick](#WebUploader:Uploader:options)一致。\n             * @example\n             * uploader.addButton({\n             *     id: '#btnContainer',\n             *     innerHTML: '选择文件'\n             * });\n             */\n      addBtn: function( pick ) {\n        var me = this,\n          opts = me.options,\n          accept = opts.accept,\n          promises = [];\n    \n        if ( !pick ) {\n          return;\n        }\n    \n        $.isPlainObject( pick ) || (pick = {\n          id: pick\n        });\n    \n        $( pick.id ).each(function() {\n          var options, picker, deferred;\n    \n          deferred = Base.Deferred();\n    \n          options = $.extend({}, pick, {\n            accept: $.isPlainObject( accept ) ? [ accept ] : accept,\n            swf: opts.swf,\n            runtimeOrder: opts.runtimeOrder,\n            id: this\n          });\n    \n          picker = new FilePicker( options );\n    \n          picker.once( 'ready', deferred.resolve );\n          picker.on( 'select', function( files ) {\n            me.owner.request( 'add-file', [ files ]);\n          });\n          picker.init();\n    \n          me.pickers.push( picker );\n    \n          promises.push( deferred.promise() );\n        });\n    \n        return Base.when.apply( Base, promises );\n      },\n    \n      disable: function() {\n        $.each( this.pickers, function() {\n          this.disable();\n        });\n      },\n    \n      enable: function() {\n        $.each( this.pickers, function() {\n          this.enable();\n        });\n      },\n    \n      destroy: function() {\n        $.each( this.pickers, function() {\n          this.destroy();\n        });\n        this.pickers = null;\n      }\n    });\n  });\n  /**\n     * @fileOverview Image\n     */\n  define('lib/image',[\n    'base',\n    'runtime/client',\n    'lib/blob'\n  ], function( Base, RuntimeClient, Blob ) {\n    var $ = Base.$;\n    \n    // 构造器。\n    function Image( opts ) {\n      this.options = $.extend({}, Image.options, opts );\n      RuntimeClient.call( this, 'Image' );\n    \n      this.on( 'load', function() {\n        this._info = this.exec('info');\n        this._meta = this.exec('meta');\n      });\n    }\n    \n    // 默认选项。\n    Image.options = {\n    \n      // 默认的图片处理质量\n      quality: 90,\n    \n      // 是否裁剪\n      crop: false,\n    \n      // 是否保留头部信息\n      preserveHeaders: false,\n    \n      // 是否允许放大。\n      allowMagnify: false\n    };\n    \n    // 继承RuntimeClient.\n    Base.inherits( RuntimeClient, {\n      constructor: Image,\n    \n      info: function( val ) {\n    \n        // setter\n        if ( val ) {\n          this._info = val;\n          return this;\n        }\n    \n        // getter\n        return this._info;\n      },\n    \n      meta: function( val ) {\n    \n        // setter\n        if ( val ) {\n          this._meta = val;\n          return this;\n        }\n    \n        // getter\n        return this._meta;\n      },\n    \n      loadFromBlob: function( blob ) {\n        var me = this,\n          ruid = blob.getRuid();\n    \n        this.connectRuntime( ruid, function() {\n          me.exec( 'init', me.options );\n          me.exec( 'loadFromBlob', blob );\n        });\n      },\n    \n      resize: function() {\n        var args = Base.slice( arguments );\n        return this.exec.apply( this, [ 'resize' ].concat( args ) );\n      },\n    \n      crop: function() {\n        var args = Base.slice( arguments );\n        return this.exec.apply( this, [ 'crop' ].concat( args ) );\n      },\n    \n      getAsDataUrl: function( type ) {\n        return this.exec( 'getAsDataUrl', type );\n      },\n    \n      getAsBlob: function( type ) {\n        var blob = this.exec( 'getAsBlob', type );\n    \n        return new Blob( this.getRuid(), blob );\n      }\n    });\n    \n    return Image;\n  });\n  /**\n     * @fileOverview 图片操作, 负责预览图片和上传前压缩图片\n     */\n  define('widgets/image',[\n    'base',\n    'uploader',\n    'lib/image',\n    'widgets/widget'\n  ], function( Base, Uploader, Image ) {\n    \n    var $ = Base.$,\n      throttle;\n    \n    // 根据要处理的文件大小来节流，一次不能处理太多，会卡。\n    throttle = (function( max ) {\n      var occupied = 0,\n        waiting = [],\n        tick = function() {\n          var item;\n    \n          while ( waiting.length && occupied < max ) {\n            item = waiting.shift();\n            occupied += item[ 0 ];\n            item[ 1 ]();\n          }\n        };\n    \n      return function( emiter, size, cb ) {\n        waiting.push([ size, cb ]);\n        emiter.once( 'destroy', function() {\n          occupied -= size;\n          setTimeout( tick, 1 );\n        });\n        setTimeout( tick, 1 );\n      };\n    })( 5 * 1024 * 1024 );\n    \n    $.extend( Uploader.options, {\n    \n      /**\n             * @property {Object} [thumb]\n             * @namespace options\n             * @for Uploader\n             * @description 配置生成缩略图的选项。\n             *\n             * 默认为：\n             *\n             * ```javascript\n             * {\n             *     width: 110,\n             *     height: 110,\n             *\n             *     // 图片质量，只有type为`image/jpeg`的时候才有效。\n             *     quality: 70,\n             *\n             *     // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.\n             *     allowMagnify: true,\n             *\n             *     // 是否允许裁剪。\n             *     crop: true,\n             *\n             *     // 为空的话则保留原有图片格式。\n             *     // 否则强制转换成指定的类型。\n             *     type: 'image/jpeg'\n             * }\n             * ```\n             */\n      thumb: {\n        width: 110,\n        height: 110,\n        quality: 70,\n        allowMagnify: true,\n        crop: true,\n        preserveHeaders: false,\n    \n        // 为空的话则保留原有图片格式。\n        // 否则强制转换成指定的类型。\n        // IE 8下面 base64 大小不能超过 32K 否则预览失败，而非 jpeg 编码的图片很可\n        // 能会超过 32k, 所以这里设置成预览的时候都是 image/jpeg\n        type: 'image/jpeg'\n      },\n    \n      /**\n             * @property {Object} [compress]\n             * @namespace options\n             * @for Uploader\n             * @description 配置压缩的图片的选项。如果此选项为`false`, 则图片在上传前不进行压缩。\n             *\n             * 默认为：\n             *\n             * ```javascript\n             * {\n             *     width: 1600,\n             *     height: 1600,\n             *\n             *     // 图片质量，只有type为`image/jpeg`的时候才有效。\n             *     quality: 90,\n             *\n             *     // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.\n             *     allowMagnify: false,\n             *\n             *     // 是否允许裁剪。\n             *     crop: false,\n             *\n             *     // 是否保留头部meta信息。\n             *     preserveHeaders: true,\n             *\n             *     // 如果发现压缩后文件大小比原来还大，则使用原来图片\n             *     // 此属性可能会影响图片自动纠正功能\n             *     noCompressIfLarger: false,\n             *\n             *     // 单位字节，如果图片大小小于此值，不会采用压缩。\n             *     compressSize: 0\n             * }\n             * ```\n             */\n      compress: {\n        width: 1600,\n        height: 1600,\n        quality: 90,\n        allowMagnify: false,\n        crop: false,\n        preserveHeaders: true\n      }\n    });\n    \n    return Uploader.register({\n    \n      name: 'image',\n    \n    \n      /**\n             * 生成缩略图，此过程为异步，所以需要传入`callback`。\n             * 通常情况在图片加入队里后调用此方法来生成预览图以增强交互效果。\n             *\n             * 当 width 或者 height 的值介于 0 - 1 时，被当成百分比使用。\n             *\n             * `callback`中可以接收到两个参数。\n             * * 第一个为error，如果生成缩略图有错误，此error将为真。\n             * * 第二个为ret, 缩略图的Data URL值。\n             *\n             * **注意**\n             * Date URL在IE6/7中不支持，所以不用调用此方法了，直接显示一张暂不支持预览图片好了。\n             * 也可以借助服务端，将 base64 数据传给服务端，生成一个临时文件供预览。\n             *\n             * @method makeThumb\n             * @grammar makeThumb( file, callback ) => undefined\n             * @grammar makeThumb( file, callback, width, height ) => undefined\n             * @for Uploader\n             * @example\n             *\n             * uploader.on( 'fileQueued', function( file ) {\n             *     var $li = ...;\n             *\n             *     uploader.makeThumb( file, function( error, ret ) {\n             *         if ( error ) {\n             *             $li.text('预览错误');\n             *         } else {\n             *             $li.append('<img alt=\"\" src=\"' + ret + '\" />');\n             *         }\n             *     });\n             *\n             * });\n             */\n      makeThumb: function( file, cb, width, height ) {\n        var opts, image;\n    \n        file = this.request( 'get-file', file );\n    \n        // 只预览图片格式。\n        if ( !file.type.match( /^image/ ) ) {\n          cb( true );\n          return;\n        }\n    \n        opts = $.extend({}, this.options.thumb );\n    \n        // 如果传入的是object.\n        if ( $.isPlainObject( width ) ) {\n          opts = $.extend( opts, width );\n          width = null;\n        }\n    \n        width = width || opts.width;\n        height = height || opts.height;\n    \n        image = new Image( opts );\n    \n        image.once( 'load', function() {\n          file._info = file._info || image.info();\n          file._meta = file._meta || image.meta();\n    \n          // 如果 width 的值介于 0 - 1\n          // 说明设置的是百分比。\n          if ( width <= 1 && width > 0 ) {\n            width = file._info.width * width;\n          }\n    \n          // 同样的规则应用于 height\n          if ( height <= 1 && height > 0 ) {\n            height = file._info.height * height;\n          }\n    \n          image.resize( width, height );\n        });\n    \n        // 当 resize 完后\n        image.once( 'complete', function() {\n          cb( false, image.getAsDataUrl( opts.type ) );\n          image.destroy();\n        });\n    \n        image.once( 'error', function( reason ) {\n          cb( reason || true );\n          image.destroy();\n        });\n    \n        throttle( image, file.source.size, function() {\n          file._info && image.info( file._info );\n          file._meta && image.meta( file._meta );\n          image.loadFromBlob( file.source );\n        });\n      },\n    \n      beforeSendFile: function( file ) {\n        var opts = this.options.compress || this.options.resize,\n          compressSize = opts && opts.compressSize || 0,\n          noCompressIfLarger = opts && opts.noCompressIfLarger || false,\n          image, deferred;\n    \n        file = this.request( 'get-file', file );\n    \n        // 只压缩 jpeg 图片格式。\n        // gif 可能会丢失针\n        // bmp png 基本上尺寸都不大，且压缩比比较小。\n        if ( !opts || !~'image/jpeg,image/jpg'.indexOf( file.type ) ||\n                        file.size < compressSize ||\n                        file._compressed ) {\n          return;\n        }\n    \n        opts = $.extend({}, opts );\n        deferred = Base.Deferred();\n    \n        image = new Image( opts );\n    \n        deferred.always(function() {\n          image.destroy();\n          image = null;\n        });\n        image.once( 'error', deferred.reject );\n        image.once( 'load', function() {\n          var width = opts.width,\n            height = opts.height;\n    \n          file._info = file._info || image.info();\n          file._meta = file._meta || image.meta();\n    \n          // 如果 width 的值介于 0 - 1\n          // 说明设置的是百分比。\n          if ( width <= 1 && width > 0 ) {\n            width = file._info.width * width;\n          }\n    \n          // 同样的规则应用于 height\n          if ( height <= 1 && height > 0 ) {\n            height = file._info.height * height;\n          }\n    \n          image.resize( width, height );\n        });\n    \n        image.once( 'complete', function() {\n          var blob, size;\n    \n          // 移动端 UC / qq 浏览器的无图模式下\n          // ctx.getImageData 处理大图的时候会报 Exception\n          // INDEX_SIZE_ERR: DOM Exception 1\n          try {\n            blob = image.getAsBlob( opts.type );\n    \n            size = file.size;\n    \n            // 如果压缩后，比原来还大则不用压缩后的。\n            if ( !noCompressIfLarger || blob.size < size ) {\n              // file.source.destroy && file.source.destroy();\n              file.source = blob;\n              file.size = blob.size;\n    \n              file.trigger( 'resize', blob.size, size );\n            }\n    \n            // 标记，避免重复压缩。\n            file._compressed = true;\n            deferred.resolve();\n          } catch ( e ) {\n            // 出错了直接继续，让其上传原始图片\n            deferred.resolve();\n          }\n        });\n    \n        file._info && image.info( file._info );\n        file._meta && image.meta( file._meta );\n    \n        image.loadFromBlob( file.source );\n        return deferred.promise();\n      }\n    });\n  });\n  /**\n     * @fileOverview 文件属性封装\n     */\n  define('file',[\n    'base',\n    'mediator'\n  ], function( Base, Mediator ) {\n    \n    var $ = Base.$,\n      idPrefix = 'WU_FILE_',\n      idSuffix = 0,\n      rExt = /\\.([^.]+)$/,\n      statusMap = {};\n    \n    function gid() {\n      return idPrefix + idSuffix++;\n    }\n    \n    /**\n         * 文件类\n         * @class File\n         * @constructor 构造函数\n         * @grammar new File( source ) => File\n         * @param {Lib.File} source [lib.File](#Lib.File)实例, 此source对象是带有Runtime信息的。\n         */\n    function WUFile( source ) {\n    \n      /**\n             * 文件名，包括扩展名（后缀）\n             * @property name\n             * @type {string}\n             */\n      this.name = source.name || 'Untitled';\n    \n      /**\n             * 文件体积（字节）\n             * @property size\n             * @type {uint}\n             * @default 0\n             */\n      this.size = source.size || 0;\n    \n      /**\n             * 文件MIMETYPE类型，与文件类型的对应关系请参考[http://t.cn/z8ZnFny](http://t.cn/z8ZnFny)\n             * @property type\n             * @type {string}\n             * @default 'application/octet-stream'\n             */\n      this.type = source.type || 'application/octet-stream';\n    \n      /**\n             * 文件最后修改日期\n             * @property lastModifiedDate\n             * @type {int}\n             * @default 当前时间戳\n             */\n      this.lastModifiedDate = source.lastModifiedDate || (new Date() * 1);\n    \n      /**\n             * 文件ID，每个对象具有唯一ID，与文件名无关\n             * @property id\n             * @type {string}\n             */\n      this.id = gid();\n    \n      /**\n             * 文件扩展名，通过文件名获取，例如test.png的扩展名为png\n             * @property ext\n             * @type {string}\n             */\n      this.ext = rExt.exec( this.name ) ? RegExp.$1 : '';\n    \n    \n      /**\n             * 状态文字说明。在不同的status语境下有不同的用途。\n             * @property statusText\n             * @type {string}\n             */\n      this.statusText = '';\n    \n      // 存储文件状态，防止通过属性直接修改\n      statusMap[ this.id ] = WUFile.Status.INITED;\n    \n      this.source = source;\n      this.loaded = 0;\n    \n      this.on( 'error', function( msg ) {\n        this.setStatus( WUFile.Status.ERROR, msg );\n      });\n    }\n    \n    $.extend( WUFile.prototype, {\n    \n      /**\n             * 设置状态，状态变化时会触发`change`事件。\n             * @method setStatus\n             * @grammar setStatus( status[, statusText] );\n             * @param {File.Status|String} status [文件状态值](#WebUploader:File:File.Status)\n             * @param {String} [statusText=''] 状态说明，常在error时使用，用http, abort,server等来标记是由于什么原因导致文件错误。\n             */\n      setStatus: function( status, text ) {\n    \n        var prevStatus = statusMap[ this.id ];\n    \n        typeof text !== 'undefined' && (this.statusText = text);\n    \n        if ( status !== prevStatus ) {\n          statusMap[ this.id ] = status;\n          /**\n                     * 文件状态变化\n                     * @event statuschange\n                     */\n          this.trigger( 'statuschange', status, prevStatus );\n        }\n    \n      },\n    \n      /**\n             * 获取文件状态\n             * @return {File.Status}\n             * @example\n                     文件状态具体包括以下几种类型：\n                     {\n                         // 初始化\n                        INITED:     0,\n                        // 已入队列\n                        QUEUED:     1,\n                        // 正在上传\n                        PROGRESS:     2,\n                        // 上传出错\n                        ERROR:         3,\n                        // 上传成功\n                        COMPLETE:     4,\n                        // 上传取消\n                        CANCELLED:     5\n                    }\n             */\n      getStatus: function() {\n        return statusMap[ this.id ];\n      },\n    \n      /**\n             * 获取文件原始信息。\n             * @return {*}\n             */\n      getSource: function() {\n        return this.source;\n      },\n    \n      destroy: function() {\n        this.off();\n        delete statusMap[ this.id ];\n      }\n    });\n    \n    Mediator.installTo( WUFile.prototype );\n    \n    /**\n         * 文件状态值，具体包括以下几种类型：\n         * * `inited` 初始状态\n         * * `queued` 已经进入队列, 等待上传\n         * * `progress` 上传中\n         * * `complete` 上传完成。\n         * * `error` 上传出错，可重试\n         * * `interrupt` 上传中断，可续传。\n         * * `invalid` 文件不合格，不能重试上传。会自动从队列中移除。\n         * * `cancelled` 文件被移除。\n         * @property {Object} Status\n         * @namespace File\n         * @class File\n         * @static\n         */\n    WUFile.Status = {\n      INITED:     'inited',    // 初始状态\n      QUEUED:     'queued',    // 已经进入队列, 等待上传\n      PROGRESS:   'progress',    // 上传中\n      ERROR:      'error',    // 上传出错，可重试\n      COMPLETE:   'complete',    // 上传完成。\n      CANCELLED:  'cancelled',    // 上传取消。\n      INTERRUPT:  'interrupt',    // 上传中断，可续传。\n      INVALID:    'invalid'    // 文件不合格，不能重试上传。\n    };\n    \n    return WUFile;\n  });\n    \n  /**\n     * @fileOverview 文件队列\n     */\n  define('queue',[\n    'base',\n    'mediator',\n    'file'\n  ], function( Base, Mediator, WUFile ) {\n    \n    var $ = Base.$,\n      STATUS = WUFile.Status;\n    \n    /**\n         * 文件队列, 用来存储各个状态中的文件。\n         * @class Queue\n         * @extends Mediator\n         */\n    function Queue() {\n    \n      /**\n             * 统计文件数。\n             * * `numOfQueue` 队列中的文件数。\n             * * `numOfSuccess` 上传成功的文件数\n             * * `numOfCancel` 被取消的文件数\n             * * `numOfProgress` 正在上传中的文件数\n             * * `numOfUploadFailed` 上传错误的文件数。\n             * * `numOfInvalid` 无效的文件数。\n             * * `numofDeleted` 被移除的文件数。\n             * @property {Object} stats\n             */\n      this.stats = {\n        numOfQueue: 0,\n        numOfSuccess: 0,\n        numOfCancel: 0,\n        numOfProgress: 0,\n        numOfUploadFailed: 0,\n        numOfInvalid: 0,\n        numofDeleted: 0,\n        numofInterrupt: 0\n      };\n    \n      // 上传队列，仅包括等待上传的文件\n      this._queue = [];\n    \n      // 存储所有文件\n      this._map = {};\n    }\n    \n    $.extend( Queue.prototype, {\n    \n      /**\n             * 将新文件加入对队列尾部\n             *\n             * @method append\n             * @param  {File} file   文件对象\n             */\n      append: function( file ) {\n        this._queue.push( file );\n        this._fileAdded( file );\n        return this;\n      },\n    \n      /**\n             * 将新文件加入对队列头部\n             *\n             * @method prepend\n             * @param  {File} file   文件对象\n             */\n      prepend: function( file ) {\n        this._queue.unshift( file );\n        this._fileAdded( file );\n        return this;\n      },\n    \n      /**\n             * 获取文件对象\n             *\n             * @method getFile\n             * @param  {String} fileId   文件ID\n             * @return {File}\n             */\n      getFile: function( fileId ) {\n        if ( typeof fileId !== 'string' ) {\n          return fileId;\n        }\n        return this._map[ fileId ];\n      },\n    \n      /**\n             * 从队列中取出一个指定状态的文件。\n             * @grammar fetch( status ) => File\n             * @method fetch\n             * @param {String} status [文件状态值](#WebUploader:File:File.Status)\n             * @return {File} [File](#WebUploader:File)\n             */\n      fetch: function( status ) {\n        var len = this._queue.length,\n          i, file;\n    \n        status = status || STATUS.QUEUED;\n    \n        for ( i = 0; i < len; i++ ) {\n          file = this._queue[ i ];\n    \n          if ( status === file.getStatus() ) {\n            return file;\n          }\n        }\n    \n        return null;\n      },\n    \n      /**\n             * 对队列进行排序，能够控制文件上传顺序。\n             * @grammar sort( fn ) => undefined\n             * @method sort\n             * @param {Function} fn 排序方法\n             */\n      sort: function( fn ) {\n        if ( typeof fn === 'function' ) {\n          this._queue.sort( fn );\n        }\n      },\n    \n      /**\n             * 获取指定类型的文件列表, 列表中每一个成员为[File](#WebUploader:File)对象。\n             * @grammar getFiles( [status1[, status2 ...]] ) => Array\n             * @method getFiles\n             * @param {String} [status] [文件状态值](#WebUploader:File:File.Status)\n             */\n      getFiles: function() {\n        var sts = [].slice.call( arguments, 0 ),\n          ret = [],\n          i = 0,\n          len = this._queue.length,\n          file;\n    \n        for ( ; i < len; i++ ) {\n          file = this._queue[ i ];\n    \n          if ( sts.length && !~$.inArray( file.getStatus(), sts ) ) {\n            continue;\n          }\n    \n          ret.push( file );\n        }\n    \n        return ret;\n      },\n    \n      /**\n             * 在队列中删除文件。\n             * @grammar removeFile( file ) => Array\n             * @method removeFile\n             * @param {File} 文件对象。\n             */\n      removeFile: function( file ) {\n        var me = this,\n          existing = this._map[ file.id ];\n    \n        if ( existing ) {\n          delete this._map[ file.id ];\n          file.destroy();\n          this.stats.numofDeleted++;\n        }\n      },\n    \n      _fileAdded: function( file ) {\n        var me = this,\n          existing = this._map[ file.id ];\n    \n        if ( !existing ) {\n          this._map[ file.id ] = file;\n    \n          file.on( 'statuschange', function( cur, pre ) {\n            me._onFileStatusChange( cur, pre );\n          });\n        }\n      },\n    \n      _onFileStatusChange: function( curStatus, preStatus ) {\n        var stats = this.stats;\n    \n        switch ( preStatus ) {\n        case STATUS.PROGRESS:\n          stats.numOfProgress--;\n          break;\n    \n        case STATUS.QUEUED:\n          stats.numOfQueue --;\n          break;\n    \n        case STATUS.ERROR:\n          stats.numOfUploadFailed--;\n          break;\n    \n        case STATUS.INVALID:\n          stats.numOfInvalid--;\n          break;\n    \n        case STATUS.INTERRUPT:\n          stats.numofInterrupt--;\n          break;\n        }\n    \n        switch ( curStatus ) {\n        case STATUS.QUEUED:\n          stats.numOfQueue++;\n          break;\n    \n        case STATUS.PROGRESS:\n          stats.numOfProgress++;\n          break;\n    \n        case STATUS.ERROR:\n          stats.numOfUploadFailed++;\n          break;\n    \n        case STATUS.COMPLETE:\n          stats.numOfSuccess++;\n          break;\n    \n        case STATUS.CANCELLED:\n          stats.numOfCancel++;\n          break;\n    \n    \n        case STATUS.INVALID:\n          stats.numOfInvalid++;\n          break;\n    \n        case STATUS.INTERRUPT:\n          stats.numofInterrupt++;\n          break;\n        }\n      }\n    \n    });\n    \n    Mediator.installTo( Queue.prototype );\n    \n    return Queue;\n  });\n  /**\n     * @fileOverview 队列\n     */\n  define('widgets/queue',[\n    'base',\n    'uploader',\n    'queue',\n    'file',\n    'lib/file',\n    'runtime/client',\n    'widgets/widget'\n  ], function( Base, Uploader, Queue, WUFile, File, RuntimeClient ) {\n    \n    var $ = Base.$,\n      rExt = /\\.\\w+$/,\n      Status = WUFile.Status;\n    \n    return Uploader.register({\n      name: 'queue',\n    \n      init: function( opts ) {\n        var me = this,\n          deferred, len, i, item, arr, accept, runtime;\n    \n        if ( $.isPlainObject( opts.accept ) ) {\n          opts.accept = [ opts.accept ];\n        }\n    \n        // accept中的中生成匹配正则。\n        if ( opts.accept ) {\n          arr = [];\n    \n          for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n            item = opts.accept[ i ].extensions;\n            item && arr.push( item );\n          }\n    \n          if ( arr.length ) {\n            accept = '\\\\.' + arr.join(',')\n              .replace( /,/g, '$|\\\\.' )\n              .replace( /\\*/g, '.*' ) + '$';\n          }\n    \n          me.accept = new RegExp( accept, 'i' );\n        }\n    \n        me.queue = new Queue();\n        me.stats = me.queue.stats;\n    \n        // 如果当前不是html5运行时，那就算了。\n        // 不执行后续操作\n        if ( this.request('predict-runtime-type') !== 'html5' ) {\n          return;\n        }\n    \n        // 创建一个 html5 运行时的 placeholder\n        // 以至于外部添加原生 File 对象的时候能正确包裹一下供 webuploader 使用。\n        deferred = Base.Deferred();\n        this.placeholder = runtime = new RuntimeClient('Placeholder');\n        runtime.connectRuntime({\n          runtimeOrder: 'html5'\n        }, function() {\n          me._ruid = runtime.getRuid();\n          deferred.resolve();\n        });\n        return deferred.promise();\n      },\n    \n    \n      // 为了支持外部直接添加一个原生File对象。\n      _wrapFile: function( file ) {\n        if ( !(file instanceof WUFile) ) {\n    \n          if ( !(file instanceof File) ) {\n            if ( !this._ruid ) {\n              throw new Error('Can\\'t add external files.');\n            }\n            file = new File( this._ruid, file );\n          }\n    \n          file = new WUFile( file );\n        }\n    \n        return file;\n      },\n    \n      // 判断文件是否可以被加入队列\n      acceptFile: function( file ) {\n        var invalid = !file || !file.size || this.accept &&\n    \n                        // 如果名字中有后缀，才做后缀白名单处理。\n                        rExt.exec( file.name ) && !this.accept.test( file.name );\n    \n        return !invalid;\n      },\n    \n    \n      /**\n             * @event beforeFileQueued\n             * @param {File} file File对象\n             * @description 当文件被加入队列之前触发，此事件的handler返回值为`false`，则此文件不会被添加进入队列。\n             * @for  Uploader\n             */\n    \n      /**\n             * @event fileQueued\n             * @param {File} file File对象\n             * @description 当文件被加入队列以后触发。\n             * @for  Uploader\n             */\n    \n      _addFile: function( file ) {\n        var me = this;\n    \n        file = me._wrapFile( file );\n    \n        // 不过类型判断允许不允许，先派送 `beforeFileQueued`\n        if ( !me.owner.trigger( 'beforeFileQueued', file ) ) {\n          return;\n        }\n    \n        // 类型不匹配，则派送错误事件，并返回。\n        if ( !me.acceptFile( file ) ) {\n          me.owner.trigger( 'error', 'Q_TYPE_DENIED', file );\n          return;\n        }\n    \n        me.queue.append( file );\n        me.owner.trigger( 'fileQueued', file );\n        return file;\n      },\n    \n      getFile: function( fileId ) {\n        return this.queue.getFile( fileId );\n      },\n    \n      /**\n             * @event filesQueued\n             * @param {File} files 数组，内容为原始File(lib/File）对象。\n             * @description 当一批文件添加进队列以后触发。\n             * @for  Uploader\n             */\n            \n      /**\n             * @property {Boolean} [auto=false]\n             * @namespace options\n             * @for Uploader\n             * @description 设置为 true 后，不需要手动调用上传，有文件选择即开始上传。\n             * \n             */\n    \n      /**\n             * @method addFiles\n             * @grammar addFiles( file ) => undefined\n             * @grammar addFiles( [file1, file2 ...] ) => undefined\n             * @param {Array of File or File} [files] Files 对象 数组\n             * @description 添加文件到队列\n             * @for  Uploader\n             */\n      addFile: function( files ) {\n        var me = this;\n    \n        if ( !files.length ) {\n          files = [ files ];\n        }\n    \n        files = $.map( files, function( file ) {\n          return me._addFile( file );\n        });\n    \n        me.owner.trigger( 'filesQueued', files );\n    \n        if ( me.options.auto ) {\n          setTimeout(function() {\n            me.request('start-upload');\n          }, 20 );\n        }\n      },\n    \n      getStats: function() {\n        return this.stats;\n      },\n    \n      /**\n             * @event fileDequeued\n             * @param {File} file File对象\n             * @description 当文件被移除队列后触发。\n             * @for  Uploader\n             */\n    \n      /**\n             * @method removeFile\n             * @grammar removeFile( file ) => undefined\n             * @grammar removeFile( id ) => undefined\n             * @grammar removeFile( file, true ) => undefined\n             * @grammar removeFile( id, true ) => undefined\n             * @param {File|id} file File对象或这File对象的id\n             * @description 移除某一文件, 默认只会标记文件状态为已取消，如果第二个参数为 `true` 则会从 queue 中移除。\n             * @for  Uploader\n             * @example\n             *\n             * $li.on('click', '.remove-this', function() {\n             *     uploader.removeFile( file );\n             * })\n             */\n      removeFile: function( file, remove ) {\n        var me = this;\n    \n        file = file.id ? file : me.queue.getFile( file );\n    \n        this.request( 'cancel-file', file );\n    \n        if ( remove ) {\n          this.queue.removeFile( file );\n        }\n      },\n    \n      /**\n             * @method getFiles\n             * @grammar getFiles() => Array\n             * @grammar getFiles( status1, status2, status... ) => Array\n             * @description 返回指定状态的文件集合，不传参数将返回所有状态的文件。\n             * @for  Uploader\n             * @example\n             * console.log( uploader.getFiles() );    // => all files\n             * console.log( uploader.getFiles('error') )    // => all error files.\n             */\n      getFiles: function() {\n        return this.queue.getFiles.apply( this.queue, arguments );\n      },\n    \n      fetchFile: function() {\n        return this.queue.fetch.apply( this.queue, arguments );\n      },\n    \n      /**\n             * @method retry\n             * @grammar retry() => undefined\n             * @grammar retry( file ) => undefined\n             * @description 重试上传，重试指定文件，或者从出错的文件开始重新上传。\n             * @for  Uploader\n             * @example\n             * function retry() {\n             *     uploader.retry();\n             * }\n             */\n      retry: function( file, noForceStart ) {\n        var me = this,\n          files, i, len;\n    \n        if ( file ) {\n          file = file.id ? file : me.queue.getFile( file );\n          file.setStatus( Status.QUEUED );\n          noForceStart || me.request('start-upload');\n          return;\n        }\n    \n        files = me.queue.getFiles( Status.ERROR );\n        i = 0;\n        len = files.length;\n    \n        for ( ; i < len; i++ ) {\n          file = files[ i ];\n          file.setStatus( Status.QUEUED );\n        }\n    \n        me.request('start-upload');\n      },\n    \n      /**\n             * @method sort\n             * @grammar sort( fn ) => undefined\n             * @description 排序队列中的文件，在上传之前调整可以控制上传顺序。\n             * @for  Uploader\n             */\n      sortFiles: function() {\n        return this.queue.sort.apply( this.queue, arguments );\n      },\n    \n      /**\n             * @event reset\n             * @description 当 uploader 被重置的时候触发。\n             * @for  Uploader\n             */\n    \n      /**\n             * @method reset\n             * @grammar reset() => undefined\n             * @description 重置uploader。目前只重置了队列。\n             * @for  Uploader\n             * @example\n             * uploader.reset();\n             */\n      reset: function() {\n        this.owner.trigger('reset');\n        this.queue = new Queue();\n        this.stats = this.queue.stats;\n      },\n    \n      destroy: function() {\n        this.reset();\n        this.placeholder && this.placeholder.destroy();\n      }\n    });\n    \n  });\n  /**\n     * @fileOverview 添加获取Runtime相关信息的方法。\n     */\n  define('widgets/runtime',[\n    'uploader',\n    'runtime/runtime',\n    'widgets/widget'\n  ], function( Uploader, Runtime ) {\n    \n    Uploader.support = function() {\n      return Runtime.hasRuntime.apply( Runtime, arguments );\n    };\n    \n    /**\n         * @property {Object} [runtimeOrder=html5,flash]\n         * @namespace options\n         * @for Uploader\n         * @description 指定运行时启动顺序。默认会想尝试 html5 是否支持，如果支持则使用 html5, 否则则使用 flash.\n         *\n         * 可以将此值设置成 `flash`，来强制使用 flash 运行时。\n         */\n    \n    return Uploader.register({\n      name: 'runtime',\n    \n      init: function() {\n        if ( !this.predictRuntimeType() ) {\n          throw Error('Runtime Error');\n        }\n      },\n    \n      /**\n             * 预测Uploader将采用哪个`Runtime`\n             * @grammar predictRuntimeType() => String\n             * @method predictRuntimeType\n             * @for  Uploader\n             */\n      predictRuntimeType: function() {\n        var orders = this.options.runtimeOrder || Runtime.orders,\n          type = this.type,\n          i, len;\n    \n        if ( !type ) {\n          orders = orders.split( /\\s*,\\s*/g );\n    \n          for ( i = 0, len = orders.length; i < len; i++ ) {\n            if ( Runtime.hasRuntime( orders[ i ] ) ) {\n              this.type = type = orders[ i ];\n              break;\n            }\n          }\n        }\n    \n        return type;\n      }\n    });\n  });\n  /**\n     * @fileOverview Transport\n     */\n  define('lib/transport',[\n    'base',\n    'runtime/client',\n    'mediator'\n  ], function( Base, RuntimeClient, Mediator ) {\n    \n    var $ = Base.$;\n    \n    function Transport( opts ) {\n      var me = this;\n    \n      opts = me.options = $.extend( true, {}, Transport.options, opts || {} );\n      RuntimeClient.call( this, 'Transport' );\n    \n      this._blob = null;\n      this._formData = opts.formData || {};\n      this._headers = opts.headers || {};\n    \n      this.on( 'progress', this._timeout );\n      this.on( 'load error', function() {\n        me.trigger( 'progress', 1 );\n        clearTimeout( me._timer );\n      });\n    }\n    \n    Transport.options = {\n      server: '',\n      method: 'POST',\n    \n      // 跨域时，是否允许携带cookie, 只有html5 runtime才有效\n      withCredentials: false,\n      fileVal: 'file',\n      timeout: 2 * 60 * 1000,    // 2分钟\n      formData: {},\n      headers: {},\n      sendAsBinary: false\n    };\n    \n    $.extend( Transport.prototype, {\n    \n      // 添加Blob, 只能添加一次，最后一次有效。\n      appendBlob: function( key, blob, filename ) {\n        var me = this,\n          opts = me.options;\n    \n        if ( me.getRuid() ) {\n          me.disconnectRuntime();\n        }\n    \n        // 连接到blob归属的同一个runtime.\n        me.connectRuntime( blob.ruid, function() {\n          me.exec('init');\n        });\n    \n        me._blob = blob;\n        opts.fileVal = key || opts.fileVal;\n        opts.filename = filename || opts.filename;\n      },\n    \n      // 添加其他字段\n      append: function( key, value ) {\n        if ( typeof key === 'object' ) {\n          $.extend( this._formData, key );\n        } else {\n          this._formData[ key ] = value;\n        }\n      },\n    \n      setRequestHeader: function( key, value ) {\n        if ( typeof key === 'object' ) {\n          $.extend( this._headers, key );\n        } else {\n          this._headers[ key ] = value;\n        }\n      },\n    \n      send: function( method ) {\n        this.exec( 'send', method );\n        this._timeout();\n      },\n    \n      abort: function() {\n        clearTimeout( this._timer );\n        return this.exec('abort');\n      },\n    \n      destroy: function() {\n        this.trigger('destroy');\n        this.off();\n        this.exec('destroy');\n        this.disconnectRuntime();\n      },\n    \n      getResponse: function() {\n        return this.exec('getResponse');\n      },\n    \n      getResponseAsJson: function() {\n        return this.exec('getResponseAsJson');\n      },\n    \n      getStatus: function() {\n        return this.exec('getStatus');\n      },\n    \n      _timeout: function() {\n        var me = this,\n          duration = me.options.timeout;\n    \n        if ( !duration ) {\n          return;\n        }\n    \n        clearTimeout( me._timer );\n        me._timer = setTimeout(function() {\n          me.abort();\n          me.trigger( 'error', 'timeout' );\n        }, duration );\n      }\n    \n    });\n    \n    // 让Transport具备事件功能。\n    Mediator.installTo( Transport.prototype );\n    \n    return Transport;\n  });\n  /**\n     * @fileOverview 负责文件上传相关。\n     */\n  define('widgets/upload',[\n    'base',\n    'uploader',\n    'file',\n    'lib/transport',\n    'widgets/widget'\n  ], function( Base, Uploader, WUFile, Transport ) {\n    \n    var $ = Base.$,\n      isPromise = Base.isPromise,\n      Status = WUFile.Status;\n    \n    // 添加默认配置项\n    $.extend( Uploader.options, {\n    \n    \n      /**\n             * @property {Boolean} [prepareNextFile=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否允许在文件传输时提前把下一个文件准备好。\n             * 对于一个文件的准备工作比较耗时，比如图片压缩，md5序列化。\n             * 如果能提前在当前文件传输期处理，可以节省总体耗时。\n             */\n      prepareNextFile: false,\n    \n      /**\n             * @property {Boolean} [chunked=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否要分片处理大文件上传。\n             */\n      chunked: false,\n    \n      /**\n             * @property {Boolean} [chunkSize=5242880]\n             * @namespace options\n             * @for Uploader\n             * @description 如果要分片，分多大一片？ 默认大小为5M.\n             */\n      chunkSize: 5 * 1024 * 1024,\n    \n      /**\n             * @property {Boolean} [chunkRetry=2]\n             * @namespace options\n             * @for Uploader\n             * @description 如果某个分片由于网络问题出错，允许自动重传多少次？\n             */\n      chunkRetry: 2,\n    \n      /**\n             * @property {Boolean} [threads=3]\n             * @namespace options\n             * @for Uploader\n             * @description 上传并发数。允许同时最大上传进程数。\n             */\n      threads: 3,\n    \n    \n      /**\n             * @property {Object} [formData={}]\n             * @namespace options\n             * @for Uploader\n             * @description 文件上传请求的参数表，每次发送都会发送此对象中的参数。\n             */\n      formData: {}\n    \n      /**\n             * @property {Object} [fileVal='file']\n             * @namespace options\n             * @for Uploader\n             * @description 设置文件上传域的name。\n             */\n    \n      /**\n             * @property {Object} [method='POST']\n             * @namespace options\n             * @for Uploader\n             * @description 文件上传方式，`POST`或者`GET`。\n             */\n    \n      /**\n             * @property {Object} [sendAsBinary=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否已二进制的流的方式发送文件，这样整个上传内容`php://input`都为文件内容，\n             * 其他参数在$_GET数组中。\n             */\n    });\n    \n    // 负责将文件切片。\n    function CuteFile( file, chunkSize ) {\n      var pending = [],\n        blob = file.source,\n        total = blob.size,\n        chunks = chunkSize ? Math.ceil( total / chunkSize ) : 1,\n        start = 0,\n        index = 0,\n        len, api;\n    \n      api = {\n        file: file,\n    \n        has: function() {\n          return !!pending.length;\n        },\n    \n        shift: function() {\n          return pending.shift();\n        },\n    \n        unshift: function( block ) {\n          pending.unshift( block );\n        }\n      };\n    \n      while ( index < chunks ) {\n        len = Math.min( chunkSize, total - start );\n    \n        pending.push({\n          file: file,\n          start: start,\n          end: chunkSize ? (start + len) : total,\n          total: total,\n          chunks: chunks,\n          chunk: index++,\n          cuted: api\n        });\n        start += len;\n      }\n    \n      file.blocks = pending.concat();\n      file.remaning = pending.length;\n    \n      return api;\n    }\n    \n    Uploader.register({\n      name: 'upload',\n    \n      init: function() {\n        var owner = this.owner,\n          me = this;\n    \n        this.runing = false;\n        this.progress = false;\n    \n        owner\n          .on( 'startUpload', function() {\n            me.progress = true;\n          })\n          .on( 'uploadFinished', function() {\n            me.progress = false;\n          });\n    \n        // 记录当前正在传的数据，跟threads相关\n        this.pool = [];\n    \n        // 缓存分好片的文件。\n        this.stack = [];\n    \n        // 缓存即将上传的文件。\n        this.pending = [];\n    \n        // 跟踪还有多少分片在上传中但是没有完成上传。\n        this.remaning = 0;\n        this.__tick = Base.bindFn( this._tick, this );\n    \n        owner.on( 'uploadComplete', function( file ) {\n    \n          // 把其他块取消了。\n          file.blocks && $.each( file.blocks, function( _, v ) {\n            v.transport && (v.transport.abort(), v.transport.destroy());\n            delete v.transport;\n          });\n    \n          delete file.blocks;\n          delete file.remaning;\n        });\n      },\n    \n      reset: function() {\n        this.request( 'stop-upload', true );\n        this.runing = false;\n        this.pool = [];\n        this.stack = [];\n        this.pending = [];\n        this.remaning = 0;\n        this._trigged = false;\n        this._promise = null;\n      },\n    \n      /**\n             * @event startUpload\n             * @description 当开始上传流程时触发。\n             * @for  Uploader\n             */\n    \n      /**\n             * 开始上传。此方法可以从初始状态调用开始上传流程，也可以从暂停状态调用，继续上传流程。\n             *\n             * 可以指定开始某一个文件。\n             * @grammar upload() => undefined\n             * @grammar upload( file | fileId) => undefined\n             * @method upload\n             * @for  Uploader\n             */\n      startUpload: function(file) {\n        var me = this;\n    \n        // 移出invalid的文件\n        $.each( me.request( 'get-files', Status.INVALID ), function() {\n          me.request( 'remove-file', this );\n        });\n    \n        // 如果指定了开始某个文件，则只开始指定文件。\n        if ( file ) {\n          file = file.id ? file : me.request( 'get-file', file );\n    \n          if (file.getStatus() === Status.INTERRUPT) {\n            $.each( me.pool, function( _, v ) {\n    \n              // 之前暂停过。\n              if (v.file !== file) {\n                return;\n              }\n    \n              v.transport && v.transport.send();\n            });\n    \n            file.setStatus( Status.QUEUED );\n          } else if (file.getStatus() === Status.PROGRESS) {\n            return;\n          } else {\n            file.setStatus( Status.QUEUED );\n          }\n        } else {\n          $.each( me.request( 'get-files', [ Status.INITED ] ), function() {\n            this.setStatus( Status.QUEUED );\n          });\n        }\n    \n        if ( me.runing ) {\n          return;\n        }\n    \n        me.runing = true;\n    \n        var files = [];\n    \n        // 如果有暂停的，则续传\n        $.each( me.pool, function( _, v ) {\n          var file = v.file;\n    \n          if ( file.getStatus() === Status.INTERRUPT ) {\n            files.push(file);\n            me._trigged = false;\n            v.transport && v.transport.send();\n          }\n        });\n    \n        var file;\n        while ( (file = files.shift()) ) {\n          file.setStatus( Status.PROGRESS );\n        }\n    \n        file || $.each( me.request( 'get-files',\n          Status.INTERRUPT ), function() {\n          this.setStatus( Status.PROGRESS );\n        });\n    \n        me._trigged = false;\n        Base.nextTick( me.__tick );\n        me.owner.trigger('startUpload');\n      },\n    \n      /**\n             * @event stopUpload\n             * @description 当开始上传流程暂停时触发。\n             * @for  Uploader\n             */\n    \n      /**\n             * 暂停上传。第一个参数为是否中断上传当前正在上传的文件。\n             *\n             * 如果第一个参数是文件，则只暂停指定文件。\n             * @grammar stop() => undefined\n             * @grammar stop( true ) => undefined\n             * @grammar stop( file ) => undefined\n             * @method stop\n             * @for  Uploader\n             */\n      stopUpload: function( file, interrupt ) {\n        var me = this;\n    \n        if (file === true) {\n          interrupt = file;\n          file = null;\n        }\n    \n        if ( me.runing === false ) {\n          return;\n        }\n    \n        // 如果只是暂停某个文件。\n        if ( file ) {\n          file = file.id ? file : me.request( 'get-file', file );\n    \n          if ( file.getStatus() !== Status.PROGRESS &&\n                            file.getStatus() !== Status.QUEUED ) {\n            return;\n          }\n    \n          file.setStatus( Status.INTERRUPT );\n          $.each( me.pool, function( _, v ) {\n    \n            // 只 abort 指定的文件。\n            if (v.file !== file) {\n              return;\n            }\n    \n            v.transport && v.transport.abort();\n            me._putback(v);\n            me._popBlock(v);\n          });\n    \n          return Base.nextTick( me.__tick );\n        }\n    \n        me.runing = false;\n    \n        if (this._promise && this._promise.file) {\n          this._promise.file.setStatus( Status.INTERRUPT );\n        }\n    \n        interrupt && $.each( me.pool, function( _, v ) {\n          v.transport && v.transport.abort();\n          v.file.setStatus( Status.INTERRUPT );\n        });\n    \n        me.owner.trigger('stopUpload');\n      },\n    \n      /**\n             * @method cancelFile\n             * @grammar cancelFile( file ) => undefined\n             * @grammar cancelFile( id ) => undefined\n             * @param {File|id} file File对象或这File对象的id\n             * @description 标记文件状态为已取消, 同时将中断文件传输。\n             * @for  Uploader\n             * @example\n             *\n             * $li.on('click', '.remove-this', function() {\n             *     uploader.cancelFile( file );\n             * })\n             */\n      cancelFile: function( file ) {\n        file = file.id ? file : this.request( 'get-file', file );\n    \n        // 如果正在上传。\n        file.blocks && $.each( file.blocks, function( _, v ) {\n          var _tr = v.transport;\n    \n          if ( _tr ) {\n            _tr.abort();\n            _tr.destroy();\n            delete v.transport;\n          }\n        });\n    \n        file.setStatus( Status.CANCELLED );\n        this.owner.trigger( 'fileDequeued', file );\n      },\n    \n      /**\n             * 判断`Uplaode`r是否正在上传中。\n             * @grammar isInProgress() => Boolean\n             * @method isInProgress\n             * @for  Uploader\n             */\n      isInProgress: function() {\n        return !!this.progress;\n      },\n    \n      _getStats: function() {\n        return this.request('get-stats');\n      },\n    \n      /**\n             * 掉过一个文件上传，直接标记指定文件为已上传状态。\n             * @grammar skipFile( file ) => undefined\n             * @method skipFile\n             * @for  Uploader\n             */\n      skipFile: function( file, status ) {\n        file = file.id ? file : this.request( 'get-file', file );\n    \n        file.setStatus( status || Status.COMPLETE );\n        file.skipped = true;\n    \n        // 如果正在上传。\n        file.blocks && $.each( file.blocks, function( _, v ) {\n          var _tr = v.transport;\n    \n          if ( _tr ) {\n            _tr.abort();\n            _tr.destroy();\n            delete v.transport;\n          }\n        });\n    \n        this.owner.trigger( 'uploadSkip', file );\n      },\n    \n      /**\n             * @event uploadFinished\n             * @description 当所有文件上传结束时触发。\n             * @for  Uploader\n             */\n      _tick: function() {\n        var me = this,\n          opts = me.options,\n          fn, val;\n    \n        // 上一个promise还没有结束，则等待完成后再执行。\n        if ( me._promise ) {\n          return me._promise.always( me.__tick );\n        }\n    \n        // 还有位置，且还有文件要处理的话。\n        if ( me.pool.length < opts.threads && (val = me._nextBlock()) ) {\n          me._trigged = false;\n    \n          fn = function( val ) {\n            me._promise = null;\n    \n            // 有可能是reject过来的，所以要检测val的类型。\n            val && val.file && me._startSend( val );\n            Base.nextTick( me.__tick );\n          };\n    \n          me._promise = isPromise( val ) ? val.always( fn ) : fn( val );\n    \n          // 没有要上传的了，且没有正在传输的了。\n        } else if ( !me.remaning && !me._getStats().numOfQueue &&\n                    !me._getStats().numofInterrupt ) {\n          me.runing = false;\n    \n          me._trigged || Base.nextTick(function() {\n            me.owner.trigger('uploadFinished');\n          });\n          me._trigged = true;\n        }\n      },\n    \n      _putback: function(block) {\n        var idx;\n    \n        block.cuted.unshift(block);\n        idx = this.stack.indexOf(block.cuted);\n    \n        if (!~idx) {\n          this.stack.unshift(block.cuted);\n        }\n      },\n    \n      _getStack: function() {\n        var i = 0,\n          act;\n    \n        while ( (act = this.stack[ i++ ]) ) {\n          if ( act.has() && act.file.getStatus() === Status.PROGRESS ) {\n            return act;\n          } else if (!act.has() ||\n                            act.file.getStatus() !== Status.PROGRESS &&\n                            act.file.getStatus() !== Status.INTERRUPT ) {\n    \n            // 把已经处理完了的，或者，状态为非 progress（上传中）、\n            // interupt（暂停中） 的移除。\n            this.stack.splice( --i, 1 );\n          }\n        }\n    \n        return null;\n      },\n    \n      _nextBlock: function() {\n        var me = this,\n          opts = me.options,\n          act, next, done, preparing;\n    \n        // 如果当前文件还有没有需要传输的，则直接返回剩下的。\n        if ( (act = this._getStack()) ) {\n    \n          // 是否提前准备下一个文件\n          if ( opts.prepareNextFile && !me.pending.length ) {\n            me._prepareNextFile();\n          }\n    \n          return act.shift();\n    \n          // 否则，如果正在运行，则准备下一个文件，并等待完成后返回下个分片。\n        } else if ( me.runing ) {\n    \n          // 如果缓存中有，则直接在缓存中取，没有则去queue中取。\n          if ( !me.pending.length && me._getStats().numOfQueue ) {\n            me._prepareNextFile();\n          }\n    \n          next = me.pending.shift();\n          done = function( file ) {\n            if ( !file ) {\n              return null;\n            }\n    \n            act = CuteFile( file, opts.chunked ? opts.chunkSize : 0 );\n            me.stack.push(act);\n            return act.shift();\n          };\n    \n          // 文件可能还在prepare中，也有可能已经完全准备好了。\n          if ( isPromise( next) ) {\n            preparing = next.file;\n            next = next[ next.pipe ? 'pipe' : 'then' ]( done );\n            next.file = preparing;\n            return next;\n          }\n    \n          return done( next );\n        }\n      },\n    \n    \n      /**\n             * @event uploadStart\n             * @param {File} file File对象\n             * @description 某个文件开始上传前触发，一个文件只会触发一次。\n             * @for  Uploader\n             */\n      _prepareNextFile: function() {\n        var me = this,\n          file = me.request('fetch-file'),\n          pending = me.pending,\n          promise;\n    \n        if ( file ) {\n          promise = me.request( 'before-send-file', file, function() {\n    \n            // 有可能文件被skip掉了。文件被skip掉后，状态坑定不是Queued.\n            if ( file.getStatus() === Status.PROGRESS ||\n                            file.getStatus() === Status.INTERRUPT ) {\n              return file;\n            }\n    \n            return me._finishFile( file );\n          });\n    \n          me.owner.trigger( 'uploadStart', file );\n          file.setStatus( Status.PROGRESS );\n    \n          promise.file = file;\n    \n          // 如果还在pending中，则替换成文件本身。\n          promise.done(function() {\n            var idx = $.inArray( promise, pending );\n    \n            ~idx && pending.splice( idx, 1, file );\n          });\n    \n          // befeore-send-file的钩子就有错误发生。\n          promise.fail(function( reason ) {\n            file.setStatus( Status.ERROR, reason );\n            me.owner.trigger( 'uploadError', file, reason );\n            me.owner.trigger( 'uploadComplete', file );\n          });\n    \n          pending.push( promise );\n        }\n      },\n    \n      // 让出位置了，可以让其他分片开始上传\n      _popBlock: function( block ) {\n        var idx = $.inArray( block, this.pool );\n    \n        this.pool.splice( idx, 1 );\n        block.file.remaning--;\n        this.remaning--;\n      },\n    \n      // 开始上传，可以被掉过。如果promise被reject了，则表示跳过此分片。\n      _startSend: function( block ) {\n        var me = this,\n          file = block.file,\n          promise;\n    \n        // 有可能在 before-send-file 的 promise 期间改变了文件状态。\n        // 如：暂停，取消\n        // 我们不能中断 promise, 但是可以在 promise 完后，不做上传操作。\n        if ( file.getStatus() !== Status.PROGRESS ) {\n    \n          // 如果是中断，则还需要放回去。\n          if (file.getStatus() === Status.INTERRUPT) {\n            me._putback(block);\n          }\n    \n          return;\n        }\n    \n        me.pool.push( block );\n        me.remaning++;\n    \n        // 如果没有分片，则直接使用原始的。\n        // 不会丢失content-type信息。\n        block.blob = block.chunks === 1 ? file.source :\n          file.source.slice( block.start, block.end );\n    \n        // hook, 每个分片发送之前可能要做些异步的事情。\n        promise = me.request( 'before-send', block, function() {\n    \n          // 有可能文件已经上传出错了，所以不需要再传输了。\n          if ( file.getStatus() === Status.PROGRESS ) {\n            me._doSend( block );\n          } else {\n            me._popBlock( block );\n            Base.nextTick( me.__tick );\n          }\n        });\n    \n        // 如果为fail了，则跳过此分片。\n        promise.fail(function() {\n          if ( file.remaning === 1 ) {\n            me._finishFile( file ).always(function() {\n              block.percentage = 1;\n              me._popBlock( block );\n              me.owner.trigger( 'uploadComplete', file );\n              Base.nextTick( me.__tick );\n            });\n          } else {\n            block.percentage = 1;\n            me.updateFileProgress( file );\n            me._popBlock( block );\n            Base.nextTick( me.__tick );\n          }\n        });\n      },\n    \n    \n      /**\n             * @event uploadBeforeSend\n             * @param {Object} object\n             * @param {Object} data 默认的上传参数，可以扩展此对象来控制上传参数。\n             * @param {Object} headers 可以扩展此对象来控制上传头部。\n             * @description 当某个文件的分块在发送前触发，主要用来询问是否要添加附带参数，大文件在开起分片上传的前提下此事件可能会触发多次。\n             * @for  Uploader\n             */\n    \n      /**\n             * @event uploadAccept\n             * @param {Object} object\n             * @param {Object} ret 服务端的返回数据，json格式，如果服务端不是json格式，从ret._raw中取数据，自行解析。\n             * @description 当某个文件上传到服务端响应后，会派送此事件来询问服务端响应是否有效。如果此事件handler返回值为`false`, 则此文件将派送`server`类型的`uploadError`事件。\n             * @for  Uploader\n             */\n    \n      /**\n             * @event uploadProgress\n             * @param {File} file File对象\n             * @param {Number} percentage 上传进度\n             * @description 上传过程中触发，携带上传进度。\n             * @for  Uploader\n             */\n    \n    \n      /**\n             * @event uploadError\n             * @param {File} file File对象\n             * @param {String} reason 出错的code\n             * @description 当文件上传出错时触发。\n             * @for  Uploader\n             */\n    \n      /**\n             * @event uploadSuccess\n             * @param {File} file File对象\n             * @param {Object} response 服务端返回的数据\n             * @description 当文件上传成功时触发。\n             * @for  Uploader\n             */\n    \n      /**\n             * @event uploadComplete\n             * @param {File} [file] File对象\n             * @description 不管成功或者失败，文件上传完成时触发。\n             * @for  Uploader\n             */\n    \n      // 做上传操作。\n      _doSend: function( block ) {\n        var me = this,\n          owner = me.owner,\n          opts = me.options,\n          file = block.file,\n          tr = new Transport( opts ),\n          data = $.extend({}, opts.formData ),\n          headers = $.extend({}, opts.headers ),\n          requestAccept, ret;\n    \n        block.transport = tr;\n    \n        tr.on( 'destroy', function() {\n          delete block.transport;\n          me._popBlock( block );\n          Base.nextTick( me.__tick );\n        });\n    \n        // 广播上传进度。以文件为单位。\n        tr.on( 'progress', function( percentage ) {\n          block.percentage = percentage;\n          me.updateFileProgress( file );\n        });\n    \n        // 用来询问，是否返回的结果是有错误的。\n        requestAccept = function( reject ) {\n          var fn;\n    \n          ret = tr.getResponseAsJson() || {};\n          ret._raw = tr.getResponse();\n          fn = function( value ) {\n            reject = value;\n          };\n    \n          // 服务端响应了，不代表成功了，询问是否响应正确。\n          if ( !owner.trigger( 'uploadAccept', block, ret, fn ) ) {\n            reject = reject || 'server';\n          }\n    \n          return reject;\n        };\n    \n        // 尝试重试，然后广播文件上传出错。\n        tr.on( 'error', function( type, flag ) {\n          block.retried = block.retried || 0;\n    \n          // 自动重试\n          if ( block.chunks > 1 && ~'http,abort'.indexOf( type ) &&\n                            block.retried < opts.chunkRetry ) {\n    \n            block.retried++;\n            tr.send();\n    \n          } else {\n    \n            // http status 500 ~ 600\n            if ( !flag && type === 'server' ) {\n              type = requestAccept( type );\n            }\n    \n            file.setStatus( Status.ERROR, type );\n            owner.trigger( 'uploadError', file, type );\n            owner.trigger( 'uploadComplete', file );\n          }\n        });\n    \n        // 上传成功\n        tr.on( 'load', function() {\n          var reason;\n    \n          // 如果非预期，转向上传出错。\n          if ( (reason = requestAccept()) ) {\n            tr.trigger( 'error', reason, true );\n            return;\n          }\n    \n          // 全部上传完成。\n          if ( file.remaning === 1 ) {\n            me._finishFile( file, ret );\n          } else {\n            tr.destroy();\n          }\n        });\n    \n        // 配置默认的上传字段。\n        data = $.extend( data, {\n          id: file.id,\n          name: file.name,\n          type: file.type,\n          lastModifiedDate: file.lastModifiedDate,\n          size: file.size\n        });\n    \n        block.chunks > 1 && $.extend( data, {\n          chunks: block.chunks,\n          chunk: block.chunk\n        });\n    \n        // 在发送之间可以添加字段什么的。。。\n        // 如果默认的字段不够使用，可以通过监听此事件来扩展\n        owner.trigger( 'uploadBeforeSend', block, data, headers );\n    \n        // 开始发送。\n        tr.appendBlob( opts.fileVal, block.blob, file.name );\n        tr.append( data );\n        tr.setRequestHeader( headers );\n        tr.send();\n      },\n    \n      // 完成上传。\n      _finishFile: function( file, ret, hds ) {\n        var owner = this.owner;\n    \n        return owner\n          .request( 'after-send-file', arguments, function() {\n            file.setStatus( Status.COMPLETE );\n            owner.trigger( 'uploadSuccess', file, ret, hds );\n          })\n          .fail(function( reason ) {\n    \n            // 如果外部已经标记为invalid什么的，不再改状态。\n            if ( file.getStatus() === Status.PROGRESS ) {\n              file.setStatus( Status.ERROR, reason );\n            }\n    \n            owner.trigger( 'uploadError', file, reason );\n          })\n          .always(function() {\n            owner.trigger( 'uploadComplete', file );\n          });\n      },\n    \n      updateFileProgress: function(file) {\n        var totalPercent = 0,\n          uploaded = 0;\n    \n        if (!file.blocks) {\n          return;\n        }\n    \n        $.each( file.blocks, function( _, v ) {\n          uploaded += (v.percentage || 0) * (v.end - v.start);\n        });\n    \n        totalPercent = uploaded / file.size;\n        this.owner.trigger( 'uploadProgress', file, totalPercent || 0 );\n      }\n    \n    });\n  });\n  /**\n     * @fileOverview 各种验证，包括文件总大小是否超出、单文件是否超出和文件是否重复。\n     */\n    \n  define('widgets/validator',[\n    'base',\n    'uploader',\n    'file',\n    'widgets/widget'\n  ], function( Base, Uploader, WUFile ) {\n    \n    var $ = Base.$,\n      validators = {},\n      api;\n    \n    /**\n         * @event error\n         * @param {String} type 错误类型。\n         * @description 当validate不通过时，会以派送错误事件的形式通知调用者。通过`upload.on('error', handler)`可以捕获到此类错误，目前有以下错误会在特定的情况下派送错来。\n         *\n         * * `Q_EXCEED_NUM_LIMIT` 在设置了`fileNumLimit`且尝试给`uploader`添加的文件数量超出这个值时派送。\n         * * `Q_EXCEED_SIZE_LIMIT` 在设置了`Q_EXCEED_SIZE_LIMIT`且尝试给`uploader`添加的文件总大小超出这个值时派送。\n         * * `Q_TYPE_DENIED` 当文件类型不满足时触发。。\n         * @for  Uploader\n         */\n    \n    // 暴露给外面的api\n    api = {\n    \n      // 添加验证器\n      addValidator: function( type, cb ) {\n        validators[ type ] = cb;\n      },\n    \n      // 移除验证器\n      removeValidator: function( type ) {\n        delete validators[ type ];\n      }\n    };\n    \n    // 在Uploader初始化的时候启动Validators的初始化\n    Uploader.register({\n      name: 'validator',\n    \n      init: function() {\n        var me = this;\n        Base.nextTick(function() {\n          $.each( validators, function() {\n            this.call( me.owner );\n          });\n        });\n      }\n    });\n    \n    /**\n         * @property {int} [fileNumLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证文件总数量, 超出则不允许加入队列。\n         */\n    api.addValidator( 'fileNumLimit', function() {\n      var uploader = this,\n        opts = uploader.options,\n        count = 0,\n        max = parseInt( opts.fileNumLimit, 10 ),\n        flag = true;\n    \n      if ( !max ) {\n        return;\n      }\n    \n      uploader.on( 'beforeFileQueued', function( file ) {\n    \n        if ( count >= max && flag ) {\n          flag = false;\n          this.trigger( 'error', 'Q_EXCEED_NUM_LIMIT', max, file );\n          setTimeout(function() {\n            flag = true;\n          }, 1 );\n        }\n    \n        return count >= max ? false : true;\n      });\n    \n      uploader.on( 'fileQueued', function() {\n        count++;\n      });\n    \n      uploader.on( 'fileDequeued', function() {\n        count--;\n      });\n    \n      uploader.on( 'reset', function() {\n        count = 0;\n      });\n    });\n    \n    \n    /**\n         * @property {int} [fileSizeLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证文件总大小是否超出限制, 超出则不允许加入队列。\n         */\n    api.addValidator( 'fileSizeLimit', function() {\n      var uploader = this,\n        opts = uploader.options,\n        count = 0,\n        max = parseInt( opts.fileSizeLimit, 10 ),\n        flag = true;\n    \n      if ( !max ) {\n        return;\n      }\n    \n      uploader.on( 'beforeFileQueued', function( file ) {\n        var invalid = count + file.size > max;\n    \n        if ( invalid && flag ) {\n          flag = false;\n          this.trigger( 'error', 'Q_EXCEED_SIZE_LIMIT', max, file );\n          setTimeout(function() {\n            flag = true;\n          }, 1 );\n        }\n    \n        return invalid ? false : true;\n      });\n    \n      uploader.on( 'fileQueued', function( file ) {\n        count += file.size;\n      });\n    \n      uploader.on( 'fileDequeued', function( file ) {\n        count -= file.size;\n      });\n    \n      uploader.on( 'reset', function() {\n        count = 0;\n      });\n    });\n    \n    /**\n         * @property {int} [fileSingleSizeLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证单个文件大小是否超出限制, 超出则不允许加入队列。\n         */\n    api.addValidator( 'fileSingleSizeLimit', function() {\n      var uploader = this,\n        opts = uploader.options,\n        max = opts.fileSingleSizeLimit;\n    \n      if ( !max ) {\n        return;\n      }\n    \n      uploader.on( 'beforeFileQueued', function( file ) {\n    \n        if ( file.size > max ) {\n          file.setStatus( WUFile.Status.INVALID, 'exceed_size' );\n          this.trigger( 'error', 'F_EXCEED_SIZE', max, file );\n          return false;\n        }\n    \n      });\n    \n    });\n    \n    /**\n         * @property {Boolean} [duplicate=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 去重， 根据文件名字、文件大小和最后修改时间来生成hash Key.\n         */\n    api.addValidator( 'duplicate', function() {\n      var uploader = this,\n        opts = uploader.options,\n        mapping = {};\n    \n      if ( opts.duplicate ) {\n        return;\n      }\n    \n      function hashString( str ) {\n        var hash = 0,\n          i = 0,\n          len = str.length,\n          _char;\n    \n        for ( ; i < len; i++ ) {\n          _char = str.charCodeAt( i );\n          hash = _char + (hash << 6) + (hash << 16) - hash;\n        }\n    \n        return hash;\n      }\n    \n      uploader.on( 'beforeFileQueued', function( file ) {\n        var hash = file.__hash || (file.__hash = hashString( file.name +\n                        file.size + file.lastModifiedDate ));\n    \n        // 已经重复了\n        if ( mapping[ hash ] ) {\n          this.trigger( 'error', 'F_DUPLICATE', file );\n          return false;\n        }\n      });\n    \n      uploader.on( 'fileQueued', function( file ) {\n        var hash = file.__hash;\n    \n        hash && (mapping[ hash ] = true);\n      });\n    \n      uploader.on( 'fileDequeued', function( file ) {\n        var hash = file.__hash;\n    \n        hash && (delete mapping[ hash ]);\n      });\n    \n      uploader.on( 'reset', function() {\n        mapping = {};\n      });\n    });\n    \n    return api;\n  });\n    \n  /**\n     * @fileOverview Md5\n     */\n  define('lib/md5',[\n    'runtime/client',\n    'mediator'\n  ], function( RuntimeClient, Mediator ) {\n    \n    function Md5() {\n      RuntimeClient.call( this, 'Md5' );\n    }\n    \n    // 让 Md5 具备事件功能。\n    Mediator.installTo( Md5.prototype );\n    \n    Md5.prototype.loadFromBlob = function( blob ) {\n      var me = this;\n    \n      if ( me.getRuid() ) {\n        me.disconnectRuntime();\n      }\n    \n      // 连接到blob归属的同一个runtime.\n      me.connectRuntime( blob.ruid, function() {\n        me.exec('init');\n        me.exec( 'loadFromBlob', blob );\n      });\n    };\n    \n    Md5.prototype.getResult = function() {\n      return this.exec('getResult');\n    };\n    \n    return Md5;\n  });\n  /**\n     * @fileOverview 图片操作, 负责预览图片和上传前压缩图片\n     */\n  define('widgets/md5',[\n    'base',\n    'uploader',\n    'lib/md5',\n    'lib/blob',\n    'widgets/widget'\n  ], function( Base, Uploader, Md5, Blob ) {\n    \n    return Uploader.register({\n      name: 'md5',\n    \n    \n      /**\n             * 计算文件 md5 值，返回一个 promise 对象，可以监听 progress 进度。\n             *\n             *\n             * @method md5File\n             * @grammar md5File( file[, start[, end]] ) => promise\n             * @for Uploader\n             * @example\n             *\n             * uploader.on( 'fileQueued', function( file ) {\n             *     var $li = ...;\n             *\n             *     uploader.md5File( file )\n             *\n             *         // 及时显示进度\n             *         .progress(function(percentage) {\n             *             console.log('Percentage:', percentage);\n             *         })\n             *\n             *         // 完成\n             *         .then(function(val) {\n             *             console.log('md5 result:', val);\n             *         });\n             *\n             * });\n             */\n      md5File: function( file, start, end ) {\n        var md5 = new Md5(),\n          deferred = Base.Deferred(),\n          blob = (file instanceof Blob) ? file :\n            this.request( 'get-file', file ).source;\n    \n        md5.on( 'progress load', function( e ) {\n          e = e || {};\n          deferred.notify( e.total ? e.loaded / e.total : 1 );\n        });\n    \n        md5.on( 'complete', function() {\n          deferred.resolve( md5.getResult() );\n        });\n    \n        md5.on( 'error', function( reason ) {\n          deferred.reject( reason );\n        });\n    \n        if ( arguments.length > 1 ) {\n          start = start || 0;\n          end = end || 0;\n          start < 0 && (start = blob.size + start);\n          end < 0 && (end = blob.size + end);\n          end = Math.min( end, blob.size );\n          blob = blob.slice( start, end );\n        }\n    \n        md5.loadFromBlob( blob );\n    \n        return deferred.promise();\n      }\n    });\n  });\n  /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n  define('runtime/compbase',[],function() {\n    \n    function CompBase( owner, runtime ) {\n    \n      this.owner = owner;\n      this.options = owner.options;\n    \n      this.getRuntime = function() {\n        return runtime;\n      };\n    \n      this.getRuid = function() {\n        return runtime.uid;\n      };\n    \n      this.trigger = function() {\n        return owner.trigger.apply( owner, arguments );\n      };\n    }\n    \n    return CompBase;\n  });\n  /**\n     * @fileOverview Html5Runtime\n     */\n  define('runtime/html5/runtime',[\n    'base',\n    'runtime/runtime',\n    'runtime/compbase'\n  ], function( Base, Runtime, CompBase ) {\n    \n    var type = 'html5',\n      components = {};\n    \n    function Html5Runtime() {\n      var pool = {},\n        me = this,\n        destroy = this.destroy;\n    \n      Runtime.apply( me, arguments );\n      me.type = type;\n    \n    \n      // 这个方法的调用者，实际上是RuntimeClient\n      me.exec = function( comp, fn/*, args...*/) {\n        var client = this,\n          uid = client.uid,\n          args = Base.slice( arguments, 2 ),\n          instance;\n    \n        if ( components[ comp ] ) {\n          instance = pool[ uid ] = pool[ uid ] ||\n                            new components[ comp ]( client, me );\n    \n          if ( instance[ fn ] ) {\n            return instance[ fn ].apply( instance, args );\n          }\n        }\n      };\n    \n      me.destroy = function() {\n        // @todo 删除池子中的所有实例\n        return destroy && destroy.apply( this, arguments );\n      };\n    }\n    \n    Base.inherits( Runtime, {\n      constructor: Html5Runtime,\n    \n      // 不需要连接其他程序，直接执行callback\n      init: function() {\n        var me = this;\n        setTimeout(function() {\n          me.trigger('ready');\n        }, 1 );\n      }\n    \n    });\n    \n    // 注册Components\n    Html5Runtime.register = function( name, component ) {\n      var klass = components[ name ] = Base.inherits( CompBase, component );\n      return klass;\n    };\n    \n    // 注册html5运行时。\n    // 只有在支持的前提下注册。\n    if ( window.Blob && window.FileReader && window.DataView ) {\n      Runtime.addRuntime( type, Html5Runtime );\n    }\n    \n    return Html5Runtime;\n  });\n  /**\n     * @fileOverview Blob Html实现\n     */\n  define('runtime/html5/blob',[\n    'runtime/html5/runtime',\n    'lib/blob'\n  ], function( Html5Runtime, Blob ) {\n    \n    return Html5Runtime.register( 'Blob', {\n      slice: function( start, end ) {\n        var blob = this.owner.source,\n          slice = blob.slice || blob.webkitSlice || blob.mozSlice;\n    \n        blob = slice.call( blob, start, end );\n    \n        return new Blob( this.getRuid(), blob );\n      }\n    });\n  });\n  /**\n     * @fileOverview FilePaste\n     */\n  define('runtime/html5/dnd',[\n    'base',\n    'runtime/html5/runtime',\n    'lib/file'\n  ], function( Base, Html5Runtime, File ) {\n    \n    var $ = Base.$,\n      prefix = 'webuploader-dnd-';\n    \n    return Html5Runtime.register( 'DragAndDrop', {\n      init: function() {\n        var elem = this.elem = this.options.container;\n    \n        this.dragEnterHandler = Base.bindFn( this._dragEnterHandler, this );\n        this.dragOverHandler = Base.bindFn( this._dragOverHandler, this );\n        this.dragLeaveHandler = Base.bindFn( this._dragLeaveHandler, this );\n        this.dropHandler = Base.bindFn( this._dropHandler, this );\n        this.dndOver = false;\n    \n        elem.on( 'dragenter', this.dragEnterHandler );\n        elem.on( 'dragover', this.dragOverHandler );\n        elem.on( 'dragleave', this.dragLeaveHandler );\n        elem.on( 'drop', this.dropHandler );\n    \n        if ( this.options.disableGlobalDnd ) {\n          $( document ).on( 'dragover', this.dragOverHandler );\n          $( document ).on( 'drop', this.dropHandler );\n        }\n      },\n    \n      _dragEnterHandler: function( e ) {\n        var me = this,\n          denied = me._denied || false,\n          items;\n    \n        e = e.originalEvent || e;\n    \n        if ( !me.dndOver ) {\n          me.dndOver = true;\n    \n          // 注意只有 chrome 支持。\n          items = e.dataTransfer.items;\n    \n          if ( items && items.length ) {\n            me._denied = denied = !me.trigger( 'accept', items );\n          }\n    \n          me.elem.addClass( prefix + 'over' );\n          me.elem[ denied ? 'addClass' :\n            'removeClass' ]( prefix + 'denied' );\n        }\n    \n        e.dataTransfer.dropEffect = denied ? 'none' : 'copy';\n    \n        return false;\n      },\n    \n      _dragOverHandler: function( e ) {\n        // 只处理框内的。\n        var parentElem = this.elem.parent().get( 0 );\n        if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\n          return false;\n        }\n    \n        clearTimeout( this._leaveTimer );\n        this._dragEnterHandler.call( this, e );\n    \n        return false;\n      },\n    \n      _dragLeaveHandler: function() {\n        var me = this,\n          handler;\n    \n        handler = function() {\n          me.dndOver = false;\n          me.elem.removeClass( prefix + 'over ' + prefix + 'denied' );\n        };\n    \n        clearTimeout( me._leaveTimer );\n        me._leaveTimer = setTimeout( handler, 100 );\n        return false;\n      },\n    \n      _dropHandler: function( e ) {\n        var me = this,\n          ruid = me.getRuid(),\n          parentElem = me.elem.parent().get( 0 ),\n          dataTransfer, data;\n    \n        // 只处理框内的。\n        if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\n          return false;\n        }\n    \n        e = e.originalEvent || e;\n        dataTransfer = e.dataTransfer;\n    \n        // 如果是页面内拖拽，还不能处理，不阻止事件。\n        // 此处 ie11 下会报参数错误，\n        try {\n          data = dataTransfer.getData('text/html');\n        } catch( err ) {\n        }\n    \n        me.dndOver = false;\n        me.elem.removeClass( prefix + 'over' );\n    \n        if ( data || !dataTransfer ) {\n          return;\n        }\n    \n        me._getTansferFiles( dataTransfer, function( results ) {\n          me.trigger( 'drop', $.map( results, function( file ) {\n            return new File( ruid, file );\n          }) );\n        });\n    \n        return false;\n      },\n    \n      // 如果传入 callback 则去查看文件夹，否则只管当前文件夹。\n      _getTansferFiles: function( dataTransfer, callback ) {\n        var results  = [],\n          promises = [],\n          items, files, file, item, i, len, canAccessFolder;\n    \n        items = dataTransfer.items;\n        files = dataTransfer.files;\n    \n        canAccessFolder = !!(items && items[ 0 ].webkitGetAsEntry);\n    \n        for ( i = 0, len = files.length; i < len; i++ ) {\n          file = files[ i ];\n          item = items && items[ i ];\n    \n          if ( canAccessFolder && item.webkitGetAsEntry().isDirectory ) {\n    \n            promises.push( this._traverseDirectoryTree(\n              item.webkitGetAsEntry(), results ) );\n          } else {\n            results.push( file );\n          }\n        }\n    \n        Base.when.apply( Base, promises ).done(function() {\n    \n          if ( !results.length ) {\n            return;\n          }\n    \n          callback( results );\n        });\n      },\n    \n      _traverseDirectoryTree: function( entry, results ) {\n        var deferred = Base.Deferred(),\n          me = this;\n    \n        if ( entry.isFile ) {\n          entry.file(function( file ) {\n            results.push( file );\n            deferred.resolve();\n          });\n        } else if ( entry.isDirectory ) {\n          entry.createReader().readEntries(function( entries ) {\n            var len = entries.length,\n              promises = [],\n              arr = [],    // 为了保证顺序。\n              i;\n    \n            for ( i = 0; i < len; i++ ) {\n              promises.push( me._traverseDirectoryTree(\n                entries[ i ], arr ) );\n            }\n    \n            Base.when.apply( Base, promises ).then(function() {\n              results.push.apply( results, arr );\n              deferred.resolve();\n            }, deferred.reject );\n          });\n        }\n    \n        return deferred.promise();\n      },\n    \n      destroy: function() {\n        var elem = this.elem;\n    \n        // 还没 init 就调用 destroy\n        if (!elem) {\n          return;\n        }\n    \n        elem.off( 'dragenter', this.dragEnterHandler );\n        elem.off( 'dragover', this.dragOverHandler );\n        elem.off( 'dragleave', this.dragLeaveHandler );\n        elem.off( 'drop', this.dropHandler );\n    \n        if ( this.options.disableGlobalDnd ) {\n          $( document ).off( 'dragover', this.dragOverHandler );\n          $( document ).off( 'drop', this.dropHandler );\n        }\n      }\n    });\n  });\n    \n  /**\n     * @fileOverview FilePaste\n     */\n  define('runtime/html5/filepaste',[\n    'base',\n    'runtime/html5/runtime',\n    'lib/file'\n  ], function( Base, Html5Runtime, File ) {\n    \n    return Html5Runtime.register( 'FilePaste', {\n      init: function() {\n        var opts = this.options,\n          elem = this.elem = opts.container,\n          accept = '.*',\n          arr, i, len, item;\n    \n        // accetp的mimeTypes中生成匹配正则。\n        if ( opts.accept ) {\n          arr = [];\n    \n          for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n            item = opts.accept[ i ].mimeTypes;\n            item && arr.push( item );\n          }\n    \n          if ( arr.length ) {\n            accept = arr.join(',');\n            accept = accept.replace( /,/g, '|' ).replace( /\\*/g, '.*' );\n          }\n        }\n        this.accept = accept = new RegExp( accept, 'i' );\n        this.hander = Base.bindFn( this._pasteHander, this );\n        elem.on( 'paste', this.hander );\n      },\n    \n      _pasteHander: function( e ) {\n        var allowed = [],\n          ruid = this.getRuid(),\n          items, item, blob, i, len;\n    \n        e = e.originalEvent || e;\n        items = e.clipboardData.items;\n    \n        for ( i = 0, len = items.length; i < len; i++ ) {\n          item = items[ i ];\n    \n          if ( item.kind !== 'file' || !(blob = item.getAsFile()) ) {\n            continue;\n          }\n    \n          allowed.push( new File( ruid, blob ) );\n        }\n    \n        if ( allowed.length ) {\n          // 不阻止非文件粘贴（文字粘贴）的事件冒泡\n          e.preventDefault();\n          e.stopPropagation();\n          this.trigger( 'paste', allowed );\n        }\n      },\n    \n      destroy: function() {\n        this.elem.off( 'paste', this.hander );\n      }\n    });\n  });\n    \n  /**\n     * @fileOverview FilePicker\n     */\n  define('runtime/html5/filepicker',[\n    'base',\n    'runtime/html5/runtime'\n  ], function( Base, Html5Runtime ) {\n    \n    var $ = Base.$;\n    \n    return Html5Runtime.register( 'FilePicker', {\n      init: function() {\n        var container = this.getRuntime().getContainer(),\n          me = this,\n          owner = me.owner,\n          opts = me.options,\n          label = this.label = $( document.createElement('label') ),\n          input =  this.input = $( document.createElement('input') ),\n          arr, i, len, mouseHandler, inputChange;\n    \n        input.attr( 'type', 'file' );\n        input.attr( 'name', opts.name );\n        input.addClass('webuploader-element-invisible');\n    \n        label.on( 'click', function() {\n          input.trigger('click');\n        });\n    \n        label.css({\n          opacity: 0,\n          width: '100%',\n          height: '100%',\n          display: 'block',\n          cursor: 'pointer',\n          background: '#ffffff'\n        });\n    \n        if ( opts.multiple ) {\n          input.attr( 'multiple', 'multiple' );\n        }\n    \n        // @todo Firefox不支持单独指定后缀\n        if ( opts.accept && opts.accept.length > 0 ) {\n          arr = [];\n    \n          for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n            arr.push( opts.accept[ i ].mimeTypes );\n          }\n    \n          input.attr( 'accept', arr.join(',') );\n        }\n    \n        container.append( input );\n        container.append( label );\n    \n        mouseHandler = function( e ) {\n          owner.trigger( e.type );\n        };\n\n        inputChange = function( e ) {\n                \tvar clone;\n                \tme.files = e.target.files;\n    \n          // reset input\n          clone = this.cloneNode( true );\n          clone.value = null;\n          this.parentNode.replaceChild( clone, this );\n    \n          input.off();\n          input = $( clone ).on( 'change', inputChange )\n            .on( 'mouseenter mouseleave', mouseHandler );\n    \n          owner.trigger('change');\n        };\n    \n        input.on( 'change', inputChange);\n    \n        label.on( 'mouseenter mouseleave', mouseHandler );\n    \n      },\n    \n    \n      getFiles: function() {\n        return this.files;\n      },\n    \n      destroy: function() {\n        this.input.off();\n        this.label.off();\n      }\n    });\n  });\n    \n  /**\n     * Terms:\n     *\n     * Uint8Array, FileReader, BlobBuilder, atob, ArrayBuffer\n     * @fileOverview Image控件\n     */\n  define('runtime/html5/util',[\n    'base'\n  ], function( Base ) {\n    \n    var urlAPI = window.createObjectURL && window ||\n                window.URL && URL.revokeObjectURL && URL ||\n                window.webkitURL,\n      createObjectURL = Base.noop,\n      revokeObjectURL = createObjectURL;\n    \n    if ( urlAPI ) {\n    \n      // 更安全的方式调用，比如android里面就能把context改成其他的对象。\n      createObjectURL = function() {\n        return urlAPI.createObjectURL.apply( urlAPI, arguments );\n      };\n    \n      revokeObjectURL = function() {\n        return urlAPI.revokeObjectURL.apply( urlAPI, arguments );\n      };\n    }\n    \n    return {\n      createObjectURL: createObjectURL,\n      revokeObjectURL: revokeObjectURL,\n    \n      dataURL2Blob: function( dataURI ) {\n        var byteStr, intArray, ab, i, mimetype, parts;\n    \n        parts = dataURI.split(',');\n    \n        if ( ~parts[ 0 ].indexOf('base64') ) {\n          byteStr = atob( parts[ 1 ] );\n        } else {\n          byteStr = decodeURIComponent( parts[ 1 ] );\n        }\n    \n        ab = new ArrayBuffer( byteStr.length );\n        intArray = new Uint8Array( ab );\n    \n        for ( i = 0; i < byteStr.length; i++ ) {\n          intArray[ i ] = byteStr.charCodeAt( i );\n        }\n    \n        mimetype = parts[ 0 ].split(':')[ 1 ].split(';')[ 0 ];\n    \n        return this.arrayBufferToBlob( ab, mimetype );\n      },\n    \n      dataURL2ArrayBuffer: function( dataURI ) {\n        var byteStr, intArray, i, parts;\n    \n        parts = dataURI.split(',');\n    \n        if ( ~parts[ 0 ].indexOf('base64') ) {\n          byteStr = atob( parts[ 1 ] );\n        } else {\n          byteStr = decodeURIComponent( parts[ 1 ] );\n        }\n    \n        intArray = new Uint8Array( byteStr.length );\n    \n        for ( i = 0; i < byteStr.length; i++ ) {\n          intArray[ i ] = byteStr.charCodeAt( i );\n        }\n    \n        return intArray.buffer;\n      },\n    \n      arrayBufferToBlob: function( buffer, type ) {\n        var builder = window.BlobBuilder || window.WebKitBlobBuilder,\n          bb;\n    \n        // android不支持直接new Blob, 只能借助blobbuilder.\n        if ( builder ) {\n          bb = new builder();\n          bb.append( buffer );\n          return bb.getBlob( type );\n        }\n    \n        return new Blob([ buffer ], type ? { type: type } : {} );\n      },\n    \n      // 抽出来主要是为了解决android下面canvas.toDataUrl不支持jpeg.\n      // 你得到的结果是png.\n      canvasToDataUrl: function( canvas, type, quality ) {\n        return canvas.toDataURL( type, quality / 100 );\n      },\n    \n      // imagemeat会复写这个方法，如果用户选择加载那个文件了的话。\n      parseMeta: function( blob, callback ) {\n        callback( false, {});\n      },\n    \n      // imagemeat会复写这个方法，如果用户选择加载那个文件了的话。\n      updateImageHead: function( data ) {\n        return data;\n      }\n    };\n  });\n    \n  /**\n     * Terms:\n     *\n     * Uint8Array, FileReader, BlobBuilder, atob, ArrayBuffer\n     * @fileOverview Image控件\n     */\n  define('runtime/html5/imagemeta',[\n    'runtime/html5/util'\n  ], function( Util ) {\n    \n    var api;\n    \n    api = {\n      parsers: {\n        0xffe1: []\n      },\n    \n      maxMetaDataSize: 262144,\n    \n      parse: function( blob, cb ) {\n        var me = this,\n          fr = new FileReader();\n    \n        fr.onload = function() {\n          cb( false, me._parse( this.result ) );\n          fr = fr.onload = fr.onerror = null;\n        };\n    \n        fr.onerror = function( e ) {\n          cb( e.message );\n          fr = fr.onload = fr.onerror = null;\n        };\n    \n        blob = blob.slice( 0, me.maxMetaDataSize );\n        fr.readAsArrayBuffer( blob.getSource() );\n      },\n    \n      _parse: function( buffer, noParse ) {\n        if ( buffer.byteLength < 6 ) {\n          return;\n        }\n    \n        var dataview = new DataView( buffer ),\n          offset = 2,\n          maxOffset = dataview.byteLength - 4,\n          headLength = offset,\n          ret = {},\n          markerBytes, markerLength, parsers, i;\n    \n        if ( dataview.getUint16( 0 ) === 0xffd8 ) {\n    \n          while ( offset < maxOffset ) {\n            markerBytes = dataview.getUint16( offset );\n    \n            if ( markerBytes >= 0xffe0 && markerBytes <= 0xffef ||\n                                markerBytes === 0xfffe ) {\n    \n              markerLength = dataview.getUint16( offset + 2 ) + 2;\n    \n              if ( offset + markerLength > dataview.byteLength ) {\n                break;\n              }\n    \n              parsers = api.parsers[ markerBytes ];\n    \n              if ( !noParse && parsers ) {\n                for ( i = 0; i < parsers.length; i += 1 ) {\n                  parsers[ i ].call( api, dataview, offset,\n                    markerLength, ret );\n                }\n              }\n    \n              offset += markerLength;\n              headLength = offset;\n            } else {\n              break;\n            }\n          }\n    \n          if ( headLength > 6 ) {\n            if ( buffer.slice ) {\n              ret.imageHead = buffer.slice( 2, headLength );\n            } else {\n              // Workaround for IE10, which does not yet\n              // support ArrayBuffer.slice:\n              ret.imageHead = new Uint8Array( buffer )\n                .subarray( 2, headLength );\n            }\n          }\n        }\n    \n        return ret;\n      },\n    \n      updateImageHead: function( buffer, head ) {\n        var data = this._parse( buffer, true ),\n          buf1, buf2, bodyoffset;\n    \n    \n        bodyoffset = 2;\n        if ( data.imageHead ) {\n          bodyoffset = 2 + data.imageHead.byteLength;\n        }\n    \n        if ( buffer.slice ) {\n          buf2 = buffer.slice( bodyoffset );\n        } else {\n          buf2 = new Uint8Array( buffer ).subarray( bodyoffset );\n        }\n    \n        buf1 = new Uint8Array( head.byteLength + 2 + buf2.byteLength );\n    \n        buf1[ 0 ] = 0xFF;\n        buf1[ 1 ] = 0xD8;\n        buf1.set( new Uint8Array( head ), 2 );\n        buf1.set( new Uint8Array( buf2 ), head.byteLength + 2 );\n    \n        return buf1.buffer;\n      }\n    };\n    \n    Util.parseMeta = function() {\n      return api.parse.apply( api, arguments );\n    };\n    \n    Util.updateImageHead = function() {\n      return api.updateImageHead.apply( api, arguments );\n    };\n    \n    return api;\n  });\n  /**\n     * 代码来自于：https://github.com/blueimp/JavaScript-Load-Image\n     * 暂时项目中只用了orientation.\n     *\n     * 去除了 Exif Sub IFD Pointer, GPS Info IFD Pointer, Exif Thumbnail.\n     * @fileOverview EXIF解析\n     */\n    \n  // Sample\n  // ====================================\n  // Make : Apple\n  // Model : iPhone 4S\n  // Orientation : 1\n  // XResolution : 72 [72/1]\n  // YResolution : 72 [72/1]\n  // ResolutionUnit : 2\n  // Software : QuickTime 7.7.1\n  // DateTime : 2013:09:01 22:53:55\n  // ExifIFDPointer : 190\n  // ExposureTime : 0.058823529411764705 [1/17]\n  // FNumber : 2.4 [12/5]\n  // ExposureProgram : Normal program\n  // ISOSpeedRatings : 800\n  // ExifVersion : 0220\n  // DateTimeOriginal : 2013:09:01 22:52:51\n  // DateTimeDigitized : 2013:09:01 22:52:51\n  // ComponentsConfiguration : YCbCr\n  // ShutterSpeedValue : 4.058893515764426\n  // ApertureValue : 2.5260688216892597 [4845/1918]\n  // BrightnessValue : -0.3126686601998395\n  // MeteringMode : Pattern\n  // Flash : Flash did not fire, compulsory flash mode\n  // FocalLength : 4.28 [107/25]\n  // SubjectArea : [4 values]\n  // FlashpixVersion : 0100\n  // ColorSpace : 1\n  // PixelXDimension : 2448\n  // PixelYDimension : 3264\n  // SensingMethod : One-chip color area sensor\n  // ExposureMode : 0\n  // WhiteBalance : Auto white balance\n  // FocalLengthIn35mmFilm : 35\n  // SceneCaptureType : Standard\n  define('runtime/html5/imagemeta/exif',[\n    'base',\n    'runtime/html5/imagemeta'\n  ], function( Base, ImageMeta ) {\n    \n    var EXIF = {};\n    \n    EXIF.ExifMap = function() {\n      return this;\n    };\n    \n    EXIF.ExifMap.prototype.map = {\n      'Orientation': 0x0112\n    };\n    \n    EXIF.ExifMap.prototype.get = function( id ) {\n      return this[ id ] || this[ this.map[ id ] ];\n    };\n    \n    EXIF.exifTagTypes = {\n      // byte, 8-bit unsigned int:\n      1: {\n        getValue: function( dataView, dataOffset ) {\n          return dataView.getUint8( dataOffset );\n        },\n        size: 1\n      },\n    \n      // ascii, 8-bit byte:\n      2: {\n        getValue: function( dataView, dataOffset ) {\n          return String.fromCharCode( dataView.getUint8( dataOffset ) );\n        },\n        size: 1,\n        ascii: true\n      },\n    \n      // short, 16 bit int:\n      3: {\n        getValue: function( dataView, dataOffset, littleEndian ) {\n          return dataView.getUint16( dataOffset, littleEndian );\n        },\n        size: 2\n      },\n    \n      // long, 32 bit int:\n      4: {\n        getValue: function( dataView, dataOffset, littleEndian ) {\n          return dataView.getUint32( dataOffset, littleEndian );\n        },\n        size: 4\n      },\n    \n      // rational = two long values,\n      // first is numerator, second is denominator:\n      5: {\n        getValue: function( dataView, dataOffset, littleEndian ) {\n          return dataView.getUint32( dataOffset, littleEndian ) /\n                        dataView.getUint32( dataOffset + 4, littleEndian );\n        },\n        size: 8\n      },\n    \n      // slong, 32 bit signed int:\n      9: {\n        getValue: function( dataView, dataOffset, littleEndian ) {\n          return dataView.getInt32( dataOffset, littleEndian );\n        },\n        size: 4\n      },\n    \n      // srational, two slongs, first is numerator, second is denominator:\n      10: {\n        getValue: function( dataView, dataOffset, littleEndian ) {\n          return dataView.getInt32( dataOffset, littleEndian ) /\n                        dataView.getInt32( dataOffset + 4, littleEndian );\n        },\n        size: 8\n      }\n    };\n    \n    // undefined, 8-bit byte, value depending on field:\n    EXIF.exifTagTypes[ 7 ] = EXIF.exifTagTypes[ 1 ];\n    \n    EXIF.getExifValue = function( dataView, tiffOffset, offset, type, length,\n      littleEndian ) {\n    \n      var tagType = EXIF.exifTagTypes[ type ],\n        tagSize, dataOffset, values, i, str, c;\n    \n      if ( !tagType ) {\n        Base.log('Invalid Exif data: Invalid tag type.');\n        return;\n      }\n    \n      tagSize = tagType.size * length;\n    \n      // Determine if the value is contained in the dataOffset bytes,\n      // or if the value at the dataOffset is a pointer to the actual data:\n      dataOffset = tagSize > 4 ? tiffOffset + dataView.getUint32( offset + 8,\n        littleEndian ) : (offset + 8);\n    \n      if ( dataOffset + tagSize > dataView.byteLength ) {\n        Base.log('Invalid Exif data: Invalid data offset.');\n        return;\n      }\n    \n      if ( length === 1 ) {\n        return tagType.getValue( dataView, dataOffset, littleEndian );\n      }\n    \n      values = [];\n    \n      for ( i = 0; i < length; i += 1 ) {\n        values[ i ] = tagType.getValue( dataView,\n          dataOffset + i * tagType.size, littleEndian );\n      }\n    \n      if ( tagType.ascii ) {\n        str = '';\n    \n        // Concatenate the chars:\n        for ( i = 0; i < values.length; i += 1 ) {\n          c = values[ i ];\n    \n          // Ignore the terminating NULL byte(s):\n          if ( c === '\\u0000' ) {\n            break;\n          }\n          str += c;\n        }\n    \n        return str;\n      }\n      return values;\n    };\n    \n    EXIF.parseExifTag = function( dataView, tiffOffset, offset, littleEndian,\n      data ) {\n    \n      var tag = dataView.getUint16( offset, littleEndian );\n      data.exif[ tag ] = EXIF.getExifValue( dataView, tiffOffset, offset,\n        dataView.getUint16( offset + 2, littleEndian ),    // tag type\n        dataView.getUint32( offset + 4, littleEndian ),    // tag length\n        littleEndian );\n    };\n    \n    EXIF.parseExifTags = function( dataView, tiffOffset, dirOffset,\n      littleEndian, data ) {\n    \n      var tagsNumber, dirEndOffset, i;\n    \n      if ( dirOffset + 6 > dataView.byteLength ) {\n        Base.log('Invalid Exif data: Invalid directory offset.');\n        return;\n      }\n    \n      tagsNumber = dataView.getUint16( dirOffset, littleEndian );\n      dirEndOffset = dirOffset + 2 + 12 * tagsNumber;\n    \n      if ( dirEndOffset + 4 > dataView.byteLength ) {\n        Base.log('Invalid Exif data: Invalid directory size.');\n        return;\n      }\n    \n      for ( i = 0; i < tagsNumber; i += 1 ) {\n        this.parseExifTag( dataView, tiffOffset,\n          dirOffset + 2 + 12 * i,    // tag offset\n          littleEndian, data );\n      }\n    \n      // Return the offset to the next directory:\n      return dataView.getUint32( dirEndOffset, littleEndian );\n    };\n    \n    // EXIF.getExifThumbnail = function(dataView, offset, length) {\n    //     var hexData,\n    //         i,\n    //         b;\n    //     if (!length || offset + length > dataView.byteLength) {\n    //         Base.log('Invalid Exif data: Invalid thumbnail data.');\n    //         return;\n    //     }\n    //     hexData = [];\n    //     for (i = 0; i < length; i += 1) {\n    //         b = dataView.getUint8(offset + i);\n    //         hexData.push((b < 16 ? '0' : '') + b.toString(16));\n    //     }\n    //     return 'data:image/jpeg,%' + hexData.join('%');\n    // };\n    \n    EXIF.parseExifData = function( dataView, offset, length, data ) {\n    \n      var tiffOffset = offset + 10,\n        littleEndian, dirOffset;\n    \n      // Check for the ASCII code for \"Exif\" (0x45786966):\n      if ( dataView.getUint32( offset + 4 ) !== 0x45786966 ) {\n        // No Exif data, might be XMP data instead\n        return;\n      }\n      if ( tiffOffset + 8 > dataView.byteLength ) {\n        Base.log('Invalid Exif data: Invalid segment size.');\n        return;\n      }\n    \n      // Check for the two null bytes:\n      if ( dataView.getUint16( offset + 8 ) !== 0x0000 ) {\n        Base.log('Invalid Exif data: Missing byte alignment offset.');\n        return;\n      }\n    \n      // Check the byte alignment:\n      switch ( dataView.getUint16( tiffOffset ) ) {\n      case 0x4949:\n        littleEndian = true;\n        break;\n    \n      case 0x4D4D:\n        littleEndian = false;\n        break;\n    \n      default:\n        Base.log('Invalid Exif data: Invalid byte alignment marker.');\n        return;\n      }\n    \n      // Check for the TIFF tag marker (0x002A):\n      if ( dataView.getUint16( tiffOffset + 2, littleEndian ) !== 0x002A ) {\n        Base.log('Invalid Exif data: Missing TIFF marker.');\n        return;\n      }\n    \n      // Retrieve the directory offset bytes, usually 0x00000008 or 8 decimal:\n      dirOffset = dataView.getUint32( tiffOffset + 4, littleEndian );\n      // Create the exif object to store the tags:\n      data.exif = new EXIF.ExifMap();\n      // Parse the tags of the main image directory and retrieve the\n      // offset to the next directory, usually the thumbnail directory:\n      dirOffset = EXIF.parseExifTags( dataView, tiffOffset,\n        tiffOffset + dirOffset, littleEndian, data );\n    \n      // 尝试读取缩略图\n      // if ( dirOffset ) {\n      //     thumbnailData = {exif: {}};\n      //     dirOffset = EXIF.parseExifTags(\n      //         dataView,\n      //         tiffOffset,\n      //         tiffOffset + dirOffset,\n      //         littleEndian,\n      //         thumbnailData\n      //     );\n    \n      //     // Check for JPEG Thumbnail offset:\n      //     if (thumbnailData.exif[0x0201]) {\n      //         data.exif.Thumbnail = EXIF.getExifThumbnail(\n      //             dataView,\n      //             tiffOffset + thumbnailData.exif[0x0201],\n      //             thumbnailData.exif[0x0202] // Thumbnail data length\n      //         );\n      //     }\n      // }\n    };\n    \n    ImageMeta.parsers[ 0xffe1 ].push( EXIF.parseExifData );\n    return EXIF;\n  });\n  /**\n     * 这个方式性能不行，但是可以解决android里面的toDataUrl的bug\n     * android里面toDataUrl('image/jpege')得到的结果却是png.\n     *\n     * 所以这里没辙，只能借助这个工具\n     * @fileOverview jpeg encoder\n     */\n  define('runtime/html5/jpegencoder',[], function( require, exports, module ) {\n    \n    /*\n          Copyright (c) 2008, Adobe Systems Incorporated\n          All rights reserved.\n    \n          Redistribution and use in source and binary forms, with or without\n          modification, are permitted provided that the following conditions are\n          met:\n    \n          * Redistributions of source code must retain the above copyright notice,\n            this list of conditions and the following disclaimer.\n    \n          * Redistributions in binary form must reproduce the above copyright\n            notice, this list of conditions and the following disclaimer in the\n            documentation and/or other materials provided with the distribution.\n    \n          * Neither the name of Adobe Systems Incorporated nor the names of its\n            contributors may be used to endorse or promote products derived from\n            this software without specific prior written permission.\n    \n          THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS\n          IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,\n          THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n          PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n          CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n          EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n          PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n          PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\n          LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n          NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n          SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n        */\n    /*\n        JPEG encoder ported to JavaScript and optimized by Andreas Ritter, www.bytestrom.eu, 11/2009\n    \n        Basic GUI blocking jpeg encoder\n        */\n    \n    function JPEGEncoder(quality) {\n      var self = this;\n      var fround = Math.round;\n      var ffloor = Math.floor;\n      var YTable = new Array(64);\n      var UVTable = new Array(64);\n      var fdtbl_Y = new Array(64);\n      var fdtbl_UV = new Array(64);\n      var YDC_HT;\n      var UVDC_HT;\n      var YAC_HT;\n      var UVAC_HT;\n    \n      var bitcode = new Array(65535);\n      var category = new Array(65535);\n      var outputfDCTQuant = new Array(64);\n      var DU = new Array(64);\n      var byteout = [];\n      var bytenew = 0;\n      var bytepos = 7;\n    \n      var YDU = new Array(64);\n      var UDU = new Array(64);\n      var VDU = new Array(64);\n      var clt = new Array(256);\n      var RGB_YUV_TABLE = new Array(2048);\n      var currentQuality;\n    \n      var ZigZag = [\n        0, 1, 5, 6,14,15,27,28,\n        2, 4, 7,13,16,26,29,42,\n        3, 8,12,17,25,30,41,43,\n        9,11,18,24,31,40,44,53,\n        10,19,23,32,39,45,52,54,\n        20,22,33,38,46,51,55,60,\n        21,34,37,47,50,56,59,61,\n        35,36,48,49,57,58,62,63\n      ];\n    \n      var std_dc_luminance_nrcodes = [0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];\n      var std_dc_luminance_values = [0,1,2,3,4,5,6,7,8,9,10,11];\n      var std_ac_luminance_nrcodes = [0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,0x7d];\n      var std_ac_luminance_values = [\n        0x01,0x02,0x03,0x00,0x04,0x11,0x05,0x12,\n        0x21,0x31,0x41,0x06,0x13,0x51,0x61,0x07,\n        0x22,0x71,0x14,0x32,0x81,0x91,0xa1,0x08,\n        0x23,0x42,0xb1,0xc1,0x15,0x52,0xd1,0xf0,\n        0x24,0x33,0x62,0x72,0x82,0x09,0x0a,0x16,\n        0x17,0x18,0x19,0x1a,0x25,0x26,0x27,0x28,\n        0x29,0x2a,0x34,0x35,0x36,0x37,0x38,0x39,\n        0x3a,0x43,0x44,0x45,0x46,0x47,0x48,0x49,\n        0x4a,0x53,0x54,0x55,0x56,0x57,0x58,0x59,\n        0x5a,0x63,0x64,0x65,0x66,0x67,0x68,0x69,\n        0x6a,0x73,0x74,0x75,0x76,0x77,0x78,0x79,\n        0x7a,0x83,0x84,0x85,0x86,0x87,0x88,0x89,\n        0x8a,0x92,0x93,0x94,0x95,0x96,0x97,0x98,\n        0x99,0x9a,0xa2,0xa3,0xa4,0xa5,0xa6,0xa7,\n        0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,0xb5,0xb6,\n        0xb7,0xb8,0xb9,0xba,0xc2,0xc3,0xc4,0xc5,\n        0xc6,0xc7,0xc8,0xc9,0xca,0xd2,0xd3,0xd4,\n        0xd5,0xd6,0xd7,0xd8,0xd9,0xda,0xe1,0xe2,\n        0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,0xea,\n        0xf1,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,\n        0xf9,0xfa\n      ];\n    \n      var std_dc_chrominance_nrcodes = [0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];\n      var std_dc_chrominance_values = [0,1,2,3,4,5,6,7,8,9,10,11];\n      var std_ac_chrominance_nrcodes = [0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,0x77];\n      var std_ac_chrominance_values = [\n        0x00,0x01,0x02,0x03,0x11,0x04,0x05,0x21,\n        0x31,0x06,0x12,0x41,0x51,0x07,0x61,0x71,\n        0x13,0x22,0x32,0x81,0x08,0x14,0x42,0x91,\n        0xa1,0xb1,0xc1,0x09,0x23,0x33,0x52,0xf0,\n        0x15,0x62,0x72,0xd1,0x0a,0x16,0x24,0x34,\n        0xe1,0x25,0xf1,0x17,0x18,0x19,0x1a,0x26,\n        0x27,0x28,0x29,0x2a,0x35,0x36,0x37,0x38,\n        0x39,0x3a,0x43,0x44,0x45,0x46,0x47,0x48,\n        0x49,0x4a,0x53,0x54,0x55,0x56,0x57,0x58,\n        0x59,0x5a,0x63,0x64,0x65,0x66,0x67,0x68,\n        0x69,0x6a,0x73,0x74,0x75,0x76,0x77,0x78,\n        0x79,0x7a,0x82,0x83,0x84,0x85,0x86,0x87,\n        0x88,0x89,0x8a,0x92,0x93,0x94,0x95,0x96,\n        0x97,0x98,0x99,0x9a,0xa2,0xa3,0xa4,0xa5,\n        0xa6,0xa7,0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,\n        0xb5,0xb6,0xb7,0xb8,0xb9,0xba,0xc2,0xc3,\n        0xc4,0xc5,0xc6,0xc7,0xc8,0xc9,0xca,0xd2,\n        0xd3,0xd4,0xd5,0xd6,0xd7,0xd8,0xd9,0xda,\n        0xe2,0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,\n        0xea,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,\n        0xf9,0xfa\n      ];\n    \n      function initQuantTables(sf){\n        var YQT = [\n          16, 11, 10, 16, 24, 40, 51, 61,\n          12, 12, 14, 19, 26, 58, 60, 55,\n          14, 13, 16, 24, 40, 57, 69, 56,\n          14, 17, 22, 29, 51, 87, 80, 62,\n          18, 22, 37, 56, 68,109,103, 77,\n          24, 35, 55, 64, 81,104,113, 92,\n          49, 64, 78, 87,103,121,120,101,\n          72, 92, 95, 98,112,100,103, 99\n        ];\n    \n        for (var i = 0; i < 64; i++) {\n          var t = ffloor((YQT[i]*sf+50)/100);\n          if (t < 1) {\n            t = 1;\n          } else if (t > 255) {\n            t = 255;\n          }\n          YTable[ZigZag[i]] = t;\n        }\n        var UVQT = [\n          17, 18, 24, 47, 99, 99, 99, 99,\n          18, 21, 26, 66, 99, 99, 99, 99,\n          24, 26, 56, 99, 99, 99, 99, 99,\n          47, 66, 99, 99, 99, 99, 99, 99,\n          99, 99, 99, 99, 99, 99, 99, 99,\n          99, 99, 99, 99, 99, 99, 99, 99,\n          99, 99, 99, 99, 99, 99, 99, 99,\n          99, 99, 99, 99, 99, 99, 99, 99\n        ];\n        for (var j = 0; j < 64; j++) {\n          var u = ffloor((UVQT[j]*sf+50)/100);\n          if (u < 1) {\n            u = 1;\n          } else if (u > 255) {\n            u = 255;\n          }\n          UVTable[ZigZag[j]] = u;\n        }\n        var aasf = [\n          1.0, 1.387039845, 1.306562965, 1.175875602,\n          1.0, 0.785694958, 0.541196100, 0.275899379\n        ];\n        var k = 0;\n        for (var row = 0; row < 8; row++)\n        {\n          for (var col = 0; col < 8; col++)\n          {\n            fdtbl_Y[k]  = (1.0 / (YTable [ZigZag[k]] * aasf[row] * aasf[col] * 8.0));\n            fdtbl_UV[k] = (1.0 / (UVTable[ZigZag[k]] * aasf[row] * aasf[col] * 8.0));\n            k++;\n          }\n        }\n      }\n    \n      function computeHuffmanTbl(nrcodes, std_table){\n        var codevalue = 0;\n        var pos_in_table = 0;\n        var HT = new Array();\n        for (var k = 1; k <= 16; k++) {\n          for (var j = 1; j <= nrcodes[k]; j++) {\n            HT[std_table[pos_in_table]] = [];\n            HT[std_table[pos_in_table]][0] = codevalue;\n            HT[std_table[pos_in_table]][1] = k;\n            pos_in_table++;\n            codevalue++;\n          }\n          codevalue*=2;\n        }\n        return HT;\n      }\n    \n      function initHuffmanTbl()\n      {\n        YDC_HT = computeHuffmanTbl(std_dc_luminance_nrcodes,std_dc_luminance_values);\n        UVDC_HT = computeHuffmanTbl(std_dc_chrominance_nrcodes,std_dc_chrominance_values);\n        YAC_HT = computeHuffmanTbl(std_ac_luminance_nrcodes,std_ac_luminance_values);\n        UVAC_HT = computeHuffmanTbl(std_ac_chrominance_nrcodes,std_ac_chrominance_values);\n      }\n    \n      function initCategoryNumber()\n      {\n        var nrlower = 1;\n        var nrupper = 2;\n        for (var cat = 1; cat <= 15; cat++) {\n          //Positive numbers\n          for (var nr = nrlower; nr<nrupper; nr++) {\n            category[32767+nr] = cat;\n            bitcode[32767+nr] = [];\n            bitcode[32767+nr][1] = cat;\n            bitcode[32767+nr][0] = nr;\n          }\n          //Negative numbers\n          for (var nrneg =-(nrupper-1); nrneg<=-nrlower; nrneg++) {\n            category[32767+nrneg] = cat;\n            bitcode[32767+nrneg] = [];\n            bitcode[32767+nrneg][1] = cat;\n            bitcode[32767+nrneg][0] = nrupper-1+nrneg;\n          }\n          nrlower <<= 1;\n          nrupper <<= 1;\n        }\n      }\n    \n      function initRGBYUVTable() {\n        for(var i = 0; i < 256;i++) {\n          RGB_YUV_TABLE[i]            =  19595 * i;\n          RGB_YUV_TABLE[(i+ 256)>>0]  =  38470 * i;\n          RGB_YUV_TABLE[(i+ 512)>>0]  =   7471 * i + 0x8000;\n          RGB_YUV_TABLE[(i+ 768)>>0]  = -11059 * i;\n          RGB_YUV_TABLE[(i+1024)>>0]  = -21709 * i;\n          RGB_YUV_TABLE[(i+1280)>>0]  =  32768 * i + 0x807FFF;\n          RGB_YUV_TABLE[(i+1536)>>0]  = -27439 * i;\n          RGB_YUV_TABLE[(i+1792)>>0]  = - 5329 * i;\n        }\n      }\n    \n      // IO functions\n      function writeBits(bs)\n      {\n        var value = bs[0];\n        var posval = bs[1]-1;\n        while ( posval >= 0 ) {\n          if (value & (1 << posval) ) {\n            bytenew |= (1 << bytepos);\n          }\n          posval--;\n          bytepos--;\n          if (bytepos < 0) {\n            if (bytenew == 0xFF) {\n              writeByte(0xFF);\n              writeByte(0);\n            }\n            else {\n              writeByte(bytenew);\n            }\n            bytepos=7;\n            bytenew=0;\n          }\n        }\n      }\n    \n      function writeByte(value)\n      {\n        byteout.push(clt[value]); // write char directly instead of converting later\n      }\n    \n      function writeWord(value)\n      {\n        writeByte((value>>8)&0xFF);\n        writeByte((value   )&0xFF);\n      }\n    \n      // DCT & quantization core\n      function fDCTQuant(data, fdtbl)\n      {\n        var d0, d1, d2, d3, d4, d5, d6, d7;\n        /* Pass 1: process rows. */\n        var dataOff=0;\n        var i;\n        var I8 = 8;\n        var I64 = 64;\n        for (i=0; i<I8; ++i)\n        {\n          d0 = data[dataOff];\n          d1 = data[dataOff+1];\n          d2 = data[dataOff+2];\n          d3 = data[dataOff+3];\n          d4 = data[dataOff+4];\n          d5 = data[dataOff+5];\n          d6 = data[dataOff+6];\n          d7 = data[dataOff+7];\n    \n          var tmp0 = d0 + d7;\n          var tmp7 = d0 - d7;\n          var tmp1 = d1 + d6;\n          var tmp6 = d1 - d6;\n          var tmp2 = d2 + d5;\n          var tmp5 = d2 - d5;\n          var tmp3 = d3 + d4;\n          var tmp4 = d3 - d4;\n    \n          /* Even part */\n          var tmp10 = tmp0 + tmp3;    /* phase 2 */\n          var tmp13 = tmp0 - tmp3;\n          var tmp11 = tmp1 + tmp2;\n          var tmp12 = tmp1 - tmp2;\n    \n          data[dataOff] = tmp10 + tmp11; /* phase 3 */\n          data[dataOff+4] = tmp10 - tmp11;\n    \n          var z1 = (tmp12 + tmp13) * 0.707106781; /* c4 */\n          data[dataOff+2] = tmp13 + z1; /* phase 5 */\n          data[dataOff+6] = tmp13 - z1;\n    \n          /* Odd part */\n          tmp10 = tmp4 + tmp5; /* phase 2 */\n          tmp11 = tmp5 + tmp6;\n          tmp12 = tmp6 + tmp7;\n    \n          /* The rotator is modified from fig 4-8 to avoid extra negations. */\n          var z5 = (tmp10 - tmp12) * 0.382683433; /* c6 */\n          var z2 = 0.541196100 * tmp10 + z5; /* c2-c6 */\n          var z4 = 1.306562965 * tmp12 + z5; /* c2+c6 */\n          var z3 = tmp11 * 0.707106781; /* c4 */\n    \n          var z11 = tmp7 + z3;    /* phase 5 */\n          var z13 = tmp7 - z3;\n    \n          data[dataOff+5] = z13 + z2; /* phase 6 */\n          data[dataOff+3] = z13 - z2;\n          data[dataOff+1] = z11 + z4;\n          data[dataOff+7] = z11 - z4;\n    \n          dataOff += 8; /* advance pointer to next row */\n        }\n    \n        /* Pass 2: process columns. */\n        dataOff = 0;\n        for (i=0; i<I8; ++i)\n        {\n          d0 = data[dataOff];\n          d1 = data[dataOff + 8];\n          d2 = data[dataOff + 16];\n          d3 = data[dataOff + 24];\n          d4 = data[dataOff + 32];\n          d5 = data[dataOff + 40];\n          d6 = data[dataOff + 48];\n          d7 = data[dataOff + 56];\n    \n          var tmp0p2 = d0 + d7;\n          var tmp7p2 = d0 - d7;\n          var tmp1p2 = d1 + d6;\n          var tmp6p2 = d1 - d6;\n          var tmp2p2 = d2 + d5;\n          var tmp5p2 = d2 - d5;\n          var tmp3p2 = d3 + d4;\n          var tmp4p2 = d3 - d4;\n    \n          /* Even part */\n          var tmp10p2 = tmp0p2 + tmp3p2;  /* phase 2 */\n          var tmp13p2 = tmp0p2 - tmp3p2;\n          var tmp11p2 = tmp1p2 + tmp2p2;\n          var tmp12p2 = tmp1p2 - tmp2p2;\n    \n          data[dataOff] = tmp10p2 + tmp11p2; /* phase 3 */\n          data[dataOff+32] = tmp10p2 - tmp11p2;\n    \n          var z1p2 = (tmp12p2 + tmp13p2) * 0.707106781; /* c4 */\n          data[dataOff+16] = tmp13p2 + z1p2; /* phase 5 */\n          data[dataOff+48] = tmp13p2 - z1p2;\n    \n          /* Odd part */\n          tmp10p2 = tmp4p2 + tmp5p2; /* phase 2 */\n          tmp11p2 = tmp5p2 + tmp6p2;\n          tmp12p2 = tmp6p2 + tmp7p2;\n    \n          /* The rotator is modified from fig 4-8 to avoid extra negations. */\n          var z5p2 = (tmp10p2 - tmp12p2) * 0.382683433; /* c6 */\n          var z2p2 = 0.541196100 * tmp10p2 + z5p2; /* c2-c6 */\n          var z4p2 = 1.306562965 * tmp12p2 + z5p2; /* c2+c6 */\n          var z3p2 = tmp11p2 * 0.707106781; /* c4 */\n    \n          var z11p2 = tmp7p2 + z3p2;  /* phase 5 */\n          var z13p2 = tmp7p2 - z3p2;\n    \n          data[dataOff+40] = z13p2 + z2p2; /* phase 6 */\n          data[dataOff+24] = z13p2 - z2p2;\n          data[dataOff+ 8] = z11p2 + z4p2;\n          data[dataOff+56] = z11p2 - z4p2;\n    \n          dataOff++; /* advance pointer to next column */\n        }\n    \n        // Quantize/descale the coefficients\n        var fDCTQuant;\n        for (i=0; i<I64; ++i)\n        {\n          // Apply the quantization and scaling factor & Round to nearest integer\n          fDCTQuant = data[i]*fdtbl[i];\n          outputfDCTQuant[i] = (fDCTQuant > 0.0) ? ((fDCTQuant + 0.5)|0) : ((fDCTQuant - 0.5)|0);\n          //outputfDCTQuant[i] = fround(fDCTQuant);\n    \n        }\n        return outputfDCTQuant;\n      }\n    \n      function writeAPP0()\n      {\n        writeWord(0xFFE0); // marker\n        writeWord(16); // length\n        writeByte(0x4A); // J\n        writeByte(0x46); // F\n        writeByte(0x49); // I\n        writeByte(0x46); // F\n        writeByte(0); // = \"JFIF\",'\\0'\n        writeByte(1); // versionhi\n        writeByte(1); // versionlo\n        writeByte(0); // xyunits\n        writeWord(1); // xdensity\n        writeWord(1); // ydensity\n        writeByte(0); // thumbnwidth\n        writeByte(0); // thumbnheight\n      }\n    \n      function writeSOF0(width, height)\n      {\n        writeWord(0xFFC0); // marker\n        writeWord(17);   // length, truecolor YUV JPG\n        writeByte(8);    // precision\n        writeWord(height);\n        writeWord(width);\n        writeByte(3);    // nrofcomponents\n        writeByte(1);    // IdY\n        writeByte(0x11); // HVY\n        writeByte(0);    // QTY\n        writeByte(2);    // IdU\n        writeByte(0x11); // HVU\n        writeByte(1);    // QTU\n        writeByte(3);    // IdV\n        writeByte(0x11); // HVV\n        writeByte(1);    // QTV\n      }\n    \n      function writeDQT()\n      {\n        writeWord(0xFFDB); // marker\n        writeWord(132);    // length\n        writeByte(0);\n        for (var i=0; i<64; i++) {\n          writeByte(YTable[i]);\n        }\n        writeByte(1);\n        for (var j=0; j<64; j++) {\n          writeByte(UVTable[j]);\n        }\n      }\n    \n      function writeDHT()\n      {\n        writeWord(0xFFC4); // marker\n        writeWord(0x01A2); // length\n    \n        writeByte(0); // HTYDCinfo\n        for (var i=0; i<16; i++) {\n          writeByte(std_dc_luminance_nrcodes[i+1]);\n        }\n        for (var j=0; j<=11; j++) {\n          writeByte(std_dc_luminance_values[j]);\n        }\n    \n        writeByte(0x10); // HTYACinfo\n        for (var k=0; k<16; k++) {\n          writeByte(std_ac_luminance_nrcodes[k+1]);\n        }\n        for (var l=0; l<=161; l++) {\n          writeByte(std_ac_luminance_values[l]);\n        }\n    \n        writeByte(1); // HTUDCinfo\n        for (var m=0; m<16; m++) {\n          writeByte(std_dc_chrominance_nrcodes[m+1]);\n        }\n        for (var n=0; n<=11; n++) {\n          writeByte(std_dc_chrominance_values[n]);\n        }\n    \n        writeByte(0x11); // HTUACinfo\n        for (var o=0; o<16; o++) {\n          writeByte(std_ac_chrominance_nrcodes[o+1]);\n        }\n        for (var p=0; p<=161; p++) {\n          writeByte(std_ac_chrominance_values[p]);\n        }\n      }\n    \n      function writeSOS()\n      {\n        writeWord(0xFFDA); // marker\n        writeWord(12); // length\n        writeByte(3); // nrofcomponents\n        writeByte(1); // IdY\n        writeByte(0); // HTY\n        writeByte(2); // IdU\n        writeByte(0x11); // HTU\n        writeByte(3); // IdV\n        writeByte(0x11); // HTV\n        writeByte(0); // Ss\n        writeByte(0x3f); // Se\n        writeByte(0); // Bf\n      }\n    \n      function processDU(CDU, fdtbl, DC, HTDC, HTAC){\n        var EOB = HTAC[0x00];\n        var M16zeroes = HTAC[0xF0];\n        var pos;\n        var I16 = 16;\n        var I63 = 63;\n        var I64 = 64;\n        var DU_DCT = fDCTQuant(CDU, fdtbl);\n        //ZigZag reorder\n        for (var j=0;j<I64;++j) {\n          DU[ZigZag[j]]=DU_DCT[j];\n        }\n        var Diff = DU[0] - DC; DC = DU[0];\n        //Encode DC\n        if (Diff==0) {\n          writeBits(HTDC[0]); // Diff might be 0\n        } else {\n          pos = 32767+Diff;\n          writeBits(HTDC[category[pos]]);\n          writeBits(bitcode[pos]);\n        }\n        //Encode ACs\n        var end0pos = 63; // was const... which is crazy\n        for (; (end0pos>0)&&(DU[end0pos]==0); end0pos--) {}\n        //end0pos = first element in reverse order !=0\n        if ( end0pos == 0) {\n          writeBits(EOB);\n          return DC;\n        }\n        var i = 1;\n        var lng;\n        while ( i <= end0pos ) {\n          var startpos = i;\n          for (; (DU[i]==0) && (i<=end0pos); ++i) {}\n          var nrzeroes = i-startpos;\n          if ( nrzeroes >= I16 ) {\n            lng = nrzeroes>>4;\n            for (var nrmarker=1; nrmarker <= lng; ++nrmarker)\n              writeBits(M16zeroes);\n            nrzeroes = nrzeroes&0xF;\n          }\n          pos = 32767+DU[i];\n          writeBits(HTAC[(nrzeroes<<4)+category[pos]]);\n          writeBits(bitcode[pos]);\n          i++;\n        }\n        if ( end0pos != I63 ) {\n          writeBits(EOB);\n        }\n        return DC;\n      }\n    \n      function initCharLookupTable(){\n        var sfcc = String.fromCharCode;\n        for(var i=0; i < 256; i++){ ///// ACHTUNG // 255\n          clt[i] = sfcc(i);\n        }\n      }\n    \n      this.encode = function(image,quality) // image data object\n      {\n        // var time_start = new Date().getTime();\n    \n        if(quality) setQuality(quality);\n    \n        // Initialize bit writer\n        byteout = new Array();\n        bytenew=0;\n        bytepos=7;\n    \n        // Add JPEG headers\n        writeWord(0xFFD8); // SOI\n        writeAPP0();\n        writeDQT();\n        writeSOF0(image.width,image.height);\n        writeDHT();\n        writeSOS();\n    \n    \n        // Encode 8x8 macroblocks\n        var DCY=0;\n        var DCU=0;\n        var DCV=0;\n    \n        bytenew=0;\n        bytepos=7;\n    \n    \n        this.encode.displayName = '_encode_';\n    \n        var imageData = image.data;\n        var width = image.width;\n        var height = image.height;\n    \n        var quadWidth = width*4;\n        var tripleWidth = width*3;\n    \n        var x, y = 0;\n        var r, g, b;\n        var start,p, col,row,pos;\n        while(y < height){\n          x = 0;\n          while(x < quadWidth){\n            start = quadWidth * y + x;\n            p = start;\n            col = -1;\n            row = 0;\n    \n            for(pos=0; pos < 64; pos++){\n              row = pos >> 3;// /8\n              col = ( pos & 7 ) * 4; // %8\n              p = start + ( row * quadWidth ) + col;\n    \n              if(y+row >= height){ // padding bottom\n                p-= (quadWidth*(y+1+row-height));\n              }\n    \n              if(x+col >= quadWidth){ // padding right\n                p-= ((x+col) - quadWidth +4);\n              }\n    \n              r = imageData[ p++ ];\n              g = imageData[ p++ ];\n              b = imageData[ p++ ];\n    \n    \n              /* // calculate YUV values dynamically\n                            YDU[pos]=((( 0.29900)*r+( 0.58700)*g+( 0.11400)*b))-128; //-0x80\n                            UDU[pos]=(((-0.16874)*r+(-0.33126)*g+( 0.50000)*b));\n                            VDU[pos]=((( 0.50000)*r+(-0.41869)*g+(-0.08131)*b));\n                            */\n    \n              // use lookup table (slightly faster)\n              YDU[pos] = ((RGB_YUV_TABLE[r]             + RGB_YUV_TABLE[(g +  256)>>0] + RGB_YUV_TABLE[(b +  512)>>0]) >> 16)-128;\n              UDU[pos] = ((RGB_YUV_TABLE[(r +  768)>>0] + RGB_YUV_TABLE[(g + 1024)>>0] + RGB_YUV_TABLE[(b + 1280)>>0]) >> 16)-128;\n              VDU[pos] = ((RGB_YUV_TABLE[(r + 1280)>>0] + RGB_YUV_TABLE[(g + 1536)>>0] + RGB_YUV_TABLE[(b + 1792)>>0]) >> 16)-128;\n    \n            }\n    \n            DCY = processDU(YDU, fdtbl_Y, DCY, YDC_HT, YAC_HT);\n            DCU = processDU(UDU, fdtbl_UV, DCU, UVDC_HT, UVAC_HT);\n            DCV = processDU(VDU, fdtbl_UV, DCV, UVDC_HT, UVAC_HT);\n            x+=32;\n          }\n          y+=8;\n        }\n    \n    \n        ////////////////////////////////////////////////////////////////\n    \n        // Do the bit alignment of the EOI marker\n        if ( bytepos >= 0 ) {\n          var fillbits = [];\n          fillbits[1] = bytepos+1;\n          fillbits[0] = (1<<(bytepos+1))-1;\n          writeBits(fillbits);\n        }\n    \n        writeWord(0xFFD9); //EOI\n    \n        var jpegDataUri = 'data:image/jpeg;base64,' + btoa(byteout.join(''));\n    \n        byteout = [];\n    \n        // benchmarking\n        // var duration = new Date().getTime() - time_start;\n        // console.log('Encoding time: '+ currentQuality + 'ms');\n        //\n    \n        return jpegDataUri;\n      };\n    \n      function setQuality(quality){\n        if (quality <= 0) {\n          quality = 1;\n        }\n        if (quality > 100) {\n          quality = 100;\n        }\n    \n        if(currentQuality == quality) return; // don't recalc if unchanged\n    \n        var sf = 0;\n        if (quality < 50) {\n          sf = Math.floor(5000 / quality);\n        } else {\n          sf = Math.floor(200 - quality*2);\n        }\n    \n        initQuantTables(sf);\n        currentQuality = quality;\n        // console.log('Quality set to: '+quality +'%');\n      }\n    \n      function init(){\n        // var time_start = new Date().getTime();\n        if(!quality) quality = 50;\n        // Create tables\n        initCharLookupTable();\n        initHuffmanTbl();\n        initCategoryNumber();\n        initRGBYUVTable();\n    \n        setQuality(quality);\n        // var duration = new Date().getTime() - time_start;\n        // console.log('Initialization '+ duration + 'ms');\n      }\n    \n      init();\n    \n    }\n    \n    JPEGEncoder.encode = function( data, quality ) {\n      var encoder = new JPEGEncoder( quality );\n    \n      return encoder.encode( data );\n    };\n    \n    return JPEGEncoder;\n  });\n  /**\n     * @fileOverview Fix android canvas.toDataUrl bug.\n     */\n  define('runtime/html5/androidpatch',[\n    'runtime/html5/util',\n    'runtime/html5/jpegencoder',\n    'base'\n  ], function( Util, encoder, Base ) {\n    var origin = Util.canvasToDataUrl,\n      supportJpeg;\n    \n    Util.canvasToDataUrl = function( canvas, type, quality ) {\n      var ctx, w, h, fragement, parts;\n    \n      // 非android手机直接跳过。\n      if ( !Base.os.android ) {\n        return origin.apply( null, arguments );\n      }\n    \n      // 检测是否canvas支持jpeg导出，根据数据格式来判断。\n      // JPEG 前两位分别是：255, 216\n      if ( type === 'image/jpeg' && typeof supportJpeg === 'undefined' ) {\n        fragement = origin.apply( null, arguments );\n    \n        parts = fragement.split(',');\n    \n        if ( ~parts[ 0 ].indexOf('base64') ) {\n          fragement = atob( parts[ 1 ] );\n        } else {\n          fragement = decodeURIComponent( parts[ 1 ] );\n        }\n    \n        fragement = fragement.substring( 0, 2 );\n    \n        supportJpeg = fragement.charCodeAt( 0 ) === 255 &&\n                        fragement.charCodeAt( 1 ) === 216;\n      }\n    \n      // 只有在android环境下才修复\n      if ( type === 'image/jpeg' && !supportJpeg ) {\n        w = canvas.width;\n        h = canvas.height;\n        ctx = canvas.getContext('2d');\n    \n        return encoder.encode( ctx.getImageData( 0, 0, w, h ), quality );\n      }\n    \n      return origin.apply( null, arguments );\n    };\n  });\n  /**\n     * @fileOverview Image\n     */\n  define('runtime/html5/image',[\n    'base',\n    'runtime/html5/runtime',\n    'runtime/html5/util'\n  ], function( Base, Html5Runtime, Util ) {\n    \n    var BLANK = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D';\n    \n    return Html5Runtime.register( 'Image', {\n    \n      // flag: 标记是否被修改过。\n      modified: false,\n    \n      init: function() {\n        var me = this,\n          img = new Image();\n    \n        img.onload = function() {\n    \n          me._info = {\n            type: me.type,\n            width: this.width,\n            height: this.height\n          };\n    \n          // 读取meta信息。\n          if ( !me._metas && 'image/jpeg' === me.type ) {\n            Util.parseMeta( me._blob, function( error, ret ) {\n              me._metas = ret;\n              me.owner.trigger('load');\n            });\n          } else {\n            me.owner.trigger('load');\n          }\n        };\n    \n        img.onerror = function() {\n          me.owner.trigger('error');\n        };\n    \n        me._img = img;\n      },\n    \n      loadFromBlob: function( blob ) {\n        var me = this,\n          img = me._img;\n    \n        me._blob = blob;\n        me.type = blob.type;\n        img.src = Util.createObjectURL( blob.getSource() );\n        me.owner.once( 'load', function() {\n          Util.revokeObjectURL( img.src );\n        });\n      },\n    \n      resize: function( width, height ) {\n        var canvas = this._canvas ||\n                        (this._canvas = document.createElement('canvas'));\n    \n        this._resize( this._img, canvas, width, height );\n        this._blob = null;    // 没用了，可以删掉了。\n        this.modified = true;\n        this.owner.trigger( 'complete', 'resize' );\n      },\n    \n      crop: function( x, y, w, h, s ) {\n        var cvs = this._canvas ||\n                        (this._canvas = document.createElement('canvas')),\n          opts = this.options,\n          img = this._img,\n          iw = img.naturalWidth,\n          ih = img.naturalHeight,\n          orientation = this.getOrientation();\n    \n        s = s || 1;\n    \n        // todo 解决 orientation 的问题。\n        // values that require 90 degree rotation\n        // if ( ~[ 5, 6, 7, 8 ].indexOf( orientation ) ) {\n    \n        //     switch ( orientation ) {\n        //         case 6:\n        //             tmp = x;\n        //             x = y;\n        //             y = iw * s - tmp - w;\n        //             console.log(ih * s, tmp, w)\n        //             break;\n        //     }\n    \n        //     (w ^= h, h ^= w, w ^= h);\n        // }\n    \n        cvs.width = w;\n        cvs.height = h;\n    \n        opts.preserveHeaders || this._rotate2Orientaion( cvs, orientation );\n        this._renderImageToCanvas( cvs, img, -x, -y, iw * s, ih * s );\n    \n        this._blob = null;    // 没用了，可以删掉了。\n        this.modified = true;\n        this.owner.trigger( 'complete', 'crop' );\n      },\n    \n      getAsBlob: function( type ) {\n        var blob = this._blob,\n          opts = this.options,\n          canvas;\n    \n        type = type || this.type;\n    \n        // blob需要重新生成。\n        if ( this.modified || this.type !== type ) {\n          canvas = this._canvas;\n    \n          if ( type === 'image/jpeg' ) {\n    \n            blob = Util.canvasToDataUrl( canvas, type, opts.quality );\n    \n            if ( opts.preserveHeaders && this._metas &&\n                                this._metas.imageHead ) {\n    \n              blob = Util.dataURL2ArrayBuffer( blob );\n              blob = Util.updateImageHead( blob,\n                this._metas.imageHead );\n              blob = Util.arrayBufferToBlob( blob, type );\n              return blob;\n            }\n          } else {\n            blob = Util.canvasToDataUrl( canvas, type );\n          }\n    \n          blob = Util.dataURL2Blob( blob );\n        }\n    \n        return blob;\n      },\n    \n      getAsDataUrl: function( type ) {\n        var opts = this.options;\n    \n        type = type || this.type;\n    \n        if ( type === 'image/jpeg' ) {\n          return Util.canvasToDataUrl( this._canvas, type, opts.quality );\n        } else {\n          return this._canvas.toDataURL( type );\n        }\n      },\n    \n      getOrientation: function() {\n        return this._metas && this._metas.exif &&\n                        this._metas.exif.get('Orientation') || 1;\n      },\n    \n      info: function( val ) {\n    \n        // setter\n        if ( val ) {\n          this._info = val;\n          return this;\n        }\n    \n        // getter\n        return this._info;\n      },\n    \n      meta: function( val ) {\n    \n        // setter\n        if ( val ) {\n          this._meta = val;\n          return this;\n        }\n    \n        // getter\n        return this._meta;\n      },\n    \n      destroy: function() {\n        var canvas = this._canvas;\n        this._img.onload = null;\n    \n        if ( canvas ) {\n          canvas.getContext('2d')\n            .clearRect( 0, 0, canvas.width, canvas.height );\n          canvas.width = canvas.height = 0;\n          this._canvas = null;\n        }\n    \n        // 释放内存。非常重要，否则释放不了image的内存。\n        this._img.src = BLANK;\n        this._img = this._blob = null;\n      },\n    \n      _resize: function( img, cvs, width, height ) {\n        var opts = this.options,\n          naturalWidth = img.width,\n          naturalHeight = img.height,\n          orientation = this.getOrientation(),\n          scale, w, h, x, y;\n    \n        // values that require 90 degree rotation\n        if ( ~[ 5, 6, 7, 8 ].indexOf( orientation ) ) {\n    \n          // 交换width, height的值。\n          width ^= height;\n          height ^= width;\n          width ^= height;\n        }\n    \n        scale = Math[ opts.crop ? 'max' : 'min' ]( width / naturalWidth,\n          height / naturalHeight );\n    \n        // 不允许放大。\n        opts.allowMagnify || (scale = Math.min( 1, scale ));\n    \n        w = naturalWidth * scale;\n        h = naturalHeight * scale;\n    \n        if ( opts.crop ) {\n          cvs.width = width;\n          cvs.height = height;\n        } else {\n          cvs.width = w;\n          cvs.height = h;\n        }\n    \n        x = (cvs.width - w) / 2;\n        y = (cvs.height - h) / 2;\n    \n        opts.preserveHeaders || this._rotate2Orientaion( cvs, orientation );\n    \n        this._renderImageToCanvas( cvs, img, x, y, w, h );\n      },\n    \n      _rotate2Orientaion: function( canvas, orientation ) {\n        var width = canvas.width,\n          height = canvas.height,\n          ctx = canvas.getContext('2d');\n    \n        switch ( orientation ) {\n        case 5:\n        case 6:\n        case 7:\n        case 8:\n          canvas.width = height;\n          canvas.height = width;\n          break;\n        }\n    \n        switch ( orientation ) {\n        case 2:    // horizontal flip\n          ctx.translate( width, 0 );\n          ctx.scale( -1, 1 );\n          break;\n    \n        case 3:    // 180 rotate left\n          ctx.translate( width, height );\n          ctx.rotate( Math.PI );\n          break;\n    \n        case 4:    // vertical flip\n          ctx.translate( 0, height );\n          ctx.scale( 1, -1 );\n          break;\n    \n        case 5:    // vertical flip + 90 rotate right\n          ctx.rotate( 0.5 * Math.PI );\n          ctx.scale( 1, -1 );\n          break;\n    \n        case 6:    // 90 rotate right\n          ctx.rotate( 0.5 * Math.PI );\n          ctx.translate( 0, -height );\n          break;\n    \n        case 7:    // horizontal flip + 90 rotate right\n          ctx.rotate( 0.5 * Math.PI );\n          ctx.translate( width, -height );\n          ctx.scale( -1, 1 );\n          break;\n    \n        case 8:    // 90 rotate left\n          ctx.rotate( -0.5 * Math.PI );\n          ctx.translate( -width, 0 );\n          break;\n        }\n      },\n    \n      // https://github.com/stomita/ios-imagefile-megapixel/\n      // blob/master/src/megapix-image.js\n      _renderImageToCanvas: (function() {\n    \n        // 如果不是ios, 不需要这么复杂！\n        if ( !Base.os.ios ) {\n          return function( canvas ) {\n            var args = Base.slice( arguments, 1 ),\n              ctx = canvas.getContext('2d');\n    \n            ctx.drawImage.apply( ctx, args );\n          };\n        }\n    \n        /**\n                 * Detecting vertical squash in loaded image.\n                 * Fixes a bug which squash image vertically while drawing into\n                 * canvas for some images.\n                 */\n        function detectVerticalSquash( img, iw, ih ) {\n          var canvas = document.createElement('canvas'),\n            ctx = canvas.getContext('2d'),\n            sy = 0,\n            ey = ih,\n            py = ih,\n            data, alpha, ratio;\n    \n    \n          canvas.width = 1;\n          canvas.height = ih;\n          ctx.drawImage( img, 0, 0 );\n          data = ctx.getImageData( 0, 0, 1, ih ).data;\n    \n          // search image edge pixel position in case\n          // it is squashed vertically.\n          while ( py > sy ) {\n            alpha = data[ (py - 1) * 4 + 3 ];\n    \n            if ( alpha === 0 ) {\n              ey = py;\n            } else {\n              sy = py;\n            }\n    \n            py = (ey + sy) >> 1;\n          }\n    \n          ratio = (py / ih);\n          return (ratio === 0) ? 1 : ratio;\n        }\n    \n        // fix ie7 bug\n        // http://stackoverflow.com/questions/11929099/\n        // html5-canvas-drawimage-ratio-bug-ios\n        if ( Base.os.ios >= 7 ) {\n          return function( canvas, img, x, y, w, h ) {\n            var iw = img.naturalWidth,\n              ih = img.naturalHeight,\n              vertSquashRatio = detectVerticalSquash( img, iw, ih );\n    \n            return canvas.getContext('2d').drawImage( img, 0, 0,\n              iw * vertSquashRatio, ih * vertSquashRatio,\n              x, y, w, h );\n          };\n        }\n    \n        /**\n                 * Detect subsampling in loaded image.\n                 * In iOS, larger images than 2M pixels may be\n                 * subsampled in rendering.\n                 */\n        function detectSubsampling( img ) {\n          var iw = img.naturalWidth,\n            ih = img.naturalHeight,\n            canvas, ctx;\n    \n          // subsampling may happen overmegapixel image\n          if ( iw * ih > 1024 * 1024 ) {\n            canvas = document.createElement('canvas');\n            canvas.width = canvas.height = 1;\n            ctx = canvas.getContext('2d');\n            ctx.drawImage( img, -iw + 1, 0 );\n    \n            // subsampled image becomes half smaller in rendering size.\n            // check alpha channel value to confirm image is covering\n            // edge pixel or not. if alpha value is 0\n            // image is not covering, hence subsampled.\n            return ctx.getImageData( 0, 0, 1, 1 ).data[ 3 ] === 0;\n          } else {\n            return false;\n          }\n        }\n    \n    \n        return function( canvas, img, x, y, width, height ) {\n          var iw = img.naturalWidth,\n            ih = img.naturalHeight,\n            ctx = canvas.getContext('2d'),\n            subsampled = detectSubsampling( img ),\n            doSquash = this.type === 'image/jpeg',\n            d = 1024,\n            sy = 0,\n            dy = 0,\n            tmpCanvas, tmpCtx, vertSquashRatio, dw, dh, sx, dx;\n    \n          if ( subsampled ) {\n            iw /= 2;\n            ih /= 2;\n          }\n    \n          ctx.save();\n          tmpCanvas = document.createElement('canvas');\n          tmpCanvas.width = tmpCanvas.height = d;\n    \n          tmpCtx = tmpCanvas.getContext('2d');\n          vertSquashRatio = doSquash ?\n            detectVerticalSquash( img, iw, ih ) : 1;\n    \n          dw = Math.ceil( d * width / iw );\n          dh = Math.ceil( d * height / ih / vertSquashRatio );\n    \n          while ( sy < ih ) {\n            sx = 0;\n            dx = 0;\n            while ( sx < iw ) {\n              tmpCtx.clearRect( 0, 0, d, d );\n              tmpCtx.drawImage( img, -sx, -sy );\n              ctx.drawImage( tmpCanvas, 0, 0, d, d,\n                x + dx, y + dy, dw, dh );\n              sx += d;\n              dx += dw;\n            }\n            sy += d;\n            dy += dh;\n          }\n          ctx.restore();\n          tmpCanvas = tmpCtx = null;\n        };\n      })()\n    });\n  });\n  /**\n     * @fileOverview Transport\n     * @todo 支持chunked传输，优势：\n     * 可以将大文件分成小块，挨个传输，可以提高大文件成功率，当失败的时候，也只需要重传那小部分，\n     * 而不需要重头再传一次。另外断点续传也需要用chunked方式。\n     */\n  define('runtime/html5/transport',[\n    'base',\n    'runtime/html5/runtime'\n  ], function( Base, Html5Runtime ) {\n    \n    var noop = Base.noop,\n      $ = Base.$;\n    \n    return Html5Runtime.register( 'Transport', {\n      init: function() {\n        this._status = 0;\n        this._response = null;\n      },\n    \n      send: function() {\n        var owner = this.owner,\n          opts = this.options,\n          xhr = this._initAjax(),\n          blob = owner._blob,\n          server = opts.server,\n          formData, binary, fr;\n    \n        if ( opts.sendAsBinary ) {\n          server += (/\\?/.test( server ) ? '&' : '?') +\n                            $.param( owner._formData );\n    \n          binary = blob.getSource();\n        } else {\n          formData = new FormData();\n          $.each( owner._formData, function( k, v ) {\n            formData.append( k, v );\n          });\n    \n          formData.append( opts.fileVal, blob.getSource(),\n            opts.filename || owner._formData.name || '' );\n        }\n    \n        if ( opts.withCredentials && 'withCredentials' in xhr ) {\n          xhr.open( opts.method, server, true );\n          xhr.withCredentials = true;\n        } else {\n          xhr.open( opts.method, server );\n        }\n    \n        this._setRequestHeader( xhr, opts.headers );\n    \n        if ( binary ) {\n          // 强制设置成 content-type 为文件流。\n          xhr.overrideMimeType &&\n                            xhr.overrideMimeType('application/octet-stream');\n    \n          // android直接发送blob会导致服务端接收到的是空文件。\n          // bug详情。\n          // https://code.google.com/p/android/issues/detail?id=39882\n          // 所以先用fileReader读取出来再通过arraybuffer的方式发送。\n          if ( Base.os.android ) {\n            fr = new FileReader();\n    \n            fr.onload = function() {\n              xhr.send( this.result );\n              fr = fr.onload = null;\n            };\n    \n            fr.readAsArrayBuffer( binary );\n          } else {\n            xhr.send( binary );\n          }\n        } else {\n          xhr.send( formData );\n        }\n      },\n    \n      getResponse: function() {\n        return this._response;\n      },\n    \n      getResponseAsJson: function() {\n        return this._parseJson( this._response );\n      },\n    \n      getStatus: function() {\n        return this._status;\n      },\n    \n      abort: function() {\n        var xhr = this._xhr;\n    \n        if ( xhr ) {\n          xhr.upload.onprogress = noop;\n          xhr.onreadystatechange = noop;\n          xhr.abort();\n    \n          this._xhr = xhr = null;\n        }\n      },\n    \n      destroy: function() {\n        this.abort();\n      },\n    \n      _initAjax: function() {\n        var me = this,\n          xhr = new XMLHttpRequest(),\n          opts = this.options;\n    \n        if ( opts.withCredentials && !('withCredentials' in xhr) &&\n                        typeof XDomainRequest !== 'undefined' ) {\n          xhr = new XDomainRequest();\n        }\n    \n        xhr.upload.onprogress = function( e ) {\n          var percentage = 0;\n    \n          if ( e.lengthComputable ) {\n            percentage = e.loaded / e.total;\n          }\n    \n          return me.trigger( 'progress', percentage );\n        };\n    \n        xhr.onreadystatechange = function() {\n    \n          if ( xhr.readyState !== 4 ) {\n            return;\n          }\n    \n          xhr.upload.onprogress = noop;\n          xhr.onreadystatechange = noop;\n          me._xhr = null;\n          me._status = xhr.status;\n    \n          if ( xhr.status >= 200 && xhr.status < 300 ) {\n            me._response = xhr.responseText;\n            return me.trigger('load');\n          } else if ( xhr.status >= 500 && xhr.status < 600 ) {\n            me._response = xhr.responseText;\n            return me.trigger( 'error', 'server' );\n          }\n    \n    \n          return me.trigger( 'error', me._status ? 'http' : 'abort' );\n        };\n    \n        me._xhr = xhr;\n        return xhr;\n      },\n    \n      _setRequestHeader: function( xhr, headers ) {\n        $.each( headers, function( key, val ) {\n          xhr.setRequestHeader( key, val );\n        });\n      },\n    \n      _parseJson: function( str ) {\n        var json;\n    \n        try {\n          json = JSON.parse( str );\n        } catch ( ex ) {\n          json = {};\n        }\n    \n        return json;\n      }\n    });\n  });\n  /**\n     * @fileOverview  Transport flash实现\n     */\n  define('runtime/html5/md5',[\n    'runtime/html5/runtime'\n  ], function( FlashRuntime ) {\n    \n    /*\n         * Fastest md5 implementation around (JKM md5)\n         * Credits: Joseph Myers\n         *\n         * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n         * @see http://jsperf.com/md5-shootout/7\n         */\n    \n    /* this function is much faster,\n          so if possible we use it. Some IEs\n          are the only ones I know of that\n          need the idiotic second function,\n          generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n      },\n    \n      cmn = function (q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n      },\n    \n      ff = function (a, b, c, d, x, s, t) {\n        return cmn((b & c) | ((~b) & d), a, b, x, s, t);\n      },\n    \n      gg = function (a, b, c, d, x, s, t) {\n        return cmn((b & d) | (c & (~d)), a, b, x, s, t);\n      },\n    \n      hh = function (a, b, c, d, x, s, t) {\n        return cmn(b ^ c ^ d, a, b, x, s, t);\n      },\n    \n      ii = function (a, b, c, d, x, s, t) {\n        return cmn(c ^ (b | (~d)), a, b, x, s, t);\n      },\n    \n      md5cycle = function (x, k) {\n        var a = x[0],\n          b = x[1],\n          c = x[2],\n          d = x[3];\n    \n        a = ff(a, b, c, d, k[0], 7, -680876936);\n        d = ff(d, a, b, c, k[1], 12, -389564586);\n        c = ff(c, d, a, b, k[2], 17, 606105819);\n        b = ff(b, c, d, a, k[3], 22, -1044525330);\n        a = ff(a, b, c, d, k[4], 7, -176418897);\n        d = ff(d, a, b, c, k[5], 12, 1200080426);\n        c = ff(c, d, a, b, k[6], 17, -1473231341);\n        b = ff(b, c, d, a, k[7], 22, -45705983);\n        a = ff(a, b, c, d, k[8], 7, 1770035416);\n        d = ff(d, a, b, c, k[9], 12, -1958414417);\n        c = ff(c, d, a, b, k[10], 17, -42063);\n        b = ff(b, c, d, a, k[11], 22, -1990404162);\n        a = ff(a, b, c, d, k[12], 7, 1804603682);\n        d = ff(d, a, b, c, k[13], 12, -40341101);\n        c = ff(c, d, a, b, k[14], 17, -1502002290);\n        b = ff(b, c, d, a, k[15], 22, 1236535329);\n    \n        a = gg(a, b, c, d, k[1], 5, -165796510);\n        d = gg(d, a, b, c, k[6], 9, -1069501632);\n        c = gg(c, d, a, b, k[11], 14, 643717713);\n        b = gg(b, c, d, a, k[0], 20, -373897302);\n        a = gg(a, b, c, d, k[5], 5, -701558691);\n        d = gg(d, a, b, c, k[10], 9, 38016083);\n        c = gg(c, d, a, b, k[15], 14, -660478335);\n        b = gg(b, c, d, a, k[4], 20, -405537848);\n        a = gg(a, b, c, d, k[9], 5, 568446438);\n        d = gg(d, a, b, c, k[14], 9, -1019803690);\n        c = gg(c, d, a, b, k[3], 14, -187363961);\n        b = gg(b, c, d, a, k[8], 20, 1163531501);\n        a = gg(a, b, c, d, k[13], 5, -1444681467);\n        d = gg(d, a, b, c, k[2], 9, -51403784);\n        c = gg(c, d, a, b, k[7], 14, 1735328473);\n        b = gg(b, c, d, a, k[12], 20, -1926607734);\n    \n        a = hh(a, b, c, d, k[5], 4, -378558);\n        d = hh(d, a, b, c, k[8], 11, -2022574463);\n        c = hh(c, d, a, b, k[11], 16, 1839030562);\n        b = hh(b, c, d, a, k[14], 23, -35309556);\n        a = hh(a, b, c, d, k[1], 4, -1530992060);\n        d = hh(d, a, b, c, k[4], 11, 1272893353);\n        c = hh(c, d, a, b, k[7], 16, -155497632);\n        b = hh(b, c, d, a, k[10], 23, -1094730640);\n        a = hh(a, b, c, d, k[13], 4, 681279174);\n        d = hh(d, a, b, c, k[0], 11, -358537222);\n        c = hh(c, d, a, b, k[3], 16, -722521979);\n        b = hh(b, c, d, a, k[6], 23, 76029189);\n        a = hh(a, b, c, d, k[9], 4, -640364487);\n        d = hh(d, a, b, c, k[12], 11, -421815835);\n        c = hh(c, d, a, b, k[15], 16, 530742520);\n        b = hh(b, c, d, a, k[2], 23, -995338651);\n    \n        a = ii(a, b, c, d, k[0], 6, -198630844);\n        d = ii(d, a, b, c, k[7], 10, 1126891415);\n        c = ii(c, d, a, b, k[14], 15, -1416354905);\n        b = ii(b, c, d, a, k[5], 21, -57434055);\n        a = ii(a, b, c, d, k[12], 6, 1700485571);\n        d = ii(d, a, b, c, k[3], 10, -1894986606);\n        c = ii(c, d, a, b, k[10], 15, -1051523);\n        b = ii(b, c, d, a, k[1], 21, -2054922799);\n        a = ii(a, b, c, d, k[8], 6, 1873313359);\n        d = ii(d, a, b, c, k[15], 10, -30611744);\n        c = ii(c, d, a, b, k[6], 15, -1560198380);\n        b = ii(b, c, d, a, k[13], 21, 1309151649);\n        a = ii(a, b, c, d, k[4], 6, -145523070);\n        d = ii(d, a, b, c, k[11], 10, -1120210379);\n        c = ii(c, d, a, b, k[2], 15, 718787259);\n        b = ii(b, c, d, a, k[9], 21, -343485551);\n    \n        x[0] = add32(a, x[0]);\n        x[1] = add32(b, x[1]);\n        x[2] = add32(c, x[2]);\n        x[3] = add32(d, x[3]);\n      },\n    \n      /* there needs to be support for Unicode here,\n           * unless we pretend that we can redefine the MD-5\n           * algorithm for multi-byte characters (perhaps\n           * by adding every four 16-bit characters and\n           * shortening the sum to 32 bits). Otherwise\n           * I suggest performing MD-5 as if every character\n           * was two bytes--e.g., 0040 0025 = @%--but then\n           * how will an ordinary MD-5 sum be matched?\n           * There is no way to standardize text to something\n           * like UTF-8 before transformation; speed cost is\n           * utterly prohibitive. The JavaScript standard\n           * itself needs to look at this: it should start\n           * providing access to strings as preformed UTF-8\n           * 8-bit unsigned value arrays.\n           */\n      md5blk = function (s) {\n        var md5blks = [],\n          i; /* Andy King said do it this way. */\n    \n        for (i = 0; i < 64; i += 4) {\n          md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n      },\n    \n      md5blk_array = function (a) {\n        var md5blks = [],\n          i; /* Andy King said do it this way. */\n    \n        for (i = 0; i < 64; i += 4) {\n          md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n      },\n    \n      md51 = function (s) {\n        var n = s.length,\n          state = [1732584193, -271733879, -1732584194, 271733878],\n          i,\n          length,\n          tail,\n          tmp,\n          lo,\n          hi;\n    \n        for (i = 64; i <= n; i += 64) {\n          md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n          tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n          md5cycle(state, tail);\n          for (i = 0; i < 16; i += 1) {\n            tail[i] = 0;\n          }\n        }\n    \n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n    \n        tail[14] = lo;\n        tail[15] = hi;\n    \n        md5cycle(state, tail);\n        return state;\n      },\n    \n      md51_array = function (a) {\n        var n = a.length,\n          state = [1732584193, -271733879, -1732584194, 271733878],\n          i,\n          length,\n          tail,\n          tmp,\n          lo,\n          hi;\n    \n        for (i = 64; i <= n; i += 64) {\n          md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n    \n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n    \n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n          tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n    \n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n          md5cycle(state, tail);\n          for (i = 0; i < 16; i += 1) {\n            tail[i] = 0;\n          }\n        }\n    \n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n    \n        tail[14] = lo;\n        tail[15] = hi;\n    \n        md5cycle(state, tail);\n    \n        return state;\n      },\n    \n      hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'],\n    \n      rhex = function (n) {\n        var s = '',\n          j;\n        for (j = 0; j < 4; j += 1) {\n          s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n      },\n    \n      hex = function (x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n          x[i] = rhex(x[i]);\n        }\n        return x.join('');\n      },\n    \n      md5 = function (s) {\n        return hex(md51(s));\n      },\n    \n    \n    \n      ////////////////////////////////////////////////////////////////////////////\n    \n      /**\n         * SparkMD5 OOP implementation.\n         *\n         * Use this class to perform an incremental md5, otherwise use the\n         * static methods instead.\n         */\n      SparkMD5 = function () {\n        // call reset to init the instance\n        this.reset();\n      };\n    \n    \n    // In some cases the fast add32 function cannot be used..\n    if (md5('hello') !== '5d41402abc4b2a76b9719d911017c592') {\n      add32 = function (x, y) {\n        var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n          msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n        return (msw << 16) | (lsw & 0xFFFF);\n      };\n    }\n    \n    \n    /**\n         * Appends a string.\n         * A conversion will be applied if an utf8 string is detected.\n         *\n         * @param {String} str The string to be appended\n         *\n         * @return {SparkMD5} The instance itself\n         */\n    SparkMD5.prototype.append = function (str) {\n      // converts the string to utf8 bytes if necessary\n      if (/[\\u0080-\\uFFFF]/.test(str)) {\n        str = unescape(encodeURIComponent(str));\n      }\n    \n      // then append as binary\n      this.appendBinary(str);\n    \n      return this;\n    };\n    \n    /**\n         * Appends a binary string.\n         *\n         * @param {String} contents The binary string to be appended\n         *\n         * @return {SparkMD5} The instance itself\n         */\n    SparkMD5.prototype.appendBinary = function (contents) {\n      this._buff += contents;\n      this._length += contents.length;\n    \n      var length = this._buff.length,\n        i;\n    \n      for (i = 64; i <= length; i += 64) {\n        md5cycle(this._state, md5blk(this._buff.substring(i - 64, i)));\n      }\n    \n      this._buff = this._buff.substr(i - 64);\n    \n      return this;\n    };\n    \n    /**\n         * Finishes the incremental computation, reseting the internal state and\n         * returning the result.\n         * Use the raw parameter to obtain the raw result instead of the hex one.\n         *\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n    SparkMD5.prototype.end = function (raw) {\n      var buff = this._buff,\n        length = buff.length,\n        i,\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n        ret;\n    \n      for (i = 0; i < length; i += 1) {\n        tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n      }\n    \n      this._finish(tail, length);\n      ret = raw ? this._state : hex(this._state);\n    \n      this.reset();\n    \n      return ret;\n    };\n    \n    /**\n         * Finish the final calculation based on the tail.\n         *\n         * @param {Array}  tail   The tail (will be modified)\n         * @param {Number} length The length of the remaining buffer\n         */\n    SparkMD5.prototype._finish = function (tail, length) {\n      var i = length,\n        tmp,\n        lo,\n        hi;\n    \n      tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n      if (i > 55) {\n        md5cycle(this._state, tail);\n        for (i = 0; i < 16; i += 1) {\n          tail[i] = 0;\n        }\n      }\n    \n      // Do the final computation based on the tail and length\n      // Beware that the final length may not fit in 32 bits so we take care of that\n      tmp = this._length * 8;\n      tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n      lo = parseInt(tmp[2], 16);\n      hi = parseInt(tmp[1], 16) || 0;\n    \n      tail[14] = lo;\n      tail[15] = hi;\n      md5cycle(this._state, tail);\n    };\n    \n    /**\n         * Resets the internal state of the computation.\n         *\n         * @return {SparkMD5} The instance itself\n         */\n    SparkMD5.prototype.reset = function () {\n      this._buff = '';\n      this._length = 0;\n      this._state = [1732584193, -271733879, -1732584194, 271733878];\n    \n      return this;\n    };\n    \n    /**\n         * Releases memory used by the incremental buffer and other aditional\n         * resources. If you plan to use the instance again, use reset instead.\n         */\n    SparkMD5.prototype.destroy = function () {\n      delete this._state;\n      delete this._buff;\n      delete this._length;\n    };\n    \n    \n    /**\n         * Performs the md5 hash on a string.\n         * A conversion will be applied if utf8 string is detected.\n         *\n         * @param {String}  str The string\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n    SparkMD5.hash = function (str, raw) {\n      // converts the string to utf8 bytes if necessary\n      if (/[\\u0080-\\uFFFF]/.test(str)) {\n        str = unescape(encodeURIComponent(str));\n      }\n    \n      var hash = md51(str);\n    \n      return raw ? hash : hex(hash);\n    };\n    \n    /**\n         * Performs the md5 hash on a binary string.\n         *\n         * @param {String}  content The binary string\n         * @param {Boolean} raw     True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n    SparkMD5.hashBinary = function (content, raw) {\n      var hash = md51(content);\n    \n      return raw ? hash : hex(hash);\n    };\n    \n    /**\n         * SparkMD5 OOP implementation for array buffers.\n         *\n         * Use this class to perform an incremental md5 ONLY for array buffers.\n         */\n    SparkMD5.ArrayBuffer = function () {\n      // call reset to init the instance\n      this.reset();\n    };\n    \n    ////////////////////////////////////////////////////////////////////////////\n    \n    /**\n         * Appends an array buffer.\n         *\n         * @param {ArrayBuffer} arr The array to be appended\n         *\n         * @return {SparkMD5.ArrayBuffer} The instance itself\n         */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n      // TODO: we could avoid the concatenation here but the algorithm would be more complex\n      //       if you find yourself needing extra performance, please make a PR.\n      var buff = this._concatArrayBuffer(this._buff, arr),\n        length = buff.length,\n        i;\n    \n      this._length += arr.byteLength;\n    \n      for (i = 64; i <= length; i += 64) {\n        md5cycle(this._state, md5blk_array(buff.subarray(i - 64, i)));\n      }\n    \n      // Avoids IE10 weirdness (documented above)\n      this._buff = (i - 64) < length ? buff.subarray(i - 64) : new Uint8Array(0);\n    \n      return this;\n    };\n    \n    /**\n         * Finishes the incremental computation, reseting the internal state and\n         * returning the result.\n         * Use the raw parameter to obtain the raw result instead of the hex one.\n         *\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n      var buff = this._buff,\n        length = buff.length,\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n        i,\n        ret;\n    \n      for (i = 0; i < length; i += 1) {\n        tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n      }\n    \n      this._finish(tail, length);\n      ret = raw ? this._state : hex(this._state);\n    \n      this.reset();\n    \n      return ret;\n    };\n    \n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n    \n    /**\n         * Resets the internal state of the computation.\n         *\n         * @return {SparkMD5.ArrayBuffer} The instance itself\n         */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n      this._buff = new Uint8Array(0);\n      this._length = 0;\n      this._state = [1732584193, -271733879, -1732584194, 271733878];\n    \n      return this;\n    };\n    \n    /**\n         * Releases memory used by the incremental buffer and other aditional\n         * resources. If you plan to use the instance again, use reset instead.\n         */\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n    \n    /**\n         * Concats two array buffers, returning a new one.\n         *\n         * @param  {ArrayBuffer} first  The first array buffer\n         * @param  {ArrayBuffer} second The second array buffer\n         *\n         * @return {ArrayBuffer} The new array buffer\n         */\n    SparkMD5.ArrayBuffer.prototype._concatArrayBuffer = function (first, second) {\n      var firstLength = first.length,\n        result = new Uint8Array(firstLength + second.byteLength);\n    \n      result.set(first);\n      result.set(new Uint8Array(second), firstLength);\n    \n      return result;\n    };\n    \n    /**\n         * Performs the md5 hash on an array buffer.\n         *\n         * @param {ArrayBuffer} arr The array buffer\n         * @param {Boolean}     raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n      var hash = md51_array(new Uint8Array(arr));\n    \n      return raw ? hash : hex(hash);\n    };\n        \n    return FlashRuntime.register( 'Md5', {\n      init: function() {\n        // do nothing.\n      },\n    \n      loadFromBlob: function( file ) {\n        var blob = file.getSource(),\n          chunkSize = 2 * 1024 * 1024,\n          chunks = Math.ceil( blob.size / chunkSize ),\n          chunk = 0,\n          owner = this.owner,\n          spark = new SparkMD5.ArrayBuffer(),\n          me = this,\n          blobSlice = blob.mozSlice || blob.webkitSlice || blob.slice,\n          loadNext, fr;\n    \n        fr = new FileReader();\n    \n        loadNext = function() {\n          var start, end;\n    \n          start = chunk * chunkSize;\n          end = Math.min( start + chunkSize, blob.size );\n    \n          fr.onload = function( e ) {\n            spark.append( e.target.result );\n            owner.trigger( 'progress', {\n              total: file.size,\n              loaded: end\n            });\n          };\n    \n          fr.onloadend = function() {\n            fr.onloadend = fr.onload = null;\n    \n            if ( ++chunk < chunks ) {\n              setTimeout( loadNext, 1 );\n            } else {\n              setTimeout(function(){\n                owner.trigger('load');\n                me.result = spark.end();\n                loadNext = file = blob = spark = null;\n                owner.trigger('complete');\n              }, 50 );\n            }\n          };\n    \n          fr.readAsArrayBuffer( blobSlice.call( blob, start, end ) );\n        };\n    \n        loadNext();\n      },\n    \n      getResult: function() {\n        return this.result;\n      }\n    });\n  });\n  /**\n     * @fileOverview FlashRuntime\n     */\n  define('runtime/flash/runtime',[\n    'base',\n    'runtime/runtime',\n    'runtime/compbase'\n  ], function( Base, Runtime, CompBase ) {\n    \n    var $ = Base.$,\n      type = 'flash',\n      components = {};\n    \n    \n    function getFlashVersion() {\n      var version;\n    \n      try {\n        version = navigator.plugins[ 'Shockwave Flash' ];\n        version = version.description;\n      } catch ( ex ) {\n        try {\n          version = new ActiveXObject('ShockwaveFlash.ShockwaveFlash')\n            .GetVariable('$version');\n        } catch ( ex2 ) {\n          version = '0.0';\n        }\n      }\n      version = version.match( /\\d+/g );\n      return parseFloat( version[ 0 ] + '.' + version[ 1 ], 10 );\n    }\n    \n    function FlashRuntime() {\n      var pool = {},\n        clients = {},\n        destroy = this.destroy,\n        me = this,\n        jsreciver = Base.guid('webuploader_');\n    \n      Runtime.apply( me, arguments );\n      me.type = type;\n    \n    \n      // 这个方法的调用者，实际上是RuntimeClient\n      me.exec = function( comp, fn/*, args...*/ ) {\n        var client = this,\n          uid = client.uid,\n          args = Base.slice( arguments, 2 ),\n          instance;\n    \n        clients[ uid ] = client;\n    \n        if ( components[ comp ] ) {\n          if ( !pool[ uid ] ) {\n            pool[ uid ] = new components[ comp ]( client, me );\n          }\n    \n          instance = pool[ uid ];\n    \n          if ( instance[ fn ] ) {\n            return instance[ fn ].apply( instance, args );\n          }\n        }\n    \n        return me.flashExec.apply( client, arguments );\n      };\n    \n      function handler( evt, obj ) {\n        var type = evt.type || evt,\n          parts, uid;\n    \n        parts = type.split('::');\n        uid = parts[ 0 ];\n        type = parts[ 1 ];\n    \n        // console.log.apply( console, arguments );\n    \n        if ( type === 'Ready' && uid === me.uid ) {\n          me.trigger('ready');\n        } else if ( clients[ uid ] ) {\n          clients[ uid ].trigger( type.toLowerCase(), evt, obj );\n        }\n    \n        // Base.log( evt, obj );\n      }\n    \n      // flash的接受器。\n      window[ jsreciver ] = function() {\n        var args = arguments;\n    \n        // 为了能捕获得到。\n        setTimeout(function() {\n          handler.apply( null, args );\n        }, 1 );\n      };\n    \n      this.jsreciver = jsreciver;\n    \n      this.destroy = function() {\n        // @todo 删除池子中的所有实例\n        return destroy && destroy.apply( this, arguments );\n      };\n    \n      this.flashExec = function( comp, fn ) {\n        var flash = me.getFlash(),\n          args = Base.slice( arguments, 2 );\n    \n        return flash.exec( this.uid, comp, fn, args );\n      };\n    \n      // @todo\n    }\n    \n    Base.inherits( Runtime, {\n      constructor: FlashRuntime,\n    \n      init: function() {\n        var container = this.getContainer(),\n          opts = this.options,\n          html;\n    \n        // if not the minimal height, shims are not initialized\n        // in older browsers (e.g FF3.6, IE6,7,8, Safari 4.0,5.0, etc)\n        container.css({\n          position: 'absolute',\n          top: '-8px',\n          left: '-8px',\n          width: '9px',\n          height: '9px',\n          overflow: 'hidden'\n        });\n    \n        // insert flash object\n        html = '<object id=\"' + this.uid + '\" type=\"application/' +\n                        'x-shockwave-flash\" data=\"' +  opts.swf + '\" ';\n    \n        if ( Base.browser.ie ) {\n          html += 'classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" ';\n        }\n    \n        html += 'width=\"100%\" height=\"100%\" style=\"outline:0\">'  +\n                    '<param name=\"movie\" value=\"' + opts.swf + '\" />' +\n                    '<param name=\"flashvars\" value=\"uid=' + this.uid +\n                    '&jsreciver=' + this.jsreciver + '\" />' +\n                    '<param name=\"wmode\" value=\"transparent\" />' +\n                    '<param name=\"allowscriptaccess\" value=\"always\" />' +\n                '</object>';\n    \n        container.html( html );\n      },\n    \n      getFlash: function() {\n        if ( this._flash ) {\n          return this._flash;\n        }\n    \n        this._flash = $( '#' + this.uid ).get( 0 );\n        return this._flash;\n      }\n    \n    });\n    \n    FlashRuntime.register = function( name, component ) {\n      component = components[ name ] = Base.inherits( CompBase, $.extend({\n    \n        // @todo fix this later\n        flashExec: function() {\n          var owner = this.owner,\n            runtime = this.getRuntime();\n    \n          return runtime.flashExec.apply( owner, arguments );\n        }\n      }, component ) );\n    \n      return component;\n    };\n    \n    if ( getFlashVersion() >= 11.4 ) {\n      Runtime.addRuntime( type, FlashRuntime );\n    }\n    \n    return FlashRuntime;\n  });\n  /**\n     * @fileOverview FilePicker\n     */\n  define('runtime/flash/filepicker',[\n    'base',\n    'runtime/flash/runtime'\n  ], function( Base, FlashRuntime ) {\n    var $ = Base.$;\n    \n    return FlashRuntime.register( 'FilePicker', {\n      init: function( opts ) {\n        var copy = $.extend({}, opts ),\n          len, i;\n    \n        // 修复Flash再没有设置title的情况下无法弹出flash文件选择框的bug.\n        len = copy.accept && copy.accept.length;\n        for (  i = 0; i < len; i++ ) {\n          if ( !copy.accept[ i ].title ) {\n            copy.accept[ i ].title = 'Files';\n          }\n        }\n    \n        delete copy.button;\n        delete copy.id;\n        delete copy.container;\n    \n        this.flashExec( 'FilePicker', 'init', copy );\n      },\n    \n      destroy: function() {\n        this.flashExec( 'FilePicker', 'destroy' );\n      }\n    });\n  });\n  /**\n     * @fileOverview 图片压缩\n     */\n  define('runtime/flash/image',[\n    'runtime/flash/runtime'\n  ], function( FlashRuntime ) {\n    \n    return FlashRuntime.register( 'Image', {\n      // init: function( options ) {\n      //     var owner = this.owner;\n    \n      //     this.flashExec( 'Image', 'init', options );\n      //     owner.on( 'load', function() {\n      //         debugger;\n      //     });\n      // },\n    \n      loadFromBlob: function( blob ) {\n        var owner = this.owner;\n    \n        owner.info() && this.flashExec( 'Image', 'info', owner.info() );\n        owner.meta() && this.flashExec( 'Image', 'meta', owner.meta() );\n    \n        this.flashExec( 'Image', 'loadFromBlob', blob.uid );\n      }\n    });\n  });\n  /**\n     * @fileOverview  Transport flash实现\n     */\n  define('runtime/flash/transport',[\n    'base',\n    'runtime/flash/runtime',\n    'runtime/client'\n  ], function( Base, FlashRuntime, RuntimeClient ) {\n    var $ = Base.$;\n    \n    return FlashRuntime.register( 'Transport', {\n      init: function() {\n        this._status = 0;\n        this._response = null;\n        this._responseJson = null;\n      },\n    \n      send: function() {\n        var owner = this.owner,\n          opts = this.options,\n          xhr = this._initAjax(),\n          blob = owner._blob,\n          server = opts.server,\n          binary;\n    \n        xhr.connectRuntime( blob.ruid );\n    \n        if ( opts.sendAsBinary ) {\n          server += (/\\?/.test( server ) ? '&' : '?') +\n                            $.param( owner._formData );\n    \n          binary = blob.uid;\n        } else {\n          $.each( owner._formData, function( k, v ) {\n            xhr.exec( 'append', k, v );\n          });\n    \n          xhr.exec( 'appendBlob', opts.fileVal, blob.uid,\n            opts.filename || owner._formData.name || '' );\n        }\n    \n        this._setRequestHeader( xhr, opts.headers );\n        xhr.exec( 'send', {\n          method: opts.method,\n          url: server,\n          forceURLStream: opts.forceURLStream,\n          mimeType: 'application/octet-stream'\n        }, binary );\n      },\n    \n      getStatus: function() {\n        return this._status;\n      },\n    \n      getResponse: function() {\n        return this._response || '';\n      },\n    \n      getResponseAsJson: function() {\n        return this._responseJson;\n      },\n    \n      abort: function() {\n        var xhr = this._xhr;\n    \n        if ( xhr ) {\n          xhr.exec('abort');\n          xhr.destroy();\n          this._xhr = xhr = null;\n        }\n      },\n    \n      destroy: function() {\n        this.abort();\n      },\n    \n      _initAjax: function() {\n        var me = this,\n          xhr = new RuntimeClient('XMLHttpRequest');\n    \n        xhr.on( 'uploadprogress progress', function( e ) {\n          var percent = e.loaded / e.total;\n          percent = Math.min( 1, Math.max( 0, percent ) );\n          return me.trigger( 'progress', percent );\n        });\n    \n        xhr.on( 'load', function() {\n          var status = xhr.exec('getStatus'),\n            readBody = false,\n            err = '',\n            p;\n    \n          xhr.off();\n          me._xhr = null;\n    \n          if ( status >= 200 && status < 300 ) {\n            readBody = true;\n          } else if ( status >= 500 && status < 600 ) {\n            readBody = true;\n            err = 'server';\n          } else {\n            err = 'http';\n          }\n    \n          if ( readBody ) {\n            me._response = xhr.exec('getResponse');\n            me._response = decodeURIComponent( me._response );\n    \n            // flash 处理可能存在 bug, 没辙只能靠 js 了\n            // try {\n            //     me._responseJson = xhr.exec('getResponseAsJson');\n            // } catch ( error ) {\n                            \n            p = window.JSON && window.JSON.parse || function( s ) {\n              try {\n                return new Function('return ' + s).call();\n              } catch ( err ) {\n                return {};\n              }\n            };\n            me._responseJson  = me._response ? p(me._response) : {};\n                            \n            // }\n          }\n                    \n          xhr.destroy();\n          xhr = null;\n    \n          return err ? me.trigger( 'error', err ) : me.trigger('load');\n        });\n    \n        xhr.on( 'error', function() {\n          xhr.off();\n          me._xhr = null;\n          me.trigger( 'error', 'http' );\n        });\n    \n        me._xhr = xhr;\n        return xhr;\n      },\n    \n      _setRequestHeader: function( xhr, headers ) {\n        $.each( headers, function( key, val ) {\n          xhr.exec( 'setRequestHeader', key, val );\n        });\n      }\n    });\n  });\n  /**\n     * @fileOverview Blob Html实现\n     */\n  define('runtime/flash/blob',[\n    'runtime/flash/runtime',\n    'lib/blob'\n  ], function( FlashRuntime, Blob ) {\n    \n    return FlashRuntime.register( 'Blob', {\n      slice: function( start, end ) {\n        var blob = this.flashExec( 'Blob', 'slice', start, end );\n    \n        return new Blob( blob.uid, blob );\n      }\n    });\n  });\n  /**\n     * @fileOverview  Md5 flash实现\n     */\n  define('runtime/flash/md5',[\n    'runtime/flash/runtime'\n  ], function( FlashRuntime ) {\n        \n    return FlashRuntime.register( 'Md5', {\n      init: function() {\n        // do nothing.\n      },\n    \n      loadFromBlob: function( blob ) {\n        return this.flashExec( 'Md5', 'loadFromBlob', blob.uid );\n      }\n    });\n  });\n  /**\n     * @fileOverview 完全版本。\n     */\n  define('preset/all',[\n    'base',\n    \n    // widgets\n    'widgets/filednd',\n    'widgets/filepaste',\n    'widgets/filepicker',\n    'widgets/image',\n    'widgets/queue',\n    'widgets/runtime',\n    'widgets/upload',\n    'widgets/validator',\n    'widgets/md5',\n    \n    // runtimes\n    // html5\n    'runtime/html5/blob',\n    'runtime/html5/dnd',\n    'runtime/html5/filepaste',\n    'runtime/html5/filepicker',\n    'runtime/html5/imagemeta/exif',\n    'runtime/html5/androidpatch',\n    'runtime/html5/image',\n    'runtime/html5/transport',\n    'runtime/html5/md5',\n    \n    // flash\n    'runtime/flash/filepicker',\n    'runtime/flash/image',\n    'runtime/flash/transport',\n    'runtime/flash/blob',\n    'runtime/flash/md5'\n  ], function( Base ) {\n    return Base;\n  });\n  /**\n     * @fileOverview 日志组件，主要用来收集错误信息，可以帮助 webuploader 更好的定位问题和发展。\n     *\n     * 如果您不想要启用此功能，请在打包的时候去掉 log 模块。\n     *\n     * 或者可以在初始化的时候通过 options.disableWidgets 属性禁用。\n     *\n     * 如：\n     * WebUploader.create({\n     *     ...\n     *\n     *     disableWidgets: 'log',\n     *\n     *     ...\n     * })\n     */\n  define('widgets/log',[\n    'base',\n    'uploader',\n    'widgets/widget'\n  ], function( Base, Uploader ) {\n    var $ = Base.$,\n      logUrl = ' http://static.tieba.baidu.com/tb/pms/img/st.gif??',\n      product = (location.hostname || location.host || 'protected').toLowerCase(),\n    \n      // 只针对 baidu 内部产品用户做统计功能。\n      enable = product && /baidu/i.exec(product),\n      base;\n    \n    if (!enable) {\n      return;\n    }\n    \n    base = {\n      dv: 3,\n      master: 'webuploader',\n      online: /test/.exec(product) ? 0 : 1,\n      module: '',\n      product: product,\n      type: 0\n    };\n    \n    function send(data) {\n      var obj = $.extend({}, base, data),\n        url = logUrl.replace(/^(.*)\\?/, '$1' + $.param( obj )),\n        image = new Image();\n    \n      image.src = url;\n    }\n    \n    return Uploader.register({\n      name: 'log',\n    \n      init: function() {\n        var owner = this.owner,\n          count = 0,\n          size = 0;\n    \n        owner\n          .on('error', function(code) {\n            send({\n              type: 2,\n              c_error_code: code\n            });\n          })\n          .on('uploadError', function(file, reason) {\n            send({\n              type: 2,\n              c_error_code: 'UPLOAD_ERROR',\n              c_reason: '' + reason\n            });\n          })\n          .on('uploadComplete', function(file) {\n            count++;\n            size += file.size;\n          }).\n          on('uploadFinished', function() {\n            send({\n              c_count: count,\n              c_size: size\n            });\n            count = size = 0;\n          });\n    \n        send({\n          c_usage: 1\n        });\n      }\n    });\n  });\n  /**\n     * @fileOverview Uploader上传类\n     */\n  define('webuploader',[\n    'preset/all',\n    'widgets/log'\n  ], function( preset ) {\n    return preset;\n  });\n  return require('webuploader');\n});\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/common/fex-webuploader/webuploader.js"],"sourceRoot":""}