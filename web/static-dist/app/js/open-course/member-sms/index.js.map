{"version":3,"sources":["webpack:///external \"jQuery\"","webpack:///./app/Resources/static-src/app/js/open-course/member-sms/index.js","webpack:///./app/Resources/static-src/app/js/open-course/member-sms/member-sms.js"],"names":["MembarSMS","element","formSubmit","options","$element","$","$formSubmit","validator","initEvent","initValidator","on","onModifyMobile","event","onGetCode","onSmsSend","onFormSubmit","$this","currentTarget","hide","find","attr","show","addRules","data","Math","random","isCanSmsSend","SmsSender","url","smsType","captchaValidated","captchaNum","captcha","form","submit","isMobile","validate","isCaptcha","$form","ajax","currentDom","submitSuccess","closest","modal","addClass","removeClass","text","parseInt","number","submitError","Translator","trans","responseJSON","message","rules","required","phone","es_remote","alphanumeric","maxlength","minlength"],"mappings":";;;;;AAAA,wB;;;;;;;;;;ACAA;;;;;;AAEA,IAAIA,mBAAJ,CAAc;AACZC,WAAS,iBADG;AAEZC,cAAY;AAFA,CAAd,E;;;;;;;;;;;;;;;;;;;;;;ACFA;;;;AACA;;;;;;IAEMF,S;AACJ,qBAAYG,OAAZ,EAAqB;AAAA;;AACnB,SAAKC,QAAL,GAAgBC,EAAEF,QAAQF,OAAV,CAAhB;AACA,SAAKC,UAAL,GAAkBC,QAAQD,UAA1B;AACA,SAAKI,WAAL,GAAmBD,EAAE,KAAKH,UAAP,CAAnB;AACA,SAAKK,SAAL,GAAiB,IAAjB;;AAEA,SAAKC,SAAL;AACA,SAAKC,aAAL;AACD;;;;gCAEW;AAAA;;AACV,WAAKL,QAAL,CAAcM,EAAd,CAAiB,OAAjB,EAA0B,mBAA1B,EAA+C;AAAA,eAAS,MAAKC,cAAL,CAAoBC,KAApB,CAAT;AAAA,OAA/C;AACA,WAAKR,QAAL,CAAcM,EAAd,CAAiB,OAAjB,EAA0B,cAA1B,EAA0C;AAAA,eAAS,MAAKG,SAAL,CAAeD,KAAf,CAAT;AAAA,OAA1C;AACA,WAAKR,QAAL,CAAcM,EAAd,CAAiB,OAAjB,EAA0B,cAA1B,EAA0C;AAAA,eAAS,MAAKI,SAAL,CAAeF,KAAf,CAAT;AAAA,OAA1C;AACA,WAAKN,WAAL,CAAiBI,EAAjB,CAAoB,OAApB,EAA6B;AAAA,eAAS,MAAKK,YAAL,CAAkBH,KAAlB,CAAT;AAAA,OAA7B;AACD;;;mCAEcA,K,EAAO;AACpB,UAAII,QAAQX,EAAEO,MAAMK,aAAR,CAAZ;AACAD,YAAME,IAAN;;AAEA,WAAKd,QAAL,CAAce,IAAd,CAAmB,sBAAnB,EAA2CC,IAA3C,CAAgD,UAAhD,EAA2D,KAA3D;AACA,WAAKhB,QAAL,CAAce,IAAd,CAAmB,aAAnB,EAAkCE,IAAlC;;AAEA,WAAKC,QAAL;AACD;;;8BAESV,K,EAAO;AACf,UAAII,QAAQX,EAAEO,MAAMK,aAAR,CAAZ;AACAD,YAAMI,IAAN,CAAW,KAAX,EAAkBJ,MAAMO,IAAN,CAAW,KAAX,IAAoB,GAApB,GAA0BC,KAAKC,MAAL,EAA5C;AACD;;;8BAESb,K,EAAO;AACf,UAAI,CAAC,KAAKc,YAAL,EAAL,EAA0B;;AAE1B,UAAIV,QAAQX,EAAEO,MAAMK,aAAR,CAAZ;AACA,UAAIU,mBAAJ,CAAc;AACZ1B,iBAAS,cADG;AAEZ2B,aAAKZ,MAAMO,IAAN,CAAW,KAAX,CAFO;AAGZM,iBAAS,eAHG;AAIZC,0BAAkB,IAJN;AAKZC,oBAAY,cALA;AAMZC,iBAAS;AANG,OAAd;AAQD;;;iCAEYpB,K,EAAO;AAClB,UAAI,KAAKL,SAAL,CAAe0B,IAAf,EAAJ,EAA2B;AACzB,aAAK7B,QAAL,CAAc8B,MAAd;AACD;AACF;;;mCAEc;AACb,UAAIC,WAAW,KAAK/B,QAAL,CAAcgC,QAAd,GAAyBnC,OAAzB,CAAiCI,EAAE,iBAAF,CAAjC,CAAf;AACA,UAAI,CAAC8B,QAAL,EAAe;AACb,eAAO,KAAP;AACD;;AAED,UAAIE,YAAY,KAAKjC,QAAL,CAAcgC,QAAd,GAAyBnC,OAAzB,CAAiCI,EAAE,uBAAF,CAAjC,CAAhB;AACA,UAAI,CAACgC,SAAL,EAAgB;AACd,eAAO,KAAP;AACD;;AAED,aAAO,IAAP;AACD;;;oCAEe;AACd,UAAIC,QAAQ,KAAKlC,QAAjB;AACA,WAAKG,SAAL,GAAiB,KAAKH,QAAL,CAAcgC,QAAd,CAAuB;AACtCG,cAAM,IADgC;AAEtCC,oBAAY,KAAKtC,UAFqB;AAGtCuC,qBAHsC,yBAGxBlB,IAHwB,EAGlB;AAClBe,gBAAMI,OAAN,CAAc,QAAd,EAAwBC,KAAxB,CAA8B,MAA9B;;AAEAtC,YAAE,YAAF,EAAgBuC,QAAhB,CAAyB,QAAzB;AACAvC,YAAE,cAAF,EAAkBwC,WAAlB,CAA8B,QAA9B;AACAxC,YAAE,qBAAF,EAAyByC,IAAzB,CAA8BC,SAASxB,KAAKyB,MAAd,CAA9B;AACD,SATqC;AAUtCC,mBAVsC,uBAU1B1B,IAV0B,EAUpB;AAChB,gCAAO,QAAP,EAAkB2B,WAAWC,KAAX,CAAiB5B,KAAK6B,YAAL,CAAkBC,OAAnC,CAAlB;AACD;AAZqC,OAAvB,CAAjB;;AAeA,UAAI,KAAKjD,QAAL,CAAce,IAAd,CAAmB,sBAAnB,EAA2CC,IAA3C,CAAgD,UAAhD,KAA+D,UAAnE,EAA+E;AAC7E,aAAKE,QAAL;AACD;AACF;;;+BAEU;AACTjB,QAAE,iBAAF,EAAqBiD,KAArB,CAA2B,KAA3B,EAAkC;AAChCC,kBAAU,IADsB;AAEhCC,eAAO,IAFyB;AAGhCC,mBAAW;AAHqB,OAAlC;AAKApD,QAAE,uBAAF,EAA2BiD,KAA3B,CAAiC,KAAjC,EAAwC;AACtCC,kBAAU,IAD4B;AAEtCG,sBAAc,IAFwB;AAGtCD,mBAAW;AAH2B,OAAxC;AAKApD,QAAE,yBAAF,EAA6BiD,KAA7B,CAAmC,KAAnC,EAA0C;AACxCC,kBAAU,IAD8B;AAExCI,mBAAW,CAF6B;AAGxCC,mBAAW,CAH6B;AAIxCH,mBAAW;AAJ6B,OAA1C;AAMD;;;;;kBAGYzD,S","file":"app/js/open-course/member-sms/index.js","sourcesContent":["module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = app/js/main app/js/v2/demo/index app/js/activity-manage/doc/index app/js/activity-manage/download/index app/js/activity-manage/flash/index app/js/activity-manage/homework/index app/js/activity-manage/ppt/index app/js/activity-manage/video/index app/js/article/detail/index app/js/attachment/index app/js/auth/captcha-modal/index app/js/auth/password-reset/index app/js/auth/register/index app/js/batch-upload/index app/js/card/card-receive/index app/js/card/index/index app/js/cashier/index app/js/cashier/modal/index app/js/classroom-manage/set-picture/index app/js/classroom-manage/student-expiryday/index app/js/classroom-manage/student-import/index app/js/classroom-manage/students-create/index app/js/classroom-manage/students-manage/index app/js/classroom/buy-modal/index app/js/classroom/index app/js/classroom/thread-form/index app/js/classroom/thread-show/index app/js/coin/invite-code/index app/js/course-chapter-manage/index app/js/course-manage-file/index/index app/js/course-manage/batch-create/index app/js/course-manage/lesson-manage/default/index app/js/course-manage/lesson-manage/normal/index app/js/course-manage/live-replay/upload/index app/js/course-manage/overview/index app/js/course-manage/student-import/index app/js/course/buy-modal/index app/js/course/thread-show/index app/js/courseset/show/index app/js/exporter/index app/js/group/index app/js/group/logo/index app/js/group/thread-add/index app/js/live-course/explore/index app/js/material-lib/index/index app/js/material-lib/share-history/index app/js/media-manage/index app/js/activity-manage/audio/index app/js/mobile-bind/index app/js/my/order-refund-apply/index app/js/my/order-refund/index app/js/my/order/index app/js/oauth2/create/index app/js/open-course-manage/add-material/index app/js/open-course-manage/lesson-modal/index app/js/open-course/index app/js/open-course/member-sms/index app/js/order/coupon-item/index app/js/order/create-sms/index app/js/order/create/index app/js/pay/select/index app/js/pay/show-mobile-modal/index app/js/player/index app/js/question-manage/form/index app/js/review/list/index app/js/search/index app/js/settings/avatar-crop-modal/index app/js/settings/bind-mobile/index app/js/settings/email/index app/js/settings/find_pay_password_by_sms/index app/js/settings/find-pay-password/index app/js/settings/password/index app/js/settings/pay-password-modal/index app/js/settings/pay-password/index app/js/settings/profile/index app/js/settings/reset-pay-password/index app/js/settings/security-questions/index app/js/settings/security/index app/js/settings/setup-password/index app/js/settings/setup/index app/js/settings/update-pay-password/index app/js/settings/user-profile/index app/js/subject/index app/js/task-manage/create/index app/js/task/plugin/note/index app/js/task/plugin/question/index app/js/testpaper-manage/create/index app/js/testpaper-manage/index app/js/testpaper-manage/questions/index app/js/testpaper/do-test/exercise/index app/js/testpaper/do-test/normal/index app/js/testpaper/result/index app/js/thread/user-info-modal/index app/js/user/fill-info/index app/js/message/show/index","import MembarSMS from './member-sms';\n\nnew MembarSMS({\n  element: '#sms-modal-form',\n  formSubmit: '#form-submit'\n});\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/open-course/member-sms/index.js","import SmsSender from 'app/common/widget/sms-sender';\nimport notify from 'common/notify';\n\nclass MembarSMS {\n  constructor(options) {\n    this.$element = $(options.element);\n    this.formSubmit = options.formSubmit;\n    this.$formSubmit = $(this.formSubmit);\n    this.validator = null;\n\n    this.initEvent();\n    this.initValidator();\n  }\n\n  initEvent() {\n    this.$element.on('click', '.js-modify-mobile', event => this.onModifyMobile(event));\n    this.$element.on('click', '.js-get-code', event => this.onGetCode(event));\n    this.$element.on('click', '.js-sms-send', event => this.onSmsSend(event));\n    this.$formSubmit.on('click', event => this.onFormSubmit(event));\n  }\n\n  onModifyMobile(event) {\n    let $this = $(event.currentTarget);\n    $this.hide();\n    \n    this.$element.find('input[name=\"mobile\"]').attr('readonly',false);\n    this.$element.find('.form-group').show();\n\n    this.addRules();\n  }\n\n  onGetCode(event) {\n    let $this = $(event.currentTarget);\n    $this.attr('src', $this.data('url') + '?' + Math.random());\n  }\n\n  onSmsSend(event) {\n    if (!this.isCanSmsSend()) return;\n    \n    let $this = $(event.currentTarget);\n    new SmsSender({\n      element: '.js-sms-send',\n      url: $this.data('url'),\n      smsType: 'system_remind',\n      captchaValidated: true,\n      captchaNum: 'captcha_code',\n      captcha: true,\n    });\n  }\n\n  onFormSubmit(event) {\n    if (this.validator.form()) {\n      this.$element.submit();\n    }\n  }\n\n  isCanSmsSend() {\n    let isMobile = this.$element.validate().element($('[name=\"mobile\"]')); \n    if (!isMobile) {\n      return false;\n    }\n\n    let isCaptcha = this.$element.validate().element($('[name=\"captcha_code\"]'));\n    if (!isCaptcha) {\n      return false;\n    }\n\n    return true;\n  }\n\n  initValidator() {\n    let $form = this.$element;\n    this.validator = this.$element.validate({\n      ajax: true,\n      currentDom: this.formSubmit,\n      submitSuccess(data) {\n        $form.closest('.modal').modal('hide');\n       \n        $('#alert-btn').addClass('hidden');\n        $('#alerted-btn').removeClass('hidden');\n        $('.js-member-num span').text(parseInt(data.number));\n      },\n      submitError(data) {\n        notify('danger',  Translator.trans(data.responseJSON.message));\n      }\n    });\n\n    if (this.$element.find('input[name=\"mobile\"]').attr('readonly') != 'readonly') {\n      this.addRules();\n    }\n  }\n\n  addRules() {\n    $('[name=\"mobile\"]').rules('add', {\n      required: true,\n      phone: true,\n      es_remote: true\n    });\n    $('[name=\"captcha_code\"]').rules('add', {\n      required: true,\n      alphanumeric: true,\n      es_remote: true\n    });\n    $('[name=\"sms_code_modal\"]').rules('add', {\n      required: true,\n      maxlength: 6,\n      minlength: 6,\n      es_remote: true\n    });\n  }\n}\n\nexport default MembarSMS;\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/open-course/member-sms/member-sms.js"],"sourceRoot":""}