{"version":3,"sources":["webpack:///external \"jQuery\"","webpack:///./app/Resources/static-src/app/js/activity-manage/download/index.js","webpack:///./app/Resources/static-src/app/js/activity-manage/download/download.js"],"names":["DownLoad","$form","$","firstName","val","media","materials","initStep2Form","bindEvent","initFileChooser","validator2","validate","rules","title","required","maxlength","trim","course_title","link","messages","Translator","trans","on","event","deleteItem","importLink","addFile","changeTitle","$parent","currentTarget","closest","mediaId","data","$materials","JSON","parse","siblings","length","remove","fileSelect","file","text","name","fileChooser","FileChooser","$this","$link","$verifyLink","valid","verifyLinkVal","source","id","summary","size","$media","$successTipDom","$errorTipDom","errorTip","successTip","existTip","addLink","showTip","checkExisted","showFile","form","item","materialsItem","checkFile","checkLink","item_tpl","append","tooltip","$hideDom","$showDom","hide","show","setTimeout","slideUp"],"mappings":"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","file":"app/js/activity-manage/download/index.js","sourcesContent":["module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = app/js/main app/js/v2/demo/index app/js/activity-manage/doc/index app/js/activity-manage/download/index app/js/activity-manage/flash/index app/js/activity-manage/homework/index app/js/activity-manage/ppt/index app/js/activity-manage/video/index app/js/article/detail/index app/js/attachment/index app/js/auth/captcha-modal/index app/js/auth/password-reset/index app/js/auth/register/index app/js/batch-upload/index app/js/card/card-receive/index app/js/card/index/index app/js/cashier/index app/js/cashier/modal/index app/js/classroom-manage/set-picture/index app/js/classroom-manage/student-expiryday/index app/js/classroom-manage/student-import/index app/js/classroom-manage/students-create/index app/js/classroom-manage/students-manage/index app/js/classroom/buy-modal/index app/js/classroom/index app/js/classroom/thread-form/index app/js/classroom/thread-show/index app/js/coin/invite-code/index app/js/course-chapter-manage/index app/js/course-manage-file/index/index app/js/course-manage/batch-create/index app/js/course-manage/lesson-manage/default/index app/js/course-manage/lesson-manage/normal/index app/js/course-manage/live-replay/upload/index app/js/course-manage/overview/index app/js/course-manage/student-import/index app/js/course/buy-modal/index app/js/course/thread-show/index app/js/courseset/show/index app/js/exporter/index app/js/group/index app/js/group/logo/index app/js/group/thread-add/index app/js/live-course/explore/index app/js/material-lib/index/index app/js/material-lib/share-history/index app/js/media-manage/index app/js/activity-manage/audio/index app/js/mobile-bind/index app/js/my/order-refund-apply/index app/js/my/order-refund/index app/js/my/order/index app/js/oauth2/create/index app/js/open-course-manage/add-material/index app/js/open-course-manage/lesson-modal/index app/js/open-course/index app/js/open-course/member-sms/index app/js/order/coupon-item/index app/js/order/create-sms/index app/js/order/create/index app/js/pay/select/index app/js/pay/show-mobile-modal/index app/js/player/index app/js/question-manage/form/index app/js/review/list/index app/js/search/index app/js/settings/avatar-crop-modal/index app/js/settings/bind-mobile/index app/js/settings/email/index app/js/settings/find_pay_password_by_sms/index app/js/settings/find-pay-password/index app/js/settings/password/index app/js/settings/pay-password-modal/index app/js/settings/pay-password/index app/js/settings/profile/index app/js/settings/reset-pay-password/index app/js/settings/security-questions/index app/js/settings/security/index app/js/settings/setup-password/index app/js/settings/setup/index app/js/settings/update-pay-password/index app/js/settings/user-profile/index app/js/subject/index app/js/task-manage/create/index app/js/task/plugin/note/index app/js/task/plugin/question/index app/js/testpaper-manage/create/index app/js/testpaper-manage/index app/js/testpaper-manage/questions/index app/js/testpaper/do-test/exercise/index app/js/testpaper/do-test/normal/index app/js/testpaper/result/index app/js/thread/user-info-modal/index app/js/user/fill-info/index app/js/message/show/index","import DownLoad from './download.js';\n\nnew DownLoad();\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/download/index.js","import FileChooser from '../../file-chooser/file-choose';\nimport notify from 'common/notify';\nimport { isEmpty } from 'common/utils';\nimport { chooserUiOpen } from '../widget/chooser-ui';\n\nexport default class DownLoad {\n  constructor() {\n    this.$form = $('#step2-form');\n    this.firstName = $('#title').val();\n    this.media = Object.create(null);\n    this.materials = Object.create(null);\n    this.initStep2Form();\n    this.bindEvent();\n    this.initFileChooser();\n  }\n\n  initStep2Form() {\n    let validator2 = this.$form.validate({\n      rules: {\n        title: {\n          required: true,\n          maxlength: 50,\n          trim: true,\n          course_title: true,\n        },\n        link: 'url',\n        materials: 'required',\n      },\n      messages: {\n        link: Translator.trans('activity.download_manage.link_error_hint'),\n        materials: Translator.trans('activity.download_manage.materials_error_hint')\n      }\n    });\n  }\n\n  bindEvent() {\n    this.$form.on('click', '.js-btn-delete', (event) => this.deleteItem(event));\n    this.$form.on('click', '.js-video-import', () => this.importLink());\n    this.$form.on('click', '.js-add-file-list', () => this.addFile());\n    this.$form.on('blur', '#title', (event) => this.changeTitle(event));\n  }\n\n  deleteItem(event) {\n    let $parent = $(event.currentTarget).closest('li');\n    let mediaId = $parent.data('id');\n    const $materials = $('#materials');\n    this.materials = isEmpty($materials.val()) ? Object.create(null) : JSON.parse($materials.val());\n    if (this.materials && this.materials[mediaId]) {\n      delete this.materials[mediaId];\n      $materials.val(JSON.stringify(this.materials));\n    }\n    if (!$parent.siblings('li').length) {\n      $materials.val('');\n    }\n    $parent.remove();\n  }\n\n  initFileChooser() {\n    const fileSelect = (file) => {\n      $('#media').val(JSON.stringify(file));\n      chooserUiOpen();\n      $('#title').val(this.firstName);\n      $('.js-current-file').text(file.name);\n    };\n\n    const fileChooser = new FileChooser();\n    fileChooser.on('select', fileSelect);\n  }\n\n  changeTitle(event) {\n    let $this = $(event.currentTarget);\n    this.firstName = $this.val();\n  }\n\n  importLink() {\n    const $link = $('#link');\n    const $verifyLink = $('#verifyLink');\n    if (this.$form.data('validator').valid() && $link.val()) {\n      $verifyLink.val($link.val());\n    } else {\n      $link.val('');\n      $verifyLink.val('');\n    }\n    $('.js-current-file').text($verifyLink.val());\n  }\n\n  addLink() {\n    let verifyLinkVal = $('#verifyLink').val();\n    const data = {\n      source: 'link',\n      id: verifyLinkVal,\n      name: verifyLinkVal,\n      link: verifyLinkVal,\n      summary: $('#file-summary').val(),\n      size: 0\n    };\n\n    $('#media').val(JSON.stringify(data));\n  }\n\n  addFile() {\n    const $media = $('#media');\n    const $materials = $('#materials');\n    const $successTipDom = $('.js-success-redmine');\n    const $errorTipDom = $('.js-danger-redmine');\n\n    const errorTip = 'activity.download_manage.materials_error_hint';\n    const successTip = 'activity.download_manage.materials_add_success_hint';\n    const existTip = 'activity.download_manage.materials_exist_error_hint';\n\n    if ($('#verifyLink').val()) {\n      this.addLink();\n    }\n\n    this.media = isEmpty($media.val()) ? Object.create(null) : JSON.parse($media.val());\n    this.materials = isEmpty($materials.val()) ? Object.create(null) : JSON.parse($materials.val());\n\n    if (isEmpty(this.media)) {\n      this.showTip($successTipDom, $errorTipDom, errorTip);\n      return;\n    }\n\n    if (!isEmpty(this.materials) && this.checkExisted()) {\n      this.showTip($successTipDom, $errorTipDom, existTip);\n      return;\n    }\n\n    this.media.summary = $('#file-summary').val();\n    this.materials[this.media.id] = this.media;\n    $materials.val(JSON.stringify(this.materials));\n\n    if (!this.firstName) {\n      this.firstName = this.media.name;\n      $('#title').val(this.firstName);\n    }\n\n    this.showFile();\n\n    this.showTip($errorTipDom, $successTipDom, successTip);\n\n    if ($('.jq-validate-error:visible').length) {\n      this.$form.data('validator').form();\n    }\n  }\n\n  checkExisted() {\n    for (let item in this.materials) {\n      const materialsItem = this.materials[item];\n      const checkFile = materialsItem.name === this.media.name;\n      const checkLink = materialsItem.link && (materialsItem.link === this.media.id);\n\n      if (checkFile || checkLink) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  showFile() {\n    let item_tpl = '';\n    if (this.media.link) {\n      item_tpl = `\n        <li class=\"download-item\" data-id=\"${ this.media.link }\">\n          <a class=\"gray-primary\" href=\"${ this.media.link }\" target=\"_blank\">${ this.media.summary ? this.media.summary : this.media.name }<span class=\"glyphicon glyphicon-new-window text-muted text-sm mlm\" title=\"${ Translator.trans('activity.download_manage.materials_delete_btn')}\"></span></a>\n          <a class=\"gray-primary phm btn-delete js-btn-delete\" href=\"javascript:;\" data-url=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"${Translator.trans('activity.download_manage.materials_delete_btn')}\"><i class=\"es-icon es-icon-delete\"></i></a>\n        </li>\n      `;\n    } else {\n      item_tpl = `\n        <li class=\"download-item\" data-id=\"${ this.media.id }\">\n          <a class=\"gray-primary\" href=\"/materiallib/${ this.media.id }/download\">${ this.media.name }</a>\n          <a class=\"gray-primary phm btn-delete js-btn-delete\" href=\"javascript:;\" data-url=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"${Translator.trans('activity.download_manage.materials_delete_btn')}\"><i class=\"es-icon es-icon-delete\"></i></a>\n        </li>\n      `;\n    }\n\n    $('#material-list').append(item_tpl);\n    $('[data-toggle=\"tooltip\"]').tooltip();\n  }\n\n  showTip($hideDom, $showDom, trans) {\n    $hideDom.hide();\n    $('.js-current-file').text('');\n    $('#link').val('');\n    $('#verifyLink').val('');\n    $('#file-summary').val('');\n    $('#media').val('');\n    $showDom.text(Translator.trans(trans)).show();\n    setTimeout(function() {\n      $showDom.slideUp();\n    }, 3000);\n  }\n\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/download/download.js"],"sourceRoot":""}