{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/cashier/coin.js","webpack:///./app/Resources/static-src/app/js/cashier/mobile/index.js"],"names":["Coin","props","$container","$coinContainer","cashierForm","$form","priceType","data","coinRate","maxCoinInput","init","initEvent","on","changeAmount","event","$this","$","currentTarget","inputCoinNum","val","parseFloat","isNaN","removePasswordValidate","trigger","calcPayPrice","toFixed","addPasswordValidate","coinName","price","originalPirce","coinPrice","Translator","trans","find","rules","CashierForm","validator","validate","initCoin","$coin","length","coin","coinAmount","self","post","text","resp","hasClass","addClass","siblings","removeClass","attr","valid","submit"],"mappings":"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","file":"app/js/cashier/mobile/index.js","sourcesContent":["export default class Coin {\n  constructor(props) {\n    this.$container = props.$coinContainer;\n    this.cashierForm = props.cashierForm;\n    this.$form = props.$form;\n    this.priceType = this.$container.data('priceType');\n    this.coinRate = this.$container.data('coinRate');\n    this.maxCoinInput = this.$container.data('maxAllowCoin') > this.$container.data('coinBalance') ?\n      this.$container.data('coinBalance') : this.$container.data('maxAllowCoin');\n    \n    this.init();\n  }\n\n  init() {\n    this.initEvent();\n  }\n\n  initEvent() {\n    this.$form.on('change', '.js-coin-amount', event => this.changeAmount(event));\n  }\n\n  changeAmount(event) {\n    let $this = $(event.currentTarget);\n    let inputCoinNum = $this.val();\n\n    if (parseFloat(inputCoinNum) > parseFloat(this.maxCoinInput)) {\n      inputCoinNum = this.maxCoinInput;\n    }\n\n    if (isNaN(parseFloat(inputCoinNum)) || parseFloat(inputCoinNum) <= 0) {\n      inputCoinNum = 0;\n      $this.val('');\n      this.removePasswordValidate();\n\n      this.$form.trigger('removePriceItem', ['coin-price']);\n      this.cashierForm.calcPayPrice(inputCoinNum);\n      return;\n    }\n\n    $this.val(parseFloat(inputCoinNum).toFixed(2));\n\n    this.addPasswordValidate();\n    let coinName = this.$form.data('coin-name');\n    let price = 0.00;\n    if (this.priceType === 'coin') {\n      price = parseFloat(inputCoinNum).toFixed(2) + ' ' + coinName;\n\n      let originalPirce = parseFloat(this.$container.data('maxAllowCoin'));\n      let coinPrice = parseFloat(originalPirce - inputCoinNum).toFixed(2) + ' ' + coinName;\n      this.$form.trigger('changeCoinPrice', [coinPrice]);\n    } else {\n      price = '￥' + parseFloat(inputCoinNum / this.coinRate).toFixed(2);\n    }\n    this.$form.trigger('addPriceItem', ['coin-price', coinName + Translator.trans('order.create.minus'), price]);\n    this.cashierForm.calcPayPrice(inputCoinNum);\n  }\n\n  addPasswordValidate() {\n    this.$container.find('[name=\"payPassword\"]').rules('add', 'required es_remote');\n  }\n\n  removePasswordValidate() {\n    this.$container.find('[name=\"payPassword\"]').rules('remove', 'required es_remote');\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/cashier/coin.js","import Coin from 'app/js/cashier/coin';\n\nclass CashierForm {\n  constructor($form) {\n    this.$container = $form;\n\n    this.validator = this.$container.validate();\n\n    this.initEvent();\n    this.initCoin();\n  }\n\n  initCoin() {\n    let $coin = $('#coin-use-section');\n    if ($coin.length > 0) {\n      this.coin = new Coin($coin, this);\n    }\n  }\n\n  calcPayPrice(coinAmount) {\n\n    let self = this;\n    $.post(this.$container.data('priceUrl'), {\n      coinAmount: coinAmount\n    }, resp => {\n      self.$container.find('.js-pay-price').text(resp.data);\n    });\n\n\n  }\n\n  initEvent() {\n    // 支付方式切换\n    this.$container.on('click', '.check', event => {\n      let $this = $(event.currentTarget);\n      if (!$this.hasClass('active') && !$this.hasClass('disabled')) {\n        $this.addClass('active').siblings().removeClass('active');\n        $('input[name=\\'payment\\']').val($this.attr('id'));\n      }\n    });\n\n    let $form = this.$container;\n    $form.on('click', '.js-pay-btn', event => {\n      if ($form.valid()) {\n        $form.submit();\n      }\n\n    });\n  }\n}\n\n\nnew CashierForm($('#cashier-form'));\n\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/cashier/mobile/index.js"],"sourceRoot":""}