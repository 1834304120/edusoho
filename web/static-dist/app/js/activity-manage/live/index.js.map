{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/activity-manage/live/index.js","webpack:///./app/Resources/static-src/app/js/activity-manage/live/live.js","webpack:///./app/Resources/static-src/app/js/activity-manage/editor.js"],"names":["Live","props","$startTime","$","_init","initStep2Form","_timePickerHide","jQuery","validator","addMethod","value","element","optional","data","Translator","trans","$step2_form","validator2","validate","onkeyup","rules","title","required","maxlength","trim","open_live_course_title","startTime","DateAndTime","after_now","es_remote","type","clientTime","val","length","digits","max","min","show_overlap_time_error","remark","messages","dateTimePicker","that","find","change","checkOverlapTime","showError","params","mediaType","ajax","url","async","dataType","success","resp","$starttime","datetimepicker","format","language","document","documentElement","lang","autoclose","endDate","Date","now","on","form","parent","window","initEditor","$item","editor","CKEDITOR","replace","toolbar","fileSingleSizeLimit","app","filebrowserImageUploadUrl","filebrowserFlashUploadUrl","allowedContent","height","console","log","getData"],"mappings":"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","file":"app/js/activity-manage/live/index.js","sourcesContent":["import Live from './live';\n\nnew Live();\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/live/index.js","import { initEditor } from '../editor';\nexport default class Live {\n  constructor(props) {\n    this.$startTime = $('#startTime');\n    this._init();\n  }\n\n  _init() {\n    this.initStep2Form();\n    this._timePickerHide();\n  }\n\n  initStep2Form() {\n    jQuery.validator.addMethod('show_overlap_time_error', function(value, element) {\n      return this.optional( element ) || !$(element).data('showError');\n    }, Translator.trans('activity.live.overlap_time_notice'));\n    let $step2_form = $('#step2-form');\n    this.validator2 = $step2_form.validate({\n      onkeyup: false,\n      rules: {\n        title: {\n          required: true,\n          maxlength: 50,\n          trim: true,\n          open_live_course_title: true,\n        },\n        startTime: {\n          required: true,\n          DateAndTime: true,\n          after_now: true,\n          es_remote: {\n            type: 'post',\n            data: {\n              clientTime: function () {\n                return $('[name=startTime]').val();\n              }\n            }\n          }\n        },\n        length: {\n          required: true,\n          digits: true,\n          max: 300,\n          min: 1,\n          show_overlap_time_error: true\n        },\n        remark: {\n          maxlength: 1000\n        },\n      },\n      messages: {\n        startTime: {\n          es_remote: Translator.trans('validate.after_now.message')\n        }\n      }\n    });\n    initEditor($('[name=\"remark\"]'), this.validator2);\n    $step2_form.data('validator', this.validator2);\n    this.dateTimePicker(this.validator2);\n    let that = this;\n    $step2_form.find('#startTime').change(function () {\n      that.checkOverlapTime($step2_form);\n    });\n\n    $step2_form.find('#length').change(function () {\n      that.checkOverlapTime($step2_form);\n    });\n  }\n\n  checkOverlapTime($step2_form) {\n    if ($step2_form.find('#startTime').val() && $step2_form.find('#length').val()) {\n      let showError = 1;\n      let params = {\n        startTime: $step2_form.find('#startTime').val(),\n        length: $step2_form.find('#length').val(),\n        mediaType: 'live'\n      };\n      $.ajax({\n        url: $step2_form.find('#length').data('url'),\n        async: false,\n        type: 'POST',\n        data: params,\n        dataType: 'json',\n        success: function (resp) {\n          showError = resp.success === 0;\n        }\n      });\n\n      $step2_form.find('#length').data('showError', showError);\n\n    }\n  }\n\n  dateTimePicker(validator) {\n    let $starttime = this.$startTime;\n    $starttime.datetimepicker({\n      format: 'yyyy-mm-dd hh:ii',\n      language: document.documentElement.lang,\n      autoclose: true,\n      endDate: new Date(Date.now() + 86400 * 365 * 10 * 1000)\n    }).on('hide', () => {\n      validator.form();\n    });\n    $starttime.datetimepicker('setStartDate', new Date());\n  }\n\n  _timePickerHide() {\n    let $starttime = this.$startTime;\n    parent.$('#modal', window.parent.document).on('afterNext',function(){\n      $starttime.datetimepicker('hide');\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/live/live.js","export const initEditor = ($item, validator) => {\n  \n  var editor = CKEDITOR.replace('text-content-field', {\n    toolbar: 'Task',\n    fileSingleSizeLimit: app.fileSingleSizeLimit,\n    filebrowserImageUploadUrl: $('#text-content-field').data('imageUploadUrl'),\n    filebrowserFlashUploadUrl: $('#text-content-field').data('flashUploadUrl'),\n    allowedContent: true,\n    height: 300,\n  });\n  \n  editor.on('change', () => {\n    console.log('change');\n    $item.val(editor.getData());\n    if (validator) {\n      validator.form();\n    }\n  });\n\n  //fix ie11 中文输入\n  editor.on('blur', () => {\n    console.log('blur');\n    $item.val(editor.getData());\n    if (validator) {\n      validator.form();\n    }\n  });\n\n  return editor;\n};\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/activity-manage/editor.js"],"sourceRoot":""}