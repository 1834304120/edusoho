{"version":3,"sources":["webpack:///./app/Resources/static-src/app/js/course-manage/create/index.js","webpack:///./app/Resources/static-src/app/js/course-manage/expiry/expiry.js"],"names":["Creator","validator","init","expiry","Expiry","$","popover","html","initValidator","expiryDaysBlur","$form","validate","groups","date","rules","title","maxlength","required","trim","course_title","click","evt","commonExpiryMode","form","currentTarget","button","submit","initDatePicker","on","event","element","target","$id","$picker","datetimepicker","format","language","document","documentElement","lang","minView","autoclose","endDate","Date","now","checkBoxChange","$date","$days","checkValue","val","removeErrorTip","removeClass","addClass","$expiryDays","$expiryDate","$tip","flag","$deadline","$expiryStartDate","$expiryEndDate","$deadlineType","expiryMode","elementRemoveRules","elementAddRules","getDeadlineEndDateRules","getExpiryDaysRules","getExpiryStartDateRules","getExpiryEndDateRules","$targetItem","closest","find","remove","$element","options","positive_integer","max_year","messages","Translator","trans","before_date","after_date"],"mappings":"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","file":"app/js/course-manage/create/index.js","sourcesContent":["import Expiry from 'app/js/course-manage/expiry/expiry';\nclass Creator {\n  constructor() {\n    this.validator = null;\n    this.init();\n    this.expiry = new Expiry();\n  }\n\n  init() {\n    $('[data-toggle=\"popover\"]').popover({\n      html: true,\n    });\n    this.initValidator();\n    this.expiryDaysBlur();\n  }\n\n  initValidator() {\n    let $form = $('#course-create-form');\n    this.validator = $form.validate({\n      groups: {\n        date: 'expiryStartDate expiryEndDate'\n      },\n      rules: {\n        title: {\n          maxlength: 10,\n          required: true,\n          trim: true,\n          course_title: true\n        }\n      },\n    });\n\n    $('#course-submit').click((evt) => {\n      this.expiry.commonExpiryMode();\n      if (this.validator.form()) {\n        $(evt.currentTarget).button('loading');\n        $form.submit();\n      }\n    });\n    this.initDatePicker('#expiryStartDate');\n    this.initDatePicker('#expiryEndDate');\n    this.initDatePicker('#deadline');\n  }\n\n\n  expiryDaysBlur() {\n    $('input[name=\"expiryDays\"]').on('blur', (event) => {\n      this.validator.element($(event.target));\n    });\n  }\n\n  initDatePicker($id) {\n    let $picker = $($id);\n    $picker.datetimepicker({\n      format: 'yyyy-mm-dd',\n      language: document.documentElement.lang,\n      minView: 2, //month\n      autoclose: true,\n      endDate: new Date(Date.now() + 86400 * 365 * 10 * 1000)\n    }).on('hide', () => {\n      this.validator && this.validator.element($picker);\n    });\n    $picker.datetimepicker('setStartDate', new Date());\n  }\n}\n\nnew Creator();\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/course-manage/create/index.js","export default class Expiry {\n  constructor() {\n    this.init();\n  }\n  \n  init() {\n    this.checkBoxChange();\n  }\n  \n  checkBoxChange() {\n    // 截止日期，有效天数\n    $('input[name=\"deadlineType\"]').on('change', (event) => {\n      const $date = $('#deadlineType-date');\n      const $days = $('#deadlineType-days');\n      const checkValue = $('input[name=\"deadlineType\"]:checked').val();\n      this.removeErrorTip(event);\n      if (checkValue === 'end_date') {\n        $date.removeClass('hidden');\n        $days.addClass('hidden');\n      } else {\n        $date.addClass('hidden');\n        $days.removeClass('hidden');\n      }\n      this.commonExpiryMode(true);\n    });\n  \n    // 有效期的选项\n    $('input[name=\"expiryMode\"]').on('change', (event) => {\n      const $expiryDays = $('#expiry-days');\n      const $expiryDate = $('#expiry-date');\n      const checkValue = $('input[name=\"expiryMode\"]:checked').val();\n      this.removeErrorTip(event);\n      const $tip = $('.js-expiry-tip');\n      if (checkValue === 'date') {\n        $expiryDays.addClass('hidden');\n        $expiryDate.removeClass('hidden');\n        $tip.removeClass('ml0');\n      } else if (checkValue === 'days') {\n        $expiryDate.addClass('hidden');\n        $expiryDays.removeClass('hidden');\n        $tip.removeClass('ml0');\n      } else {\n        $expiryDate.addClass('hidden');\n        $expiryDays.addClass('hidden');\n        $tip.addClass('ml0');\n      }\n      this.commonExpiryMode(true);\n    });\n  }\n  \n  commonExpiryMode(flag) {\n    let $deadline = $('[name=\"deadline\"]');\n    let $expiryDays = $('[name=\"expiryDays\"]');\n    let $expiryStartDate = $('[name=\"expiryStartDate\"]');\n    let $expiryEndDate = $('[name=\"expiryEndDate\"]');\n    let $deadlineType = $('[name=\"deadlineType\"]:checked');\n    let expiryMode = $('[name=\"expiryMode\"]:checked').val();\n    this.elementRemoveRules($deadline);\n    this.elementRemoveRules($expiryDays);\n    this.elementRemoveRules($expiryStartDate);\n    this.elementRemoveRules($expiryEndDate);\n  \n    switch (expiryMode) {\n    case 'days':\n      if ($deadlineType.val() === 'end_date') {\n        if (flag) {\n          $deadline.on('focus', () => {\n            this.elementAddRules($deadline, this.getDeadlineEndDateRules());\n          });\n        } else {\n          this.elementAddRules($deadline, this.getDeadlineEndDateRules());\n        }\n        return;\n      }\n      if (flag) {\n        $expiryDays.on('focus', () => {\n          this.elementAddRules($expiryDays, this.getExpiryDaysRules());\n        });\n      } else {\n        this.elementAddRules($expiryDays, this.getExpiryDaysRules());\n      }\n      break;\n    case 'date':\n      if (flag) {\n        $expiryStartDate.on('focus', () => {\n          this.elementAddRules($expiryStartDate, this.getExpiryStartDateRules());\n        });\n        $expiryEndDate.on('focus', () => {\n          this.elementAddRules($expiryEndDate, this.getExpiryEndDateRules());\n        });\n      } else {\n        this.elementAddRules($expiryStartDate, this.getExpiryStartDateRules());\n        this.elementAddRules($expiryEndDate, this.getExpiryEndDateRules());\n      }\n      break;\n    default:\n      break;\n    }\n  }\n  \n  removeErrorTip(event) {\n    const $targetItem = $(event.target).closest('.form-group');\n    $targetItem.removeClass('has-error');\n    $targetItem.find('.js-expiry-input').removeClass('form-control-error');\n    $('.jq-validate-error').remove();\n  }\n  \n  // 添加验证规则\n  elementRemoveRules($element) {\n    $element.rules('remove');\n  }\n  \n  // 移除验证规则\n  elementAddRules($element, options) {\n    $element.rules('add', options);\n  }\n  \n  \n  // 有效期天数\n  getExpiryDaysRules() {\n    return {\n      required: true,\n      positive_integer: true,\n      max_year: true,\n      messages: {\n        required: Translator.trans(Translator.trans('course.manage.expiry_days_error_hint'))\n      }\n    };\n  }\n  \n  // 开始日期\n  getExpiryStartDateRules() {\n    return {\n      required: true,\n      date: true,\n      before_date: '#expiryEndDate',\n      messages: {\n        required: Translator.trans('course.manage.expiry_start_date_error_hint')\n      }\n    };\n  }\n  \n  // 结束日期 \n  getExpiryEndDateRules() {\n    return {\n      required: true,\n      date: true,\n      after_date: '#expiryStartDate',\n      messages: {\n        required: Translator.trans('course.manage.expiry_end_date_error_hint')\n      }\n    };\n  }\n  \n  // 截止日期\n  getDeadlineEndDateRules() {\n    return {\n      required: true,\n      date: true,\n      messages: {\n        required: Translator.trans('course.manage.deadline_end_date_error_hint')\n      }\n    };\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/course-manage/expiry/expiry.js"],"sourceRoot":""}