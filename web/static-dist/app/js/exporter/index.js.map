{"version":3,"sources":["webpack:///external \"jQuery\"","webpack:///./app/Resources/static-src/app/js/exporter/index.js"],"names":["Export","$exprtBtns","$exportBtns","$modal","$","exportDataEvent","self","on","$exportBtn","$form","data","formData","length","serialize","preUrl","tryUrl","can","tryExport","button","urls","showProgress","exportData","ajax","type","url","async","success","response","notifyError","Translator","trans","message","parameters","find","width","parent","removeClass","$title","setTimeout","modal","progressHtml","html","backdrop","keyboard","fileName","window","location","href","start","get","console","log","status","process","count","download","finish","error","e","responseJSON"],"mappings":"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","file":"app/js/exporter/index.js","sourcesContent":["module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 0\n// module chunks = app/js/main app/js/v2/demo/index app/js/activity-manage/doc/index app/js/activity-manage/download/index app/js/activity-manage/flash/index app/js/activity-manage/homework/index app/js/activity-manage/ppt/index app/js/activity-manage/video/index app/js/article/detail/index app/js/attachment/index app/js/auth/captcha-modal/index app/js/auth/password-reset/index app/js/auth/register/index app/js/batch-upload/index app/js/card/card-receive/index app/js/card/index/index app/js/cashier/index app/js/cashier/modal/index app/js/classroom-manage/set-picture/index app/js/classroom-manage/student-expiryday/index app/js/classroom-manage/student-import/index app/js/classroom-manage/students-create/index app/js/classroom-manage/students-manage/index app/js/classroom/buy-modal/index app/js/classroom/index app/js/classroom/thread-form/index app/js/classroom/thread-show/index app/js/coin/invite-code/index app/js/course-chapter-manage/index app/js/course-manage-file/index/index app/js/course-manage/batch-create/index app/js/course-manage/lesson-manage/default/index app/js/course-manage/lesson-manage/normal/index app/js/course-manage/live-replay/upload/index app/js/course-manage/overview/index app/js/course-manage/student-import/index app/js/course/buy-modal/index app/js/course/thread-show/index app/js/courseset/show/index app/js/exporter/index app/js/group/index app/js/group/logo/index app/js/group/thread-add/index app/js/live-course/explore/index app/js/material-lib/index/index app/js/material-lib/share-history/index app/js/media-manage/index app/js/activity-manage/audio/index app/js/mobile-bind/index app/js/my/order-refund-apply/index app/js/my/order-refund/index app/js/my/order/index app/js/oauth2/create/index app/js/open-course-manage/add-material/index app/js/open-course-manage/lesson-modal/index app/js/open-course/index app/js/open-course/member-sms/index app/js/order/coupon-item/index app/js/order/create-sms/index app/js/order/create/index app/js/pay/select/index app/js/pay/show-mobile-modal/index app/js/player/index app/js/question-manage/form/index app/js/review/list/index app/js/search/index app/js/settings/avatar-crop-modal/index app/js/settings/bind-mobile/index app/js/settings/email/index app/js/settings/find_pay_password_by_sms/index app/js/settings/find-pay-password/index app/js/settings/password/index app/js/settings/pay-password-modal/index app/js/settings/pay-password/index app/js/settings/profile/index app/js/settings/reset-pay-password/index app/js/settings/security-questions/index app/js/settings/security/index app/js/settings/setup-password/index app/js/settings/setup/index app/js/settings/update-pay-password/index app/js/settings/user-profile/index app/js/subject/index app/js/task-manage/create/index app/js/task/plugin/note/index app/js/task/plugin/question/index app/js/testpaper-manage/create/index app/js/testpaper-manage/index app/js/testpaper-manage/questions/index app/js/testpaper/do-test/exercise/index app/js/testpaper/do-test/normal/index app/js/testpaper/result/index app/js/thread/user-info-modal/index app/js/user/fill-info/index app/js/message/show/index","import notify from 'common/notify';\n\nclass Export {\n  constructor($exprtBtns) {\n    this.$exportBtns = $exprtBtns;\n    this.$modal = $('#modal');\n    this.exportDataEvent();\n  }\n\n  exportDataEvent()\n  {\n    let self  = this;\n    self.$exportBtns.on('click', function () {\n      self.$exportBtn = $(this);\n      let $form = $(self.$exportBtn.data('targetForm'));\n      let formData = $form.length > 0 ? $form.serialize() : '';\n      let preUrl = self.$exportBtn.data('preUrl') + '?' + formData;\n      let tryUrl = self.$exportBtn.data('tryUrl') + '?' + formData;\n      let can = self.tryExport(tryUrl);\n      if (!can) {\n        return false;\n      }\n\n      self.$exportBtn.button('loading');\n      let urls = {'preUrl':preUrl, 'url':self.$exportBtn.data('url')};\n      self.showProgress();\n\n      self.exportData(0, '', urls);\n    });\n  }\n\n  tryExport(tryUrl)\n  {\n    let can = true;\n    let self = this;\n    $.ajax({\n      type : 'get',\n      url : tryUrl,\n      async : false,\n      success : function(response){\n        if (!response.success) {\n          self.notifyError(Translator.trans(response.message,response.parameters));\n          can = false;\n        }\n      }\n    });\n\n    return can;\n  }\n\n  finish() {\n    let self = this;\n    self.$modal.find('#progress-bar').width('100%').parent().removeClass('active');\n    let $title = self.$modal.find('.modal-title');\n    setTimeout(function(){\n      notify('success', $title.data('success'));\n      self.$modal.modal('hide');\n    },500);\n\n  }\n\n\n\n\n  showProgress() {\n    let progressHtml = $('#export-modal').html();\n    this.$modal.html(progressHtml);\n    this.$modal.modal({backdrop: 'static', keyboard: false});\n  }\n\n  download(urls, fileName) {\n    if (urls.url && fileName) {\n      window.location.href = urls.url + '?fileName=' + fileName;\n      return true;\n    }\n\n    return false;\n  }\n\n  notifyError(message){\n    this.$modal.modal('hide');\n    notify('warning', message);\n  }\n\n  exportData(start, fileName, urls) {\n    let self = this;\n    let data = {\n      'start': start,\n      'fileName': fileName,\n    };\n\n    $.get(urls.preUrl, data, function (response) {\n      if (!response.success) {\n        console.log(response);\n\n        notify('danger', Translator.trans(response.message));\n        return;\n      }\n\n      if (response.status === 'continue') {\n        let process = response.start * 100 / response.count + '%';\n        self.$modal.find('#progress-bar').width(process);\n        self.exportData(response.start, response.fileName, urls);\n      } else {\n        self.$exportBtn.button('reset');\n        self.download(urls, response.fileName) ?  self.finish() : self.notifyError('unexpected error, try again');\n      }\n    }).error(function(e){\n      notify('danger', e.responseJSON.error.message);\n    });\n  }\n}\n\nnew Export($('.js-export-btn'));\n\n\n// WEBPACK FOOTER //\n// ./app/Resources/static-src/app/js/exporter/index.js"],"sourceRoot":""}